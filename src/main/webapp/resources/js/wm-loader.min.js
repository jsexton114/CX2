var WM=window.angular,wm={};wm.init=function(){"use strict";wm.modules={},wm.plugins={},wm.baseClasses=wm.baseClasses||{}}(),WM.module("wm.layouts.page",[]),WM.module("wm.layouts.containers",[]),WM.module("wm.layouts.device",[]),WM.module("wm.widgets.basic",["toaster"]),WM.module("wm.widgets.form",["ui.mask"]),WM.module("wm.widgets.dialog",["ui.bootstrap.modal"]),WM.module("wm.widgets.grid",[]),WM.module("wm.widgets.live",[]),WM.module("wm.widgets.advanced",["ui.calendar"]),WM.module("wm.prefabs",["wm.widgets.base"]),WM.module("wm.themes",["wm.widgets.base"]),WM.module("wm.layouts",["wm.layouts.page","wm.layouts.containers","wm.layouts.device"]),WM.module("wm.widgets",["wm.widgets.base","wm.widgets.basic","wm.widgets.form","wm.widgets.dialog","wm.widgets.grid","wm.widgets.live","wm.widgets.advanced"]),WM.module("wm.utils",[]).service("Utils",["$rootScope","$location","$window","CONSTANTS","$sce","DialogService","$timeout","$http","$filter","$q",function($rootScope,$location,$window,CONSTANTS,$sce,DialogService,$timeout,$http,$filter,$q){"use strict";function hyphenate(name){return name.replace(REGEX.SNAKE_CASE,function(letter,pos){return(pos?"-":"")+letter.toLowerCase()})}function deHyphenate(name){return name.split("-").join(" ")}function spaceSeparate(name){return name===name.toUpperCase()?name:name.replace(REGEX.SNAKE_CASE,function(letter,pos){return(pos?" ":"")+letter})}function replaceAt(string,index,character){return string.substr(0,index)+character+string.substr(index+character.length)}function periodSeparate(name){var dotIndex;return dotIndex=name.indexOf("."),dotIndex!==-1&&(name=replaceAt(name,dotIndex+1,name.charAt(dotIndex+1).toUpperCase()),name=replaceAt(name,dotIndex," ")),name}function initCaps(name){return name?name.charAt(0).toUpperCase()+name.substring(1):""}function firstCaps(name){return name?name.charAt(0).toUpperCase()+name.slice(1).toLowerCase():""}function prettifyLabel(label){return label=_.camelCase(label),label=initCaps(label),label=spaceSeparate(label),label=periodSeparate(label)}function prettifyLabels(names,separator){var modifiedNames,namesArray=[],isArray=WM.isArray(names);return separator=separator||",",isArray||(namesArray=names.split(separator)),modifiedNames=_.map(namesArray,prettifyLabel),isArray?modifiedNames:modifiedNames.join(separator)}function getVariableName(iScope,scope){if(iScope&&iScope.binddataset){var variableName,widgetScope,widgetName,isBoundToVariable,isBoundToWidget,parts=iScope.binddataset.split(".");return isBoundToVariable=_.includes(iScope.binddataset,"bind:Variables."),isBoundToVariable||(isBoundToWidget=_.includes(iScope.binddataset,"bind:Widgets.")),isBoundToVariable?variableName=parts[1]:isBoundToWidget&&WM.isString(iScope.binddataset)&&""!==iScope.binddataset&&(_.includes(iScope.binddataset,"selecteditem.")?variableName=null:(widgetName=parts[1],widgetScope=(scope||iScope).Widgets[widgetName],variableName=getVariableName(widgetScope))),variableName}}function isValidWebURL(url){return REGEX.VALID_WEB_URL.test(url)}function isValidWebSocketURL(url){return REGEX.VALID_WEBSOCKET_URL.test(url)}function isValidAppServerUrl(url){return REGEX.APP_SERVER_URL_FORMAT.test(url)}function getParentOverlayElZIndex(element){var parentEl,parentOverlay,parentOvleryZIndex;return parentEl=element.parent().closest("[widgetid]"),parentEl.length>0?(parentEl=parentEl.eq(0),parentOverlay=parentEl.data("overlayElement"),parentOvleryZIndex=parentOverlay?parentOverlay.css("zIndex"):parentEl.parent().data("overlayElement")?parseInt(parentEl.parent().data("overlayElement").css("zIndex"),10)+10:10,+parentOvleryZIndex):100}function getValidMarkUp(htmlString,handleValidMarkUp,handleInValidMarkUp){var $htm,$outerEle,$innerEle,newMarkup="",checkValidRootElement=function(ele){return WM.element(ele).is("wm-page, wm-partial, wm-template")};return $htm=WM.element.parseHTML(htmlString),checkValidRootElement($htm[0])?(newMarkup=htmlString,triggerFn(handleValidMarkUp)):(triggerFn(handleInValidMarkUp),$outerEle=WM.element("<div>"+htmlString+"</div>"),$innerEle=$outerEle.find("wm-page, wm-partial, wm-template"),$innerEle.length>0&&(newMarkup=$innerEle[0].outerHTML)),newMarkup}function formatVariableIconClass(variableCategory){return variableCategoryMap[variableCategory]}function pushFieldDef(dataObject,columnDefObj,namePrefix,options){var modifiedTitle,relatedTable,relatedField,relatedInfo,fieldName,isRelated;options||(options={}),WM.forEach(dataObject,function(value,title){_.includes(title,".")&&(relatedInfo=_.split(title,"."),relatedTable=relatedInfo[0],relatedField=relatedInfo[1],isRelated=!0),options.noModifyTitle?modifiedTitle=title:WM.isString(title)?(modifiedTitle=prettifyLabel(title),modifiedTitle=deHyphenate(modifiedTitle),modifiedTitle=namePrefix?initCaps(namePrefix)+" "+modifiedTitle:modifiedTitle):modifiedTitle=title,title=namePrefix?namePrefix+"."+title:title,isRelated?(fieldName=_.split(modifiedTitle," "),fieldName=fieldName.length>1?fieldName[fieldName.length-2]+" "+fieldName[fieldName.length-1]:fieldName[0]):fieldName=modifiedTitle;var defObj=options.setBindingField?{displayName:fieldName,field:title,relatedTable:relatedTable,relatedField:relatedField||modifiedTitle}:{displayName:fieldName,relatedTable:relatedTable,relatedField:relatedField||modifiedTitle};if(!WM.isObject(value)||WM.isArray(value)&&!value[0]){if(options.upperBound&&options.columnCount===options.upperBound)return;columnDefObj.terminals.push(defObj),options.columnCount+=1}else options.columnCount!==options.upperBound&&columnDefObj.objects.push(defObj),WM.isArray(value)&&value[0]?pushFieldDef(value[0],columnDefObj,title+"[0]",options):pushFieldDef(value,columnDefObj,title,options)})}function getMetaDataFromData(data){var dataObject;return WM.isArray(data)?WM.isObject(data[0])?(dataObject=getClonedObject(data[0]),_.forEach(data,function(row,index){return!(index+1>=CONSTANTS.DATA_SEARCH_LIMIT)&&void _.assignWith(dataObject,row,function(objValue,srcValue){return null===objValue||void 0===objValue?srcValue:objValue})})):dataObject=data[0]:dataObject=data,dataObject}function prepareFieldDefs(data,options){var dataObject,columnDef={objects:[],terminals:[]};if(data||(data=[]),options||(options={}),options.setBindingField=!0,options.columnCount=0,dataObject=getMetaDataFromData(data),pushFieldDef(dataObject,columnDef,"",options),!options||options&&!options.filter)return columnDef.terminals;switch(options.filter){case"all":return columnDef;case"objects":return columnDef.objects;case"terminals":return columnDef.terminals}return columnDef}function swapArrayElements(array,index1,index2){var temp=array[index1];return array[index1]=array[index2],array[index2]=temp,array}function swapProperties(data,property1,property2){var temp=data[property1];data[property1]=data[property2],data[property2]=temp}function triggerFn(fn){var start=1,len=arguments.length,args=new Array(len-start);for(start;start<len;start++)args[start-1]=arguments[start];if(WM.isFunction(fn))return fn.apply(null,args)}function isStyleSheetLoaded(href){return WM.element('link[href="'+href+'"]').length>0}function removeStyleSheetLoaded(href){var styleTag=WM.element('link[href="'+href+'"]');styleTag.length&&styleTag.remove()}function loadStyleSheet(url,attr){if(!isStyleSheetLoaded(url)){var link=linkEl.cloneNode();return link.href=url,attr&&attr.name&&link.setAttribute(attr.name,attr.value),headNode.appendChild(link),link}}function loadStyleSheets(urlArray){urlArray&&(WM.isArray(urlArray)||(urlArray=[urlArray]),WM.forEach(urlArray,loadStyleSheet))}function isScriptLoaded(src){return WM.element('script[src="'+src+'"]').length>0||WM.element('script[data-src="'+src+'"]').length>0}function fetchContent(dataType,url,successCallback,errorCallback,inSync){if(inSync&&window.nativeXMLHTTP){var response,xhr=new window.nativeXMLHTTP;xhr.open("GET",url,!1),xhr.onload=function(){4===xhr.readyState&&(200===xhr.status?(response=xhr.responseText,"json"===dataType&&(response=JSON.parse(xhr.responseText)),successCallback(response)):errorCallback())},xhr.send()}else WM.element.ajax({type:"get",dataType:dataType,url:url,success:successCallback,error:errorCallback,async:!inSync})}function loadScripts(scripts,onsuccess,onerror,hasError,jqxhr){if(!scripts||0===scripts.length)return void(hasError?triggerFn(onerror,jqxhr):triggerFn(onsuccess,jqxhr));var url=scripts.shift();return isScriptLoaded(url)?void loadScripts(scripts,onsuccess,onerror):void WM.element.getScript(url).done(function(script,textStatus,jqxhr){loadScripts(scripts,onsuccess,onerror,!1,jqxhr)}).fail(function(jqxhr){loadScripts([],onsuccess,onerror,!0,jqxhr)})}function loadScriptsInSync(urlArray){if(0!==urlArray.length){var url=urlArray.shift();!isScriptLoaded(url)&&url&&url&&fetchContent("text",url,function(response){var script=scriptEl.cloneNode();script.text=response,script.setAttribute("data-src",url),headNode.appendChild(script),loadScriptsInSync(urlArray)},null,!0)}}function isImageFile(fileName){return REGEX.SUPPORTED_IMAGE_FORMAT.test(fileName)}function isZipFile(fileName){return REGEX.ZIP_FILE.test(fileName)}function isExeFile(fileName){return REGEX.EXE_FILE.test(fileName)}function isTextLikeFile(fileName){return REGEX.SUPPORTED_FILE_FORMAT.test(fileName)}function isAudioFile(fileName){return REGEX.SUPPORTED_AUDIO_FORMAT.test(fileName)}function isVideoFile(fileName){return REGEX.SUPPORTED_VIDEO_FORMAT.test(fileName)}function isPageResource(path){return REGEX.PAGE_RESOURCE_PATH.test(path)&&!REGEX.MIN_PAGE_RESOURCE_PATH.test(path)}function isAndroid(){return REGEX.ANDROID.test(userAgent)}function isAndroidPhone(){return isAndroid()&&REGEX.MOBILE.test(userAgent)}function isIphone(){return REGEX.IPHONE.test(userAgent)}function isIpod(){return REGEX.IPOD.test(userAgent)}function isIpad(){return REGEX.IPAD.test(userAgent)}function isIOS(){return isIphone()||isIpod()||isIpad()}function isAndroidTablet(){return REGEX.ANDROID_TABLET.test(userAgent)}function isTablet(){return isIpad()||isAndroidTablet()}function isWindowsPhone(){return REGEX.WINDOWS.test(userAgent)}function isMobile(){return!!CONSTANTS.isRunMode&&(isAndroidPhone()||isIphone()||isIpod()||isIpad()||isAndroidTablet()||isWindowsPhone()||WM.element("#wm-mobile-display:visible").length>0)}function isValidJavaPackageName(pkgName){return pkgName.match(/^\w[\w\d_.]*[\w\d]$/)}function isQuoteNotPresent(str){return REGEX.NO_QUOTES_ALLOWED.test(str)}function isNoDoubleQuoteNotPresent(str){return REGEX.NO_DOUBLE_QUOTES_ALLOWED.test(str)}function isValidHtml(str){return REGEX.VALID_HTML.test(str)}function hasSpecialCharacters(str){return REGEX.SPECIAL_CHARACTERS.test(str)}function encodeUrlParams(url){var queryParams,queryParamsString,index,encodedParams="";return index=url.indexOf("?"),index>-1&&(index+=1,queryParamsString=url.substring(index),queryParamsString&&(queryParams=queryParamsString.split("&"),_.forEach(queryParams,function(param){var index=param.indexOf("="),paramName=param.substr(0,index),paramValue=param.substr(index+1);encodedParams+=paramName+"="+encodeURIComponent(paramValue)+"&"}),encodedParams=encodedParams.slice(0,-1),url=url.replace(queryParamsString,encodedParams))),url}function encodeUrl(url){var index=url.indexOf("?");return index>-1?(url=encodeURI(url.substring(0,index))+url.substring(index),url=encodeUrlParams(url)):url=encodeURI(url),url}function getImageUrl(urlString,shouldEncode){return CONSTANTS.isRunMode?shouldEncode?encodeUrl(urlString):urlString:isValidWebURL(urlString)?urlString:(isImageFile(urlString)||(urlString="resources/images/imagelists/default-image.png"),stringStartsWith(urlString,"services/prefabs")?urlString:urlString=getProjectResourcePath($rootScope.project.id)+urlString)}function getResourceURL(urlString){return isValidWebURL(urlString)?$sce.trustAsResourceUrl(urlString):CONSTANTS.isRunMode?urlString:stringStartsWith(urlString,"services/prefabs")?urlString:urlString=getProjectResourcePath($rootScope.project.id)+urlString}function getBackGroundImageUrl(urlString){return""===urlString||"none"===urlString?urlString:"url("+getImageUrl(urlString)+")"}function stringStartsWith(str,startsWith,ignoreCase){if(!str)return!1;var regEx=new RegExp("^"+startsWith,ignoreCase?"i":[]);return regEx.test(str)}function stringEndsWith(str,endsWith,ignoreCase){if(!str)return!1;var regEx=new RegExp(endsWith+"$",ignoreCase?"i":[]);return regEx.test(str)}function isEmptyObject(obj){return!(!WM.isObject(obj)||WM.isArray(obj))&&0===Object.keys(obj).length}function isValidEmail(email){return REGEX.VALID_EMAIL.test(email)}function isValidPassword(text){return!!REGEX.VALID_PASSWORD.test(text)}function isValidFieldName(fieldName){return/^[0-9a-zA-Z_\$]+$/.test(fieldName)}function getPropertyNode(prop){return{type:prop.type,isPrimaryKey:prop.isPrimaryKey,generator:prop.generator,isRelatedPk:prop.isRelatedPk,systemUpdated:prop.systemUpdated,systemInserted:prop.systemInserted,relatedEntityName:prop.relatedEntityName,notNull:prop.notNull,defaultValue:prop.defaultValue}}function checkSpecialCharacters(str){return hasSpecialCharacters(str)?(_.includes(str,"'")&&(str=str.replace(/'/g,"\\'")),str="['"+str+"']"):str}function fetchPropertiesMapColumns(propertiesMap,namePrefix,options){var info,objects={},relatedColumnsArr=[],terminals={},columns=getClonedObject(propertiesMap.columns);if(_.forEach(columns,function(val){if(val.isRelated){if(val.isList)return;relatedColumnsArr.push(val)}else{var columnName=namePrefix?namePrefix+"."+val.fieldName:val.fieldName;terminals[columnName]=getPropertyNode(val),propertiesMap.isRelated&&(terminals[columnName].notNull=propertiesMap.notNull&&val.notNull&&val.isPrimaryKey)}}),_.forEach(relatedColumnsArr,function(val){if(_.isEmpty(val.columns)){var relColumnName=namePrefix?namePrefix+"."+val.relatedColumnName:val.relatedColumnName;return void(terminals[relColumnName]=getPropertyNode(val))}_.forEach(val.columns,function(col){val.isRelated&&(col.isPrimaryKey&&(col.isRelatedPk="true"),col.relatedEntityName=val.relatedEntityName)});var columnName=namePrefix?namePrefix+"."+val.fieldName:val.fieldName;if(objects[columnName]=getPropertyNode(val),info=fetchPropertiesMapColumns(val,val.fieldName,options),!options||options&&!options.filter)_.assignWith(terminals,info,function(objValue,srcValue){return _.isUndefined(objValue)?srcValue:objValue});else switch(options.filter){case"all":WM.extend(terminals,info.terminals),WM.extend(objects,info.objects);break;case"objects":WM.extend(objects,info);break;case"terminals":WM.extend(terminals,info)}}),!options||options&&!options.filter)return terminals;switch(options.filter){case"all":return{objects:objects,terminals:terminals};case"objects":return objects;case"terminals":return terminals}}function resetObjectWithEmptyValues(object){var properties;return object&&(properties={},WM.forEach(object,function(value,key){properties[key]=""})),properties}function getCurrentPage(){var pathName=location.pathname;return pathName.split("/").pop()||"index.html"}function isDebugMode(){return getCurrentPage().indexOf("-debug")!==-1}function getIndexPage(){return isDebugMode()?"index-debug.html":"index.html"}function redirectToIndexPage(path){path?$window.location=indexPage+"#"+path:$window.location=indexPage}function redirectToLoginPage(){var locationHash=$location.$$path,currentPageName=getCurrentPage();browserStorage.storeItem("wm.referenceUrlToStudio",currentPageName+"#"+locationHash),$window.location=CONSTANTS.LOGIN_PAGE}function handleUploadIFrameOnLoad(iFrameElement,successCallback,errorCallback,evt){var serverResponse;iFrameElement.off("load",handleUploadIFrameOnLoad),serverResponse=WM.element("#fileUploadIFrame").contents().find("body").text(),evt&&evt.currentTarget&&(evt.currentTarget.responseText=serverResponse),iFrameElement.first().remove(),serverResponse.errorDetails?triggerFn(errorCallback):triggerFn(successCallback,evt)}function fileUploadFallback(uploadConfig,successCallback,errorCallback){var formElement,formAction,dataArray,index,dataObj,dataElement,elementName,elementValue,key,iFrameElement=WM.element('<iframe id="fileUploadIFrame" name="fileUploadIFrame" class="ng-hide"></iframe>');if(uploadConfig&&(formAction=uploadConfig.url),WM.element("body").append(iFrameElement),iFrameElement.on("load",function(evt){handleUploadIFrameOnLoad(iFrameElement,successCallback,errorCallback,evt)}),formElement=WM.element("*[name="+uploadConfig.formName+"]").first(),uploadConfig.data)for(dataArray=uploadConfig.data,index=0;index<dataArray.length;index+=1){dataObj=dataArray[index];for(key in dataObj)dataObj.hasOwnProperty(key)&&(elementName=key,elementValue=dataObj[key]);dataElement=WM.element('<input type="hidden" name="'+elementName+'" value="'+elementValue+'"/>'),formElement.append(dataElement)}formElement.attr({target:"fileUploadIFrame",action:formAction,method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"}),formElement.submit()}function findValueOf(obj,key,create){if(obj&&key){if(!create)return _.get(obj,key);var skipProcessing,parts=key.split("."),keys=[];if(_.forEach(parts,function(part){if(!parts.length)return skipProcessing=!0,!1;for(var subPart,subParts=part.match(/\w+/g);subParts.length;)subPart=subParts.shift(),keys.push({key:subPart,value:subParts.length?[]:{}})}),!skipProcessing)return _.forEach(keys,function(_key){var tempObj=obj[_key.key];WM.isObject(tempObj)||(tempObj=getValidJSON(tempObj),tempObj||(tempObj=_key.value)),obj[_key.key]=tempObj,obj=tempObj}),obj}}function replace(template,map){if(template)return template.replace(REGEX.REPLACE_PATTERN,function(match,key){return _.get(map,key)})}function getLoadedPrefabNames(){return WM.element("[prefabname]").map(function(){return WM.element(this).attr("prefabname")})}function initializeAction(op,callback){var img=new Image;img.onload=function(){triggerFn(callback)},img.onerror=function(){triggerFn(callback)}}function getNodeFromJson(tree,nodeId,parentNodeId){var nodeUId,parentNodeUId,nodeIndex,nodeStartIndex,node;if(WM.element.each(tree[0].nodeMap,function(uid,name){if(name===nodeId){if(nodeUId=uid,!parentNodeId)return!1;if(parentNodeUId=nodeUId.substr(0,nodeUId.lastIndexOf("-")),tree[0].nodeMap[parentNodeUId]===parentNodeId)return!1}}),nodeUId)return nodeIndex=nodeUId.split("-"),nodeStartIndex=nodeIndex.shift(),node=tree[nodeStartIndex],nodeIndex.forEach(function(index){node=node.children[index]}),node}function addNodeToJson(tree,nodeId,parentNodeUId,options,parentNodeId){options=options||{};var parentIndex,parentStartIndex,parentNode,existingNode,node={id:nodeId,label:options.label,collapsed:options.collapsed,class:options.class,active:options.active,props:options.nodeProps,isDeletable:options.isDeletable,title:options.title,onDelete:options.onDelete,hasChildren:options.hasChildren,deepSearch:options.deepSearch};if(!WM.isUndefined(tree)){if(WM.isUndefined(parentNodeUId)&&WM.isUndefined(parentNodeId)?parentNode=tree[0]:(parentNodeId&&!parentNodeUId&&(parentNodeUId=getNodeFromJson(tree,parentNodeId).uid),parentIndex=parentNodeUId.split("-"),parentStartIndex=parentIndex.shift(),parentNode=tree[parentStartIndex],parentIndex.forEach(function(index){parentNode=parentNode.children[index]})),!parentNode)return node.uid="0",node.nodeMap={0:node.id},tree.push(node),node;if(parentNode.children&&WM.isArray(parentNode.children)){if(existingNode=getNode(parentNode.children,nodeId))return existingNode}else parentNode.children=[];return node.uid=parentNode.uid+"-"+parentNode.children.length,parentNode.children.push(node),tree[0].nodeMap[node.uid]=nodeId,node}}function removeJsonNodeChildren(tree,nodeId,parentNodeId){var node=getNodeFromJson(tree,nodeId,parentNodeId);node&&(node.children=void 0)}function getValidJSON(content){if(!content)return!1;try{var parsedIntValue=parseInt(content,10);return WM.isObject(content)||!isNaN(parsedIntValue)?content:JSON.parse(content)}catch(e){return!1}}function prettifyJS(content){return window.js_beautify?window.js_beautify(content):(loadScriptsInSync(["_static_/components/js-beautify/js/lib/beautify.js"]),window.js_beautify(content))}function prettifyHTML(content){return window.html_beautify?window.html_beautify(content):(loadScriptsInSync(["_static_/components/js-beautify/js/lib/beautify-html.js"]),window.html_beautify(content))}function prettifyCSS(content){return window.css_beautify?window.css_beautify(content):(loadScriptsInSync(["_static_/components/js-beautify/js/lib/beautify-css.js"]),window.css_beautify(content))}function getActionFromKey(event){var ctrlOrMetaKey=isAppleProduct?event.metaKey:event.ctrlKey,shiftKey=event.shiftKey,altKey=event.altKey;if(isAppleProduct){if(8===event.which)return"DELETE";if(event.metaKey&&91===event.which)return"DB-FIND"}else{if(46===event.which)return"DELETE";if(event.ctrlKey&&70===event.which)return"DB-FIND"}if(ctrlOrMetaKey)switch(event.which){case 80:return altKey?"PREVIEW":"UNKNOWN";case 81:return altKey?"RUN-DEBUG":"UNKNOWN";case 82:return altKey?"RUN":"UNKNOWN";case 68:return altKey?"DEPLOY":"UNKNOWN";case 83:return"SAVE";case 88:return"CUT";case 67:return"COPY";case 86:return"PASTE";case 90:return event.shiftKey?"REDO":"UNDO";case 37:return"CTRL-LEFT-ARROW";case 38:return"CTRL-UP-ARROW";case 39:return"CTRL-RIGHT-ARROW";case 40:return"CTRL-DOWN-ARROW"}else if(shiftKey)switch(event.which){case 37:return"SHIFT+LEFT";case 38:return"SHIFT+UP";case 39:return"SHIFT+RIGHT";case 40:return"SHIFT+DOWN"}else switch(event.which){case 8:return"BACKSPACE";case 13:return"ENTER";case 27:return"ESC";case 37:return"LEFT-ARROW";case 38:return"UP-ARROW";case 39:return"RIGHT-ARROW";case 40:return"DOWN-ARROW"}return"UNKNOWN"}function preventCachingOf(url){return url}function getAllKeysOf(obj,prefix){var keys=[];return prefix=prefix?prefix+".":"",WM.isObject(obj)&&!WM.isArray(obj)&&Object.keys(obj).forEach(function(key){keys.push(prefix+key),keys=keys.concat(getAllKeysOf(obj[key],prefix+key))}),keys}function getService(serviceName){if(serviceName){var injector,appEl=WM.element("[id=ng-app]");if(appEl)try{if(injector=appEl.injector())return injector.get(serviceName)}catch(e){return}}}function removeProtocol(url){var newUrl;return newUrl=url.indexOf("http")!==-1?url.indexOf("https:")!==-1?url.substr(6):url.substr(5):url}function getCookieByName(name){var cookiesArray=document.cookie.split("; "),cookies={};if(_.some(cookiesArray,function(cookie){var index=cookie.indexOf("="),cookieName=cookie.substr(0,index),cookieValue=cookie.substr(index+1);if(cookies[cookieName]=cookieValue,cookieName===name)return!0}))return decodeURIComponent(cookies[name])}function isPageable(obj){var pageable={content:[],first:!0,last:!0,number:0,numberOfElements:10,size:20,sort:null,totalElements:10,totalPages:1};return WM.equals(_.keys(pageable),_.keys(obj).sort())}function isFileUploadSupported(){return window.File&&window.FileReader&&window.FileList&&window.Blob}function processMarkup(markupStr){if(!markupStr)return"";markupStr=getValidMarkUp(markupStr);var content=markupStr.replace(/>\s+</g,"><"),root=WM.element("<div></div>");return CONSTANTS.isRunMode&&(root.html(content).find("wm-livelist, wm-login, wm-template").each(function(){var wrapper,widget=WM.element(this),ctrlName=widget.attr("data-ng-controller")||widget.attr("ng-controller");ctrlName&&(wrapper=WM.element('<div class="app-controller"></div>').attr("data-ng-controller",ctrlName),widget.removeAttr("data-ng-controller ng-controller").wrap(wrapper))}),content=root[0].innerHTML),content}function isDateTimeType(type){return _.includes(type,".")&&(type=_.toLower(extractType(type))),_.includes(["date","time","timestamp","datetime","localdatetime"],type)}function getDataSetWidgets(){return dataSetWidgets}function getDaysOptions(){return daysOptions}function getDateTimeDefaultFormats(){return DEFAULT_FORMATS}function getDateTimeFormatForType(type){return DEFAULT_FORMATS[_.toUpper(type)]}function isValidDataSet(dataset){return WM.isArray(dataset)&&dataset.length>0||WM.isObject(dataset)&&Object.keys(dataset).length>0}function parseCombinedPageContent(pageContent,pageName){var pageDom=WM.element("<div>"+pageContent+"</div>"),htmlEle=pageDom.find('script[id="'+pageName+'.html"]'),variableContext="_"+pageName+"Page_Variables_";htmlEle.remove(),CONSTANTS.isStudioMode&&WM.element('script[id="'+pageName+'.css"]').remove();try{WM.element("head").append(pageDom.find("style, script"))}catch(e){console.log(e.message)}return{html:htmlEle.html()||"",variables:window[variableContext]||{}}}function extractType(typeRef){return typeRef?typeRef&&typeRef.substring(typeRef.lastIndexOf(".")+1):"string"}function isNumberType(type){return NUMBER_TYPES.indexOf(extractType(type).toLowerCase())!==-1}function isDeleteResourceAllowed(context,path){return!SYSTEM_FOLDER_PATHS[context]||SYSTEM_FOLDER_PATHS[context].indexOf(path)===-1}function random(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function generateGUId(){return random()+"-"+random()+"-"+random()}function isDuplicateName(list,newName,caseSensitive){var i,retVal=!1;if(!list||!newName)return retVal;if(caseSensitive){for(i=0;i<list.length;i+=1)if(list[i].toLowerCase()===newName.toLowerCase()){retVal=!0;break}}else list.indexOf(newName)!==-1&&(retVal=!0);return retVal}function scrollIntoView(element,container,offSetParent){var elemBottom,$parent,$container=WM.element(container),$element=WM.element(element),containerTop=$container.scrollTop(),containerHeight=$container.height(),containerBottom=containerTop+containerHeight,elemTop=$element[0]&&$element[0].offsetTop;offSetParent&&($parent=$element.parents(offSetParent),$parent.length&&(elemTop=elemTop+$parent[0].offsetTop+$element.height())),elemBottom=elemTop+$element.height(),elemTop<containerTop?$container.scrollTop(elemTop):elemBottom>containerBottom&&$container.scrollTop(elemBottom-containerHeight)}function arraysEqual(arr1,arr2){var i;if(arr1.length!==arr2.length)return!1;for(i=0;i<arr1.length;i++)if(arr1[i]!==arr2[i])return!1;return!0}function getNewEventsObject(prefix,events,args){var newEventName,newCustomEvent,eventNumber=0,customEvents=[];return _.forEach(events,function(event,index){if("Javascript"===event){for(newCustomEvent=prefix,newEventName=newCustomEvent+args;_.includes(events,newEventName);)eventNumber+=1,newCustomEvent=prefix+eventNumber,newEventName=newCustomEvent+args;events[index]=newEventName,customEvents=customEvents.concat(newCustomEvent)}}),{events:events,customEvents:customEvents}}function getEvaluatedExprValue(object,expression,scope){var val;return val=_.attempt(function(){return scope.$eval(expression,object)}),_.isError(val)&&(val=_.get(object,expression)||_.get(scope,expression)),val}function getProjectResourcePath(projectId){return"services/projects/"+projectId+"/resources/content/web/"}function getVariableNameFromExpr(expr){var variableRegex=/^bind:Variables\.(.*)\.dataSet/,matchValue=expr.match(variableRegex);return matchValue&&matchValue[1]}function getClonedObject(object){return _.cloneDeep(object)}function getValidDateObject(val){return WM.isDate(val)?val:(isNaN(val)?new Date(val).getTime()||(val=moment().format("YYYY-MM-DD")+" "+val):val=parseInt(val,10),new Date(moment(val).valueOf()))}function getMatchModes(){return{start:"start",end:"end",anywhere:"anywhere",exact:"exact"}}function updateTmplAttrs($root,parentDataSet,name){var currentItemRegEx,currentItemWidgetsRegEx,_parentDataSet=parentDataSet.replace("bind:",""),regex=new RegExp("("+_parentDataSet+")(\\[0\\])?(.data\\[\\$i\\])?(.content\\[\\$i\\])?(\\[\\$i\\])?","g");name&&(currentItemRegEx=new RegExp("(Widgets."+name+".currentItem)\\b","g"),currentItemWidgetsRegEx=new RegExp("(Widgets."+name+".currentItemWidgets)\\b","g")),$root.find("*").each(function(){var node=this;_.forEach(node.attributes,function(attr){var value=attr.value;_.startsWith(value,"bind:")&&(_.includes(value,_parentDataSet)&&value!=="bind:"+_parentDataSet&&(value=value.replace("bind:",""),value=value.replace(regex,"item"),value="bind:"+value),currentItemRegEx&&currentItemRegEx.test(value)&&(value=value.replace(currentItemRegEx,"item")),currentItemWidgetsRegEx&&currentItemWidgetsRegEx.test(value)&&(value=value.replace(currentItemWidgetsRegEx,"currentItemWidgets")),attr.value=value)})})}function sort(collection,key,caseSensitive){return _.sortBy(collection,function(item){if(item)return key?item[key]&&!caseSensitive&&item[key].toLowerCase?item[key].toLowerCase():item[key]:!caseSensitive&&item.toLowerCase?item.toLowerCase():item})}function evalExp(scope,evtValue){var d=$q.defer();if(_.includes(evtValue,"Variables.")){var parts=evtValue.split(".");evtValue=parts[0]+'["'+parts[1]+'"].'+parts[2]}return $timeout(function(){_.startsWith(evtValue,"Variables")||_.startsWith(evtValue,"Widgets.")||!_.includes(evtValue,".")?scope.$eval(evtValue):$rootScope.$emit("invoke-service",evtValue),d.resolve()}),d.promise}function triggerCustomEvents(event,customEvents,callBackScope,data,variable,info){var retVal,firstArg=variable||event;return _.forEach(_.split(customEvents,";"),function(eventValue){return"Javascript"===eventValue&&(retVal=triggerFn(callBackScope[variable&&variable.name+event],firstArg,data,info)),_.startsWith(eventValue,"Widgets.")||_.startsWith(eventValue,"Variables.")?void evalExp(callBackScope,eventValue):void(_.includes(eventValue,"(")?retVal=triggerFn(callBackScope[eventValue.substring(0,eventValue.indexOf("("))],firstArg,data,info):$timeout(function(){$rootScope.$emit("invoke-service",eventValue,{scope:callBackScope}),$rootScope.$safeApply(callBackScope)},null,!1))}),retVal}function setParamsFromURL(queryParams,params){queryParams=_.split(queryParams,"&"),_.forEach(queryParams,function(param){param=_.split(param,"="),params[param[0]]=decodeURIComponent(_.join(_.slice(param,1),"="))})}function simulateFileDownload(requestParams){var iFrameElement,formEl,paramElement,queryParams="",IFRAME_NAME="fileDownloadIFrame",FORM_NAME="fileDownloadForm",CONTENT_TYPE="Content-Type",url=requestParams.url,encType=_.get(requestParams.headers,CONTENT_TYPE),params=_.pickBy(requestParams.headers,function(val,key){return key!==CONTENT_TYPE}),WS_CONSTANTS=getService("WS_CONSTANTS");return CONSTANTS.hasCordova?void window.open(url,"_system"):(iFrameElement=$(IFRAME_NAME),iFrameElement.length&&iFrameElement.first().remove(),iFrameElement=WM.element('<iframe id="'+IFRAME_NAME+'" name="'+IFRAME_NAME+'" class="ng-hide"></iframe>'),formEl=WM.element('<form id="'+FORM_NAME+'" name="'+FORM_NAME+'"></form>'),formEl.attr({target:iFrameElement.attr("name"),action:url,method:requestParams.method,enctype:encType}),queryParams+=url.indexOf("?")!==-1?url.substring(url.indexOf("?")+1):"",queryParams+=encType===WS_CONSTANTS.CONTENT_TYPES.FORM_URL_ENCODED?(queryParams?"&":"")+requestParams.dataParams:"",_.includes(WS_CONSTANTS.NON_BODY_HTTP_METHODS,_.toUpper(requestParams.method))&&setParamsFromURL(queryParams,params),setParamsFromURL(requestParams.data,params),_.forEach(params,function(val,key){paramElement=WM.element('<input type="hidden">'),paramElement.attr({name:key,value:val}),formEl.append(paramElement)}),WM.element("body").append(iFrameElement),void $timeout(function(){iFrameElement.contents().find("body").append(formEl),formEl.submit()},100))}function getWidgetRolesArrayFromStr(val){var UNICODE_COMMA_REGEX=/&#44;/g;return val=val||"",""===val?[]:_.split(val,",").map(function(v){return _.trim(v).replace(UNICODE_COMMA_REGEX,",")})}function setNodeContent(nodeRef,content){WM.isObject(content)?nodeRef.text(JSON.stringify(content)):nodeRef.html($sce.trustAs($sce.HTML,(WM.isDefined(content)?content:"").toString()).toString())}function getOrderByExpr(pageableObj){pageableObj=pageableObj||[];var expr="",KEY_VAL_SEPARATOR=" ",FIELD_SEPARATOR=",";return _.forEach(pageableObj,function(obj,index){expr+=obj.property+KEY_VAL_SEPARATOR+obj.direction.toLowerCase()+(index>0&&index<pageableObj.length-1?FIELD_SEPARATOR:"")}),expr}function xmlToJson(xmlString,includeRoot){var json=new X2JS({emptyNodeForm:"content",attributePrefix:"",enableToStringFunc:!1}).xml_str2json(xmlString);return!includeRoot&&json&&(json=_.get(json,Object.keys(json)[0])),
json}function getTypes(type){var types=[];return"form-widgets"===type?types=["wm-label","wm-text","wm-checkbox","wm-checkboxset","wm-radio","wm-radioset","wm-textarea","wm-select","wm-chips","wm-button","wm-picture","wm-anchor","wm-popover","wm-date","wm-calendar","wm-time","wm-datetime","wm-currency","wm-colorpicker","wm-slider","wm-fileupload","wm-grid","wm-livefilter","wm-livelist","wm-datanavigator","wm-html","wm-prefab","wm-richtexteditor","wm-search","wm-menu","wm-switch","wm-nav","wm-tree","wm-liveform","wm-rating","wm-camera","wm-barcodescanner","wm-mobile-navbar ","wm-chart","wm-view","wm-form","wm-carousel","wm-media-list"]:"page-container-widgets"===type?types=["wm-accordionpane","wm-container","wm-panel","wm-tabcontent","wm-footer","wm-header","wm-left-panel","wm-right-panel","wm-top-nav","wm-cardcontent","wm-wizardstep","wm-tabpane"]:"dialog-widgets"===type?types=["wm-dialog","wm-alertdialog","wm-confirmdialog","wm-iframedialog","wm-pagedialog","wm-logindialog"]:"spinner-widgets"===type&&(types=["wm-checkboxset","wm-radioset","wm-calendar","wm-grid","wm-livefilter","wm-livelist","wm-tree","wm-liveform","wm-chart","wm-view","wm-form","wm-carousel","wm-media-list","wm-accordionpane","wm-container","wm-panel","wm-tabcontent","wm-left-panel","wm-right-panel","wm-top-nav","wm-cardcontent","wm-wizardstep","wm-tabpane"]),types}function openDialog(dialogId,dialogScope,params){if(!dialogScope){var $scriptEl=WM.element('script[id="'+dialogId+'"]'),isCommonDialog=WM.element('[id="wm-common-content"]').find($scriptEl).length,parentPageScope=$scriptEl.closest('[data-role="pageContainer"]').scope(),isPrefabDialog=parentPageScope&&parentPageScope.prefabname;isPrefabDialog?dialogScope=parentPageScope:isCommonDialog||(dialogScope=$scriptEl.closest('[data-role="partial"]').scope()||parentPageScope)}DialogService.open(dialogId,dialogScope,params)}function convertToArray(val){if(WM.isDefined(val))return""===val?val:WM.isArray(val)?val:WM.isString(val)?_.split(val,",").map(function(opt){return(""+opt).trim()}):[val]}function loadActiveTheme(){var themeName=$rootScope.project.activeTheme||CONSTANTS.DEFAULT_THEME;$rootScope.activeTheme=themeName,WM.element('link[theme="wmtheme"]').remove(),$rootScope.isMobileApplicationType&&(themeName+="/android"),loadStyleSheet(getProjectResourcePath($rootScope.project.id)+"themes/"+themeName+"/style.css",{name:"theme",value:"wmtheme"})}function isInsecureContentRequest(url){var parser=document.createElement("a");return parser.href=url,""!==parser.protocol&&(!!stringStartsWith($location.$$absUrl,"https://")&&("https:"!==parser.protocol&&"wss:"!==parser.protocol))}function addDefaultHeaders(xhr){xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");var xsrfCookieValue=getCookieByName($http.defaults.xsrfCookieName);xsrfCookieValue&&xhr.setRequestHeader($http.defaults.xsrfHeaderName,xsrfCookieValue)}function _formatDate(dateValue,type){var epoch;return WM.isDate(dateValue)?epoch=dateValue.getTime():(isNaN(dateValue)||(dateValue=parseInt(dateValue,10)),epoch=moment(dateValue).valueOf()),"timestamp"===type?epoch:("time"!==type||epoch||(epoch=moment((new Date).toDateString()+" "+dateValue).valueOf()),dateValue&&$filter("date")(epoch,getDateTimeFormatForType(type)))}function formatDate(value,type){return _.includes(type,".")&&(type=_.toLower(extractType(type))),WM.isArray(value)?_.map(value,function(val){return _formatDate(val,type)}):_formatDate(value,type)}function getBlob(val,valContentType){var valConstructorType=_.toLower(_.get(val,"constructor.name"));return"string"===valConstructorType||"number"===valConstructorType?val=new Blob([val],{type:valContentType||"text/plain"}):"object"===valConstructorType&&getValidJSON(val)&&(val=new Blob([WM.toJson(val)],{type:valContentType||"application/json"})),val}function formatStyle(val,format,forceFormat){var styleRegExp=/px|em|rem|pt|%/g;return val||(val=""),forceFormat?val=styleRegExp.replace(val,""):styleRegExp.test(val)||(val+=format||"px"),val}function getFormData(formData,param,paramValue){var paramType=_.toLower(_.get(param,"items.type")||param.type),paramContentType=CONSTANTS.isStudioMode?param["x-WM-CONTENT_TYPE"]:param.contentType;if(isFileUploadSupported())return"string"!==paramType||"string"!==paramContentType&&paramContentType?WM.isArray(paramValue)&&"file"===paramType?WM.forEach(paramValue,function(fileObject){formData.append(param.name,getBlob(fileObject),fileObject.name)}):formData.append(param.name,getBlob(paramValue,paramContentType),paramValue&&paramValue.name):(WM.isObject(paramValue)&&(paramValue=JSON.stringify(paramValue)),formData.append(param.name,paramValue)),formData}function validateAccessRoles(roleExp){var roles;return!(roleExp&&$rootScope.userRoles&&CONSTANTS.isRunMode)||(roles=_.split(roleExp,",").map(Function.prototype.call,String.prototype.trim),_.intersection(roles,$rootScope.userRoles).length)}function listenOnce($s,event,callBack){var deregisterEvent=$s.$on(event,function(){deregisterEvent(),callBack&&callBack.apply(void 0,arguments)});return deregisterEvent}var userAgent=navigator.userAgent,scriptEl=document.createElement("script"),linkEl=document.createElement("link"),headNode=document.getElementsByTagName("head")[0],isAppleProduct=/Mac|iPod|iPhone|iPad/.test(navigator.platform),REGEX={SNAKE_CASE:/[A-Z]/g,ANDROID:/Android/i,IPHONE:/iPhone/i,IPOD:/iPod/i,IPAD:/iPad/i,ANDROID_TABLET:/android|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i,MOBILE:/Mobile/i,WINDOWS:/Windows Phone/i,SUPPORTED_IMAGE_FORMAT:/\.(bmp|gif|jpe|jpg|jpeg|tif|tiff|pbm|png|ico)$/i,SUPPORTED_FILE_FORMAT:/\.(txt|js|css|html|script|properties|json|java|xml|smd|xmi|sql|log|wsdl|vm|ftl|jrxml|yml|yaml)$/i,SUPPORTED_AUDIO_FORMAT:/\.(mp3|ogg|webm|wma|3gp|wav)$/i,SUPPORTED_VIDEO_FORMAT:/\.(mp4|ogg|webm|wmv|mpeg|mpg|avi)$/i,PAGE_RESOURCE_PATH:/^\/pages\/.*\.(js|css|html|json)$/,MIN_PAGE_RESOURCE_PATH:/.*(page.min.html)$/,VALID_EMAIL:/^[a-zA-Z][\w.]+@[a-zA-Z_]+?\.[a-zA-Z.]{1,4}[a-zA-Z]$/,VALID_WEB_URL:/^(http[s]?:\/\/)(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/,VALID_WEBSOCKET_URL:/^(ws[s]?:\/\/)(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/,REPLACE_PATTERN:/\$\{([^\}]+)\}/g,ZIP_FILE:/\.zip$/i,EXE_FILE:/\.exe$/i,NO_QUOTES_ALLOWED:/^[^'|"]*$/,NO_DOUBLE_QUOTES_ALLOWED:/^[^"]*$/,VALID_HTML:/<[a-z][\s\S]*>/i,VALID_PASSWORD:/^[0-9a-zA-Z-_.@&*!#$%]+$/,SPECIAL_CHARACTERS:/[^A-Z0-9a-z_]+/i,APP_SERVER_URL_FORMAT:/^(http[s]?:\/\/)(www\.){0,1}[a-zA-Z0-9\.\-]+([:]?[0-9]{2,5}|\.[a-zA-Z]{2,5}[\.]{0,1})\/+[^?#&=]+$/},NUMBER_TYPES=["int","integer","float","double","long","short","byte","big_integer","big_decimal"],SYSTEM_FOLDER_PATHS={project:["../lib","../project","../project/services","../project/lib","../project/src","../project/test","../project/src/main","../project/src/main/webapp","../project/src/main/resources","../project/src/main/webapp/services","../project/src/main/webapp/resources","../project/src/main/webapp/pages","../project/src/main/webapp/resources/images","../project/src/main/webapp/resources/WEB-INF","../project/src/main/webapp/resources/ngLocale","../project/src/main/webapp/resources/i18n","../project/src/main/webapp/resources/images/imagelists","../project/src/main/webapp/resources/audio","../project/src/main/webapp/resources/video"],resources:["","/services","/resources","/WEB-INF","/app","/pages","/resources/i18n","/resources/ngLocale","resources/images","resources/audio","resources/video","resources/images/imagelists"],lib:["../lib"],jar:["../lib"],locale:["resources/i18n"],services:["services"],image:["resources/images","resources/images/imagelists"],audio:["resources/audio"],video:["resources/video"]},hasLocalStorage="localStorage"in window&&null!==window.localStorage,browserStorage={storeItem:function(key,value){hasLocalStorage&&window.localStorage.setItem(key,value)},getItem:function(key){if(hasLocalStorage)return window.localStorage.getItem(key)},deleteItem:function(key){hasLocalStorage&&delete window.localStorage[key]}},isIE11=function(){return navigator.appVersion.indexOf("Trident/")>-1},isIE9=function(){return navigator.appVersion.indexOf("MSIE 9")>-1},isIE=function(){return isIE9()||isIE11()||userAgent.indexOf("MSIE")>-1},getNode=function(tree,nodeId){var index,treeLength;if(!WM.isUndefined(tree))for(treeLength=tree.length,index=0;index<treeLength;index+=1)if(tree[index].id===nodeId)return tree[index]},variableCategoryMap={"wm.Variable":"variable","wm.ServiceVariable":"service-variable","wm.LiveVariable":"live-variable","wm.LoginVariable":"login-variable","wm.LogoutVariable":"logout-variable","wm.NavigationVariable":"navigation-variable","wm.NotificationVariable":"notification-variable","wm.TimerVariable":"time","wm.DeviceVariable":"device-variable","wm.WebSocketVariable":"web-socket-variable"},dataSetWidgets={select:!0,checkboxset:!0,radioset:!0,switch:!0,autocomplete:!0,chips:!0,typeahead:!0},daysOptions=[{name:"Sunday",value:"0"},{name:"Monday",value:"1"},{name:"Tuesday",value:"2"},{name:"Wednesday",value:"3"},{name:"Thursday",value:"4"},{name:"Friday",value:"5"},{name:"Saturday",value:"6"}],DEFAULT_FORMATS={DATE:"yyyy-MM-dd",TIME:"HH:mm:ss",TIMESTAMP:"timestamp",DATETIME:"yyyy-MM-ddTHH:mm:ss",LOCALDATETIME:"yyyy-MM-ddTHH:mm:ss",DATETIME_ORACLE:"yyyy-MM-dd HH:mm:ss"},indexPage=getIndexPage(),pluginConfig={BARCODE_SCANNER:[{name:"phonegap-plugin-barcodescanner",spec:"6.0.2",variables:[{name:"CAMERA_USAGE_DESCRIPTION",value:"To scan barcodes"}]}],CALENDAR:[{name:"cordova-plugin-calendar",spec:"4.5.5",variables:[{name:"CALENDAR_USAGE_DESCRIPTION",value:"To show events"}]}],CAMERA:[{name:"cordova-plugin-camera",spec:"2.3.0",variables:[{name:"CAMERA_USAGE_DESCRIPTION",value:"To take photos"}]},{name:"cordova-plugin-media-capture",spec:"1.4.0",variables:[{name:"CAMERA_USAGE_DESCRIPTION",value:"To take videos"},{name:"MICROPHONE_USAGE_DESCRIPTION",value:"To record voice while taking videos"},{name:"PHOTO_LIBRARY_USAGE_DESCRIPTION",value:"To provide photo browsing"}]}],CONTACTS:[{name:"cordova-plugin-contacts",spec:"2.2.0",variables:[{name:"CONTACTS_USAGE_DESCRIPTION",value:"To show phone numbers"}]}],FILE:[{name:"cordova-plugin-file",spec:"4.3.0"},{name:"cordova-plugin-file-transfer",spec:"1.6.0"}],GEOLOCATION:[{name:"cordova-plugin-geolocation",spec:"2.4.0"}],NETWORK:[{name:"cordova-plugin-network-information",spec:"1.3.0"}],VIBRATE:[{name:"cordova-plugin-vibration",spec:"2.1.2"}],MEDIAPICKER:[{name:"cordova-plugin-mediapicker",spec:"0.0.1"}],MEDIASCANNER:[{name:"cordova-plugin-mediascanner",spec:"0.1.3"}],IMAGEPICKER:[{name:"cordova-plugin-imagepicker",spec:"1.3.0",variables:[{name:"PHOTO_LIBRARY_USAGE_DESCRIPTION",value:"To provide photo browsing picker"}]}],SPLASHSCREEN:[{name:"cordova-plugin-splashscreen",spec:"4.0.0"}],DEVICE:[{name:"cordova-plugin-device",spec:"1.1.3"}],APPVERSION:[{name:"cordova-plugin-app-version",spec:"0.1.9"}],WHITELIST:[{name:"cordova-plugin-whitelist",spec:"1.3.0"}],COMPAT:[{name:"cordova-plugin-compat",spec:"1.0.0"}],INAPPBROWSER:[{name:"cordova-plugin-inappbrowser",spec:"1.5.0"}],STATUSBAR:[{name:"cordova-plugin-statusbar",spec:"2.2.0"}],OFFLINE_DB:[{name:"cordova-sqlite-storage",spec:"https://github.com/wavemaker/Cordova-sqlite-storage.git#pb-1.4.8"}]};linkEl.rel="stylesheet",linkEl.type="text/css",$rootScope.$safeApply=function($scope,fn){$rootScope.$$phase||$scope.$$phase?triggerFn(fn):$scope.$apply(fn)},$.fn.extend({scrollParent:function(includeHidden){var position=this.css("position"),excludeStaticParent="absolute"===position,overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,docHeight=document.body.clientHeight,scrollParent=this.parents().filter(function(){var hasOverFlowAuto,parent=$(this);return(!excludeStaticParent||"static"!==parent.css("position"))&&(hasOverFlowAuto=overflowRegex.test(parent.css("overflow")+parent.css("overflow-y")),hasOverFlowAuto&&this.clientHeight<=docHeight)}).eq(0);return"fixed"!==position&&scrollParent.length?scrollParent:$(this[0].ownerDocument||document)}}),this.camelCase=WM.element.camelCase,this.initCaps=initCaps,this.firstCaps=firstCaps,this.periodSeparate=periodSeparate,this.spaceSeparate=spaceSeparate,this.prettifyLabel=prettifyLabel,this.prettifyLabels=prettifyLabels,this.getVariableName=getVariableName,this.getImageUrl=getImageUrl,this.getResourceUrl=getResourceURL,this.encodeUrlParams=encodeUrlParams,this.encodeUrl=encodeUrl,this.formatVariableIconClass=formatVariableIconClass,this.getBackGroundImageUrl=getBackGroundImageUrl,this.getParentOverlayElZIndex=getParentOverlayElZIndex,this.hyphenate=hyphenate,this.deHyphenate=deHyphenate,this.isAndroid=isAndroid,this.isAndroidPhone=isAndroidPhone,this.isIphone=isIphone,this.isIpod=isIpod,this.isIpad=isIpad,this.isIOS=isIOS,this.isAndroidTablet=isAndroidTablet,this.isTablet=isTablet,this.isMobile=isMobile,this.isScriptLoaded=isScriptLoaded,this.isValidJavaPackageName=isValidJavaPackageName,this.isValidHtml=isValidHtml,this.hasSpecialCharacters=hasSpecialCharacters,this.checkSpecialCharacters=checkSpecialCharacters,this.isQuoteNotPresent=isQuoteNotPresent,this.isNoDoubleQuoteNotPresent=isNoDoubleQuoteNotPresent,this.stringStartsWith=stringStartsWith,this.stringEndsWith=stringEndsWith,this.isStyleSheetLoaded=isStyleSheetLoaded,this.isValidWebURL=isValidWebURL,this.isValidWebSocketURL=isValidWebSocketURL,this.loadScripts=loadScripts,this.loadStyleSheets=loadStyleSheets,this.loadStyleSheet=loadStyleSheet,this.prepareFieldDefs=prepareFieldDefs,this.prettifyCSS=prettifyCSS,this.prettifyHTML=prettifyHTML,this.prettifyJS=prettifyJS,this.swapArrayElements=swapArrayElements,this.swapProperties=swapProperties,this.triggerFn=triggerFn,this.isEmptyObject=isEmptyObject,this.isValidEmail=isValidEmail,this.isValidPassword=isValidPassword,this.isValidFieldName=isValidFieldName,this.resetObjectWithEmptyValues=resetObjectWithEmptyValues,this.isImageFile=isImageFile,this.isZipFile=isZipFile,this.isExeFile=isExeFile,this.isTextLikeFile=isTextLikeFile,this.isAudioFile=isAudioFile,this.isVideoFile=isVideoFile,this.isPageResource=isPageResource,this.findValueOf=findValueOf,this.replace=replace,this.removeStyleSheetLoaded=removeStyleSheetLoaded,this.fileUploadFallback=fileUploadFallback,this.getCurrentPage=getCurrentPage,this.isDebugMode=isDebugMode,this.getIndexPage=getIndexPage,this.redirectToIndexPage=redirectToIndexPage,this.redirectToLoginPage=redirectToLoginPage,this.browserStorage=browserStorage,this.fetchPropertiesMapColumns=fetchPropertiesMapColumns,this.getLoadedPrefabNames=getLoadedPrefabNames,this.initializeAction=initializeAction,this.addNodeToJson=addNodeToJson,this.getNodeFromJson=getNodeFromJson,this.removeJsonNodeChildren=removeJsonNodeChildren,this.isIE=isIE,this.isIE9=isIE9,this.isIE11=isIE11,this.getValidJSON=getValidJSON,this.getActionFromKey=getActionFromKey,this.preventCachingOf=preventCachingOf,this.getAllKeysOf=getAllKeysOf,this.fetchContent=fetchContent,this.getService=getService,this.removeProtocol=removeProtocol,this.getCookieByName=getCookieByName,this.isPageable=isPageable,this.isNumberType=isNumberType,this.isFileUploadSupported=isFileUploadSupported,this.processMarkup=processMarkup,this.isDateTimeType=isDateTimeType,this.getDataSetWidgets=getDataSetWidgets,this.getDaysOptions=getDaysOptions,this.getDateTimeDefaultFormats=getDateTimeDefaultFormats,this.getDateTimeFormatForType=getDateTimeFormatForType,this.isValidDataSet=isValidDataSet,this.parseCombinedPageContent=parseCombinedPageContent,this.extractType=extractType,this.isDeleteResourceAllowed=isDeleteResourceAllowed,this.generateGUId=generateGUId,this.isDuplicateName=isDuplicateName,this.getValidMarkUp=getValidMarkUp,this.scrollIntoView=scrollIntoView,this.arraysEqual=arraysEqual,this.getNewEventsObject=getNewEventsObject,this.getEvaluatedExprValue=getEvaluatedExprValue,this.getProjectResourcePath=getProjectResourcePath,this.getVariableNameFromExpr=getVariableNameFromExpr,this.getClonedObject=getClonedObject,this.getValidDateObject=getValidDateObject,this.getMatchModes=getMatchModes,this.updateTmplAttrs=updateTmplAttrs,this.sort=sort,this.triggerCustomEvents=triggerCustomEvents,this.simulateFileDownload=simulateFileDownload,this.getWidgetRolesArrayFromStr=getWidgetRolesArrayFromStr,this.setNodeContent=setNodeContent,this.getOrderByExpr=getOrderByExpr,this.xmlToJson=xmlToJson,this.getTypes=getTypes,this.openDialog=openDialog,this.evalExp=evalExp,this.convertToArray=convertToArray,this.pluginConfig=pluginConfig,this.loadActiveTheme=loadActiveTheme,this.isInsecureContentRequest=isInsecureContentRequest,this.isValidAppServerUrl=isValidAppServerUrl,this.addDefaultHeaders=addDefaultHeaders,this.formatDate=formatDate,this.getBlob=getBlob,this.getMetaDataFromData=getMetaDataFromData,this.isAppleProduct=isAppleProduct,this.formatStyle=formatStyle,this.getFormData=getFormData,this.validateAccessRoles=validateAccessRoles,this.listenOnce=listenOnce}]),WM.module("wm.utils").service("AppDefaults",function(){"use strict";function setAppDefault(key,value){WM.isString(key)?map[key]=value:WM.isObject(key)&&_.assign(map,key)}function getAppDefault(key){return map[key]}var map={};this.set=setAppDefault,this.get=getAppDefault}),WM.module("wm.utils").config(["$filterProvider",function($filterProvider){"use strict";WM.module("wm.utils").$filter=$filterProvider.register}]).service("DataFormatService",["$filter","CURRENCYCONSTANTS",function($filter,CURRENCYCONSTANTS){"use strict";function getDateTimePatterns(){return DATE_TIME_PATTERNS}function getDatePatterns(){return DATE_PATTERNS}function getTimePatterns(){return TIME_PATTERNS}function getCurrencyOptions(){return CURRENCY_OPTIONS}function getFormatPatterns(){return FORMAT_OPTIONS}function numberToString(data,fracSize){return $filter("number")(data,fracSize)}function number2currency(data,currencySymbol,fractionSize){var _sym=currencySymbol||"",_val=numberToString(data,fractionSize);return _val?_sym+_val:""}function getEpochValue(data){var epoch;return WM.isDate(data)||isNaN(data)||(data=parseInt(data,10)),epoch=moment(data).valueOf()||moment((new Date).toDateString()+" "+data).valueOf()}function toDate(data,format){var timestamp;if("null"===data)return"";if(WM.isDefined(data))return timestamp=getEpochValue(data),timestamp?"timestamp"===format?timestamp:$filter("date")(timestamp,format):void 0}function stringToNumber(data){return Number(data)||void 0}function toNumber(data,fracSize){return numberToString(data,fracSize)}function timeFromNow(data){var timestamp;if(WM.isDefined(data))return timestamp=getEpochValue(data),timestamp?moment(timestamp).fromNow():void 0}function toCurrency(data,currencySymbol,fracSize){var _currencySymbol=(CURRENCYCONSTANTS[currencySymbol]||{}).symbol||currencySymbol;return number2currency(data,_currencySymbol,fracSize)}function lpad(data,padding){return data?padding+data:padding}function rpad(data,padding){return data?data+padding:padding}function prefix(data,padding){return data?padding+data:padding}function suffix(data,padding){return data?data+padding:padding}function register(formatterName,formatterFn){WM.module("wm.utils").$filter(formatterName,formatterFn)}var DATE_PATTERNS=["yyyy-MM-dd","yyyy-M-dd","M-dd-yyyy","MM-dd-yy","yyyy, dd MMMM","yyyy, MMM dd","MM/dd/yyyy","M/d/yyyy","EEE, dd MMM yyyy","EEE MMM dd yyyy","EEEE, MMMM dd, yyyy","timestamp"],DATE_TIME_PATTERNS=["dd/MM/yyyy","yyyy-MM-dd","yyyy-M-dd","M-dd-yyyy","M/d/yyyy","MM/dd/yyyy","yyyy, MMM dd","yyyy, dd MMMM","yyyy-MM-ddTHH:mm:ss","MM-dd-yy hh:mm:ss a","MM-dd-yy hh:mm:ss a Z","dd-MMM-yyyy HH:mm:ss","yyyy-MM-dd HH:mm","yyyy-MM-dd HH:mm:ss:sss","yyyy-MM-dd hh:mm a","yyyy-MM-dd hh:mm:ss a","yyyy-MM-dd hh:mm:ss:sss Z","yyyy-MM-dd hh:mm:ss:sss a","EEE MMM dd hh:mm:ss Z yyyy","EEE, dd MMM yyyy HH:mm:ss Z","EEEE, MMMM dd, yyyy","timestamp","MMM, yyyy","w 'Week',  yyyy"],TIME_PATTERNS=["HH:mm:ss","HH:mm","hh:mm:ss","hh:mm","hh:mm a","H:m:s","h:m:s","timestamp"],CURRENCY_OPTIONS=["AED","AFN","ALL","AMD","ARS","AUD","AZN","BAM","BDT","BGN","BHD","BIF","BND","BOB","BRL","BWP","BYR","BZD","CAD","CDF","CHF","CLP","CNY","COP","CRC","CVE","CZK","DJF","DKK","DOP","DZD","EEK","EGP","ERN","ETB","EUR","GBP","GEL","GHS","GNF","GTQ","HKD","HNL","HRK","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KHR","KMF","KRW","KWD","KZT","LBP","LKR","LTL","LVL","LYD","MAD","MDL","MGA","MKD","MMK","MOP","MUR","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SDG","SEK","SGD","SOS","SYP","THB","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VEF","VND","XAF","XOF","YER","ZAR","ZMK"],FORMAT_OPTIONS=["toDate","toCurrency","prefix","suffix","numberToString","stringToNumber","timeFromNow","None"],customFilters={};customFilters.toDate=toDate,customFilters.toNumber=toNumber,customFilters.toCurrency=toCurrency,customFilters.lpad=lpad,customFilters.rpad=rpad,customFilters.prefix=prefix,customFilters.suffix=suffix,customFilters.timeFromNow=timeFromNow,customFilters.numberToString=toNumber,customFilters.stringToNumber=stringToNumber,Object.keys(customFilters).forEach(function(filterName){WM.module("wm.utils").$filter(filterName,function(){return customFilters[filterName]})}),this.register=register,this.getDateTimePatterns=getDateTimePatterns,this.getDatePatterns=getDatePatterns,this.getTimePatterns=getTimePatterns,this.getCurrencyOptions=getCurrencyOptions,this.getFormatPatterns=getFormatPatterns}]).constant("CURRENCYCONSTANTS",{USD:{symbol:"$",name:"US Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"USD",name_plural:"US dollars"},CAD:{symbol:"CA$",name:"Canadian Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"CAD",name_plural:"Canadian dollars"},EUR:{symbol:"€",name:"Euro",symbol_native:"€",decimal_digits:2,rounding:0,code:"EUR",name_plural:"euros"},AED:{symbol:"AED",name:"United Arab Emirates Dirham",symbol_native:"د.إ.‏",decimal_digits:2,rounding:0,code:"AED",name_plural:"UAE dirhams"},AFN:{symbol:"Af",name:"Afghan Afghani",symbol_native:"؋",decimal_digits:0,rounding:0,code:"AFN",name_plural:"Afghan Afghanis"},ALL:{symbol:"ALL",name:"Albanian Lek",symbol_native:"Lek",decimal_digits:0,rounding:0,code:"ALL",name_plural:"Albanian lekë"},AMD:{symbol:"AMD",name:"Armenian Dram",symbol_native:"դր.",decimal_digits:0,rounding:0,code:"AMD",name_plural:"Armenian drams"},ARS:{symbol:"AR$",name:"Argentine Peso",symbol_native:"$",decimal_digits:2,rounding:0,code:"ARS",name_plural:"Argentine pesos"},AUD:{symbol:"AU$",name:"Australian Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"AUD",name_plural:"Australian dollars"},AZN:{symbol:"man.",name:"Azerbaijani Manat",symbol_native:"ман.",decimal_digits:2,rounding:0,code:"AZN",name_plural:"Azerbaijani manats"},BAM:{symbol:"KM",name:"Bosnia-Herzegovina Convertible Mark",symbol_native:"KM",decimal_digits:2,rounding:0,code:"BAM",name_plural:"Bosnia-Herzegovina convertible marks"},BDT:{symbol:"Tk",name:"Bangladeshi Taka",symbol_native:"৳",decimal_digits:2,rounding:0,code:"BDT",name_plural:"Bangladeshi takas"},BGN:{symbol:"BGN",name:"Bulgarian Lev",symbol_native:"лв.",decimal_digits:2,rounding:0,code:"BGN",name_plural:"Bulgarian leva"},BHD:{symbol:"BD",name:"Bahraini Dinar",symbol_native:"د.ب.‏",decimal_digits:3,rounding:0,code:"BHD",name_plural:"Bahraini dinars"},BIF:{symbol:"FBu",name:"Burundian Franc",symbol_native:"FBu",decimal_digits:0,rounding:0,code:"BIF",name_plural:"Burundian francs"},BND:{symbol:"BN$",name:"Brunei Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"BND",name_plural:"Brunei dollars"},BOB:{symbol:"Bs",name:"Bolivian Boliviano",symbol_native:"Bs",decimal_digits:2,rounding:0,code:"BOB",name_plural:"Bolivian bolivianos"},BRL:{symbol:"R$",name:"Brazilian Real",symbol_native:"R$",decimal_digits:2,rounding:0,code:"BRL",name_plural:"Brazilian reals"},BWP:{symbol:"BWP",name:"Botswanan Pula",symbol_native:"P",decimal_digits:2,rounding:0,code:"BWP",name_plural:"Botswanan pulas"},BYR:{symbol:"BYR",name:"Belarusian Ruble",symbol_native:"BYR",decimal_digits:0,rounding:0,code:"BYR",name_plural:"Belarusian rubles"},BZD:{symbol:"BZ$",name:"Belize Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"BZD",name_plural:"Belize dollars"},CDF:{symbol:"CDF",name:"Congolese Franc",symbol_native:"FrCD",decimal_digits:2,rounding:0,code:"CDF",name_plural:"Congolese francs"},CHF:{symbol:"CHF",name:"Swiss Franc",symbol_native:"CHF",decimal_digits:2,rounding:.05,code:"CHF",name_plural:"Swiss francs"},CLP:{symbol:"CL$",name:"Chilean Peso",symbol_native:"$",decimal_digits:0,rounding:0,code:"CLP",name_plural:"Chilean pesos"},CNY:{symbol:"CN¥",name:"Chinese Yuan",symbol_native:"CN¥",decimal_digits:2,rounding:0,code:"CNY",name_plural:"Chinese yuan"},COP:{symbol:"CO$",name:"Colombian Peso",symbol_native:"$",decimal_digits:0,rounding:0,code:"COP",name_plural:"Colombian pesos"},CRC:{symbol:"₡",name:"Costa Rican Colón",symbol_native:"₡",decimal_digits:0,rounding:0,code:"CRC",name_plural:"Costa Rican colóns"},CVE:{symbol:"CV$",name:"Cape Verdean Escudo",symbol_native:"CV$",decimal_digits:2,rounding:0,code:"CVE",name_plural:"Cape Verdean escudos"},CZK:{symbol:"Kč",name:"Czech Republic Koruna",symbol_native:"Kč",decimal_digits:2,rounding:0,code:"CZK",name_plural:"Czech Republic korunas"},DJF:{symbol:"Fdj",name:"Djiboutian Franc",symbol_native:"Fdj",decimal_digits:0,rounding:0,code:"DJF",name_plural:"Djiboutian francs"},DKK:{symbol:"Dkr",name:"Danish Krone",symbol_native:"kr",decimal_digits:2,rounding:0,code:"DKK",name_plural:"Danish kroner"},DOP:{symbol:"RD$",name:"Dominican Peso",symbol_native:"RD$",decimal_digits:2,rounding:0,code:"DOP",name_plural:"Dominican pesos"},DZD:{symbol:"DA",name:"Algerian Dinar",symbol_native:"د.ج.‏",decimal_digits:2,rounding:0,code:"DZD",name_plural:"Algerian dinars"},EEK:{symbol:"Ekr",name:"Estonian Kroon",symbol_native:"kr",decimal_digits:2,rounding:0,code:"EEK",name_plural:"Estonian kroons"},EGP:{symbol:"EGP",name:"Egyptian Pound",symbol_native:"ج.م.‏",decimal_digits:2,rounding:0,code:"EGP",name_plural:"Egyptian pounds"},ERN:{symbol:"Nfk",name:"Eritrean Nakfa",symbol_native:"Nfk",decimal_digits:2,rounding:0,code:"ERN",name_plural:"Eritrean nakfas"},ETB:{symbol:"Br",name:"Ethiopian Birr",symbol_native:"Br",decimal_digits:2,rounding:0,code:"ETB",name_plural:"Ethiopian birrs"},GBP:{symbol:"£",name:"British Pound Sterling",symbol_native:"£",decimal_digits:2,rounding:0,code:"GBP",name_plural:"British pounds sterling"},GEL:{symbol:"GEL",name:"Georgian Lari",symbol_native:"GEL",decimal_digits:2,rounding:0,code:"GEL",name_plural:"Georgian laris"},GHS:{symbol:"GH₵",name:"Ghanaian Cedi",symbol_native:"GH₵",decimal_digits:2,rounding:0,code:"GHS",name_plural:"Ghanaian cedis"},GNF:{symbol:"FG",name:"Guinean Franc",symbol_native:"FG",decimal_digits:0,rounding:0,code:"GNF",name_plural:"Guinean francs"},GTQ:{symbol:"GTQ",name:"Guatemalan Quetzal",symbol_native:"Q",decimal_digits:2,rounding:0,code:"GTQ",name_plural:"Guatemalan quetzals"},HKD:{symbol:"HK$",name:"Hong Kong Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"HKD",name_plural:"Hong Kong dollars"},HNL:{symbol:"HNL",name:"Honduran Lempira",symbol_native:"L",decimal_digits:2,rounding:0,code:"HNL",name_plural:"Honduran lempiras"},HRK:{symbol:"kn",name:"Croatian Kuna",symbol_native:"kn",decimal_digits:2,rounding:0,code:"HRK",name_plural:"Croatian kunas"},HUF:{symbol:"Ft",name:"Hungarian Forint",symbol_native:"Ft",decimal_digits:0,rounding:0,code:"HUF",name_plural:"Hungarian forints"},IDR:{symbol:"Rp",name:"Indonesian Rupiah",symbol_native:"Rp",decimal_digits:0,rounding:0,code:"IDR",name_plural:"Indonesian rupiahs"},ILS:{symbol:"₪",name:"Israeli New Sheqel",symbol_native:"₪",decimal_digits:2,rounding:0,code:"ILS",name_plural:"Israeli new sheqels"},INR:{symbol:"₹",name:"Indian Rupee",symbol_native:"টকা",decimal_digits:2,rounding:0,code:"INR",name_plural:"Indian rupees"},IQD:{symbol:"IQD",name:"Iraqi Dinar",symbol_native:"د.ع.‏",decimal_digits:0,rounding:0,code:"IQD",name_plural:"Iraqi dinars"},IRR:{symbol:"IRR",name:"Iranian Rial",symbol_native:"﷼",decimal_digits:0,rounding:0,code:"IRR",name_plural:"Iranian rials"},ISK:{symbol:"Ikr",name:"Icelandic Króna",symbol_native:"kr",decimal_digits:0,rounding:0,code:"ISK",name_plural:"Icelandic krónur"},JMD:{symbol:"J$",name:"Jamaican Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"JMD",name_plural:"Jamaican dollars"},JOD:{symbol:"JD",name:"Jordanian Dinar",symbol_native:"د.أ.‏",decimal_digits:3,rounding:0,code:"JOD",name_plural:"Jordanian dinars"},JPY:{symbol:"¥",name:"Japanese Yen",symbol_native:"￥",decimal_digits:0,rounding:0,code:"JPY",name_plural:"Japanese yen"},KES:{symbol:"Ksh",name:"Kenyan Shilling",symbol_native:"Ksh",decimal_digits:2,rounding:0,code:"KES",name_plural:"Kenyan shillings"},KHR:{symbol:"KHR",name:"Cambodian Riel",symbol_native:"៛",decimal_digits:2,rounding:0,code:"KHR",name_plural:"Cambodian riels"},KMF:{symbol:"CF",name:"Comorian Franc",symbol_native:"FC",decimal_digits:0,rounding:0,code:"KMF",name_plural:"Comorian francs"},KRW:{symbol:"₩",name:"South Korean Won",symbol_native:"₩",decimal_digits:0,rounding:0,code:"KRW",name_plural:"South Korean won"},KWD:{symbol:"KD",name:"Kuwaiti Dinar",symbol_native:"د.ك.‏",decimal_digits:3,rounding:0,code:"KWD",name_plural:"Kuwaiti dinars"},KZT:{symbol:"KZT",name:"Kazakhstani Tenge",symbol_native:"тңг.",decimal_digits:2,rounding:0,code:"KZT",name_plural:"Kazakhstani tenges"},LBP:{symbol:"LB£",name:"Lebanese Pound",symbol_native:"ل.ل.‏",decimal_digits:0,rounding:0,code:"LBP",name_plural:"Lebanese pounds"},LKR:{symbol:"SLRs",name:"Sri Lankan Rupee",symbol_native:"SL Re",decimal_digits:2,rounding:0,code:"LKR",name_plural:"Sri Lankan rupees"},LTL:{symbol:"Lt",name:"Lithuanian Litas",symbol_native:"Lt",decimal_digits:2,rounding:0,code:"LTL",name_plural:"Lithuanian litai"},LVL:{symbol:"Ls",name:"Latvian Lats",symbol_native:"Ls",decimal_digits:2,rounding:0,code:"LVL",name_plural:"Latvian lati"},LYD:{symbol:"LD",name:"Libyan Dinar",symbol_native:"د.ل.‏",decimal_digits:3,rounding:0,code:"LYD",name_plural:"Libyan dinars"},MAD:{symbol:"MAD",name:"Moroccan Dirham",symbol_native:"د.م.‏",decimal_digits:2,rounding:0,code:"MAD",name_plural:"Moroccan dirhams"},MDL:{symbol:"MDL",name:"Moldovan Leu",symbol_native:"MDL",decimal_digits:2,rounding:0,code:"MDL",name_plural:"Moldovan lei"},MGA:{symbol:"MGA",name:"Malagasy Ariary",symbol_native:"MGA",decimal_digits:0,rounding:0,code:"MGA",name_plural:"Malagasy Ariaries"},MKD:{symbol:"MKD",name:"Macedonian Denar",symbol_native:"MKD",decimal_digits:2,rounding:0,code:"MKD",name_plural:"Macedonian denari"},MMK:{symbol:"MMK",name:"Myanma Kyat",symbol_native:"K",decimal_digits:0,rounding:0,code:"MMK",name_plural:"Myanma kyats"},MOP:{symbol:"MOP$",name:"Macanese Pataca",symbol_native:"MOP$",decimal_digits:2,rounding:0,code:"MOP",name_plural:"Macanese patacas"},MUR:{symbol:"MURs",name:"Mauritian Rupee",symbol_native:"MURs",decimal_digits:0,rounding:0,code:"MUR",name_plural:"Mauritian rupees"},MXN:{symbol:"MX$",name:"Mexican Peso",symbol_native:"$",decimal_digits:2,rounding:0,code:"MXN",name_plural:"Mexican pesos"},MYR:{symbol:"RM",name:"Malaysian Ringgit",symbol_native:"RM",decimal_digits:2,rounding:0,code:"MYR",name_plural:"Malaysian ringgits"},MZN:{symbol:"MTn",name:"Mozambican Metical",symbol_native:"MTn",decimal_digits:2,rounding:0,code:"MZN",name_plural:"Mozambican meticals"},NAD:{symbol:"N$",name:"Namibian Dollar",symbol_native:"N$",decimal_digits:2,rounding:0,code:"NAD",name_plural:"Namibian dollars"},NGN:{symbol:"₦",name:"Nigerian Naira",symbol_native:"₦",decimal_digits:2,rounding:0,code:"NGN",name_plural:"Nigerian nairas"},NIO:{symbol:"C$",name:"Nicaraguan Córdoba",symbol_native:"C$",decimal_digits:2,rounding:0,code:"NIO",name_plural:"Nicaraguan córdobas"},NOK:{symbol:"Nkr",name:"Norwegian Krone",symbol_native:"kr",decimal_digits:2,rounding:0,code:"NOK",name_plural:"Norwegian kroner"},NPR:{symbol:"NPRs",name:"Nepalese Rupee",symbol_native:"नेरू",decimal_digits:2,rounding:0,code:"NPR",name_plural:"Nepalese rupees"},NZD:{symbol:"NZ$",
name:"New Zealand Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"NZD",name_plural:"New Zealand dollars"},OMR:{symbol:"OMR",name:"Omani Rial",symbol_native:"ر.ع.‏",decimal_digits:3,rounding:0,code:"OMR",name_plural:"Omani rials"},PAB:{symbol:"B/.",name:"Panamanian Balboa",symbol_native:"B/.",decimal_digits:2,rounding:0,code:"PAB",name_plural:"Panamanian balboas"},PEN:{symbol:"S/.",name:"Peruvian Nuevo Sol",symbol_native:"S/.",decimal_digits:2,rounding:0,code:"PEN",name_plural:"Peruvian nuevos soles"},PHP:{symbol:"₱",name:"Philippine Peso",symbol_native:"₱",decimal_digits:2,rounding:0,code:"PHP",name_plural:"Philippine pesos"},PKR:{symbol:"PKRs",name:"Pakistani Rupee",symbol_native:"₨",decimal_digits:0,rounding:0,code:"PKR",name_plural:"Pakistani rupees"},PLN:{symbol:"zł",name:"Polish Zloty",symbol_native:"zł",decimal_digits:2,rounding:0,code:"PLN",name_plural:"Polish zlotys"},PYG:{symbol:"₲",name:"Paraguayan Guarani",symbol_native:"₲",decimal_digits:0,rounding:0,code:"PYG",name_plural:"Paraguayan guaranis"},QAR:{symbol:"QR",name:"Qatari Rial",symbol_native:"ر.ق.‏",decimal_digits:2,rounding:0,code:"QAR",name_plural:"Qatari rials"},RON:{symbol:"RON",name:"Romanian Leu",symbol_native:"RON",decimal_digits:2,rounding:0,code:"RON",name_plural:"Romanian lei"},RSD:{symbol:"din.",name:"Serbian Dinar",symbol_native:"дин.",decimal_digits:0,rounding:0,code:"RSD",name_plural:"Serbian dinars"},RUB:{symbol:"RUB",name:"Russian Ruble",symbol_native:"руб.",decimal_digits:2,rounding:0,code:"RUB",name_plural:"Russian rubles"},RWF:{symbol:"RWF",name:"Rwandan Franc",symbol_native:"FR",decimal_digits:0,rounding:0,code:"RWF",name_plural:"Rwandan francs"},SAR:{symbol:"SR",name:"Saudi Riyal",symbol_native:"ر.س.‏",decimal_digits:2,rounding:0,code:"SAR",name_plural:"Saudi riyals"},SDG:{symbol:"SDG",name:"Sudanese Pound",symbol_native:"SDG",decimal_digits:2,rounding:0,code:"SDG",name_plural:"Sudanese pounds"},SEK:{symbol:"Skr",name:"Swedish Krona",symbol_native:"kr",decimal_digits:2,rounding:0,code:"SEK",name_plural:"Swedish kronor"},SGD:{symbol:"S$",name:"Singapore Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"SGD",name_plural:"Singapore dollars"},SOS:{symbol:"Ssh",name:"Somali Shilling",symbol_native:"Ssh",decimal_digits:0,rounding:0,code:"SOS",name_plural:"Somali shillings"},SYP:{symbol:"SY£",name:"Syrian Pound",symbol_native:"ل.س.‏",decimal_digits:0,rounding:0,code:"SYP",name_plural:"Syrian pounds"},THB:{symbol:"฿",name:"Thai Baht",symbol_native:"฿",decimal_digits:2,rounding:0,code:"THB",name_plural:"Thai baht"},TND:{symbol:"DT",name:"Tunisian Dinar",symbol_native:"د.ت.‏",decimal_digits:3,rounding:0,code:"TND",name_plural:"Tunisian dinars"},TOP:{symbol:"T$",name:"Tongan Paʻanga",symbol_native:"T$",decimal_digits:2,rounding:0,code:"TOP",name_plural:"Tongan paʻanga"},TRY:{symbol:"TL",name:"Turkish Lira",symbol_native:"TL",decimal_digits:2,rounding:0,code:"TRY",name_plural:"Turkish Lira"},TTD:{symbol:"TT$",name:"Trinidad and Tobago Dollar",symbol_native:"$",decimal_digits:2,rounding:0,code:"TTD",name_plural:"Trinidad and Tobago dollars"},TWD:{symbol:"NT$",name:"New Taiwan Dollar",symbol_native:"NT$",decimal_digits:2,rounding:0,code:"TWD",name_plural:"New Taiwan dollars"},TZS:{symbol:"TSh",name:"Tanzanian Shilling",symbol_native:"TSh",decimal_digits:0,rounding:0,code:"TZS",name_plural:"Tanzanian shillings"},UAH:{symbol:"₴",name:"Ukrainian Hryvnia",symbol_native:"₴",decimal_digits:2,rounding:0,code:"UAH",name_plural:"Ukrainian hryvnias"},UGX:{symbol:"USh",name:"Ugandan Shilling",symbol_native:"USh",decimal_digits:0,rounding:0,code:"UGX",name_plural:"Ugandan shillings"},UYU:{symbol:"$U",name:"Uruguayan Peso",symbol_native:"$",decimal_digits:2,rounding:0,code:"UYU",name_plural:"Uruguayan pesos"},UZS:{symbol:"UZS",name:"Uzbekistan Som",symbol_native:"UZS",decimal_digits:0,rounding:0,code:"UZS",name_plural:"Uzbekistan som"},VEF:{symbol:"Bs.F.",name:"Venezuelan Bolívar",symbol_native:"Bs.F.",decimal_digits:2,rounding:0,code:"VEF",name_plural:"Venezuelan bolívars"},VND:{symbol:"₫",name:"Vietnamese Dong",symbol_native:"₫",decimal_digits:0,rounding:0,code:"VND",name_plural:"Vietnamese dong"},XAF:{symbol:"FCFA",name:"CFA Franc BEAC",symbol_native:"FCFA",decimal_digits:0,rounding:0,code:"XAF",name_plural:"CFA francs BEAC"},XOF:{symbol:"CFA",name:"CFA Franc BCEAO",symbol_native:"CFA",decimal_digits:0,rounding:0,code:"XOF",name_plural:"CFA francs BCEAO"},YER:{symbol:"YR",name:"Yemeni Rial",symbol_native:"ر.ي.‏",decimal_digits:0,rounding:0,code:"YER",name_plural:"Yemeni rials"},ZAR:{symbol:"R",name:"South African Rand",symbol_native:"R",decimal_digits:2,rounding:0,code:"ZAR",name_plural:"South African rand"},ZMK:{symbol:"ZK",name:"Zambian Kwacha",symbol_native:"ZK",decimal_digits:0,rounding:0,code:"ZMK",name_plural:"Zambian kwachas"}}),WM.module("wm.widgets.live").service("LiveWidgetUtils",["Utils","$rootScope","FormWidgetUtils","PropertiesFactory","$compile","CONSTANTS","WidgetUtilService","Variables","QueryBuilder","DialogService",function(Utils,$rs,FormWidgetUtils,PropertiesFactory,$compile,CONSTANTS,WidgetUtilService,Variables,QueryBuilder,DialogService){"use strict";function formatBooleanValue(value){return"true"===value||"false"!==value&&value}function getEventTypes(widgetType){return widgetType?_.includes(keyEventsWidgets,widgetType.toLowerCase())?allEventTypes:eventTypes:allEventTypes}function getDefaultValue(value,type,widget){return _.startsWith(value,"bind:")?value:widget?"number"===widget||"slider"===widget||"currency"===widget?isNaN(Number(value))?null:Number(value):"checkbox"===widget||"toggle"===widget?formatBooleanValue(value):value:Utils.isNumberType(type)?isNaN(Number(value))?null:Number(value):"boolean"===type?formatBooleanValue(value):value}function getLiveWidgetButtons(widgetType){var defaultButtons;switch(widgetType){case"LIVEFORM":defaultButtons=[{key:"reset",class:"form-reset btn-secondary",iconclass:"wi wi-refresh",action:"reset()",displayName:"Reset",show:"true",type:"button",updateMode:!0,shortcutkey:""},{key:"cancel",class:"form-cancel btn-secondary",iconclass:"wi wi-cancel",action:"cancel()",displayName:"Cancel",show:"true",type:"button",updateMode:!0,shortcutkey:""},{key:"save",class:"form-save btn-success",iconclass:$rs.isMobileApplicationType?"wi wi-done":"wi wi-save",action:"",displayName:"Save",show:"true",type:"submit",updateMode:!0,shortcutkey:""},{key:"delete",class:"form-delete btn-secondary",iconclass:"wi wi-trash",action:"delete()",displayName:"Delete",show:"true",type:"button",updateMode:!1,shortcutkey:""},{key:"edit",class:"form-update btn-secondary",iconclass:"wi wi-pencil",action:"edit()",displayName:"Edit",show:"true",type:"button",updateMode:!1,shortcutkey:""},{key:"new",class:"form-new btn-success",iconclass:"wi wi-plus",action:"new()",displayName:"New",show:"true",type:"button",updateMode:!1,shortcutkey:""}];break;case"LIVEFILTER":defaultButtons=[{key:"filter",class:"btn-primary",iconclass:"wi wi-filter-list",action:"filter()",displayName:"Filter",show:"true",type:"button",shortcutkey:""},{key:"clear",class:"btn-secondary",iconclass:"wi wi-trash",action:"clearFilter()",displayName:"Clear",show:"true",type:"button",shortcutkey:""}];break;case"GRID":defaultButtons=[{key:"addNewRow",displayName:"New",iconclass:"wi wi-plus",show:"true",class:"btn-primary",action:"addNewRow()",position:"footer",shortcutkey:""}];break;case"GRIDROW":defaultButtons=[{key:"updaterow",displayName:"",title:"Edit",iconclass:"wi wi-pencil",show:"true",class:"btn-transparent",action:"editRow()"},{key:"deleterow",displayName:"",title:"Delete",iconclass:"wi wi-trash",show:"true",class:"btn-transparent",action:"deleteRow()"}]}return defaultButtons}function getFieldTypeWidgetTypesMap(){var fieldTypeWidgetTypeMap={integer:["number","text","select","checkboxset","radioset","rating","slider","currency","autocomplete","chips"],big_integer:["number","text","select","checkboxset","radioset","rating","slider","currency","autocomplete","chips"],short:["number","text","select","checkboxset","radioset","slider","currency","autocomplete","chips"],float:["number","text","select","checkboxset","radioset","slider","currency","autocomplete","chips"],big_decimal:["number","text","select","checkboxset","radioset","slider","currency","autocomplete","chips"],double:["number","text","select","checkboxset","radioset","slider","currency","autocomplete","chips"],long:["number","text","select","checkboxset","radioset","rating","slider","currency","autocomplete","chips"],byte:["number","text","select","checkboxset","radioset","slider","currency","autocomplete","chips"],string:["text","number","textarea","password","richtext","select","checkboxset","radioset","date","time","timestamp","switch","currency","autocomplete","chips","colorpicker"],character:["text","number","textarea","password","richtext","select","checkboxset","radioset","switch","currency","autocomplete","chips"],text:["text","number","textarea","password","richtext","select","checkboxset","radioset","date","time","timestamp","switch","currency","autocomplete","chips","colorpicker"],date:["date","text","number","select","checkboxset","radioset","autocomplete","chips"],time:["time","text","number","select","checkboxset","radioset","autocomplete","chips"],timestamp:["timestamp","text","number","select","checkboxset","radioset","autocomplete","chips"],datetime:["datetime","text","select","checkboxset","radioset","autocomplete","chips"],boolean:["checkbox","radioset","toggle","select"],list:["select","radioset","checkboxset","switch","autocomplete","chips"],clob:["text","textarea","richtext"],blob:["upload"],custom:["text","number","textarea","password","checkbox","slider","richtext","currency","switch","select","checkboxset","radioset","date","time","timestamp","rating","datetime","autocomplete","chips","colorpicker"]};return fieldTypeWidgetTypeMap}function getMatchModeTypesMap(){var matchModeTypesMap={integer:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],big_integer:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],short:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],float:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],big_decimal:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],double:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],long:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],byte:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],string:["anywhere","start","end","exact","notequals","null","isnotnull","empty","isnotempty","nullorempty"],character:["exact","notequals","null","isnotnull","empty","isnotempty","nullorempty"],text:["anywhere","start","end","exact","notequals","null","isnotnull","empty","isnotempty","nullorempty"],date:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],time:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],timestamp:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],datetime:["exact","notequals","lessthan","lessthanequal","greaterthan","greaterthanequal","null","isnotnull"],boolean:["exact","null","isnotnull"],clob:[],blob:[]};return matchModeTypesMap}function toBoolean(val,identity){return"false"!==val&&("true"===val||""===val||val===identity||val)}function getColumnDef(attrs){var columnDef={},widgetType=attrs.widget||attrs.widgetType&&attrs.widgetType.toLowerCase()||getFieldTypeWidgetTypesMap()[attrs.type||"text"][0],excludeKeys=["$attr","$$element","initWidget","role","wmResizable","wmWidgetDrag","value"],booleanAttrs=["readonly","multiple","required","disabled","primaryKey"];return _.each(attrs,function(value,key){return _.includes(booleanAttrs,key)?void(columnDef[key]=toBoolean(value,key)):void(_.includes(excludeKeys,key)||(columnDef[key]=value))}),columnDef.displayname=attrs.displayname||attrs.caption,columnDef.pcDisplay=!WM.isDefined(attrs.pcDisplay)||"true"===attrs.pcDisplay,columnDef.mobileDisplay=!WM.isDefined(attrs.mobileDisplay)||"true"===attrs.mobileDisplay,columnDef.type=attrs.type||"text",columnDef.widget=widgetType,columnDef.show=!WM.isDefined(attrs.show)||"false"!==attrs.show&&("true"===attrs.show||attrs.show),columnDef.name=columnDef.name||columnDef.key||columnDef.field,columnDef}function getButtonDef(attrs){return{key:attrs.key||attrs.binding,displayName:attrs.displayName||attrs.label||attrs.caption||"",show:attrs.show||"false",class:attrs.class||"",iconclass:attrs.iconclass,title:_.isUndefined(attrs.title)?attrs.displayName||"":attrs.title,action:attrs.action,accessroles:attrs.accessroles,shortcutkey:attrs.shortcutkey,disabled:attrs.disabled||"false",tabindex:attrs.tabindex?+attrs.tabindex:void 0}}function getStepValue(type){switch(type){case"text":return"";case"float":case"double":case"big_decimal":return.01;case"long":case"integer":return 1;default:return}}function getCaptionByWidget(type,index,isRelated){if(isRelated)return"{{getDisplayExpr(formFields["+index+"].value, formFields["+index+"].displayexpression || formFields["+index+"].displayfield || formFields["+index+"].displaylabel)}}";if("password"===type)return"********";var caption="formFields["+index+"].value";return"datetime"===type||"timestamp"===type?caption+=" | date:formFields["+index+"].datepattern || 'yyyy-MM-dd hh:mm:ss a'":"time"===type?caption+=" | date:formFields["+index+"].timepattern ||  'hh:mm a'":"date"===type?caption+=" | date:formFields["+index+"].datepattern ||  'yyyy-MM-dd'":"rating"!==type&&"upload"!==type||(caption=""),"{{"+caption+"}}"}function getFormFields(fieldDef){var evtTypes,excludeProperties,fieldKeys,fields="",formEvents=Utils.getClonedObject(definedEvents);return"autocomplete"===fieldDef.widget&&(_.pull(formEvents,"onChange"),formEvents.push("onSubmit")),evtTypes=_.pull(getEventTypes(),formEvents),excludeProperties=formEvents.concat(["caption","type","show","placeholder","maxPlaceholder","readonly","inputtype","widgettype","dataset","key","field","pcDisplay","mobileDisplay","generator","isRelated","displayname","primaryKey","step","widget","validationmessage","permitted"]),fieldKeys=_.pullAll(_.keys(fieldDef),excludeProperties),_.forEach(fieldKeys,function(field){if(fieldDef[field])switch(field){case"name":fields+=' name="'+fieldDef[field]+'_formWidget"';break;case"widgetid":fields+=' widgetid="'+fieldDef.widgetid+"_"+fieldDef.name+'"';break;case"textAlignment":fields+=' textalign="'+fieldDef[field]+'"';break;case"ngclass":fields+=' ng-class="'+fieldDef[field]+'"';break;default:fields+=_.includes(evtTypes,field)?" "+Utils.hyphenate(field)+'="'+fieldDef[field]+'"':_.isString(fieldDef[field])?" "+field+'="'+fieldDef[field].replace(/"/g,"'")+'"':" "+field+'="'+fieldDef[field]+'"'}}),_.forEach(formEvents,function(evt){fields+=" "+Utils.hyphenate(evt)+'="_'+evt+"Field($event, $scope, newVal, oldVal);"+(fieldDef[evt]||"")+'"'}),fields}function getDataSetFields(fieldDef,index,$el){var template;return template="autocomplete"===fieldDef.widget||"typeahead"===fieldDef.widget?' datafield="{{formFields['+index+'].datafield}}" searchkey="{{formFields['+index+'].searchkey}}" displaylabel="{{formFields['+index+'].displaylabel}}"':' datafield="{{formFields['+index+'].datafield}}" displayfield="{{formFields['+index+'].displayfield}}"',fieldDef.dataset?template=template+' dataset="{{formFields['+index+'].dataset}}" ':CONSTANTS.isStudioMode&&$el?(template+=' dataset="Option 1, Option 2, Option 3" ',$el.attr("data-evaluated-dataset","")):template=template+' scopedataset="formFields['+index+'].dataset" dataset="" ',template}function getDefaultTemplate(widgetType,fieldDef,index,minPlaceholderDefault,maxPlaceholderDefault,defaultPlaceholder,additionalFields,isCustomWidget){var template="",widgetName="wm-"+widgetType,updateModeCondition=isCustomWidget?"":"richtexteditor"===widgetType?'show = "bind:isUpdateMode"':'ng-if="isUpdateMode"',allowInvalidAttr="number"===fieldDef.widget?" allowinvalid=true ":"",readonly="richtexteditor"!==widgetType||fieldDef.readonly?'readonly="{{!isUpdateMode || formFields['+index+'].readonly}}"':"";return additionalFields=additionalFields||"",fieldDef.isRange?(fieldDef.placeholder=fieldDef.displayformat?"":_.isUndefined(fieldDef.placeholder)?minPlaceholderDefault:fieldDef.placeholder,fieldDef.maxPlaceholder=fieldDef.displayformat?"":_.isUndefined(fieldDef.maxPlaceholder)?maxPlaceholderDefault:fieldDef.maxPlaceholder,template=template+'<div class="'+($rs.isMobileApplicationType?"col-xs-6":"col-sm-6")+'"><'+widgetName+" "+getFormFields(fieldDef,index,widgetType)+' scopedatavalue="formFields['+index+'].minValue" placeholder="{{formFields['+index+'].placeholder}}" readonly="{{!isUpdateMode || formFields['+index+'].readonly}}"'+allowInvalidAttr+updateModeCondition+additionalFields+"></"+widgetName+'></div><div class="'+($rs.isMobileApplicationType?"col-xs-6":"col-sm-6")+'"><'+widgetName+" "+getFormFields(fieldDef,index,widgetType)+' scopedatavalue="formFields['+index+'].maxValue" placeholder="{{formFields['+index+'].maxPlaceholder}}" readonly="{{!isUpdateMode || formFields['+index+'].readonly}}"'+allowInvalidAttr+updateModeCondition+additionalFields+"></"+widgetName+"></div>"):(fieldDef.placeholder=fieldDef.displayformat?"":_.isUndefined(fieldDef.placeholder)?defaultPlaceholder:fieldDef.placeholder,template=template+"<"+widgetName+" "+getFormFields(fieldDef,index,widgetType)+' scopedatavalue="formFields['+index+'].value" placeholder="{{formFields['+index+'].placeholder}}"'+readonly+allowInvalidAttr+updateModeCondition+additionalFields+"></"+widgetName+">"),template}function getDateTimeTemplate(fieldDef,index){return getDefaultTemplate("datetime",fieldDef,index,"Select Min date time","Select Max date time","Select date time")}function getTimeTemplate(fieldDef,index){return getDefaultTemplate("time",fieldDef,index,"Select Min time","Select Max time","Select time")}function getDateTemplate(fieldDef,index){return getDefaultTemplate("date",fieldDef,index,"Select Min date","Select Max date","Select date")}function getFileUploadTemplate(fieldDef,index){var template="",events=["change","click","focus","blur","mouseenter","mouseleave"],eventTl="";return _.forEach(events,function(event){var eventName="on"+_.capitalize(event);fieldDef[eventName]&&(eventTl+=" ng-"+event+'="'+fieldDef[eventName]+'"')}),template="image"===fieldDef.filetype?template+'<a class="form-control-static" target="_blank" href="{{formFields['+index+'].href}}" ng-show="formFields['+index+'].href"><img style="height:2em" class="wi wi-file" ng-src="{{formFields['+index+'].href}}"/></a>':template+'<a class="form-control-static" target="_blank" href="{{formFields['+index+'].href}}" ng-show="formFields['+index+'].href"><i class="wi wi-file"></i></a>',template=template+'<input wm-valid-file class="app-blob-upload" data-ng-class="{\'file-readonly\': formFields['+index+'].readonly}" required="{{formFields['+index+'].required}}" type="file" name="{{formFields['+index+'].key}}" ng-required="{{formFields['+index+'].required}}" ng-readonly="{{formFields['+index+'].readonly}}" data-ng-show="isUpdateMode" data-ng-model="formFields['+index+'].value" accept="{{formFields['+index+'].permitted}}"'+eventTl+"/>"}function getTextareaTemplate(fieldDef,index){return getDefaultTemplate("textarea",fieldDef,index,"","","Enter value")}function getRichtextTemplate(fieldDef,index){return getDefaultTemplate("richtexteditor",fieldDef,index,"","","Enter value")}function getSliderTemplate(fieldDef,index){var additionalFields,stepVal=fieldDef.step||getStepValue(fieldDef.type);return additionalFields=stepVal?' step="'+stepVal+'" ':"",getDefaultTemplate("slider",fieldDef,index,"","","",additionalFields)}function getColorPickerTemplate(fieldDef,index){return getDefaultTemplate("colorpicker",fieldDef,index,"Select Color","Select Color","Select Color")}function getChipsTemplate(fieldDef,index){var additionalFields=getDataSetFields(fieldDef,index);return getDefaultTemplate("chips",fieldDef,index,"","","Type here...",additionalFields)}function getRadiosetTemplate(fieldDef,index,$el){var additionalFields=getDataSetFields(fieldDef,index,$el);return getDefaultTemplate("radioset",fieldDef,index,"","","",additionalFields)}function getCheckboxsetTemplate(fieldDef,index,$el){var additionalFields=getDataSetFields(fieldDef,index,$el);return getDefaultTemplate("checkboxset",fieldDef,index,"","","",additionalFields)}function getCheckboxTemplate(fieldDef,index,widgetType){var additionalFields="toggle"===widgetType?'type="toggle"':"";return getDefaultTemplate("checkbox",fieldDef,index,"","","",additionalFields)}function getSelectTemplate(fieldDef,index){var additionalFields=getDataSetFields(fieldDef,index);return getDefaultTemplate("select",fieldDef,index,"Select Min value","Select Max value","Select value",additionalFields)}function getTextNumberTemplate(fieldDef,index){var stepVal,additionalFields;return stepVal=fieldDef.step||getStepValue(fieldDef.type),additionalFields='type="{{formFields['+index+'].inputtype}}" '+(stepVal?' step="'+stepVal+'"':""),getDefaultTemplate("text",fieldDef,index,"Enter Min value","Enter Max value","Enter value",additionalFields)}function getRatingTemplate(fieldDef,index){var additionalFields=' maxvalue="{{formFields['+index+'].maxvalue}}" ';return getDefaultTemplate("rating",fieldDef,index,"","","",additionalFields,!0)}function getSwitchTemplate(fieldDef,index,$el){var additionalFields=getDataSetFields(fieldDef,index,$el);return getDefaultTemplate("switch",fieldDef,index,"","","",additionalFields)}function getCurrencyTemplate(fieldDef,index){var additionalFields,stepVal=fieldDef.step||getStepValue(fieldDef.type);return additionalFields='currency="{{formFields['+index+'].currency}}" '+stepVal?' step="'+stepVal+'" ':"",getDefaultTemplate("currency",fieldDef,index,"Enter Min value","Enter Max value","Enter value",additionalFields)}function getSearchTemplate(fieldDef,index){var additionalFields=' type="autocomplete" relatedfield="{{formFields['+index+'].relatedfield}}"  width="{{formFields['+index+'].width}}"'+getDataSetFields(fieldDef,index);return getDefaultTemplate("search",fieldDef,index,"","","Search",additionalFields)}function getHiddenTemplate(fieldDef,index){var additionalFields='type="hidden" ';return getDefaultTemplate("text",fieldDef,index,"","","",additionalFields)}function getTemplate(fieldDef,index,captionPosition,$el){var widgetType,labelLayout,controlLayout,template="",fieldTypeWidgetTypeMap=getFieldTypeWidgetTypesMap(),displayLabel="";switch(captionPosition=captionPosition||"top",fieldDef.readonly&&"identity"===fieldDef.generator&&(fieldDef.placeholder=fieldDef.placeholder||""),"top"===captionPosition?$rs.selectedViewPort&&"android"===$rs.selectedViewPort.os||!$rs.isMobileApplicationType||Utils.isAndroid()?labelLayout=controlLayout="col-xs-12":$rs.isMobileApplicationType&&(labelLayout="col-xs-4",controlLayout="col-xs-8"):(labelLayout=$rs.isMobileApplicationType?"col-xs-4":"col-sm-3",controlLayout=$rs.isMobileApplicationType?"col-xs-8":"col-sm-9"),widgetType=fieldDef.widget||fieldTypeWidgetTypeMap[fieldDef.type][0],widgetType=widgetType.toLowerCase(),fieldDef.displayname?displayLabel='<label class="app-label control-label formfield-label '+labelLayout+'" title="{{formFields['+index+"].displayname}}\" ng-class=\"{'text-danger': ngform['"+fieldDef.name+"_formWidget'].$invalid &&  ngform['"+fieldDef.name+"_formWidget'].$touched && isUpdateMode, required: isUpdateMode && formFields["+index+'].required}">{{formFields['+index+"].displayname}}</label>":controlLayout=$rs.isMobileApplicationType?"col-xs-12":"col-sm-12",fieldDef.displayname=CONSTANTS.isRunMode&&_.startsWith(fieldDef.displayname,"bind:")?"":fieldDef.displayname,template=template+'<div class="live-field form-group app-composite-widget clearfix caption-{{captionposition}}" widget="'+widgetType+'" >'+displayLabel+'<div class="'+controlLayout+" {{formFields["+index+'].class}}"><label class="form-control-static app-label" ng-show="!isUpdateMode">'+getCaptionByWidget(widgetType,index,fieldDef.isRelated)+"</label>",widgetType){case"number":case"text":case"password":template+=getTextNumberTemplate(fieldDef,index);break;case"select":template+=getSelectTemplate(fieldDef,index);break;case"checkbox":case"toggle":template+=getCheckboxTemplate(fieldDef,index,widgetType);break;case"checkboxset":template+=getCheckboxsetTemplate(fieldDef,index,$el);break;case"radioset":template+=getRadiosetTemplate(fieldDef,index,$el);break;case"slider":template+=getSliderTemplate(fieldDef,index);break;case"colorpicker":template+=getColorPickerTemplate(fieldDef,index);break;case"chips":template+=getChipsTemplate(fieldDef,index);break;case"richtext":template+=getRichtextTemplate(fieldDef,index);break;case"textarea":template+=getTextareaTemplate(fieldDef,index);break;case"upload":template+=getFileUploadTemplate(fieldDef,index);break;case"date":template+=getDateTemplate(fieldDef,index);break;case"time":template+=getTimeTemplate(fieldDef,index);break;case"datetime":case"timestamp":template+=getDateTimeTemplate(fieldDef,index);break;case"rating":template+=getRatingTemplate(fieldDef,index);break;case"switch":template+=getSwitchTemplate(fieldDef,index,$el);break;case"currency":template+=getCurrencyTemplate(fieldDef,index);break;case"typeahead":case"autocomplete":template+=getSearchTemplate(fieldDef,index);break;default:template+=getDefaultTemplate("text",fieldDef,index,"Enter Min value","Enter Max value","Enter value")}return template+=fieldDef.hint?'<p class="help-block" ng-if="!(ngform[\''+fieldDef.name+"_formWidget'].$invalid &&  ngform['"+fieldDef.name+"_formWidget'].$touched) && isUpdateMode\">{{formFields["+index+"].hint}}</p>":"",template=template+"<p ng-if=\"ngform['"+fieldDef.name+"_formWidget'].$invalid &&  ngform['"+fieldDef.name+'_formWidget\'].$touched && isUpdateMode" class="help-block text-danger">{{formFields['+index+"].validationmessage}}</p>",template+="</div></div>"}function translateVariableObject(rawObject,scope){var translatedObj=[],columnArray=rawObject.propertiesMap?rawObject.propertiesMap.columns:void 0,fieldNames=[],widgetsMap=getFieldTypeWidgetTypesMap();return scope&&(scope.propertiesMap=rawObject.propertiesMap,scope.columnArray=scope.propertiesMap.columns,scope.primaryKey=scope.primaryKey||[]),_.each(columnArray,function(fieldObj){if(!fieldObj.systemInserted&&!fieldObj.systemUpdated){var column;_.includes(fieldNames,fieldObj.fieldName)||fieldObj.readonly||(fieldNames.push(fieldObj.fieldName),column={displayname:Utils.prettifyLabel(fieldObj.fieldName),show:!0,primaryKey:fieldObj.isPrimaryKey,generator:fieldObj.generator,key:fieldObj.fieldName,value:"",type:fieldObj.isRelated?"list":fieldObj.fullyQualifiedType,maxvalue:"",isRelated:fieldObj.isRelated,readonly:fieldObj.isPrimaryKey,required:"true"===fieldObj.notNull||fieldObj.notNull===!0,pcDisplay:!0,mobileDisplay:!0},Utils.isNumberType(column.type)&&(column.step=fieldObj.scale?Math.pow(10,fieldObj.scale*-1):0),column.widget=widgetsMap[column.type||"custom"][0],fieldObj.defaultValue&&(column.defaultvalue=getDefaultValue(fieldObj.defaultValue,fieldObj.type)),"string"!==fieldObj.type&&"character"!==fieldObj.type&&"text"!==fieldObj.type&&"blob"!==fieldObj.type&&"clob"!==fieldObj.type||(column.maxchars=fieldObj.length),fieldObj.isPrimaryKey&&("assigned"===fieldObj.generator?column.readonly=!1:column.show=!1),translatedObj.push(column))}}),translatedObj}function getColumnCountByLayoutType(layout,numOfColumns){if(layout){var layoutObj={"One Column":1,"Two Column":2,"Three Column":3,"Four Column":4};return layoutObj[layout]||1}return numOfColumns||1}function getCustomFieldKey(fields,key,prefix,definedKeys){var index,keys=definedKeys||fields.map(function(event){return event[key]});if(keys&&_.includes(keys,prefix)){for(index=1;_.includes(keys,prefix+index);)index+=1;prefix+=index}return prefix}function splitDimension(column,type){var value,unit,width,height,getValue=function(val){return val=parseInt(val,10),isNaN(val)?"":val};switch(type){case"width":width=column.width||"",value=getValue(width),unit=width.indexOf("%")===-1?"px":"%",column.widthValue=value,column.widthUnit=unit;break;case"height":height=column.height||"",value=getValue(height),unit=height.indexOf("%")===-1?"px":"%",column.heightValue=value,column.heightUnit=unit}}function mergeDimension(column,type){switch(type){case"width":WM.isDefined(column.widthValue)&&""!==column.widthValue&&!isNaN(column.widthValue)?column.width=column.widthValue+column.widthUnit:(!column.widthValue||!column.widthValue.length&&Utils.stringStartsWith(column.width,column.widthValue))&&(column.width=void 0),column.widthValue=void 0,column.widthUnit=void 0;break;case"height":WM.isDefined(column.heightValue)&&""!==column.heightValue&&!isNaN(column.heightValue)?column.height=column.heightValue+column.heightUnit:(!column.heightValue||!column.heightValue.length&&Utils.stringStartsWith(column.width,column.heightValue))&&(column.height=void 0),column.heightValue=void 0,column.heightUnit=void 0}}function fieldPropertyChangeHandler(scope,element,attrs,parentScope,index,key,newVal){function compileField(){CONSTANTS.isRunMode&&(template=getTemplate(parentScope.formFields[index],index,parentScope.captionposition),element.find(".ng-isolate-scope").each(function(){var elIscope=WM.element(this).isolateScope();elIscope&&elIscope.$destroy()}),element.find(".live-field").remove(),element.append(template),$compile(element.contents())(parentScope))}function setFormField(){CONSTANTS.isRunMode&&(parentScope.formFields[index][key]=newVal)}var template="",wdgtProperties=scope.widgetProps,formWidget=parentScope.Widgets[scope.name+"_formWidget"];switch(formWidget&&"show"!==key&&(formWidget[key]=newVal),key){case"dataset":scope.widgetid&&isDataSetWidgets[attrs.widget]&&WM.isDefined(newVal)&&null!==newVal&&(""===newVal&&scope.$root.$emit("set-markup-attr",scope.widgetid,{datafield:"",searchkey:"",displaylabel:"",displayfield:""}),WidgetUtilService.updatePropertyPanelOptions(scope),"autocomplete"===scope.widget&&FormWidgetUtils.updatePropertyOptionsWithParams(scope),element.removeAttr("data-evaluated-dataset"));break;case"inputtype":FormWidgetUtils.setPropertiesTextWidget(wdgtProperties,newVal);break;case"show":CONSTANTS.isStudioMode&&newVal&&(Utils.getService("LiveWidgetsMarkupManager").updateFieldMarkup({formName:parentScope.name,fieldName:scope.name}),element.parents('[widgettype="wm-gridcolumn"]').removeClass("hide")),setFormField(),compileField();break;case"displayname":element.find("label.formfield-label").attr("title",newVal).text(newVal),setFormField();break;case"disabled":case"readonly":case"required":case"validationmessage":case"hint":setFormField();break;case"active":"number"!==scope.widget&&"password"!==scope.widget&&"text"!==scope.widget||FormWidgetUtils.setPropertiesTextWidget(wdgtProperties,scope.inputtype)}}function getWidgetProps(widgetType,fieldType){var widgetProps,baseProperties,extendedProperties,textWidgets=["text","number","password"],setDefaultValueProps=function(){var defaultProp;defaultProp="radioset"===widgetType?"selectedvalue":"checkboxset"===widgetType?"selectedvalues":"switch"===widgetType?"defaultvalue":"datavalue",widgetProps[defaultProp]&&(widgetProps.defaultvalue=WM.copy(widgetProps[defaultProp]),widgetProps[defaultProp].show=!1),_.set(widgetProps.datavalue,"ignoreGetterSetters",!0)};switch(widgetType=widgetType.toLowerCase()){case"textarea":baseProperties="wm.textarea",extendedProperties=["wm.base","wm.base.editors","wm.base.editors.abstracteditors","wm.base.events.keyboard"];break;case"toggle":case"checkbox":baseProperties="wm.checkbox",extendedProperties=["wm.base","wm.base.editors.abstracteditors"];
break;case"slider":baseProperties="wm.slider",extendedProperties=["wm.base","wm.base.events.change"];break;case"colorpicker":baseProperties="wm.colorpicker",extendedProperties=["wm.base","wm.base.events","wm.base.events.focus","wm.base.events.change"];break;case"chips":baseProperties="wm.chips",extendedProperties=["wm.base","wm.base.editors.dataseteditors"];break;case"richtext":baseProperties="wm.richtexteditor",extendedProperties=["wm.base"];break;case"select":baseProperties="wm.select",extendedProperties=["wm.base","wm.base.editors","wm.base.editors.abstracteditors","wm.base.editors.dataseteditors","wm.base.events.keyboard"];break;case"checkboxset":baseProperties="wm.checkboxset",extendedProperties=["wm.base","wm.base.editors.dataseteditors"];break;case"radioset":baseProperties="wm.radioset",extendedProperties=["wm.base","wm.base.editors.dataseteditors"];break;case"date":baseProperties="wm.date",extendedProperties=["wm.base","wm.base.editors.abstracteditors","wm.base.datetime"];break;case"time":baseProperties="wm.time",extendedProperties=["wm.base","wm.base.editors.abstracteditors","wm.base.datetime"];break;case"datetime":case"timestamp":baseProperties="wm.datetime",extendedProperties=["wm.base","wm.base.editors.abstracteditors","wm.base.datetime"];break;case"rating":baseProperties="wm.rating",extendedProperties=["wm.base","wm.base.editors"];break;case"upload":baseProperties="",extendedProperties=["wm.base","wm.base.editors","wm.base.editors.abstracteditors"];break;case"switch":baseProperties="wm.switch",extendedProperties=["wm.base","wm.base.editors.abstracteditors"];break;case"currency":baseProperties="wm.currency",extendedProperties=["wm.base","wm.base.editors","wm.base.editors.abstracteditors"];break;case"typeahead":case"autocomplete":baseProperties="wm.search",extendedProperties=["wm.base","wm.base.editors.abstracteditors"];break;default:baseProperties="wm.text",extendedProperties=["wm.base","wm.base.editors","wm.base.editors.abstracteditors","wm.base.events.keyboard"]}return widgetProps=PropertiesFactory.getPropertiesOf(baseProperties,extendedProperties),widgetProps.displayname={type:"string",show:!0,bindable:"in-bound"},widgetProps.widget={type:"label",show:!0},"wm-form-field"===fieldType&&(widgetProps.validationmessage={type:"string",bindable:"in-bound"},widgetProps.validationmessage.show=widgetProps.required&&widgetProps.required.show),_.includes(textWidgets,widgetType)?(widgetProps.inputtype=WM.copy(widgetProps.type),delete widgetProps.type):isDataSetWidgets[widgetType]?(widgetProps.dataset.value="",widgetProps.datafield.value="",_.set(widgetProps.displayvalue,"ignoreGetterSetters",!0),"autocomplete"===widgetType&&(widgetProps.type.show=!1)):"upload"===widgetType&&(widgetProps=WM.extend(widgetProps,{readonly:{type:"boolean",bindable:"in-bound",show:!0},filetype:{type:"data-list",options:["image","audio","video"],show:!0},extensions:{type:"string",show:!0},onTap:{show:!1}})),setDefaultValueProps(),widgetProps.scopedatavalue&&delete widgetProps.scopedatavalue,widgetProps.scopedataset&&delete widgetProps.scopedataset,widgetProps}function handleBackwardCompatibility(fieldType,scope,attrs,tElement){var changeAttr=function(newAttr,oldAttr){scope[newAttr]=attrs[newAttr]=attrs[oldAttr],WM.element(tElement.context).attr(newAttr,scope[newAttr]),delete attrs[oldAttr]};!attrs.defaultvalue&&attrs.defaultValue&&changeAttr("defaultvalue","defaultValue"),!attrs.displayname&&attrs.displayName&&changeAttr("displayname","displayName"),attrs.maxchars||!attrs.maxvalue||"text"!==attrs.inputtype&&"password"!==attrs.inputtype&&"textarea"!==attrs.widget||changeAttr("maxchars","maxvalue"),"date"!==attrs.widget&&"datetime"!==attrs.widget||(attrs.minvalue&&changeAttr("mindate","minvalue"),attrs.maxvalue&&changeAttr("maxdate","maxvalue")),attrs.minPlaceholder&&!attrs.placeholder&&"wm-filter-field"===fieldType&&changeAttr("placeholder","minPlaceholder"),!attrs.displayexpression&&attrs.displayvalue&&changeAttr("displayexpression","displayvalue")}function preProcessFields(fieldType,scope,attrs,tElement){var inputtype;scope.widgettype=fieldType,attrs.widget=attrs.widget||attrs.widgetType&&attrs.widgetType.toLowerCase()||getFieldTypeWidgetTypesMap()[attrs.type||"text"][0],scope.widget=attrs.widget,WM.element(tElement.context).attr("widget",scope.widget),"text"===attrs.widget?inputtype=attrs.inputtype||"text":"number"===attrs.widget?inputtype="number":"password"===attrs.widget&&(inputtype="password"),scope.inputtype=attrs.inputtype=inputtype,WM.element(tElement.context).attr("inputtype",inputtype),handleBackwardCompatibility(fieldType,scope,attrs,tElement),scope.widgetProps=getWidgetProps(attrs.widget,fieldType)}function parseNgClasses(classExpression){var conditionalClasses,ngClasses=[];return defaultNgClassesConfig={className:"",condition:""},classExpression?(conditionalClasses=classExpression.substring(1,classExpression.length-1).split(","),_.each(conditionalClasses,function(conditionalClassConfig){var conditionalExpression=conditionalClassConfig.split(":"),className=conditionalExpression[0].trim(),classCondition=conditionalExpression[1].trim(),classNameLen=className.length,config=WM.copy(defaultNgClassesConfig);"'"===className[0]&&"'"===className[classNameLen-1]&&(className=className.substring(1,classNameLen-1)),config.className=className,config.condition=classCondition,ngClasses.push(config)}),ngClasses):(ngClasses.push(WM.copy(defaultNgClassesConfig)),ngClasses)}function generateNgClassExpression(conditionalClasses){var ngClassExpression="";return _.each(conditionalClasses,function(config){config.className&&config.condition&&(ngClassExpression.length&&(ngClassExpression+=", "),ngClassExpression+="'"+config.className+"':"+config.condition)}),ngClassExpression.length?"{"+ngClassExpression+"}":ngClassExpression}function setColumnCustomExpression(column){var widgetNgClassesExpression=generateNgClassExpression(column.widgetConfig.ngClasses);switch(column.widgetType){case"image":"blob"===column.type?(column.widgetConfig.src="{{contentBaseUrl + row[primaryKey] + '/content/'+ colDef.field}}",column.customExpression='<img ng-if="columnValue != null" width="48px" class="" data-ng-src="'+column.widgetConfig.src+'"/>'):column.customExpression='<wm-picture picturesource="'+column.widgetConfig.src+'" hint="'+column.widgetConfig.src+'" class="'+column.widgetConfig.class+'" data-ng-class="'+widgetNgClassesExpression+'"></wm-picture>';break;case"button":column.customExpression='<wm-button caption="'+column.widgetConfig.title+'" show="true" class="'+column.widgetConfig.class+'" iconclass="'+column.widgetConfig.icon+'" on-click="'+column.widgetConfig.action+'" data-ng-class="'+widgetNgClassesExpression+'"></wm-button>';break;case"checkbox":column.customExpression='<wm-checkbox scopedatavalue="'+column.widgetConfig.model+'" disabled="'+column.widgetConfig.disabled+'" class = "'+column.widgetConfig.class+'" data-ng-class="'+widgetNgClassesExpression+'"></wm-checkbox>';break;case"anchor":column.customExpression='<wm-anchor caption="'+column.widgetConfig.title+'" hyperlink="'+column.widgetConfig.hyperlink+'" class = "'+column.widgetConfig.class+'" data-ng-class="'+widgetNgClassesExpression+'"></wm-anchor>';break;case"label":column.customExpression='<wm-label caption="'+column.widgetConfig.title+'" class = "'+column.widgetConfig.class+'" data-ng-class="'+widgetNgClassesExpression+'"></wm-label>';break;case"icon":column.customExpression='<wm-icon caption="'+column.widgetConfig.title+'" iconclass="'+column.widgetConfig.icon+'" iconposition="'+column.widgetConfig.iconposition+'" class = "'+column.widgetConfig.class+'" data-ng-class="'+widgetNgClassesExpression+'"></wm-icon>';break;default:"blob"===column.type&&(column.customExpression='<a data-ng-if="columnValue != null" class="col-md-9" target="_blank" data-ng-href="{{contentBaseUrl + row[primaryKey] + \'/content/\'+ colDef.field}}"><i class="wm-icon wm-icon24 wi wi-file"></i></a>')}}function setDefaultWidgetConfig(column){var widgetType=column.widgetType,field=column.field,val="button"===column.widgetType?"{{row.getProperty('"+field+"') || 'Button'}}":"{{row.getProperty('"+field+"')}}",defaultModel="row['"+field+"']",widgetNgClasses=[Utils.getClonedObject(defaultNgClassesConfig)];switch(column.widgetConfig={},widgetType){case"image":column.widgetConfig={src:val,class:"",ngClasses:widgetNgClasses};break;case"button":column.widgetConfig={icon:"",action:"",title:val,class:"btn-sm btn-primary",ngClasses:widgetNgClasses};break;case"checkbox":column.widgetConfig={model:defaultModel,disabled:"{{colDef.readonly || !isGridEditMode}}",class:"",ngClasses:widgetNgClasses};break;case"anchor":column.widgetConfig={title:val,hyperlink:"",class:"",ngClasses:widgetNgClasses};break;case"label":column.widgetConfig={title:val,class:"",ngClasses:widgetNgClasses};break;case"icon":column.widgetConfig={title:val,class:"",icon:"wi wi-star-border",iconposition:"left",ngClasses:widgetNgClasses};break;default:column.widgetConfig={src:val,class:"",ngClasses:widgetNgClasses}}}function extractWidgetConfig(column){var widgetDisabled,widgetAction,widgetIcon,widgetTitle,widgetClass,widgetNgClasses,widgetSrc,widgetModel,widgetHyperlink,el,customExpression=column.customExpression,widgetType=column.widgetType;switch(column.widgetConfig={},Utils.isValidHtml(customExpression)||(customExpression="<span>"+customExpression+"</span>"),el=WM.element(customExpression),widgetClass=el.attr("widget-class")||el.attr("class"),widgetNgClasses=parseNgClasses(el.attr("data-ng-class")),widgetType){case"image":widgetSrc=el.attr("data-ng-src")||el.attr("picturesource"),column.widgetConfig={src:widgetSrc,class:widgetClass,ngClasses:widgetNgClasses};break;case"button":widgetIcon=el.attr("iconclass")||el.attr("iconname"),widgetTitle=el.attr("caption"),widgetAction=el.attr("on-click"),column.widgetConfig={icon:widgetIcon,action:widgetAction,title:widgetTitle,class:widgetClass,ngClasses:widgetNgClasses};break;case"checkbox":widgetModel=el.attr("ng-model")||el.attr("scopedatavalue"),widgetDisabled=el.attr("ng-disabled")||el.get(0).getAttribute("disabled"),column.widgetConfig={model:widgetModel,disabled:widgetDisabled,class:widgetClass,ngClasses:widgetNgClasses};break;case"anchor":widgetTitle=el.attr("caption"),widgetHyperlink=el.attr("hyperlink"),column.widgetConfig={title:widgetTitle,hyperlink:widgetHyperlink,class:widgetClass,ngClasses:widgetNgClasses};break;case"label":widgetTitle=el.attr("caption"),column.widgetConfig={title:widgetTitle,class:widgetClass,ngClasses:widgetNgClasses};break;case"icon":widgetTitle=el.attr("caption"),widgetIcon=el.attr("iconclass"),column.widgetConfig={title:widgetTitle,icon:widgetIcon,class:widgetClass,iconposition:el.attr("iconposition")||"left",ngClasses:widgetNgClasses};break;default:column.widgetConfig={src:"",class:widgetClass,ngClasses:widgetNgClasses}}}function setColumnConfig(column){column.ngClasses=parseNgClasses(column.ngclass),column.customExpression?extractWidgetConfig(column):(setDefaultWidgetConfig(column),setColumnCustomExpression(column))}function fetchPropertiesMapColumns(propertiesMap,bindDataSet){var columnName,primaryKey,columns={},data={},typeUtils=Utils.getService("TypeUtils");return _.forEach(propertiesMap.columns,function(val){if(val.isRelated){if(val.isList)return;data.relatedData=data.relatedData||{};var relatedTableColumns=typeUtils.getFieldsForExpr(bindDataSet+"."+val.fieldName),columnNameTypeMap={};_.each(val.columns,function(column){column.isPrimaryKey&&(primaryKey=column.fieldName),columnNameTypeMap[column.fieldName]=column.type}),data.relatedData[val.relatedEntityName]={columns:relatedTableColumns,primaryKey:primaryKey,columnNameTypeMap:columnNameTypeMap},columnName=val.fieldName.charAt(0).toLowerCase()+val.fieldName.slice(1),columns[columnName]={},columns[columnName].isRelated="true"===val.isRelated||val.isRelated===!0,columns[columnName].relatedEntityName=val.relatedEntityName,columns[columnName].relatedPrimaryKey=primaryKey}else columnName=val.fieldName,columns[columnName]={};columns[columnName].type=val.type,columns[columnName].isPrimaryKey=val.isPrimaryKey,columns[columnName].generator=val.generator}),{columns:columns,relatedData:data.relatedData}}function fetchReferenceDetails($scope,elScope){for(var referenceWidget,referenceBindDataSet,referenceVariableName,relatedFieldName,relatedFieldType,fields,details,referenceVariable,widgetName,bindDataSetSplit,bindDataSet=$scope.binddataset,widgetRegEx=/Widgets./g,WidgetScopes=elScope?elScope.Widgets:$scope.Widgets,isBoundToSelectedItemSubset=bindDataSet.indexOf("selecteditem.")!==-1;null!==widgetRegEx.exec(bindDataSet);)bindDataSetSplit=_.split(bindDataSet.substr(widgetRegEx.lastIndex,bindDataSet.length),"."),widgetName=_.head(bindDataSetSplit),relatedFieldName=isBoundToSelectedItemSubset&&_.last(bindDataSetSplit),referenceWidget=_.get(WidgetScopes,widgetName),WidgetScopes=referenceWidget&&referenceWidget.Widgets;return referenceWidget&&(referenceBindDataSet=referenceWidget.binddataset,referenceVariableName=referenceBindDataSet.replace("bind:Variables.",""),referenceVariableName=referenceVariableName.substr(0,referenceVariableName.indexOf(".")),referenceVariable=Variables.getVariableByName(referenceVariableName),fields=null!==referenceVariable&&$rs.dataTypes&&$rs.dataTypes[referenceVariable.package||referenceVariable.type].fields),details={referenceVariableName:referenceVariableName,referenceWidget:referenceWidget,referenceVariable:referenceVariable,relatedFieldName:relatedFieldName},relatedFieldName&&fields?(relatedFieldType=fields[relatedFieldName].type,details.relatedFieldType=relatedFieldType):details.fields=fields,details}function fetchDynamicData($scope,elScope,success,error){var reference,referenceVariableKey,watchSelectedItem,referenceVariable;reference=fetchReferenceDetails($scope,elScope),referenceVariable=Variables.getVariableByName(reference.referenceVariableName),!$scope.selectedItemWatched&&referenceVariable&&referenceVariable.isRelatedFieldMany(reference.relatedFieldName)&&(watchSelectedItem=reference.referenceWidget.$watch("selecteditem",function(newVal,oldVal){$scope.selectedItemWatched=!0,newVal&&!WM.equals(newVal,oldVal)?!referenceVariableKey&&referenceVariable&&"wm.LiveVariable"===referenceVariable.category&&(referenceVariableKey=referenceVariable.getPrimaryKey(),1===referenceVariableKey.length&&(referenceVariableKey=referenceVariableKey[0]),watchSelectedItem(),reference.referenceWidget.$watch("selecteditem."+referenceVariableKey,function(newVal){newVal?referenceVariable.updateRelatedData({id:reference.referenceWidget.selecteditem[referenceVariableKey],relatedFieldName:reference.relatedFieldName},function(data){WM.isDefined(data)&&Utils.triggerFn(success,data)},function(err){Utils.triggerFn(error,err)}):Utils.triggerFn(success,{})})):Utils.triggerFn(success,void 0)},!0))}function getRowOperationsColumn(){return{field:"rowOperations",type:"custom",displayName:"Actions",width:"120px",readonly:!0,sortable:!1,searchable:!1,resizable:!1,selectable:!1,show:!0,operations:[],opConfig:{},pcDisplay:!0,mobileDisplay:!0,include:!0,isRowOperation:!0}}function getDistinctValues(filterField,variable,callBack){var query,tableName,columns,aliasColumn,fieldColumn,dataSetWidgetTypes=Utils.getDataSetWidgets();fieldColumn=filterField.field,dataSetWidgetTypes[filterField.widget||filterField.filterwidget]&&!filterField.tempDataset&&(filterField.isRelated?(tableName=filterField.lookupType,columns=filterField.lookupField,aliasColumn=columns.replace(".","_"),query=QueryBuilder.getQuery({tableName:tableName,columns:[" DISTINCT "+columns+" AS "+aliasColumn]})):(aliasColumn=fieldColumn,query=QueryBuilder.getQuery({tableName:variable.propertiesMap.entityName,columns:[" DISTINCT "+fieldColumn+" AS "+filterField.field]})),QueryBuilder.executeQuery({databaseName:variable.liveSource,query:query,page:1,size:500,nativeSql:!1,prefabName:variable._prefabName},function(data){callBack(filterField,data,aliasColumn)}))}function setHeaderConfig(headerConfig,config,field){_.forEach(headerConfig,function(cols){cols.isGroup&&(cols.field===field?cols.columns.push(config):setHeaderConfig(cols.columns,config,field))})}function setHeaderConfigForTable(headerConfig,config,$parentEl){_.isEmpty($parentEl)?headerConfig.push(config):setHeaderConfig(headerConfig,config,$parentEl.attr("name"))}function setFormWidgetsValues($el,dataObject){$el&&($el.find('.form-elements [role="input"]').each(function(){var fieldKey,val,$inputEl=WM.element(this);_.isEmpty($inputEl.closest('[data-role="form-field"]'))&&!$inputEl.hasClass("app-composite-widget")&&(fieldKey=$inputEl.attr("key")||$inputEl.attr("name"),val=$inputEl.isolateScope()&&$inputEl.isolateScope().datavalue,val&&!_.has(dataObject,fieldKey)&&(dataObject[fieldKey]=val))}),$el.find('[data-identifier="grid"]').each(function(){var fieldTarget,formWidget=WM.element(this).isolateScope();fieldTarget=_.split(formWidget.key||formWidget.name,"."),1===fieldTarget.length?dataObject[fieldTarget[0]]=formWidget.datavalue||formWidget.dataset:(dataObject[fieldTarget[0]]=dataObject[fieldTarget[0]]||{},dataObject[fieldTarget[0]][fieldTarget[1]]=formWidget.datavalue||formWidget.dataset)}))}function getFormFilterWidgets(element,nameAttr){var wid={};return element.find("[init-widget]").not('[name*="_formWidget"]').each(function(){var _is,$target=WM.element(this);$target.isolateScope&&(_is=$target.isolateScope(),nameAttr?wid[$target.attr(nameAttr)]=_is:_is.name&&(wid[_is.name]=_is))}),wid}function getViewModeWidgets(){return["image","button","checkbox","label","anchor","icon"]}function setCaptionSize(formEle,value){formEle.find(".form-group .app-label.ng-isolate-scope").each(function(){WM.element(this).isolateScope().width=value})}function closeDialog(ele){var dialogEle;dialogEle=ele.closest(".app-dialog"),dialogEle.length&&DialogService.hideDialog(dialogEle.attr("dialogid"))}function fetchRelatedFieldData(columnDef,relatedField,datafield,widget,elScope,parentScope){var primaryKeys,displayField,boundVariable=elScope.Variables[parentScope.variableName||Utils.getVariableName(parentScope)];boundVariable&&(primaryKeys=boundVariable.getRelatedTablePrimaryKeys(relatedField),columnDef.datafield=datafield,displayField="All Fields"===datafield?void 0:datafield,"autocomplete"===widget||"typeahead"===widget?(columnDef.relatedfield=relatedField,columnDef.dataset=parentScope.binddataset,displayField=displayField||(_.isEmpty(primaryKeys)?void 0:primaryKeys[0]),columnDef.searchkey=columnDef.searchkey||displayField,columnDef.displaylabel=columnDef.displaylabel||displayField):boundVariable.getRelatedTableData(relatedField,{},function(response){columnDef.dataset=response,columnDef.isDefinedData=!0,displayField=displayField||(_.isEmpty(primaryKeys)?_.head(_.keys(_.get(response,"[0]"))):primaryKeys[0]),columnDef.displayfield=columnDef.displayfield||displayField}))}function getEditModeWidget(colDef){var fieldTypeWidgetTypeMap=getFieldTypeWidgetTypesMap();return colDef.relatedEntityName&&colDef.primaryKey?"select":fieldTypeWidgetTypeMap[colDef.type]&&fieldTypeWidgetTypeMap[colDef.type][0]||"text"}var keyEventsWidgets=["number","text","select","password","textarea"],definedEvents=["onBlur","onFocus","onChange"],eventTypes=definedEvents.concat(["onMouseleave","onMouseenter","onClick","onSelect","onSubmit"]),allEventTypes=eventTypes.concat("onKeypress","onKeydown","onKeyup"),defaultNgClassesConfig={className:"",condition:""},isDataSetWidgets=Utils.getDataSetWidgets();this.getEventTypes=getEventTypes,this.getDefaultValue=getDefaultValue,this.getLiveWidgetButtons=getLiveWidgetButtons,this.getColumnDef=getColumnDef,this.getButtonDef=getButtonDef,this.getTemplate=getTemplate,this.getHiddenTemplate=getHiddenTemplate,this.translateVariableObject=translateVariableObject,this.getColumnCountByLayoutType=getColumnCountByLayoutType,this.getCustomFieldKey=getCustomFieldKey,this.getStepValue=getStepValue,this.splitDimension=splitDimension,this.mergeDimension=mergeDimension,this.getFieldTypeWidgetTypesMap=getFieldTypeWidgetTypesMap,this.getMatchModeTypesMap=getMatchModeTypesMap,this.fieldPropertyChangeHandler=fieldPropertyChangeHandler,this.preProcessFields=preProcessFields,this.setColumnConfig=setColumnConfig,this.fetchPropertiesMapColumns=fetchPropertiesMapColumns,this.fetchDynamicData=fetchDynamicData,this.fetchReferenceDetails=fetchReferenceDetails,this.getRowOperationsColumn=getRowOperationsColumn,this.getDistinctValues=getDistinctValues,this.setHeaderConfigForTable=setHeaderConfigForTable,this.setFormWidgetsValues=setFormWidgetsValues,this.getWidgetProps=getWidgetProps,this.getFormFilterWidgets=getFormFilterWidgets,this.getViewModeWidgets=getViewModeWidgets,this.parseNgClasses=parseNgClasses,this.setCaptionSize=setCaptionSize,this.closeDialog=closeDialog,this.fetchRelatedFieldData=fetchRelatedFieldData,this.getEditModeWidget=getEditModeWidget}]).directive("liveActions",["Utils","wmToaster","$rootScope","DialogService",function(Utils,wmToaster,$rs,DialogService){"use strict";var getRecords=function(options,success,error){var variable=options.variable;variable.update({},function(response){Utils.triggerFn(success,response)},function(err){Utils.triggerFn(error,err)})},insertRecord=function(options,success,error){var variable=options.variable,dataObject={row:options.row,transform:!0,multipartData:options.multipartData,skipNotification:!0};variable.insertRecord(dataObject,function(response){Utils.triggerFn(success,response)},function(err){Utils.triggerFn(error,err)})},updateRecord=function(options,success,error){var variable=options.variable,dataObject={row:options.row,prevData:options.prevData,multipartData:options.multipartData,transform:!0,rowData:options.rowData,skipNotification:!0};variable.updateRecord(dataObject,function(response){Utils.triggerFn(success,response)},function(err){Utils.triggerFn(error,err)})},deleteRecord=function(options,success,error){var variable=options.variable,confirmMsg=options.scope.confirmdelete||"Are you sure you want to delete this?",dataObject={row:options.row,transform:!0,skipNotification:!0},deleteFn=function(){variable.deleteRecord(dataObject,function(response){Utils.triggerFn(success,response)},function(err){Utils.triggerFn(error,err)})};DialogService._showAppConfirmDialog({caption:"Delete Record",content:confirmMsg,iconClass:"wi wi-delete fa-lg",resolve:{confirmActionOk:function(){return deleteFn},confirmActionCancel:function(){return function(){Utils.triggerFn(options.cancelDeleteCallback)}}}})},performOperation=function(operation,options){var fn,scope=options.scope,successHandler=function(response){Utils.triggerFn(scope.liveActionSuccess,operation,response),Utils.triggerFn(options.success,response)},errorHandler=function(error){Utils.triggerFn(scope.liveActionError,operation,error),wmToaster.show("error","ERROR",error),Utils.triggerFn(options.error,error)};switch(operation){case"create":fn=insertRecord;break;case"update":fn=updateRecord;break;case"delete":fn=deleteRecord;break;case"read":fn=getRecords}fn(options,function(response){return response.error?void errorHandler(response.error):void("read"!==fn?getRecords(options,function(){successHandler(response)},function(){successHandler(response)}):successHandler(response))},function(error){errorHandler(error)})};return{restrict:"A",link:{post:function($is,$el){$is.addRow=function(){$rs.$emit("wm-event",$is.name,"create")},$is.updateRow=function(){$rs.$emit("wm-event",$is.name,"update")},$is.deleteRow=function(){$rs.$emit("wm-event",$is.name,"delete")},$is.call=function(operation,data,success,error){var $elScope=$el.scope(),variableName=Utils.getVariableName($is,$elScope);data.scope=data.scope||$is,data.success=success,data.error=error,data.variable=$elScope.Variables[variableName],performOperation(operation,data)}}}}}]),WM.module("wm.widgets.form").service("FormWidgetUtils",["WidgetUtilService","Utils","Variables","$servicevariable","$rootScope","$filter",function(WidgetUtilService,Utils,Variables,$servicevariable,$rootScope,$filter){"use strict";function getDisplayField(dataSet,displayField){return displayField&&displayField!==ALLFIELDS||(WM.isArray(dataSet)&&dataSet.length>0?displayField=WM.isObject(dataSet[0])?Object.keys(dataSet[0])[0]:"":WM.isObject(dataSet)&&(displayField="")),displayField}function setPropertiesTextWidget(widgetProps,newVal){var datavalueObj=widgetProps.datavalue||widgetProps.defaultvalue;switch(widgetProps.step.show=widgetProps.minvalue.show=widgetProps.maxvalue.show=widgetProps.displayformat.show=!1,widgetProps.placeholder.show=widgetProps.maxchars.show=widgetProps.updateon.show=widgetProps.updatedelay.show=!0,datavalueObj.type="date"===newVal?newVal:"string",newVal){case"text":widgetProps.displayformat.show=!0;break;case"number":widgetProps.step.show=widgetProps.minvalue.show=widgetProps.maxvalue.show=!0,widgetProps.placeholder.show=widgetProps.maxchars.show=!0;break;case"date":case"datetime-local":case"month":case"time":case"week":widgetProps.step.show=widgetProps.minvalue.show=widgetProps.maxvalue.show=!0,widgetProps.placeholder.show=widgetProps.maxchars.show=!1;break;case"color":widgetProps.updateon.show=widgetProps.updatedelay.show=widgetProps.maxchars.show=!1,widgetProps.placeholder.show=!1}}function setDisplayValues(scope){_.forEach(scope.checkedValues,function(value,dataKey){"wm-checkboxset"===scope._widgettype&&(scope.displayValue=scope.displayValue||[],value&&!_.includes(scope.displayValue,dataKey)?scope.displayValue.push(dataKey):!value&&_.includes(scope.displayValue,dataKey)&&_.remove(scope.displayValue,function(value){return value===dataKey})),"wm-radioset"===scope._widgettype&&value&&(scope.displayValue=dataKey)})}function updatedCheckedValues(scope){if(scope.dataKeys&&scope.checkedValues){var model=scope._model_,dataObj=WM.isArray(scope.dataObject)||WM.isString(scope.dataObject)?{}:scope.dataObject;"wm-checkboxset"===scope._widgettype&&WM.isString(model)&&""!==model&&(model=model.split(",")),_.forEach(scope.dataKeys,function(dataKey){scope.checkedValues[dataKey]=scope.valueInModel(model,dataKey,dataObj[dataKey])}),setDisplayValues(scope)}}function createDataKeys(scope,dataSet){function getKeys(){return scope.orderedKeys.length?scope.orderedKeys:Object.keys(scope.dataObject)}WM.isArray(dataSet)?WM.isObject(dataSet[0])&&_.has(dataSet[0],"dataValue")?(_.forEach(dataSet,function(data){scope.dataObject[data.name]=data.dataValue}),scope.dataKeys=getKeys()):(scope.dataObject=dataSet,scope.dataKeys=dataSet):WM.isString(dataSet)?(scope.dataObject=dataSet,scope.dataKeys=dataSet.split(",").map(function(option){return option.trim()})):WM.isObject(dataSet)&&(scope.dataObject=dataSet,scope.dataKeys=getKeys()),updatedCheckedValues(scope)}function getOrderedDataSet(dataset,orderby){if(!orderby)return dataset;var items=_.split(orderby,","),fields=[],directions=[];return _.forEach(items,function(obj){var item=_.split(obj,":");fields.push(item[0]),directions.push(item[1])}),_.orderBy(dataset,fields,directions)}function parseDataSet(dataSet,scope){var data=dataSet,dataField=scope.datafield,useKeys=scope.usekeys,objectKeys=[],orderedKeys=[],displayField=getDisplayField(dataSet,scope.displayfield);return scope.widgetProps.displayfield.value=displayField,WM.isArray(dataSet)?(dataSet=getOrderedDataSet(dataSet,scope.orderby),useKeys?(data={},objectKeys=WM.isObject(dataSet[0])?Object.keys(dataSet[0]):[],_.forEach(objectKeys,function(key){data[key]=key})):dataField&&(data={},_.forEach(dataSet,function(option){var key=WidgetUtilService.getEvaluatedData(scope,option,{fieldName:"displayfield",expressionName:"displayexpression"},displayField);data[key]=dataField===ALLFIELDS?option:_.get(option,dataField),_.includes(orderedKeys,key)||orderedKeys.push(key)}))):WM.isObject(dataSet)&&(data={},objectKeys=Object.keys(dataSet),_.forEach(objectKeys,function(key){data[key]=key})),scope.orderedKeys=orderedKeys,data}function parseData(scope){return!WM.isString(scope.dataset||scope.scopedataset)&&(!(WM.isArray(scope.dataset)&&!WM.isObject(scope.dataset[0]))&&!(WM.isArray(scope.scopedataset)&&!WM.isObject(scope.scopedataset[0])))}function getParsedDataSet(dataSet,scope,element){return dataSet=dataSet?dataSet.data||dataSet:[],parseData(scope)&&(dataSet=parseDataSet(dataSet,scope,element)),dataSet}function getModelValue(scope,dataSet,value,checkedValue){var val=_.get(scope.dataObject,value);return WM.isObject(scope.dataObject)||(value=WM.isString(value)?value.trim():value),WM.isString(dataSet)?value:WM.isArray(dataSet)?WM.isObject(dataSet[0])&&val?val:value:checkedValue?val:value}function getGroupedFields(fields,isGroupFields){var groupedKeys={all:{keys:[]}};return isGroupFields?_.forEach(fields,function(key,index){if(_.includes(key,".")){var field=_.split(key,".");groupedKeys[field[0]]||(groupedKeys[field[0]]={keys:[]}),groupedKeys[field[0]].keys.push({title:field[1],index:index,key:key})}else groupedKeys.all.keys.push({title:key,index:index,key:key})}):groupedKeys.all.keys=groupedKeys.all.keys.concat(_.map(fields,function(key,index){return{title:key,index:index,key:key}})),groupedKeys}function getRadiosetCheckboxsetTemplate(scope,widgetType){var liClass,labelClass,type,template="",required="",groupedKeys={},uniqueName="name="+(scope.name||widgetType)+Utils.generateGUId();switch(widgetType){case"checkboxset":liClass="checkbox app-checkbox",labelClass="app-checkboxset-label",type="checkbox";break;case"radioset":liClass="radio app-radio",labelClass="app-radioset-label",type="radio",required=' data-ng-required="'+scope.required+'"'}return groupedKeys=getGroupedFields(scope.dataKeys,scope.groupFields),_.forEach(_.keys(groupedKeys),function(key){"all"!==key&&(template=template+'<li class="'+liClass+' group-header" title="'+key+'" data-fixed-header="true"><i class="wi wi-arrow-drop-down group-icon"></i><span class="group-title">'+key+"</span></li>"),_.forEach(groupedKeys[key].keys,function(dataKey){dataKey.title=WM.isString(dataKey.title)?dataKey.title.trim():dataKey.title;var parsedKey=_.includes(dataKey.key,"\\")?_.replace(dataKey.key,"\\","\\\\"):dataKey.key;template=template+'<li class="'+liClass+" {{itemclass}}\" data-ng-class=\"{'active':checkedValues['"+parsedKey+'\']}"><label class="'+labelClass+'" data-ng-class="{\'disabled\':disabled}" title="'+dataKey.key+'"><input '+uniqueName+required+' type="'+type+'" '+(scope.disabled?' disabled="disabled" ':"")+"data-attr-index="+dataKey.index+' value="'+dataKey.key+'" tabindex="'+scope.tabindex+'" data-ng-checked="checkedValues[\''+parsedKey+'\']"/><span class="caption">'+dataKey.title+"</span></label></li>"})}),template+='<input name="{{name}}" data-ng-disabled="disabled" data-ng-hide="true" class="model-holder" data-ng-model="_model_"><div data-ng-if="readonly || disabled" class="readonly-wrapper"></div>'}function getBoundVariableCategory(scope){var variableName,variableObj;return variableName=Utils.getVariableName(scope),variableObj=variableName&&Variables.getVariableByName(variableName),variableObj&&variableObj.category}function appendMessage(element){var noDataMsg;noDataMsg="<li>"+$rootScope.locale.MESSAGE_GRID_CANNOT_LOAD_DATA_IN_STUDIO+"</li>",element.empty().append(noDataMsg)}function getProxyEventsMap(){return{onClick:{name:"data-ng-click",value:'eventProxy("onClick", {$event: $event, $scope: this})'},onDblclick:{name:"data-ng-dblclick",value:"onDblclick({$event: $event, $scope: this})"},onMouseenter:{name:"data-ng-mouseenter",value:"onMouseenter({$event: $event, $scope: this})"},onMouseleave:{name:"data-ng-mouseleave",value:"onMouseleave({$event: $event, $scope: this})"},onMouseover:{name:"data-ng-mouseover",value:"onMouseover({$event: $event, $scope: this})"},onMouseout:{name:"data-ng-mouseout",value:"onMouseout({$event: $event, $scope: this})"}}}function getFocusBlurEvents(){return{onFocus:{name:"data-ng-focus",value:"onFocus({$event: $event, $scope: this})"},onBlur:{name:"data-ng-blur",value:"onBlur({$event: $event, $scope: this})"}}}function eventProxy(scope,eventType,eventArgs){_.includes(eventArgs.$event.target.classList,"caption")||Utils.triggerFn(scope[eventType],eventArgs);
}function getTimestampFromDate(date){return moment($filter("date")(date,"yyyy-MM-dd")).valueOf()}function getProxyExcludeDates(excludeDates){var dates,proxyExcludeDates=[];return dates=WM.isString(excludeDates)?excludeDates.split(","):WM.isArray(excludeDates)?excludeDates:[excludeDates],dates=dates.map(function(date){return WM.isDate(date)?date:isNaN(date)?date:parseInt(date,10)}),_.forEach(dates,function(date){proxyExcludeDates.push(getTimestampFromDate(date))}),proxyExcludeDates}function getUpdatedModel(minDate,maxDate,modelValue,proxyModelValue,previousValue){function getFormatedDate(val){return moment(val).format(dateFormat)}function getTimeStamp(val){return moment(val).valueOf()}var startDate,endDate,selectedDate,dateFormat="YYYY-MM-DD";return minDate||maxDate?(minDate=getFormatedDate(minDate),maxDate=getFormatedDate(maxDate),startDate=getTimeStamp(minDate),endDate=getTimeStamp(maxDate),selectedDate=getTimeStamp(getFormatedDate(modelValue)),startDate<=selectedDate&&selectedDate<=endDate?proxyModelValue:(alert("Please enter date between "+minDate+" & "+maxDate),previousValue)):proxyModelValue}function disableDates(scope,date){if("day"===date.mode)return _.includes(scope.excludedays,date.date.getDay())||scope.proxyExcludeDates&&_.includes(scope.proxyExcludeDates,getTimestampFromDate(date.date))}function setFixedHeader(element,$headerEle){element.on("scroll",_.debounce(function(){$headerEle.css("display","none"),WM.element(this).find("[data-fixed-header]").each(function(){var groupEle=WM.element(this),headerTop=groupEle.position().top,headerTitle=groupEle.attr("title");headerTop<0&&($headerEle.attr("title",headerTitle),$headerEle.find(".group-title").text(headerTitle),$headerEle.css("display","block"))})},50))}function updatePropertyOptionsWithParams($is){var isBoundVariable=Utils.stringStartsWith($is.binddataset,"bind:Variables."),parts=_.split($is.binddataset,/\W/),variable=isBoundVariable&&Variables.getVariableByName(parts[2]),queryParams=[],searchOptions=[];variable&&"wm.ServiceVariable"===variable.category&&($servicevariable.getServiceOperationInfo(variable.operation,variable.service,function(serviceOperationInfo){queryParams=serviceOperationInfo.parameters}),queryParams=Variables.getMappedServiceQueryParams(queryParams),queryParams&&queryParams.length>0&&(searchOptions=_.map(queryParams,function(value){return value}),_.set($is.widgetProps,"searchkey.options",searchOptions)))}var ALLFIELDS="All Fields";this.getDisplayField=getDisplayField,this.setPropertiesTextWidget=setPropertiesTextWidget,this.createDataKeys=createDataKeys,this.getParsedDataSet=getParsedDataSet,this.getModelValue=getModelValue,this.getRadiosetCheckboxsetTemplate=getRadiosetCheckboxsetTemplate,this.getBoundVariableCategory=getBoundVariableCategory,this.appendMessage=appendMessage,this.getProxyEventsMap=getProxyEventsMap,this.getFocusBlurEvents=getFocusBlurEvents,this.eventProxy=eventProxy,this.getTimestampFromDate=getTimestampFromDate,this.getProxyExcludeDates=getProxyExcludeDates,this.getUpdatedModel=getUpdatedModel,this.updatedCheckedValues=updatedCheckedValues,this.getOrderedDataSet=getOrderedDataSet,this.disableDates=disableDates,this.setFixedHeader=setFixedHeader,this.getGroupedFields=getGroupedFields,this.updatePropertyOptionsWithParams=updatePropertyOptionsWithParams}]).constant("FIELD_TYPE",{INTEGER:"integer",BIG_INTEGER:"big_integer",SHORT:"short",FLOAT:"float",BIG_DECIMAL:"big_decimal",DOUBLE:"double",LONG:"long",BYTE:"byte",STRING:"string",CHARACTER:"character",TEXT:"text",DATE:"date",TIME:"time",TIMESTAMP:"timestamp",DATETIME:"datetime",BOOLEAN:"boolean",LIST:"list",CLOB:"clob",BLOB:"blob"}).constant("FIELD_WIDGET",{TEXT:"text",NUMBER:"number",TEXTAREA:"textarea",PASSWORD:"password",CHECKBOX:"checkbox",SLIDER:"slider",RICHTEXT:"richtext",CURRENCY:"currency",SWITCH:"switch",SELECT:"select",CHECKBOXSET:"checkboxset",RADIOSET:"radioset",DATE:"date",TIME:"time",TIMESTAMP:"timestamp",UPLOAD:"upload",RATING:"rating",DATETIME:"datetime",AUTOCOMPLETE:"autocomplete"}),wm.modules.wmCommon=WM.module("wm.common",[]),wm.modules.wmCommon.controllers={},wm.modules.wmCommon.directives={},wm.modules.wmCommon.factories={},wm.modules.wmCommon.services={},wm.modules.wmCommon.providers={},wm.modules.wmCommon.services.$ocLazyLoad=WM.noop,wm.modules.wmCommon.controller(wm.modules.wmCommon.controllers),wm.modules.wmCommon.directive(wm.modules.wmCommon.directives),wm.modules.wmCommon.factory(wm.modules.wmCommon.factories),wm.modules.wmCommon.service(wm.modules.wmCommon.services),wm.modules.wmCommon.provider(wm.modules.wmCommon.providers),wm.modules.wmCommon.constant("SERVICE_TYPE_CONSTANTS",{JAVA_SERVICE:"JavaService",WM_JAVA_SERVICE:"wm.JavaService",WM_WEB_SERVICE:"wm.WebService",WM_DB_SERVICE:"wm.DataModel",JAVA_SERVICE_WORKSPACE_TYPE:"javaservice",DEFAULT_JAVA_SERVICE_NAME:"MyJavaService",JAVA_SERVICE_TREE_ROOT_NODE_ICON_CLASS:"java-service",SECURITY_SERVICE:"Security",SECURITY_SERVICE_CLASS:"security-service",SECURITY_SERVICE_WORKSPACE_TYPE:"securityservice",SECURITY_SERVICE_TYPE:"SecurityServiceType"}),wm.modules.wmCommon.constant("WM_COMMON_SERVICE_URLS",{Project_Run:{inplaceDeploy:{url:"services/projects/:projectId/deployment/inplaceDeploy",method:"POST"}},FILE_RUN:{read:{url:":filePath",method:"GET"}},MARKUP:{get:{url:"services/projects/:projectId/pages/:pageName/:pageName.html",method:"GET"},post:{url:"services/projects/:projectId/pages/:pageName/:pageName.html",method:"POST"}}}),wm.modules.wmCommon.config(function(BaseServiceManagerProvider,WM_COMMON_SERVICE_URLS){"use strict";BaseServiceManagerProvider.register(WM_COMMON_SERVICE_URLS)}),wm.modules.wmCommon.run(function(Utils,CONSTANTS){"use strict";CONSTANTS.isMobile=Utils.isMobile(),CONSTANTS.isIE=Utils.isIE(),CONSTANTS.isIE11=Utils.isIE11()}),wm.modules.wmCommon.providers.BaseServiceManager=function(){"use strict";function register(serviceConfig){WM.extend(baseServiceConfig,serviceConfig)}function getConfig(){return WM.copy(baseServiceConfig)}var baseServiceConfig={};this.getConfig=getConfig,this.register=register,this.$get=function(){return{getConfig:getConfig,register:register}}},wm.modules.wmCommon.services.BaseService=["$http","$rootScope","$injector","BaseServiceManager","DialogService","Utils","CONSTANTS","$q",function($http,$rootScope,$injector,BaseServiceManager,DialogService,Utils,CONSTANTS,$q){"use strict";var wmLogger,wmToaster,isUnAuthorized,localeObject,errorCallStack=[],cache={},serviceCallPatterns=[new RegExp("^/?services/"),new RegExp("j_spring_security_check"),new RegExp("j_spring_security_logout")],logAction=function(type,message,description){if(wmLogger)switch(type){case"debug":wmLogger.debug(message,description);break;case"success":wmLogger.success(message,description);break;case"failure":wmLogger.error(message,description)}},getLocaleObject=function(){return $rootScope.locale||$rootScope.appLocale},displayMessage=function(type,messageTitle,messageDescription){if(wmToaster)switch(type){case"success":wmToaster.show("success",messageTitle,messageDescription);break;case"failure":wmToaster.show("error",messageTitle,messageDescription)}},parseReplace=function(serviceParams){var val,param,config=BaseServiceManager.getConfig(),urlParams=serviceParams.urlParams;if(config.hasOwnProperty(serviceParams.target)&&config[serviceParams.target].hasOwnProperty(serviceParams.action)){if(config=Utils.getClonedObject(config[serviceParams.target][serviceParams.action]),serviceParams.config&&(config.url=(serviceParams.config.url||"")+config.url,config.method=serviceParams.config.method||config.method,config.headers=config.headers||{},WM.forEach(serviceParams.config.headers,function(val,key){config.headers[key]=val})),urlParams)for(param in urlParams)urlParams.hasOwnProperty(param)&&(val=urlParams[param],WM.isDefined(val)&&null!==val&&(config.url=config.url.replace(new RegExp(":"+param,"g"),val)));return config.url=Utils.preventCachingOf(config.url),serviceParams.params&&(config.params=serviceParams.params),WM.isDefined(serviceParams.data)&&(config.data=serviceParams.data),serviceParams.dataParams&&(config.data.params=serviceParams.dataParams),serviceParams.headers&&(config.headers=serviceParams.headers),config.byPassResult=serviceParams.byPassResult,config.isDirectCall=serviceParams.isDirectCall,config.isExtURL=serviceParams.isExtURL,config.preventMultiple=serviceParams.preventMultiple,config}return null},parseError=function(errorDetails){var errMsg;return localeObject=localeObject||getLocaleObject(),localeObject&&localeObject[errorDetails.messageKey]?(errMsg=Utils.getClonedObject(localeObject[errorDetails.messageKey]),errMsg=Utils.replace(errMsg,errorDetails.parameters)):errMsg=errorDetails.message||errorDetails.parameters&&errorDetails.parameters[0]||""},getHttpPromise=function(params){var config=params;return params.isDirectCall||(config.headers=config.headers||{},config.headers["X-Requested-With"]="XMLHttpRequest"),params.hasOwnProperty("target")&&params.hasOwnProperty("action")&&(config=parseReplace(params)),$http(config)},successHandler=function(config,successCallback,response){var returnVal;return isUnAuthorized=!1,!config.byPassResult&&response.data.hasOwnProperty("result")?(Utils.triggerFn(successCallback,response.data.result,response),returnVal=response.data.result):(Utils.triggerFn(successCallback,response.data,response),returnVal=response.data),logAction("success","GOT_RESPONSE_FROM_SERVER",config.url),returnVal},getLoginErrorMsg=function(error){return WM.isFunction(error.headers)&&error.headers("X-WM-Login-ErrorMessage")},isPlatformSessionTimeout=function(error){var MSG_SESSION_NOT_FOUND="Session Not Found";return 401===error.status&&getLoginErrorMsg(error)===MSG_SESSION_NOT_FOUND},isLoginFailure=function(error){var MSG_LOGIN_FAILURE="Authentication Failed: Bad credentials";return 401===error.status&&getLoginErrorMsg(error)===MSG_LOGIN_FAILURE},failureHandler=function(config,successCallback,failureCallback,error){var errTitle,errMsg,appManager,errorDetails=error,HTTP_STATUS_MSG={404:"Requested resource not found",401:"Requested resource requires authentication"};return isPlatformSessionTimeout(error)&&!config.isDirectCall?(CONSTANTS.isRunMode&&"app.variables.json"!==config.url&&pushToErrorCallStack(config,successCallback,failureCallback),void(CONSTANTS.isRunMode?(appManager=Utils.getService("AppManager"),appManager.handleSessionTimeOut(),Utils.triggerFn(failureCallback)):(pushToErrorCallStack(config,successCallback,failureCallback),handleSessionTimeOut()))):(isUnAuthorized=!1,403!==error.status||config.isDirectCall?(localeObject?(errTitle=localeObject.MESSAGE_ERROR_HTTP_ERROR_TITLE,errMsg=localeObject.MESSAGE_ERROR_HTTP_STATUS_ERROR_DESC):(errTitle="Error!",errMsg="Service call failed"),errMsg=HTTP_STATUS_MSG[error.status]||errMsg,_.get(error,"data.errors")?(errMsg="",errorDetails=error.data.errors,errorDetails.error&&errorDetails.error.forEach(function(errorDetails,i){errMsg+=parseError(errorDetails)+(i>0?"\n":"")})):CONSTANTS.isRunMode&&config.isExtURL&&!_.isEmpty(error.data)&&(errMsg=error.data),isLoginFailure(error)&&(errMsg=getLoginErrorMsg(error)),WM.isFunction(failureCallback)?Utils.triggerFn(failureCallback,errMsg,errorDetails,error):displayMessage("failure",errTitle,errMsg),logAction("failure","GOT_RESPONSE_FROM_SERVER",config.url+" as "+errMsg),error):(pushToErrorCallStack(config,successCallback,failureCallback),displayMessage("failure",$rootScope.appLocale.LABEL_ACCESS_DENIED||"Access Denied",$rootScope.appLocale.LABEL_FORBIDDEN_MESSAGE||"The requested resource access/action is forbidden."),void Utils.triggerFn(failureCallback)))},isServiceCall=function(url){return _.some(serviceCallPatterns,function(p){return p.test(url)})},makeCall=function(config,successCallback,failureCallback){if(logAction("debug","SEND_REQUEST_TO_SERVER",config.url),CONSTANTS.isRunMode&&$rootScope.isMobileApplicationType&&isServiceCall(config.url)){var deployUrl=$rootScope.project.deployedUrl;deployUrl+="/"===_.last(deployUrl)?"":"/",config.url=deployUrl+config.url}var promiseObj,deferred=$q.defer();return config.timeout=deferred.promise,promiseObj=config.preventMultiple?(cache[config.url]||_.set(cache,config.url,getHttpPromise(config))[config.url]).then(function(response){return cache[config.url]=void 0,response},function(err){return cache[config.url]=void 0,$q.reject(err)}):getHttpPromise(config),promiseObj=promiseObj.then(successHandler.bind(void 0,config,successCallback),function(err){return failureHandler(config,successCallback,failureCallback,err),$q.reject(err)}),promiseObj.abort=function(){deferred.resolve()},promiseObj.finally(function(){promiseObj.abort=WM.noop,deferred=promiseObj=null}),promiseObj},send=function(params,successCallback,failureCallback){var serviceSettings=parseReplace(params);return serviceSettings?makeCall(serviceSettings,successCallback,failureCallback):(localeObject=localeObject||getLocaleObject(),void displayMessage("failure",localeObject.MESSAGE_ERROR_HTTP_ERROR_TITLE,localeObject.MESSAGE_ERROR_HTTP_CONFIG_ERROR_DESC))},execute=function(params,successCallback,failureCallback){return params.hasOwnProperty("target")&&params.hasOwnProperty("action")?send(params,successCallback,failureCallback):void Utils.triggerFn(successCallback)},initializeDependencies=function(){try{$injector.get("wmLogger")&&(wmLogger=$injector.get("wmLogger"),wmLogger.compile($rootScope))}catch(exception){wmLogger&&wmLogger.error("EXCEPTION_CAUSED",["initializeDependencies in wmService.baseService",exception&&exception.message])}try{$injector.get("wmToaster")&&(wmToaster=$injector.get("wmToaster"),wmToaster.compile($rootScope))}catch(exception){wmLogger&&wmLogger.error("EXCEPTION_CAUSED",["initializeDependencies in wmService.baseService",exception&&exception.message])}},pushToErrorCallStack=function(config,success,failure){errorCallStack.push({config:config,success:success,failure:failure})},executeErrorCallStack=function(){errorCallStack.length&&(errorCallStack.forEach(function(call){call.config?makeCall(call.config,call.success,call.failure):Utils.triggerFn(call.success)}),errorCallStack.length=0)},handleSessionTimeOut=function(){if(!isUnAuthorized){var isStudioDisabled,dialogId=CONSTANTS.isStudioMode?"sessionTimeOutDialog":"CommonLoginDialog";CONSTANTS.isStudioMode||(Utils.triggerFn($rootScope.onSessionTimeout),$rootScope.$emit("on-sessionTimeout")),isStudioDisabled=$rootScope.isStudioDisabled,$rootScope.isStudioDisabled=!1,DialogService.closeAllDialogs(),DialogService.showDialog(dialogId,{resolve:{OnLogin:function(){return function(){CONSTANTS.isStudioMode&&(executeErrorCallStack(),$rootScope.isStudioDisabled=isStudioDisabled),DialogService.hideDialog(dialogId)}}},onClose:function(){isUnAuthorized=!1}}),isUnAuthorized=!0}};return initializeDependencies(),{execute:execute,send:send,getHttpPromise:getHttpPromise,pushToErrorCallStack:pushToErrorCallStack,executeErrorCallStack:executeErrorCallStack,handleSessionTimeOut:handleSessionTimeOut,parseError:parseError,parseReplace:parseReplace}}],wm.modules.wmCommon.services.FileService=function(BaseService,CONSTANTS){"use strict";var target=CONSTANTS.isRunMode?"FILE_RUN":"FILE";return{read:function(params,successCallback,failureCallback){var urlParams={filePath:params.path};CONSTANTS.isStudioMode&&(urlParams.projectID=params.projectID),BaseService.execute({target:target,action:"read",urlParams:urlParams},successCallback,failureCallback)},readDir:function(params,successCallback,failureCallback){var urlParams={filePath:params.path};CONSTANTS.isStudioMode&&(urlParams.projectID=params.projectID),BaseService.execute({target:target,action:"readDir",urlParams:urlParams},successCallback,failureCallback)}}},wm.modules.wmCommon.services.FileUploadService=["$rootScope","Utils","$q","CONSTANTS",function($rootScope,Utils,$q,CONSTANTS){"use strict";function transformEvent(event){return event.target=event.target||{status:event.responseCode,response:event.response},event}function FileTransferObject(file,transferFn,promise,abortFn){this.name=file.name,this.size=file.size||"",this.status=FILE_UPLOAD_STATUSES.QUEUED,this.start=function(){this.status===FILE_UPLOAD_STATUSES.QUEUED&&(this.status=FILE_UPLOAD_STATUSES.IN_PROGRESS,Utils.triggerFn(transferFn))},this.then=function(onSuccess,onError,onProgress){var self=this;return promise.then(function(event){self.status=FILE_UPLOAD_STATUSES.SUCCESS,Utils.triggerFn(onSuccess,event)},function(event){self.status=FILE_UPLOAD_STATUSES.ERROR,Utils.triggerFn(onError,event)},function(event){self.progress=Math.round(event.loaded/event.total*100),Utils.triggerFn(onProgress,event)}),this},this.finally=function(onFinal){promise.finally(onFinal)},this.abort=function(){this.status=FILE_UPLOAD_STATUSES.ABORTED,Utils.triggerFn(abortFn),this.finally()}}function uploadWithFileTransfer(file,url,options){var defer=$q.defer(),ft=new FileTransfer,uploadUrl=$rootScope.project.deployedUrl+"/"+url,ftOptions={fileKey:options.paramName,fileName:file.name,chunkedMode:!1},transferFn=function(){ft.upload(file.path,uploadUrl,function(event){defer.resolve(transformEvent(event))},function(event){defer.reject(transformEvent(event))},ftOptions)};return ft.onprogress=function(event){defer.notify(transformEvent(event))},new FileTransferObject(file,transferFn,defer.promise,ft.abort.bind(ft))}function uploadWithAjax(file,url,options){var xhr,defer=$q.defer(),fd=new FormData;return WM.isArray(file)?WM.forEach(file,function(fileObject){fileObject.file&&fileObject.uploadPath&&fd.append(options.paramName,fileObject.file,fileObject.file.name)}):WM.isObject(file)&&fd.append(options.paramName,file,file.name),xhr=new XMLHttpRequest,xhr.upload.addEventListener("progress",defer.notify.bind(defer)),xhr.addEventListener("load",defer.resolve.bind(defer)),xhr.addEventListener("error",defer.reject.bind(defer)),xhr.open("POST",url),xhr.setRequestHeader("Accept","*/*"),Utils.addDefaultHeaders(xhr),new FileTransferObject(file,xhr.send.bind(xhr,fd),defer.promise,xhr.abort.bind(xhr))}function uploadWithIframe(file,url,options){var defer=$q.defer(),uploadConfig={url:url,formName:options.formName},transferFn=function(){Utils.fileUploadFallback(uploadConfig,function(event){defer.resolve(event)},function(event){defer.reject(event)})};return new FileTransferObject(file,transferFn,defer.promise,WM.noop)}function starNextFileTransfer(fts){var ft=_.find(fts,function(ft){return ft.status===FILE_UPLOAD_STATUSES.QUEUED});ft&&(ft.start(),ft.finally(starNextFileTransfer.bind(void 0,fts)))}function startFileTransfers(fts,max){for(var i=0,len=fts.length;i<max&&i<len;)starNextFileTransfer(fts),i++}var FILE_UPLOAD_STATUSES={QUEUED:"queued",IN_PROGRESS:"inprogress",SUCCESS:"success",ERROR:"error",ABORTED:"abort"};this.upload=function(files,config,options){var fileTransfers=[],url=config.uploadUrl;return options=_.extend({paramName:config.fileParamName},options),CONSTANTS.hasCordova?_.forEach(files,function(file){fileTransfers.push(uploadWithFileTransfer(file,url,options))}):window.FormData?_.forEach(files,function(file){fileTransfers.push(uploadWithAjax(file,url,options))}):_.forEach(files,function(file){fileTransfers.push(uploadWithIframe(file,url,options))}),startFileTransfers(fileTransfers,2),fileTransfers}}],wm.modules.wmCommon.services.ProjectService=function(BaseService,CONSTANTS,$location,Utils){"use strict";function run(details,successCallback,failureCallback){var target=CONSTANTS.isRunMode?"Project_Run":"Project";BaseService.execute({target:target,action:"inplaceDeploy",urlParams:{projectId:details.projectId},config:details.config,preventMultiple:!0},successCallback,failureCallback)}function getDeployedUrl(){var locationUrl,lastIndex,projectDeployedUrl;if(CONSTANTS.isRunMode)return locationUrl=$location.$$absUrl,lastIndex=locationUrl.split("#")[0].lastIndexOf("/"),projectDeployedUrl=locationUrl.substr(0,lastIndex),lastIndex=projectDeployedUrl.lastIndexOf("/"),"#"===projectDeployedUrl[lastIndex+1]&&(projectDeployedUrl=projectDeployedUrl.substr(0,lastIndex)),projectDeployedUrl.indexOf("http")!==-1?projectDeployedUrl=projectDeployedUrl.indexOf("https:")!==-1?projectDeployedUrl.substr(6):projectDeployedUrl.substr(5):projectDeployedUrl.indexOf("file")!==-1&&Utils.fetchContent("json",Utils.preventCachingOf("./config.json"),function(response){response.error||(projectDeployedUrl=response.baseUrl)},WM.noop,!0),projectDeployedUrl}function getId(){return $location.$$absUrl.split("/")[3]}return{run:run,getDeployedUrl:getDeployedUrl,getId:getId}},WM.module("wm.prefabs").service("PrefabManager",["$rootScope","$timeout","$ocLazyLoad","PrefabService","ProjectService","Variables","Utils","wmToaster","CONSTANTS","i18nService","$q","$interval","DialogService","FileService",function($rs,$timeout,$ocLazyLoad,PrefabService,ProjectService,Variables,Utils,wmToaster,CONSTANTS,i18nService,$q,$interval,DialogService,FileService){"use strict";function getProjectId(){return projectDetails?projectDetails.id:(projectDetails=ProjectService.getDetails(),projectDetails&&projectDetails.id)}function onStudioPrefabsLoad(prefabs){prefabs.forEach(function(prefab){studioPrefabNamePropertiesMap[prefab.name]=prefab})}function listStudioPrefabs(){return studioPrefabNamePropertiesMap={},PrefabService.list().then(onStudioPrefabsLoad)}function onAppPrefabsLoad(prefabs){prefabs.forEach(function(prefab){appPrefabNamePropertiesMap[prefab.name]=prefab})}function listAppPrefabs(callback){appPrefabNamePropertiesMap={},Utils.fetchContent("json",Utils.preventCachingOf("services/projects/"+getProjectId()+"/prefabs"),function(response){onAppPrefabsLoad(response),Utils.triggerFn(callback)},function(){wmToaster.show("error",$rs.locale.MESSAGE_ERROR_TITLE,$rs.locale.MESSAGE_ERROR_PROJECT_PREFAB_LIST_FAILED_DESC)},!0)}function processPrefabsList(){var config,projectPrefabs=Object.keys(appPrefabNamePropertiesMap),studioPrefabs=Object.keys(studioPrefabNamePropertiesMap),prefabList=_.union(projectPrefabs,studioPrefabs),mergedPrefabsConfig={};return _.forEach(prefabList,function(prefabName){config={},appPrefabNameConfigMap[prefabName]?(config=_.merge({config:appPrefabNameConfigMap[prefabName]},appPrefabNamePropertiesMap[prefabName]),config.loadPrefabResource=!0):config=_.merge({config:studioPrefabNameConfigMap[prefabName]},studioPrefabNamePropertiesMap[prefabName]),appPrefabNameConfigMap[prefabName]&&!studioPrefabNamePropertiesMap[prefabName]&&(config.isProjectPrefab=!0),mergedPrefabsConfig[prefabName]=config}),mergedPrefabsConfig}function loadAppPrefabConfig(prefabName,callback){var configUrl,config;config=appPrefabNameConfigMap[prefabName],config?Utils.triggerFn(callback,config):(configUrl=CONSTANTS.isRunMode?"app/prefabs/"+prefabName+"/config.json":Utils.getProjectResourcePath(getProjectId())+"app/prefabs/"+prefabName+"/config.json",Utils.fetchContent("json",Utils.preventCachingOf(configUrl),function(response){appPrefabNameConfigMap[prefabName]=response,Utils.triggerFn(callback,response)},function(){wmToaster.show("error",$rs.locale.MESSAGE_PREFAB_CONFIG_ERROR_TITLE,$rs.locale.MESSAGE_PREFAB_CONFIG_ERROR_DESC)},!0))}function loadStudioPrefabConfig(prefabName){var configUrl,deferred=$q.defer();return configUrl="services/prefabs/"+studioPrefabNamePropertiesMap[prefabName].id+"/files/webapp/config.json",Utils.fetchContent("json",Utils.preventCachingOf(configUrl),function(response){studioPrefabNameConfigMap[prefabName]=response,deferred.resolve(response)},function(error){delete studioPrefabNamePropertiesMap[prefabName],delete studioPrefabNameConfigMap[prefabName],deferred.reject(error)}),deferred.promise}function loadProjectPrefabsConfig(prefabName){var configUrl,deferred=$q.defer();return projectDetails=ProjectService.getDetails(),configUrl="services/projects/"+(projectDetails.studioProjectId||projectDetails.id)+"/prefabs/"+prefabName+"/files/config.json",Utils.fetchContent("json",Utils.preventCachingOf(configUrl),function(response){appPrefabNameConfigMap[prefabName]=response,deferred.resolve(response)},function(error){delete appPrefabs[prefabName],delete appPrefabNameConfigMap[prefabName],deferred.reject(error)}),deferred.promise}function getAppPrefabsConfig(isReloadRequest){function onConfigLoad(){if(count-=1,!count){var content=Utils.getClonedObject(appPrefabNamePropertiesMap);prefabNames.forEach(function(prefabName){content[prefabName].config=appPrefabNameConfigMap[prefabName]}),deferred.resolve(content)}}var deferred=$q.defer(),prefabNames=Object.keys(appPrefabNamePropertiesMap),count=prefabNames.length;return _.isEmpty(appPrefabNamePropertiesMap)||!isReloadRequest&&_.isEqual(_.keys(appPrefabNameConfigMap),_.keys(appPrefabNamePropertiesMap))?deferred.resolve():(isReloadRequest&&(appPrefabNameConfigMap={}),prefabNames.forEach(function(prefabName){loadProjectPrefabsConfig(prefabName).finally(onConfigLoad)})),deferred.promise}function getAllStudioPrefabsConfig(){function onConfigLoad(){if(count-=1,!count){var content=Utils.getClonedObject(studioPrefabNamePropertiesMap);Object.keys(studioPrefabNameConfigMap).forEach(function(prefabName){content[prefabName].config=studioPrefabNameConfigMap[prefabName]}),deferred.resolve(content)}}var deferred=$q.defer(),prefabNames=Object.keys(studioPrefabNamePropertiesMap),count=prefabNames.length;return studioPrefabNameConfigMap={},prefabNames.forEach(function(prefabName){return appPrefabNamePropertiesMap[prefabName]?void(count-=1):void loadStudioPrefabConfig(prefabName).finally(onConfigLoad)}),deferred.promise}function isPrefabVersionMismatch(prefabName){var prefab=getProjectPrefab(prefabName);return prefab.workspaceVersion&&("DEV"===prefab.status||prefab.version!==prefab.workspaceVersion)}function getDevStatusPrefabs(prefabs){return _.filter(prefabs,function(prefabConfig){return"DEV"===prefabConfig.status})}function prepareAppPrefabsNamePropertiesMap(){appPrefabNamePropertiesMap={},_.forEach(appPrefabs,function(prefabObj){appPrefabNamePropertiesMap[prefabObj.name]=prefabObj})}function setProjectPrefabs(prefabs){appPrefabs=prefabs,prepareAppPrefabsNamePropertiesMap()}function getProjectPrefab(prefabName){return Utils.getClonedObject(appPrefabNamePropertiesMap[prefabName])||{}}function getProjectPrefabs(){return Utils.getClonedObject(appPrefabs)||[]}function fetchProjectPrefabs(){return ProjectService.getProjectPrefabs($rs.project.id).then(setProjectPrefabs)}function prepareWorkspacePrefabsNamePropertiesMap(){studioPrefabNamePropertiesMap={},_.forEach(workspacePrefabs,function(prefabObj){studioPrefabNamePropertiesMap[prefabObj.name]=prefabObj})}function setWorkspacePrefabs(prefabs){workspacePrefabs=prefabs,prepareWorkspacePrefabsNamePropertiesMap()}function getWorkspacePrefab(prefabName){return Utils.getClonedObject(studioPrefabNamePropertiesMap[prefabName])||{}}function fetchWorkspacePrefabs(){return ProjectService.getWorkspacePrefabs($rs.project.id).then(setWorkspacePrefabs)}function constructPrefabConflictMessage(prefab){var msg,actionsBtnMsg="Update";return Number(prefab.version)&&Number(prefab.workspaceVersion)?prefab.version<prefab.workspaceVersion?msg=$rs.getLocalizedMessage("MESSAGE_PREFAB_VERSION_MISMATCH_OLDER",prefab.name,prefab.version,prefab.workspaceVersion,actionsBtnMsg):(actionsBtnMsg="Revert",msg=$rs.getLocalizedMessage("MESSAGE_PREFAB_VERSION_MISMATCH_FUTURE",prefab.name,prefab.version,prefab.workspaceVersion,actionsBtnMsg)):prefab.version!==prefab.workspaceVersion&&(msg=$rs.getLocalizedMessage("MESSAGE_PREFAB_VERSION_MISMATCH_CONFLICT",prefab.name,prefab.workspaceVersion,actionsBtnMsg)),"DEV"===prefab.status&&(msg=$rs.getLocalizedMessage("MESSAGE_PREFAB_VERSION_MISMATCH_DEVELOPMENT",prefab.name,prefab.version,prefab.workspaceVersion,actionsBtnMsg)),prefab.actionsBtnMsg=actionsBtnMsg,msg}function getPrefabVersionConflicts(){var conflicts=[],prefabs=getProjectPrefabs();return _.forEach(prefabs,function(prefab){!prefab.workspaceVersion||prefab.version===prefab.workspaceVersion&&"DEV"!==prefab.status||(prefab.versionMessage=constructPrefabConflictMessage(prefab),conflicts.push(prefab))}),conflicts}function setVersionMismatchMessages(){_.forEach(getProjectPrefabs(),function(prefab){var messageMap=versionMismatchMessages,prefabName=prefab.name;parseFloat(prefab.version),parseFloat(prefab.workspaceVersion);"DEV"===prefab.status&&(messageMap[prefabName]=$rs.locale.MESSAGE_PREFAB_VERSION_DEVELOPMENT_STATE)})}function getVersionMismatchMessage(prefabName){return versionMismatchMessages[prefabName]}function doRegistration(prefabName,callback){PrefabService.register({projectId:getProjectId(),prefabId:studioPrefabNamePropertiesMap[prefabName].id},function(){appPrefabNamePropertiesMap[prefabName]=Utils.getClonedObject(studioPrefabNamePropertiesMap[prefabName]),appPrefabNameConfigMap[prefabName]=studioPrefabNameConfigMap[prefabName],Utils.triggerFn(callback)},function(){wmToaster.show("error",$rs.locale.MESSAGE_ERROR_TITLE,$rs.locale.MESSAGE_ERROR_PREFAB_REGISTER_FAILED_DESC)})}function showPrefabUpgradeDialog(prefabName){DialogService.showDialog("upgradePrefabDialog",{resolve:{upgradeFn:function(){return function(){doRegistration(prefabName,function(){Utils.getService("StudioActions").saveProject().then(function(){window.location.reload()})})}},prefabName:function(){return prefabName}}})}function validateAndRegister(prefabName,callback){appPrefabNamePropertiesMap[prefabName]?isPrefabVersionMismatch(prefabName)?(showPrefabUpgradeDialog(prefabName),Utils.triggerFn(callback)):Utils.triggerFn(callback):doRegistration(prefabName,callback)}function registerPrefab(prefabName,callback){void 0===appPrefabNamePropertiesMap?listAppPrefabs(validateAndRegister.bind(void 0,prefabName,callback)):validateAndRegister(prefabName,callback)}function OnPrefabResourceLoad(count){this.count=count,this.updateCount=function(){this.count-=1},this.getCount=function(){return this.count}}function loadScripts(scripts){function onResourcesReady(){!obj.getCount()&&intervalHandler&&($interval.cancel(intervalHandler),intervalHandler=null,deferred.resolve())}var obj,intervalHandler,deferred=$q.defer(),rand=Date.now(),count=0,fnName="onPrefabResourceLoad"+rand;return scripts=scripts.map(function(script){return script.indexOf("onPrefabResourceLoad")!==-1&&(count+=1,script=script.replace("onPrefabResourceLoad",fnName)),script}),obj=new OnPrefabResourceLoad(count),window[fnName]=obj.updateCount.bind(obj),scripts&&scripts.length?Utils.loadScripts(scripts,function(){intervalHandler=$interval(onResourcesReady,50,10)}):deferred.resolve(),deferred.promise}function loadModules(modules){var resolveFn,deferred=$q.defer();return modules&&modules.length?(resolveFn=_.after(modules.length,function(){$timeout(deferred.resolve,200,!1)}),_.forEach(modules,function(module){$ocLazyLoad.jsLoader(module.files,function(){$ocLazyLoad.inject(module.name).then(resolveFn)},{})})):deferred.resolve(),deferred.promise}function loadPrefabMinifiedPage(prefabName){var url,config=appPrefabNameConfigMap[prefabName],deferred=$q.defer();return url=config.templateUrl.substr(0,config.templateUrl.lastIndexOf("/")+1)+"page.min.html",FileService.read({path:"app/prefabs/"+prefabName+url,projectID:$rs.project.id},function(prefabContent){var pageDom=WM.element("<div>"+prefabContent+"</div>"),htmlMarkup=pageDom.find('script[id="Main.html"]').html()||"";WM.element("head").append(pageDom.find("style, script")),WM.forEach(window._MainPage_Variables_,function(variable){variable._prefabName=prefabName}),Variables.setPageVariables(prefabName,window._MainPage_Variables_),CONSTANTS.isRunMode?Utils.getService("MetaDataFactory").load(prefabName).then(function(){deferred.resolve(htmlMarkup)}):deferred.resolve(htmlMarkup)}),deferred.promise}function getPrefabResourceUrl(resourcePath,resourceBasePath,preventCache){var _url=resourcePath;return Utils.stringStartsWith(resourcePath,"http://|https://|//")||(_url=(resourceBasePath+_url).replace("//","/")),preventCache&&(_url=Utils.preventCachingOf(_url)),_url}function extendAppLocale(root){var localePath=root+(root.lastIndexOf("/")===root.length-1?"":"/")+"resources/i18n/";CONSTANTS.isRunMode?i18nService.loadComponentLocaleBundle(localePath):$rs.$emit("load-component-locale-bundle",localePath);
}function loadDependencies(prefabName){var resources,resourcePath,scriptFiles,styleFiles,modules,handler,config=appPrefabNameConfigMap[prefabName],deferred=$q.defer();return config?(resources=config.resources||{},resourcePath=CONSTANTS.isRunMode?"app/prefabs/"+prefabName+"/":"services/projects/"+getProjectId()+"/resources/info/web/app/prefabs/"+prefabName+"/",pendingTasks.resources[prefabName]?handler=$rs.$on(prefabName+"-dependencies-ready",function(evt,prefabContent){evt.stopPropagation(),deferred.resolve(prefabContent),handler()}):(pendingTasks.resources[prefabName]=!0,scriptFiles=resources.scripts||[],styleFiles=resources.styles||[],modules=resources.modules||[],scriptFiles=scriptFiles.map(function(file){return getPrefabResourceUrl(file,resourcePath,!0)}),modules=modules.map(function(module){return module.files=module.files.map(function(file){return getPrefabResourceUrl(file,resourcePath,!0)}),module}),styleFiles=styleFiles.map(function(file){if(!Utils.stringEndsWith(file,"/pages/Main/Main.css"))return getPrefabResourceUrl(file,resourcePath,!0)}).filter(function(file){return!!file}),Utils.loadStyleSheets(styleFiles),extendAppLocale(resourcePath),loadScripts(scriptFiles).then(loadModules.bind(void 0,modules)).then(loadPrefabMinifiedPage.bind(void 0,prefabName)).then(function(prefabContent){pendingTasks.resources[prefabName]=void 0,$rs.$emit(prefabName+"-dependencies-ready",prefabContent),deferred.resolve(prefabContent)})),deferred.promise):(deferred.reject(),deferred.promise)}function removePrefab(params){return PrefabService.remove(params)}function getConfig(success,error,reload){return activePrefabConfig&&!reload?void Utils.triggerFn(success,activePrefabConfig):($rs.reloadPrefabConfig=void 0,void FileService.read({projectID:$rs.project.id,path:"config.json"},function(response){activePrefabConfig=response,Utils.triggerFn(success,response)},function(response){Utils.triggerFn(error,response)}))}function setConfig(config,success,error){activePrefabConfig=config,FileService.write({projectID:$rs.project.id,path:"config.json",content:config},function(response){Utils.triggerFn(success,response)},function(response){Utils.triggerFn(error,response)})}function updateHTMLImportRefs(prefabName,markup){var $markup=WM.element(markup);return $markup.find("link[rel=import]").each(function(){var resourcePath,$el=WM.element(this),href=$el.attr("href");resourcePath=CONSTANTS.isRunMode?"app/prefabs/"+prefabName+"/":"services/projects/"+getProjectId()+"/resources/info/web/app/prefabs/"+prefabName+"/",$el.attr("href",getPrefabResourceUrl(href,resourcePath))}),$markup[0].outerHTML}function publishPrefabToWorkspace(){projectDetails=ProjectService.getDetails();var payload={projectID:projectDetails.studioProjectId||projectDetails.id,data:{prefabName:projectDetails.name,version:projectDetails.version}};return PrefabService.publishPrefabToWorkSpace(payload)}function publishPrefabToProject(targetProjectId){projectDetails=ProjectService.getDetails();var payload={projectID:projectDetails.studioProjectId||projectDetails.id,data:{targetProjectId:targetProjectId,prefabName:projectDetails.name,version:projectDetails.version}};return PrefabService.publishPrefabToProject(payload)}function register(prefabId,successHandler,errorHandler){PrefabService.register({projectId:$rs.project.studioProjectId||$rs.project.id,prefabId:prefabId},successHandler,errorHandler)}var activePrefabConfig,projectDetails,appPrefabs,workspacePrefabs,studioPrefabNamePropertiesMap={},studioPrefabNameConfigMap={},appPrefabNamePropertiesMap={},appPrefabNameConfigMap={},pendingTasks={resources:{}},versionMismatchMessages={};this.publishPrefabToWorkspace=publishPrefabToWorkspace,this.publishPrefabToProject=publishPrefabToProject,this.removePrefab=removePrefab,this.loadDependencies=loadDependencies,this.loadScripts=loadScripts,this.loadModules=loadModules,this.listStudioPrefabs=listStudioPrefabs,this.getAllStudioPrefabsConfig=getAllStudioPrefabsConfig,this.getAppPrefabsConfig=getAppPrefabsConfig,this.processPrefabsList=processPrefabsList,this.registerPrefab=registerPrefab,this.loadAppPrefabConfig=loadAppPrefabConfig,this.getConfig=getConfig,this.setConfig=setConfig,this.updateHTMLImportRefs=updateHTMLImportRefs,this.fetchProjectPrefabs=fetchProjectPrefabs,this.getProjectPrefab=getProjectPrefab,this.fetchWorkspacePrefabs=fetchWorkspacePrefabs,this.getWorkspacePrefab=getWorkspacePrefab,this.getPrefabVersionConflicts=getPrefabVersionConflicts,this.getDevStatusPrefabs=getDevStatusPrefabs,this.setVersionMismatchMessages=setVersionMismatchMessages,this.getVersionMismatchMessage=getVersionMismatchMessage,this.register=register}]),wm.variables=WM.module("wm.variables",["base64"]),wm.variables.controllers={},wm.variables.services={},wm.variables.factories={},wm.variables.filters={},wm.variables.controller(wm.variables.controllers),wm.variables.service(wm.variables.services),wm.variables.factory(wm.variables.factories),wm.variables.filter(wm.variables.filters),wm.variables.constant("VARIABLE_CONSTANTS",{EVENTS:["onBeforeUpdate","onResult","onBeforeOpen","onOpen","onBeforeMessageSend","onMessageReceive","onError","onBeforeDatasetReady","onCanUpdate","onClick","onHide","onOk","onCancel","onBeforeClose","onClose","onTimerFire","onSuccess","onProgress","onOnline","onOffline","onBeforePush"],EVENT:{CAN_UPDATE:"onCanUpdate",BEFORE_UPDATE:"onBeforeUpdate",PREPARE_SETDATA:"onBeforeDatasetReady",RESULT:"onResult",ERROR:"onError",CLICK:"onClick",HIDE:"onHide",OK:"onOk",CANCEL:"onCancel",CLOSE:"onClose",TIMER_FIRE:"onTimerFire",SUCCESS:"onSuccess",BEFORE_OPEN:"onBeforeOpen",OPEN:"onOpen",BEFORE_SEND:"onBeforeMessageSend",MESSAGE_RECEIVE:"onMessageReceive",BEFORE_CLOSE:"onBeforeClose"},OWNER:{APP:"App",PAGE:"Page"},SERVICE_TYPE_JAVA:"JavaService",SERVICE_TYPE_REST:"RestService",SERVICE_TYPE_SOAP:"SoapService",SERVICE_TYPE_FEED:"FeedService",SERVICE_TYPE_DATA:"DataService",SERVICE_TYPE_SECURITY:"SecurityServiceType",SERVICE_NAME_FEED:"FeedService",SERVICE_TYPE_WEBSOCKET:"WebSocketService",BODY_FIELD:"bodyField",REST_SUPPORTED_SERVICES:["JavaService","SoapService","FeedService","RestService","SecurityServiceType","DataService","WebSocketService"],PAGINATION_PARAMS:["page","size","sort"],DEFAULT_VAR:{NOTIFICATION:"appNotification"}}),wm.variables.constant("VARIABLE_SERVICE_URLS",{VariableService:{addAppVariables:{url:"services/projects/:projectId/variables",method:"POST"},addPageVariables:{url:"services/projects/:projectId/pages/:pageName/variables",method:"POST"},getAppVariables:{url:"services/projects/:projectId/variables",method:"GET"},getPageVariables:{url:"services/projects/:projectId/pages/:pageName/variables",method:"GET"},updateAppVariables:{url:"services/projects/:projectId/variables",method:"PUT"},updatePageVariables:{url:"services/projects/:projectId/pages/:pageName/variables",method:"PUT"},deleteAppVariables:{url:"services/projects/:projectId/variables?variableNames[]=:deletedNames",method:"DELETE"},deletePageVariables:{url:"services/projects/:projectId/pages/:pageName/variables?variableNames[]=:deletedNames",method:"DELETE"},moveAppVariables:{url:"services/projects/:projectId/variables/move?pageName=:toPage",method:"POST"},movePageVariables:{url:"services/projects/:projectId/pages/:pageName/variables/move",method:"POST"},getServiceOpInfo:{url:"services/servicedefs",method:"GET"},getPrefabServiceOpInfo:{url:"services/prefabs/:prefabName/servicedefs",method:"GET"}}}),wm.variables.constant("VARIABLE_SERVICE_URLS_MOBILE",{VariableService:{getServiceOpInfo:{url:"metadata/app/service-definitions.json",method:"GET"},getPrefabServiceOpInfo:{url:"metadata/prefabs/:prefabName/service-definitions.json",method:"GET"}}}),wm.variables.config(function(BaseServiceManagerProvider,VARIABLE_SERVICE_URLS){"use strict";BaseServiceManagerProvider.register(VARIABLE_SERVICE_URLS)}),wm.variables.run(function($location,BaseServiceManager,VARIABLE_SERVICE_URLS,VARIABLE_SERVICE_URLS_MOBILE){"use strict";if("file"===$location.protocol()){var urls=WM.extend({},VARIABLE_SERVICE_URLS.VariableService,VARIABLE_SERVICE_URLS_MOBILE.VariableService);VARIABLE_SERVICE_URLS.VariableService=urls,BaseServiceManager.register(VARIABLE_SERVICE_URLS)}}),wm.variables.factories.BaseVariablePropertyFactory=["WIDGET_CONSTANTS","Utils","VARIABLE_CONSTANTS",function(WIDGET_CONSTANTS,Utils,VARIABLE_CONSTANTS){"use strict";function addNavigationOption(name,label){properties["wm.NavigationVariable"].operation.options[name]=label}function getPropertiesOf(variableCategory,parentCategories){var tempPropertiesObject,variablePropertiesObject={};return parentCategories?(parentCategories=WM.isArray(parentCategories)?parentCategories:[parentCategories],parentCategories.push(variableCategory),tempPropertiesObject={},WM.forEach(parentCategories,function(parent){WM.forEach(properties[parent],function(propObj,propName){tempPropertiesObject[propName]||(tempPropertiesObject[propName]={}),WM.forEach(propObj,function(value,key){tempPropertiesObject[propName][key]=value})})}),variablePropertiesObject.variableProps=tempPropertiesObject):variablePropertiesObject.variableProps=Utils.getClonedObject(properties[variableCategory]),WM.forEach(variablePropertiesObject.variableProps,function(propObj,propName){variablePropertiesObject[propName]||(variablePropertiesObject[propName]=void 0===propObj.value?"":propObj.value)}),variablePropertiesObject}function register(category,properties,parentCategories,methods){variableMap[category]={},WM.extend(properties,getPropertiesOf(category,parentCategories)),variableMap[category].propertyMap=properties.variableProps,delete properties.variableProps,variableMap[category].properties=properties,variableMap[category].methods=methods}function getProperties(category){return variableMap[category]?Utils.getClonedObject(variableMap[category].properties):{}}function getPropertyGroups(){return propertyGroups}function getPropertyMap(category){return variableMap[category]?variableMap[category].propertyMap:void 0}function invoke(method,variableType,variable,options,successCallBack,errorCallBack){return variableMap[variableType]?variableMap[variableType].methods[method](variable,options,successCallBack,errorCallBack):void Utils.triggerFn(errorCallBack,"variable is not valid")}var result,properties,propertyGroups,variableMap,variableEventOptions=[],variableRegex="^[a-zA-Z_][A-Za-z0-9_]+$",matchModes=Utils.getMatchModes();return _.forEach(Utils.getClonedObject(WIDGET_CONSTANTS.EVENTS_OPTIONS),function(event){variableEventOptions.push({name:event,category:"Default"})}),result={properties:{"wm.Variable":{name:{type:"string",required:!0,pattern:variableRegex},type:{type:"list",widgettype:"typeahead",options:{string:"LABEL_STRING",boolean:"LABEL_BOOLEAN",number:"LABEL_NUMBER",date:"LABEL_DATE",entry:"LABEL_ENTRY"},value:"string",required:!0},isList:{type:"boolean",value:!1},owner:{type:"list",options:{Page:"LABEL_PAGE",App:"LABEL_APPLICATION"},value:"Page"},editJson:{type:"json"},isBound:{type:"boolean"},dataSet:{type:"string",value:{dataValue:""},hide:!0},dataBinding:{type:"list",value:[{target:"dataValue",type:"string"}],hide:!0},saveInPhonegap:{type:"boolean",value:!1,hide:!0}},"wm.ServiceVariable":{isList:{hide:!0,required:!1},editJson:{hide:!0,required:!1},dataSet:{type:"string",value:[],hide:!0},type:{hide:!0,required:!1},maxResults:{type:"number",value:20,disabled:!0,hide:!0},designMaxResults:{type:"number",value:10,disabled:!0,hide:!0},orderBy:{type:"string",placeholder:"field1 asc,field2 desc",hide:!0},service:{type:"list",required:!0,widgettype:"typeahead"},operation:{type:"list",required:!0,widgettype:"typeahead",groupBy:"type",propertyName:"name"},operationType:{type:"string",hide:!0},startUpdate:{type:"boolean",widgettype:"boolean-inputfirst",value:!1},autoUpdate:{type:"boolean",widgettype:"boolean-inputfirst",value:!0},inFlightBehavior:{type:"list",options:{doNotExecute:"doNotExecute",executeLast:"executeLast",executeAll:"executeAll"},value:"executeLast"},transformationRequired:{type:"boolean",widgettype:"boolean-inputfirst",value:!1},columnField:{type:"list",options:{},hide:!0},dataField:{type:"list",options:{},hide:!0},dataBinding:{type:"list",value:[],hide:!0},spinnerContext:{type:"list",options:{"":"",page:"page"},placeholder:"Search Widgets",widgettype:"typeahead"},spinnerMessage:{type:"string"},onCanUpdate:{type:"event",options:variableEventOptions},onBeforeUpdate:{type:"event",options:variableEventOptions},onResult:{type:"event",options:variableEventOptions},onBeforeDatasetReady:{type:"event",options:variableEventOptions},onSuccess:{type:"event",options:variableEventOptions},onError:{type:"event",options:variableEventOptions}},"wm.LiveVariable":{service:{hide:!0,required:!1},editJson:{hide:!0},transformationRequired:{hide:!0},operation:{options:{read:"read",insert:"insert",update:"update",delete:"delete"},value:"read",widgettype:"typeahead",propertyName:""},liveSource:{type:"list",required:!0,widgettype:"typeahead"},type:{hide:!1,options:{},value:"",required:!0,widgettype:"typeahead"},maxResults:{disabled:!1,hide:!1},designMaxResults:{disabled:!1,hide:!1},ignoreCase:{type:"boolean",value:!0},matchMode:{type:"list",options:matchModes,value:"start"},orderBy:{type:"string",placeholder:"field1 asc,field2 desc",hide:!1,widgettype:"order-by",order:"desc"},autoUpdate:{value:!0},startUpdate:{value:!0}},"wm.LoginVariable":{transformationRequired:{hide:!0},isList:{value:""},maxResults:{value:""},designMaxResults:{value:""},operation:{hide:!0,required:!1},service:{hide:!0,required:!1},dataSet:{value:{username:"",password:"",rememberme:!1}},dataBinding:{type:"list",value:[{target:"username",type:"string"},{target:"password",type:"string"},{target:"rememberme",type:"boolean"}],hide:!0},startUpdate:{value:!1},autoUpdate:{value:!1},useDefaultSuccessHandler:{type:"boolean",widgettype:"boolean-inputfirst",value:!0}},"wm.LogoutVariable":{transformationRequired:{hide:!0},isList:{value:""},maxResults:{value:""},designMaxResults:{value:""},operation:{hide:!0,required:!1},service:{hide:!0,required:!1},dataSet:{value:""},dataBinding:{value:""},startUpdate:{hide:!0,value:""},autoUpdate:{hide:!0,value:""},redirectTo:{type:"list",options:[],value:"",placeholder:"Search Redirect To",widgettype:"typeahead"},useDefaultSuccessHandler:{type:"boolean",widgettype:"boolean-inputfirst",value:!0}},"wm.NavigationVariable":{name:{type:"string",required:!0,pattern:variableRegex},owner:{type:"list",options:{Page:"LABEL_PAGE",App:"LABEL_APPLICATION"},value:"Page"},operation:{type:"list",required:!0,options:{goToPreviousPage:"goToPreviousPage",gotoPage:"gotoPage",gotoTab:"gotoTab",gotoAccordion:"gotoAccordion"},value:"gotoPage"},dataBinding:{type:"string",value:[],hide:!0},pageTransitions:{type:"list",widgettype:"typeahead",options:{none:"none",slide:"slide",pop:"pop",fade:"fade",flip:"flip"},value:"none",hide:!0},dataSet:{hide:!0,value:[]}},"wm.NotificationVariable":{name:{type:"string",required:!0,pattern:variableRegex},owner:{type:"list",options:{Page:"LABEL_PAGE",App:"LABEL_APPLICATION"},value:"Page"},operation:{type:"list",required:!0,options:{alert:"alert",confirm:"confirm",toast:"toast"},value:"alert"},onCancel:{type:"event",options:variableEventOptions,disabled:!0,hide:!0},onClose:{type:"event",options:variableEventOptions},onOk:{type:"event",options:variableEventOptions},onHide:{type:"event",options:variableEventOptions},onClick:{type:"event",options:variableEventOptions},dataBinding:{type:"string",value:[],hide:!0}},"wm.TimerVariable":{name:{type:"string",required:!0,pattern:variableRegex},owner:{type:"list",options:{Page:"LABEL_PAGE",App:"LABEL_APPLICATION"},value:"Page"},autoStart:{type:"boolean",value:!1},repeating:{type:"boolean",value:!1},delay:{type:"number",value:500},onTimerFire:{type:"event",options:variableEventOptions}},"wm.DeviceVariable":{name:{type:"string",required:!0,pattern:variableRegex},owner:{type:"list",options:{Page:"LABEL_PAGE",App:"LABEL_APPLICATION"},value:"Page"},dataSet:{type:"string",value:{dataValue:""},hide:!0},dataBinding:{type:"object",value:[],hide:!0},service:{type:"list",options:[],required:!0},operation:{type:"list",hide:!0,options:[],required:!0},autoUpdate:{type:"boolean",widgettype:"boolean-inputfirst",value:!1,hide:!0},startUpdate:{type:"boolean",widgettype:"boolean-inputfirst",value:!1,hide:!0},onSuccess:{type:"event",options:variableEventOptions},onError:{type:"event",options:variableEventOptions},onProgress:{type:"event",options:variableEventOptions,hide:!0},onOnline:{type:"event",options:variableEventOptions,hide:!0},onOffline:{type:"event",options:variableEventOptions,hide:!0},onBeforePush:{type:"event",options:variableEventOptions,hide:!0}},"wm.WebSocketVariable":{name:{type:"string",required:!0,pattern:variableRegex},owner:{type:"list",options:{Page:"LABEL_PAGE",App:"LABEL_APPLICATION"},value:"Page"},dataSet:{type:"string",value:[],hide:!0},service:{type:"list",required:!0,widgettype:"typeahead"},type:{hide:!0},operation:{hide:!0},operationId:{hide:!0},startUpdate:{type:"boolean",widgettype:"boolean",displayName:"Connect on page load",value:!0},dataUpdateStrategy:{type:"string",widgettype:"list",options:{refresh:"Refresh dataSet",append:"Add as last record in dataSet",prepend:"Add as first record in dataSet"},value:"refresh",displayName:"On New Data"},dataLimit:{type:"number",value:20},dataBinding:{type:"list",value:[],hide:!0},onBeforeOpen:{type:"event",options:variableEventOptions},onOpen:{type:"event",options:variableEventOptions},onBeforeMessageSend:{type:"event",options:variableEventOptions},onMessageReceive:{type:"event",options:variableEventOptions},onError:{type:"event",options:variableEventOptions},onBeforeClose:{type:"event",options:variableEventOptions},onClose:{type:"event",options:variableEventOptions}}},propertyGroups:[{name:"properties",parent:""},{name:"data",parent:""},{name:"events",parent:""},{properties:["liveSource","type","isList"],parent:"properties"},{name:"service",properties:["service","operation"],parent:"properties"},{name:"serveroptions",properties:["downloadFile","matchMode","maxResults","designMaxResults","orderBy","ignoreCase"],parent:"properties"},{name:"behavior",properties:["useDefaultSuccessHandler","clearDataOnLogout","autoUpdate","startUpdate","inFlightBehavior","loadingDialog","saveInCookie","refireOnDbChange","redirectTo","autoStart","delay","repeating","pageTransitions"],parent:"properties"},{name:"dataset",properties:["dataUpdateStrategy","dataLimit"],parent:"properties"},{name:"mobile",properties:["saveInPhonegap"],parent:"properties"},{name:"Inputs",properties:["pageName","viewName","tabName","accordionName","segmentName","dataBinding"],parent:"properties",propertyTarget:"dataBinding"},{name:"spinner",properties:["spinnerContext","spinnerMessage"],parent:"properties"},{name:"Inputs",properties:[],parent:"data",propertyTarget:"dataBinding, dataSet"},{name:"inputfields",properties:[],parent:"data",propertyTarget:"dataBinding"},{name:"filterfields",properties:[],parent:"data",propertyTarget:"dataBinding"},{name:"bindings",properties:[],parent:"data",propertyTarget:"dataBinding"},{name:"dataTransformation",properties:["transformationRequired","columnField","dataField"],parent:"data"},{properties:VARIABLE_CONSTANTS.EVENTS,parent:"events"}]},properties=result.properties,propertyGroups=result.propertyGroups,variableMap={},{addNavigationOption:addNavigationOption,getPropertiesOf:getPropertiesOf,register:register,getProperties:getProperties,getPropertyGroups:getPropertyGroups,getPropertyMap:getPropertyMap,invoke:invoke}}],wm.variables.services.Variables=["$rootScope","BaseVariablePropertyFactory","ProjectService","FileService","VariableService","CONSTANTS","VARIABLE_CONSTANTS","DialogService","$timeout","Utils","BindingManager","MetaDataFactory","WIDGET_CONSTANTS","$q",function($rootScope,BaseVariablePropertyFactory,ProjectService,FileService,VariableService,CONSTANTS,VARIABLE_CONSTANTS,DialogService,$timeout,Utils,BindingManager,MetaDataFactory,WIDGET_CONSTANTS,$q){"use strict";function migrateOrderBy(variable){var orderBy=variable.orderBy||"";_.includes(orderBy,"&")&&(orderBy=_.map(variable.orderBy.split("&"),function(clause){return clause.replace(/,/g," ")}).join(",")),variable.orderBy=orderBy}var returnObject,activePage,runMode=CONSTANTS.isRunMode,DOT_EXPR_REX=/^\[("|')[\w\W]*(\1)\]$/g,MAIN_PAGE="Main",startUpdateQueue={},lazySartUpdateQueue={},internalBoundNodeMap={},variableConfig={"wm.LiveVariable":{collectionType:"data",category:"wm.LiveVariable",defaultName:"liveVariable",spinnerInFlight:!0,newVariableKey:"New LiveVariable"},"wm.ServiceVariable":{collectionType:"data",category:"wm.ServiceVariable",defaultName:"serviceVariable",spinnerInFlight:!0,newVariableKey:"New ServiceVariable"},"wm.WebSocketVariable":{collectionType:"data",category:"wm.WebSocketVariable",defaultName:"webSocketVariable",methods:["open","send","close"],newVariableKey:"New WebSocketVariable"},"wm.NavigationVariable":{collectionType:"call",category:"wm.NavigationVariable",defaultName:"navigationVariable",newVariableKey:"New NavigationVariable"},"wm.NotificationVariable":{collectionType:"call",category:"wm.NotificationVariable",defaultName:"notificationVariable",newVariableKey:"New NotificationVariable"},"wm.Variable":{collectionType:"data",category:"wm.Variable",defaultName:"staticVariable",hideInEvents:!0},"wm.LoginVariable":{collectionType:"data",category:"wm.LoginVariable",defaultName:"loginVariable",appOnly:!0,spinnerInFlight:!0,newVariableKey:"New LoginVariable",hideInEvents:!0},"wm.LogoutVariable":{collectionType:"data",category:"wm.LogoutVariable",defaultName:"logoutVariable",appOnly:!0,spinnerInFlight:!0,newVariableKey:"New LogoutVariable",hideInEvents:!0},"wm.TimerVariable":{collectionType:"data",category:"wm.TimerVariable",defaultName:"timerVariable",newVariableKey:"New TimerVariable"}},variableCategoryToNameMap={},self=this,CRUDMAP={CREATE:{},UPDATE:{},DELETE:{},MOVE:{}},reloadRequired=[],pageScopeMap={},watchers={},initVariableNameMap=function(){variableCategoryToNameMap={},_.forEach(variableConfig,function(variable){variableCategoryToNameMap[variable.category]=variable.defaultName})},resetVariableNameIterator=function(){self.variableNameIterator={},Object.keys(variableCategoryToNameMap).forEach(function(category){self.variableNameIterator[category]=1})},reloadVariables=function(success,error){function handleSuccess(){pageVariablesLoaded&&appVariablesLoaded&&Utils.triggerFn(success)}var pageVariablesLoaded=!1,appVariablesLoaded=!1;reloadRequired.push(VARIABLE_CONSTANTS.OWNER.APP),initAppVariables($rootScope,function(){appVariablesLoaded=!0,handleSuccess()},error),$rootScope.activePageName?(reloadRequired.push($rootScope.activePageName),initPageVariables($rootScope.activePageName,function(){pageVariablesLoaded=!0,handleSuccess()},error)):pageVariablesLoaded=!0},bindVariableField=function(props){var bindingVal=props.bindingVal,param=props.paramName,variable=props.variable,variableName=props.variableName,variableScope=props.scope||{};Utils.stringStartsWith(bindingVal,"bind:")?watchers[variableScope.$id][variableName].push(variableScope.$watch(bindingVal.replace("bind:",""),function(newVal,oldVal){newVal===oldVal&&WM.isUndefined(newVal)||WM.isUndefined(newVal)&&!WM.isUndefined(oldVal)||("wm.Variable"===variable.category?variable.dataSet[param]=newVal:"wm.ServiceVariable"===variable.category?(props.parentNode?variable.dataBinding[props.parentNode][param]=newVal:variable.dataBinding[param]=newVal,variable.autoUpdate&&!WM.isUndefined(newVal)&&WM.isFunction(variable.update)&&variable.update()):"wm.LiveVariable"===variable.category?"read"===variable.operation?(variable.filterFields[param]={value:newVal},variable.autoUpdate&&!WM.isUndefined(newVal)&&WM.isFunction(variable.update)&&variable.update()):(variable.inputFields[param]=newVal,variable.autoUpdate&&!WM.isUndefined(newVal)&&variable[variable.operation+"Record"]()):"wm.NotificationVariable"===variable.category||"wm.NavigationVariable"===variable.category?variable.dataBinding[param]=newVal:"wm.LoginVariable"===variable.category?(variable.dataBinding[param]=newVal,variable.autoUpdate&&!WM.isUndefined(newVal)&&variable.login()):"wm.DeviceVariable"===variable.category&&(variable[param]=newVal,variable.autoUpdate&&variable.invoke()))})):"wm.LiveVariable"===variable.category?"read"===variable.operation?variable.filterFields[param]={value:bindingVal}:variable.inputFields[param]=bindingVal:"wm.Variable"===variable.category?variable.dataBinding[param]&&(variable.dataSet[param]=variable.dataSet[param]||variable.dataBinding[param]):"wm.DeviceVariable"===variable.category&&(variable[param]=bindingVal)},timers={},_invoke=function(variable,op){var debouncedFn,cancelFn=_.noop,key=variable._id+"__"+op+"__"+(_.get(variable,["activeScope","$id"])||"");timers[key]&&(cancelFn=timers[key].cancel),cancelFn(),debouncedFn=_.debounce(function(){variable[op]()},100),timers[key]=debouncedFn,debouncedFn()},processVariablePostBindUpdate=function(nodeName,nodeVal,nodeType,variable,noUpdate){"wm.LiveVariable"===variable.category?"read"===variable.operation?("dataBinding"===nodeName?_.forEach(nodeVal,function(val,key){variable.filterFields[key]={value:val}}):variable.filterFields[nodeName]={value:nodeVal,type:nodeType},variable.autoUpdate&&!WM.isUndefined(nodeVal)&&WM.isFunction(variable.update)&&!noUpdate&&_invoke(variable,"update")):("dataBinding"===nodeName?variable.inputFields=nodeVal:variable.inputFields[nodeName]=nodeVal,variable.autoUpdate&&!WM.isUndefined(nodeVal)&&WM.isFunction(variable[variable.operation+"Record"])&&!noUpdate&&_invoke(variable,variable.operation+"Record")):"wm.ServiceVariable"===variable.category?variable.autoUpdate&&!WM.isUndefined(nodeVal)&&WM.isFunction(variable.update)&&!noUpdate&&_invoke(variable,"update"):"wm.LoginVariable"===variable.category?variable.autoUpdate&&!WM.isUndefined(nodeVal)&&WM.isFunction(variable.login)&&!noUpdate&&_invoke(variable,"login"):"wm.DeviceVariable"===variable.category&&(variable[nodeName]=nodeVal,variable.autoUpdate&&!WM.isUndefined(nodeVal)&&WM.isFunction(variable.invoke)&&!noUpdate&&_invoke(variable,"invoke"))},getVariablesByNames=function(pageName,namesArray){var tempCollection=[],collection=self.variableCollection[pageName];return _.each(namesArray,function(name){collection[name]&&tempCollection.push(collection[name])}),filterVariables(Utils.getClonedObject(tempCollection))},isCrudEmpty=function(map,pageName){return!map.CREATE[pageName]||!(map.CREATE[pageName].length||map.UPDATE[pageName].length||map.DELETE[pageName].length||map.MOVE[pageName].length)},executeCrudOp=function(pageName,success,error){function handleSuccess(crudMapCopy,pageName){isCrudEmpty(crudMapCopy,pageName)&&Utils.triggerFn(success)}if(isCrudEmpty(CRUDMAP,pageName))Utils.triggerFn(success);else{var params={projectId:$rootScope.project.id,pageName:pageName},crudMapCopy=Utils.getClonedObject(CRUDMAP),opTypes=["CREATE","UPDATE"];_.each(opTypes,function(op){crudMapCopy[op][pageName].length&&(CRUDMAP[op][pageName]=[],params.data=getVariablesByNames(pageName,crudMapCopy[op][pageName]),VariableService[op.toLowerCase()](params,function(){crudMapCopy[op][pageName]=[],handleSuccess(crudMapCopy,pageName)},function(errMsg){Utils.triggerFn(error,errMsg)}))}),crudMapCopy.MOVE[pageName].length&&(params.toPage=pageName===VARIABLE_CONSTANTS.OWNER.APP?$rootScope.activePageName:VARIABLE_CONSTANTS.OWNER.APP,CRUDMAP.MOVE[pageName]=[],params.data=getVariablesByNames(params.toPage,crudMapCopy.MOVE[pageName]),VariableService.move(params,function(){crudMapCopy.MOVE[pageName]=[],handleSuccess(crudMapCopy,pageName)},function(errMsg){Utils.triggerFn(error,errMsg)})),crudMapCopy.DELETE[pageName].length&&(CRUDMAP.DELETE[pageName]=[],params.deletedNames=crudMapCopy.DELETE[pageName].join(","),VariableService.delete(params,function(){crudMapCopy.DELETE[pageName]=[],handleSuccess(crudMapCopy,pageName)},function(errMsg){Utils.triggerFn(error,errMsg)}))}},getTargetObj=function(obj,root,variable){var targetObj,target=obj.target,rootNode=variable[root];return DOT_EXPR_REX.test(target)?targetObj=rootNode:(target=target.substr(0,target.lastIndexOf(".")),targetObj=obj.target===root?variable:target?Utils.findValueOf(rootNode,target,!0):rootNode),targetObj},getTargetNodeKey=function(target){var targetNodeKey;return targetNodeKey=DOT_EXPR_REX.test(target)?target.replace(/^(\[["'])|(["']\])$/g,""):target.split(".").pop()},setValueToNode=function(target,obj,root,variable,value,noUpdate){var targetNodeKey=getTargetNodeKey(target),targetObj=getTargetObj(obj,root,variable);value=WM.isDefined(value)?value:obj.value,targetObj&&(targetObj[targetNodeKey]=value),processVariablePostBindUpdate(targetNodeKey,value,obj.type,variable,noUpdate)},updateInternalNodes=function(target,root,variable){function findInternalNodeBound(){return _.filter(boundInternalNodes,function(node){return node!==targetNodeKey&&_.includes(node,targetNodeKey)||targetNodeKey===root&&node!==targetNodeKey})}var internalNodes,boundInternalNodes=_.keys(_.get(internalBoundNodeMap,[variable.activeScope.$id,variable.name,root])),targetNodeKey=getTargetNodeKey(target);internalNodes=findInternalNodeBound(),internalNodes.length&&_.forEach(internalNodes,function(node){setValueToNode(node,{target:node},root,variable,_.get(internalBoundNodeMap,[variable.activeScope.$id,variable.name,root,node]))})},processBindObject=function(obj,scope,root,variable){var target=obj.target,targetObj=getTargetObj(obj,root,variable),targetNodeKey=getTargetNodeKey(target);Utils.stringStartsWith(obj.value,"bind:")?BindingManager.register(scope,obj.value.replace("bind:",""),function(newVal,oldVal){newVal===oldVal&&WM.isUndefined(newVal)||!(!WM.isUndefined(newVal)||WM.isUndefined(oldVal)&&WM.isUndefined(targetObj[targetNodeKey]))||(setValueToNode(target,obj,root,variable,Utils.getClonedObject(newVal)),runMode&&(WM.isObject(newVal)&&updateInternalNodes(target,root,variable),_.set(internalBoundNodeMap,[variable.activeScope.$id,variable.name,root,target],newVal)))},{deepWatch:!0}):WM.isDefined(obj.value)&&(setValueToNode(target,obj,root,variable,obj.value,!0),runMode&&root!==targetNodeKey&&_.set(internalBoundNodeMap,[variable.activeScope.$id,variable.name,root,target],obj.value))},processBindNode=function(node,parentNode,scope,variable){Utils.stringStartsWith(node.value,"bind:")?scope.$watch(node.value.replace("bind:",""),function(newVal,oldVal){newVal===oldVal&&WM.isUndefined(newVal)||!(!WM.isUndefined(newVal)||WM.isUndefined(oldVal)&&WM.isUndefined(parentNode[node.name]))||(parentNode[node.name]=newVal,processVariablePostBindUpdate(node.name,newVal,node.type,variable))},!0):(WM.isDefined(node.value)&&(parentNode[node.name]=node.value,"wm.LiveVariable"===variable.category&&("read"===variable.operation?variable.filterFields[node.name]={value:node.value}:variable.inputFields[node.name]=node.value)),node.fields&&node.fields.length&&(parentNode[node.name]=WM.isObject(parentNode[node.name])?parentNode[node.name]:{},WM.forEach(node.fields,function(field){processBindNode(field,parentNode[node.name],scope,variable)})))},updateVariableBinding=function(variable,name,scope){var bindMap,root;watchers[scope.$id][name]=watchers[scope.$id][name]||[],watchers[scope.$id][name].forEach(Utils.triggerFn),WM.isArray(variable.dataBinding)?(bindMap=variable.dataBinding,root="wm.Variable"===variable.category?"dataSet":"dataBinding",variable.dataBinding={},bindMap[0]&&WM.isArray(bindMap[0].fields)?bindMap.forEach(function(node){processBindNode(node,variable,scope,variable)}):bindMap.forEach(function(node){"wm.Variable"===variable.category&&"dataBinding"===node.target&&(node.target="dataSet"),processBindObject(node,scope,root,variable)})):WM.forEach(variable.dataBinding,function(binding,param){"object"==typeof binding&&"wm.ServiceVariable"===variable.category&&WM.forEach(binding,function(subParamBinding,subParam){bindVariableField({bindingVal:subParamBinding,paramName:subParam,variable:variable,variableName:name,parentNode:param,scope:scope})}),bindVariableField({
bindingVal:binding,paramName:param,variable:variable,variableName:name,scope:scope})}),runMode&&"wm.NavigationVariable"===variable.category&&WM.isArray(variable.dataSet)&&(bindMap=variable.dataSet,root="dataSet",variable.dataSet={},bindMap.forEach(function(node){processBindObject(node,scope,root,variable)}))},makeVariableCall=function(variable){var method,deferredVariableCall=$q.defer();switch(variable.category){case"wm.ServiceVariable":method="update";break;case"wm.WebSocketVariable":method="open",deferredVariableCall.resolve();break;case"wm.LiveVariable":method="read"!==variable.operation?variable.operation+"Record":"update";break;case"wm.LoginVariable":method="login";break;case"wm.TimerVariable":method="fire",deferredVariableCall.resolve();break;case"wm.DeviceVariable":method="invoke"}return WM.isFunction(variable[method])?variable[method](void 0,deferredVariableCall.resolve,deferredVariableCall.reject):deferredVariableCall.reject(),deferredVariableCall.promise},processVariableStartUpdate=function(variable,scope){$rootScope._pageReady?(lazySartUpdateQueue[scope.$id]=lazySartUpdateQueue[scope.$id]||[],lazySartUpdateQueue[scope.$id].push(variable)):(startUpdateQueue[scope.$id]=startUpdateQueue[scope.$id]||[],startUpdateQueue[scope.$id].push(variable))},updateVariableData=function(variable,name,context,scope,options){if(variable.name=name,variable.init&&variable.init(),runMode?variable.activeScope=scope:self.studioCopy[context][name]=variable,updateVariableBinding(variable,name,scope),"wm.Variable"===variable.category){if(CONSTANTS.isRunMode&&variable.isList&&1===variable.dataSet.length){var firstObj=variable.dataSet[0],isEmpty=!0,checkEmpty=function(obj){_.forEach(obj,function(value){return _.isEmpty(value)||(_.isObject(value)?_.isArray(value)?isEmpty=_.isEmpty(value)||1===value.length&&_.isEmpty(value[0]):checkEmpty(value):isEmpty=!1),isEmpty})};checkEmpty(firstObj),isEmpty&&(variable.dataSet=[])}}else"wm.ServiceVariable"===variable.category?runMode?(variable.canUpdate=!0,variable.startUpdate&&processVariableStartUpdate(variable,scope)):WM.isFunction(variable.update)&&variable.update(options):"wm.WebSocketVariable"===variable.category?runMode?variable.startUpdate&&processVariableStartUpdate(variable,scope):WM.isFunction(variable.update)&&variable.update():"wm.LiveVariable"===variable.category?(migrateOrderBy(variable),runMode?(variable.canUpdate=!0,variable.startUpdate&&processVariableStartUpdate(variable,scope)):variable.startUpdate&&WM.isFunction(variable.update)?$timeout(function(){variable.update()},null,!1):$timeout(function(){WM.isFunction(variable.update)&&variable.update({skipFetchData:!0})},null,!1)):"wm.LoginVariable"===variable.category?runMode&&variable.startUpdate&&processVariableStartUpdate(variable,scope):"wm.TimerVariable"===variable.category?runMode&&variable.autoStart&&processVariableStartUpdate(variable,scope):"wm.DeviceVariable"===variable.category&&runMode&&variable.startUpdate&&processVariableStartUpdate(variable,scope)},updateContextVariables=function(context,scope){self.studioCopy[context]={},scope=scope||pageScopeMap[context]||{},watchers[scope.$id]={},self.variableCollection[scope.$id]=Utils.getClonedObject(self.variableCollection[context]),scope.Variables=self.variableCollection[scope.$id],context!==VARIABLE_CONSTANTS.OWNER.APP&&WM.forEach(self.variableCollection[$rootScope.$id],function(variable,name){scope.Variables.hasOwnProperty(name)||Object.defineProperty(scope.Variables,name,{configurable:!0,get:function(){return variable}})}),_.forEach(self.variableCollection[scope.$id],function(variable,name){updateVariableData(variable,name,context,scope)})},updateVariableValues=function(activePageName,isUpdatePageVariables){isUpdatePageVariables||updateContextVariables(VARIABLE_CONSTANTS.OWNER.APP),activePageName&&updateContextVariables(activePageName)},setPageVariables=function(pageName,pageVariables){self.variableCollection=self.variableCollection||{},self.variableCollection[pageName]=pageVariables||{}},getPageVariables=function(pageName,success,error){var requestParams;return runMode||(CRUDMAP.CREATE[pageName]=[],CRUDMAP.DELETE[pageName]=[],CRUDMAP.UPDATE[pageName]=[],CRUDMAP.MOVE[pageName]=[]),null!==self.variableCollection&&self.variableCollection[pageName]&&reloadRequired&&!_.includes(reloadRequired,pageName)?void Utils.triggerFn(success,self.variableCollection[pageName]):void(runMode||(requestParams={pageName:pageName,projectId:$rootScope.project.id},VariableService.get(requestParams,function(variables){_.remove(reloadRequired,function(page){return page===pageName}),WM.isObject(variables)||(variables={}),setPageVariables(pageName,variables),Utils.triggerFn(success,variables)},function(errMsg){setPageVariables(pageName,void 0),Utils.triggerFn(error,errMsg)})))},getAppVariables=function(success,error){if(runMode||(CRUDMAP.CREATE[VARIABLE_CONSTANTS.OWNER.APP]=[],CRUDMAP.DELETE[VARIABLE_CONSTANTS.OWNER.APP]=[],CRUDMAP.UPDATE[VARIABLE_CONSTANTS.OWNER.APP]=[],CRUDMAP.MOVE[VARIABLE_CONSTANTS.OWNER.APP]=[]),null!==self.variableCollection&&self.variableCollection[VARIABLE_CONSTANTS.OWNER.APP]&&reloadRequired&&!_.includes(reloadRequired,"App"))return void Utils.triggerFn(success,self.variableCollection[VARIABLE_CONSTANTS.OWNER.APP]);var requestParams={};runMode?(requestParams={path:"app.variables.json"},FileService.read(requestParams,function(variables){WM.isObject(variables)||(variables={}),Utils.triggerFn(success,variables,!0)},function(errMsg){Utils.triggerFn(error,errMsg)})):(requestParams={pageName:VARIABLE_CONSTANTS.OWNER.APP,projectId:$rootScope.project.id},VariableService.get(requestParams,function(variables){WM.isObject(variables)||(variables={}),_.remove(reloadRequired,function(page){return"App"===page}),Utils.triggerFn(success,variables,!0)},function(errMsg){Utils.triggerFn(error,errMsg)}))},extendVariables=function(variables){return WM.forEach(variables,function(variable,name){variables[name]=WM.extend(BaseVariablePropertyFactory.getProperties(variable.category),variable),runMode||"wm.LiveVariable"!==variable.category?!runMode||"wm.ServiceVariable"!==variable.category&&"wm.WebSocketVariable"!==variable.category||(variables[name]._wmServiceOperationInfo=MetaDataFactory.getByOperationId(variable.operationId,variable._prefabName),runMode&&!variable.controller&&variable.operationId&&(variables[name].controller=variable.operationId.split("_")[0].replace(/Controller$/,""))):variables[name].dataSet=[]}),variables},initAppVariables=function(scope,success,error){self.variableCollection=self.variableCollection||{},getAppVariables(function(appVariables,freshVariables){"object"!=typeof appVariables&&(appVariables={}),freshVariables&&register(VARIABLE_CONSTANTS.OWNER.APP,appVariables,!0,$rootScope),Utils.triggerFn(success,appVariables)},function(errMsg){self.variableCollection[VARIABLE_CONSTANTS.OWNER.APP]={},pageScopeMap[VARIABLE_CONSTANTS.OWNER.APP]=$rootScope,Utils.triggerFn(error,errMsg)})},initPageVariables=function(pageName,success,error,isUpdatePageVariables){activePage=pageName,self.variableCollection=self.variableCollection||{},getPageVariables(activePage,function(pageVariables){"object"!=typeof pageVariables&&(pageVariables={}),pageVariables=extendVariables(pageVariables),self.variableCollection[activePage]=pageVariables,updateVariableValues(activePage,!isUpdatePageVariables),$rootScope.$emit("on-"+activePage+"-variables-ready",pageVariables),Utils.triggerFn(success,self.variableCollection)},function(errMsg){self.variableCollection[activePage]={},Utils.triggerFn(error,errMsg)})},initVariableCollection=function(activeWorkspaceName,success,error,isUpdatePageVariables){activePage=activeWorkspaceName,self.variableCollection=self.variableCollection||{},getAppVariables(activePage,function(appVariables,freshVariables){"object"!=typeof appVariables&&(appVariables={}),appVariables=extendVariables(appVariables),self.variableCollection[VARIABLE_CONSTANTS.OWNER.APP]=appVariables,freshVariables&&$rootScope.$emit("on-app-variables-ready",appVariables),getPageVariables(activeWorkspaceName,function(pageVariables){"object"!=typeof pageVariables&&(pageVariables={}),pageVariables=extendVariables(pageVariables),self.variableCollection[activeWorkspaceName]=pageVariables,updateVariableValues(activeWorkspaceName,isUpdatePageVariables),$rootScope.$emit("on-"+activeWorkspaceName+"-variables-ready",pageVariables),Utils.triggerFn(success,self.variableCollection)},function(errMsg){self.variableCollection[activeWorkspaceName]={},Utils.triggerFn(error,errMsg)})},function(errMsg){self.variableCollection[VARIABLE_CONSTANTS.OWNER.APP]={},Utils.triggerFn(error,errMsg)})},getVariableByName=function(variableName,scope){var scopes,i,n,variables=self.variableCollection;if(scope)return variables[scope.$id]&&variables[scope.$id][variableName]||self.variableCollection[$rootScope.$id][variableName];if(CONSTANTS.isRunMode){if(scope=pageScopeMap[$rootScope.activePageName],scope&&variables[scope.$id][variableName])return variables[scope.$id][variableName];if(scope=pageScopeMap[VARIABLE_CONSTANTS.OWNER.APP],scope&&variables[scope.$id][variableName])return variables[scope.$id][variableName];for(i=0,scopes=Object.keys(variables),n=scopes.length;i<n;i+=1)if(scope=scopes[i],variables[scopes[i]][variableName])return variables[scopes[i]][variableName]}return variables[$rootScope.activePageName]&&variables[$rootScope.activePageName][variableName]||variables[VARIABLE_CONSTANTS.OWNER.APP]&&variables[VARIABLE_CONSTANTS.OWNER.APP][variableName]||null},updateVariable=function(variableName,newProperties,isUpdate){var newName=newProperties.name,updated=!1,pageName="App"===newProperties.owner?"App":$rootScope.isPrefabTemplate?MAIN_PAGE:$rootScope.activePageName,oldOwner="App"===pageName?$rootScope.activePageName:"App",scope=pageScopeMap[pageName];return _.find(self.variableCollection[pageName],{_id:newProperties._id})?(self.variableCollection[pageName][newName]=newProperties,updated=!0,_.includes(CRUDMAP.UPDATE[pageName],newName)||_.includes(CRUDMAP.CREATE[pageName],newName)||CRUDMAP.UPDATE[pageName].push(newName),variableName!==newName&&(delete self.variableCollection[pageName][variableName],reloadRequired.push(pageName))):_.find(self.variableCollection[oldOwner],{_id:newProperties._id})&&(self.variableCollection[pageName][newName]=newProperties,delete self.variableCollection[oldOwner][variableName],_.includes(CRUDMAP.MOVE[oldOwner],newName)||CRUDMAP.MOVE[oldOwner].push(newName),updated=!0),isUpdate&&call("getData",newName,{scope:scope,skipFetchData:!0}),updated},getType=function(name){return getVariableByName(name)&&getVariableByName(name).category},getVariableCategoryList=function(collectionType,getKeysList){var categoryList={},isPrefabProject=$rootScope.isPrefabTemplate,filteredVariables=[];return isPrefabProject?_.forEach(variableConfig,function(variable){variable.appOnly||collectionType&&"all"!==collectionType.toLowerCase()&&variable.collectionType!==collectionType||filteredVariables.push(variable)}):_.forEach(variableConfig,function(variable){collectionType&&"all"!==collectionType.toLowerCase()&&variable.collectionType!==collectionType||filteredVariables.push(variable)}),_.forEach(_.sortBy(filteredVariables,"defaultName"),function(variable){categoryList[variable.category]=variable.category}),getKeysList&&(categoryList=Object.keys(categoryList)),categoryList},isExists=function(variableName,caseSensitive){var arrOfVariables,variables=self.variableCollection;return arrOfVariables=$rootScope.isPrefabTemplate?_.keys(variables[MAIN_PAGE]):_.union(_.keys(variables[VARIABLE_CONSTANTS.OWNER.APP]),_.keys(variables[$rootScope.activePageName])),Utils.isDuplicateName(arrOfVariables,variableName,caseSensitive)},call=function(method,name,options,success,error){if(options=options||{},!name||!method)return void Utils.triggerFn(error);var variable=getVariableByName(name,options.scope),type=variable.category;return BaseVariablePropertyFactory.invoke(method,type,variable,options,function(data,propertiesMap,pagingOptions){Utils.triggerFn(success,data,propertiesMap,pagingOptions)},error)},updateVariableDataSet=function(name,data,propertiesMap,pagingOptions){if(returnObject[name]){if(!WM.isObject(data)){var temp=data;data={},data.value=temp}propertiesMap?returnObject[name].dataSet={data:data,propertiesMap:propertiesMap,pagingOptions:pagingOptions}:returnObject[name].dataSet=data}},generateUniqueName=function(category,name,overWrite){var defaultName,nameIteratorKey=category;return name?(nameIteratorKey=name,self.variableNameIterator[nameIteratorKey]=self.variableNameIterator[nameIteratorKey]||0,defaultName=name+(self.variableNameIterator[nameIteratorKey]||"")):defaultName=variableCategoryToNameMap[category]+self.variableNameIterator[category],!isExists(defaultName,!0)||overWrite?defaultName:(self.variableNameIterator[nameIteratorKey]+=1,generateUniqueName(category,name))},register=function(nameSpace,variables,loadValuesInStudio,scope){variables=extendVariables(variables),pageScopeMap[nameSpace]=scope,self.variableCollection=self.variableCollection||{},self.variableCollection[nameSpace]=variables,(loadValuesInStudio||runMode)&&(updateContextVariables(nameSpace,scope),$rootScope.$emit("on-"+nameSpace+"-variables-ready",variables))},isEventCallbackVariable=function(category){var retVal=!1;return"wm.Variable"!==category&&(retVal=!0),retVal},retrieveEventCallbackVariables=function(variableName,context){var methods,variableArray=[],varCollection=self.variableCollection,contextsVariables=context?[varCollection[context]]:[varCollection[VARIABLE_CONSTANTS.OWNER.APP],varCollection[$rootScope.activePageName]];return $rootScope.isPrefabTemplate&&(contextsVariables=[varCollection.Main]),_.forEach(contextsVariables,function(variables){_.forEach(variables,function(curVariable,curVariableName){isEventCallbackVariable(curVariable.category)&&(variableName&&curVariableName===variableName||(methods=variableConfig[curVariable.category].methods,variableArray.push({name:curVariableName,category:curVariable.category,methods:methods})))})}),_.uniq(variableArray)},saveContextVariables=function(context,contextVariables){_.each(contextVariables,function(varObj,name){updateVariable(name,varObj)})},cleanseBindings=function(bindings,variable){_.remove(bindings,function(binding){return WM.isUndefined(binding.value)||""===binding.value||_.isNull(binding.value)&&variable&&"wm.LiveVariable"===variable.category})},filterVariables=function(variables){return WM.forEach(variables,function(variable){WM.forEach(variable,function(propertyValue,propertyName){(""===propertyValue||void 0===propertyValue||Utils.stringStartsWith(propertyName,"_")&&"_id"!==propertyName||"$$hashKey"===propertyName)&&delete variable[propertyName]}),cleanseBindings(variable.dataBinding,variable),"wm.NavigationVariable"===variable.category&&cleanseBindings(variable.dataSet)}),variables},create=function(type,options,name,overWrite){type=type||"wm.Variable";var variableObj={},defaultName="";return options=WM.isObject(options)?options:{},defaultName=name?generateUniqueName(type,name,overWrite):generateUniqueName(type),WM.extend(variableObj,BaseVariablePropertyFactory.getProperties(type),{name:defaultName},options),variableObj},store=function(owner,name,variableObj,isUpdate,fetchData){if(variableObj){var scope,varCollectionObj=self.variableCollection;owner=$rootScope.isPrefabTemplate?MAIN_PAGE:owner||VARIABLE_CONSTANTS.OWNER.APP,scope=pageScopeMap[owner],varCollectionObj.hasOwnProperty(owner)&&varCollectionObj[owner]||(varCollectionObj[owner]={}),variableObj._id="wm-"+name+"-"+variableObj.category+"-"+(new Date).getTime(),varCollectionObj[owner][name]=variableObj,varCollectionObj[scope.$id][name]=Utils.getClonedObject(variableObj),varCollectionObj[scope.$id][name].name=name,self.studioCopy[owner][name]=varCollectionObj[scope.$id][name],"wm.LiveVariable"===variableObj.category&&(variableObj._isNew=!0),owner===VARIABLE_CONSTANTS.OWNER.APP&&$rootScope.activePageName&&pageScopeMap[$rootScope.activePageName]&&Object.defineProperty(pageScopeMap[$rootScope.activePageName].Variables,name,{configurable:!0,get:function(){return varCollectionObj[scope.$id][name]}}),_.includes(CRUDMAP.CREATE[owner],name)||CRUDMAP.CREATE[owner].push(name),isUpdate&&updateVariableData(varCollectionObj[scope.$id][name],name,owner,scope,{skipFetchData:!fetchData})}},initiateCallback=function(event,variable,response,info,skipDefaultNotification){var retVal,errorVariable,eventValues=variable[event],callBackScope=variable.activeScope;return eventValues?retVal=Utils.triggerCustomEvents(event,eventValues,callBackScope,response,variable,info):event!==VARIABLE_CONSTANTS.EVENT.ERROR||skipDefaultNotification||(errorVariable=getVariableByName(VARIABLE_CONSTANTS.DEFAULT_VAR.NOTIFICATION),errorVariable&&(response=errorVariable.getMessage()||response,$rootScope.$evalAsync(function(){$rootScope.$emit("invoke-service",VARIABLE_CONSTANTS.DEFAULT_VAR.NOTIFICATION,{scope:callBackScope,message:response})}))),retVal},unload=function(namespace,scope){if(namespace){var scopeId=scope.$id;self.variableCollection=self.variableCollection||{},watchers[scopeId]&&WM.forEach(self.variableCollection[namespace],function(variable,name){watchers[scopeId][name]&&watchers[scopeId][name].forEach(Utils.triggerFn),_.set(internalBoundNodeMap,scopeId,void 0)}),delete self.variableCollection[namespace],delete self.variableCollection[scopeId]}},processRequestQueue=function(variable,requestQueue,handler){if(requestQueue&&requestQueue[variable.name]&&requestQueue[variable.name].length){var requestObj;switch(variable.inFlightBehavior){case"executeLast":requestObj=requestQueue[variable.name].pop(),handler(requestObj.variable,requestObj.options,requestObj.success,requestObj.error),requestQueue[variable.name]=null;break;case"executeAll":requestObj=requestQueue[variable.name].splice(0,1).pop(),handler(requestObj.variable,requestObj.options,requestObj.success,requestObj.error);break;default:requestQueue[variable.name]=null}}},deleteVariable=function(name,pageName){var i,pageContext,owner;if(pageName)return void(name&&!_.includes(CRUDMAP.DELETE[pageName],name)?(CRUDMAP.DELETE[pageName].push(name),delete self.variableCollection[pageName][name],CONSTANTS.isStudioMode&&(delete returnObject[name],delete self.studioCopy[pageName][name])):(_.each(self.variableCollection[pageName],function(variable){_.includes(CRUDMAP.DELETE[pageName],variable.name)||CRUDMAP.DELETE[pageName].push(variable.name)}),delete self.variableCollection[pageName],CONSTANTS.isStudioMode&&delete self.studioCopy[pageName]));for(i in self.variableCollection)self.variableCollection.hasOwnProperty(i)&&self.variableCollection[i].hasOwnProperty(name)&&(owner=self.variableCollection[i][name].owner===VARIABLE_CONSTANTS.OWNER.APP?VARIABLE_CONSTANTS.OWNER.APP:$rootScope.activePageName,_.includes(CRUDMAP.DELETE[owner],name)||CRUDMAP.DELETE[owner].push(name),delete self.variableCollection[i][name],CONSTANTS.isStudioMode&&self.studioCopy[i]&&delete self.studioCopy[i][name],ProjectService.getPageNames().indexOf(i)>-1&&(pageContext=i));return!!pageContext&&pageContext},filterByVariableKeys=function(variableParams,searchAllContexts){function findMatchingVariables(contextVariables,context){for(variableNames=_.keys(contextVariables),index=0;index<variableNames.length;index++){for(currentVariable=variables[context][variableNames[index]],varParamCounter=0;varParamCounter<varParamsArray.length&&(currentVarParam=varParamsArray[varParamCounter],currentVariable[currentVarParam]===variableParams[currentVarParam]);varParamCounter++);varParamCounter===varParamsArray.length&&filteredVariables.indexOf(currentVariable)===-1&&(currentVariable.name=variableNames[index],filteredVariables.push(currentVariable))}}var currentVariable,variableOwner,variableNames,index,varParamCounter,currentVarParam,variables=self.variableCollection,varParamsArray=_.keys(variableParams),filteredVariables=[],defaultContextArray=$rootScope.isPrefabTemplate?[MAIN_PAGE]:[VARIABLE_CONSTANTS.OWNER.APP,$rootScope.activePageName];return variableParams.owner&&(variableOwner=$rootScope.isPrefabTemplate?MAIN_PAGE:variableParams.owner===VARIABLE_CONSTANTS.OWNER.APP?VARIABLE_CONSTANTS.OWNER.APP:$rootScope.activePageName),searchAllContexts?Object.keys(variables).forEach(function(context){isNaN(context)&&findMatchingVariables(variables[context],context)}):variableOwner?findMatchingVariables(variables[variableOwner],variableOwner):defaultContextArray.forEach(function(context){findMatchingVariables(variables[context],context)}),filteredVariables},getBindMap=function(type,parentReference,oldBindings,visitedNodes){var curFieldObj,types=$rootScope.dataTypes;oldBindings=oldBindings||{},visitedNodes||(visitedNodes=[]),visitedNodes.indexOf(type)===-1&&types&&types[type]&&types[type].fields&&Object.keys(types[type].fields).length&&(visitedNodes.push(type),parentReference.fields=[],WM.forEach(types[type].fields,function(field,fieldName){curFieldObj={name:fieldName,type:field.type,isList:field.isList},oldBindings[fieldName]&&!WM.isObject(oldBindings[fieldName])&&(curFieldObj.value=oldBindings[fieldName]),parentReference.fields.push(curFieldObj),getBindMap(field.type,curFieldObj,oldBindings[fieldName],visitedNodes)}))},getEvaluatedOrderBy=function(varOrder,optionsOrder){var optionFields,varOrderBy;return!optionsOrder||WM.element.isEmptyObject(optionsOrder)?varOrder:varOrder?(varOrder=_.split(varOrder,","),optionsOrder=_.split(optionsOrder,","),optionFields=_.map(optionsOrder,function(order){return _.split(_.trim(order)," ")[0]}),_.remove(varOrder,function(orderBy){return _.includes(optionFields,_.split(_.trim(orderBy)," ")[0])}),varOrderBy=varOrder.length?","+_.join(varOrder,","):"",_.join(optionsOrder,",")+varOrderBy):optionsOrder};return this.variableCollection=null,this.studioCopy={},runMode&&($rootScope.project={id:ProjectService.getId()}),initVariableNameMap(),resetVariableNameIterator(),CONSTANTS.isRunMode&&($rootScope.$on("page-ready",function(e,pageName){var pageScope=pageScopeMap[pageName],pageScopeId=pageScope.$id;$q.all(_.map(startUpdateQueue[pageScopeId],makeVariableCall)).finally(function(){$rootScope.$emit("page-startupdate-variables-loaded",pageName)}),delete startUpdateQueue[pageScopeId],startUpdateQueue[$rootScope.$id]&&(_.forEach(startUpdateQueue[$rootScope.$id],makeVariableCall),delete startUpdateQueue[$rootScope.$id])}),$rootScope.$on("partial-ready",function(event,scope){var queue=lazySartUpdateQueue[scope.$id]||startUpdateQueue[scope.$id];queue&&(_.forEach(queue,makeVariableCall),delete lazySartUpdateQueue[scope.$id],delete startUpdateQueue[scope.$id])})),CONSTANTS.isStudioMode&&($rootScope.$on("bind-widget-to-variable",function(event,variableName,isBind,scope,bindCount){event.stopPropagation();var variable=getVariableByName(variableName,scope),writableVariable=getVariableByName(variableName);variable&&"wm.LiveVariable"===variable.category&&"read"===variable.operation&&(isBind?variable.bindCount=(variable.bindCount||0)+(bindCount||1):variable.bindCount-=1,writableVariable.bindCount=variable.bindCount,updateVariable(writableVariable.name,writableVariable),$rootScope.saveVariables=!0)}),_.forEach(variableConfig,function(variable){variable.hideInEvents||WIDGET_CONSTANTS.EVENTS_OPTIONS.push(variable.newVariableKey)})),returnObject={create:create,store:store,isExists:isExists,isNameAvailable:function(variableObj){var variableNameAvailable=!1,existingVariable=getVariableByName(variableObj.name);return variableObj&&variableObj._id===existingVariable._id&&(variableNameAvailable=!0),variableNameAvailable},getVariableByName:getVariableByName,updateVariable:updateVariable,delete:deleteVariable,getAll:function(){return self.variableCollection},getByContext:function(pages){if(pages)return pages=pages||_.keys(pageScopeMap),_.pick(self.variableCollection,pages)},getDuplicateVariables:function(){return _.intersection(_.keys(self.variableCollection[VARIABLE_CONSTANTS.OWNER.APP]),_.keys(self.variableCollection[$rootScope.activePageName]))},getStudioCopy:function(pages){return pages&&pages.length?(pages=pages||_.keys(pageScopeMap),_.pick(self.studioCopy,pages)):self.studioCopy},saveVariables:function(activePageName,success,error,updateValues){function onSuccess(){_.includes(reloadRequired,"App")?reloadVariables(success,error):_.includes(reloadRequired,activePageName)?initPageVariables(activePageName,success,error):Utils.triggerFn(success)}$rootScope.isPrefabTemplate&&(activePageName=MAIN_PAGE),updateValues&&updateVariableValues(activePageName),executeCrudOp(VARIABLE_CONSTANTS.OWNER.APP,function(){activePageName?executeCrudOp(activePageName,onSuccess,error):onSuccess()},error)},savePageVariables:function(activePageName,success,error,updateValues){function onSuccess(){_.includes(reloadRequired,activePageName)?initPageVariables(activePageName,success,error):Utils.triggerFn(success)}activePageName&&(updateValues&&updateVariableValues(activePageName),executeCrudOp(activePageName,onSuccess,error))},saveAppVariables:function(success,error,updateValues){function onSuccess(){_.includes(reloadRequired,"App")?reloadVariables(success,error):Utils.triggerFn(success)}updateValues&&updateVariableValues(),executeCrudOp(VARIABLE_CONSTANTS.OWNER.APP,onSuccess,error)},init:initVariableCollection,initAppVariables:initAppVariables,initPageVariables:initPageVariables,reloadVariables:reloadVariables,getVariableCategoryList:getVariableCategoryList,getType:getType,getVariableNameIterator:function(){return self.variableNameIterator},resetVariableNameIterator:resetVariableNameIterator,call:call,generateUniqueName:generateUniqueName,register:register,retrieveEventCallbackVariables:retrieveEventCallbackVariables,isEventCallbackVariable:isEventCallbackVariable,saveContextVariables:saveContextVariables,updateVariableDataSet:updateVariableDataSet,createLiveVariable:function(variableDetails,fetchData){var defaultName,createdVariable,variableName,variableOwner,variableCategory="wm.LiveVariable";return defaultName=variableDetails.name||Utils.initCaps(variableDetails.service)+Utils.initCaps(variableDetails.table)+"Data",isExists(defaultName)?variableName=defaultName:(createdVariable=create(variableCategory,{owner:variableDetails.owner||"Page",isList:!0},defaultName),variableName=createdVariable.name,variableOwner=createdVariable.owner===VARIABLE_CONSTANTS.OWNER.PAGE?$rootScope.activePageName:null,createdVariable.liveSource=variableDetails.service,createdVariable.type=variableDetails.table,createdVariable.package=variableDetails.package,createdVariable.category=variableCategory,createdVariable.isDefault=!0,_.forEach(["maxResults","startUpdate","autoUpdate","bindCount"],function(property){WM.isDefined(variableDetails[property])&&(createdVariable[property]=variableDetails[property])}),createdVariable.dbSystem=variableDetails.dbSystem,store(variableOwner,variableName,createdVariable,!0,fetchData),$rootScope.$emit("update-variables-tree",createdVariable)),variableName},createServiceVariable:function(variableDetails,overWrite){var createdVariable,variableName,variableOwner,bindMapCollection,variableCategory="wm.ServiceVariable",defaultName=variableDetails.name||Utils.initCaps(variableDetails.service)+Utils.initCaps(variableDetails.operation);return!isExists(defaultName)||overWrite?(createdVariable=create(variableCategory,{owner:variableDetails.owner||"Page"},defaultName,overWrite),variableName=createdVariable.name,variableOwner=createdVariable.owner===VARIABLE_CONSTANTS.OWNER.PAGE?$rootScope.activePageName:null,createdVariable.service=variableDetails.service,createdVariable.operation=variableDetails.operation,createdVariable.operationType=variableDetails.operationType,createdVariable.serviceType=variableDetails.serviceType,createdVariable.category=variableCategory,createdVariable.isDefault=!0,createdVariable.controller=variableDetails.controller,createdVariable.operationId=variableDetails.operationId,createdVariable.type=variableDetails.returnType,_.forEach(["maxResults","startUpdate","autoUpdate","isList"],function(property){WM.isDefined(variableDetails[property])&&(createdVariable[property]=variableDetails[property])}),bindMapCollection=createdVariable.dataBinding,WM.forEach(variableDetails.sampleParamValues,function(val,key){bindMapCollection.push({target:key,value:val,type:"java.lang.String"})}),store(variableOwner,variableName,createdVariable,!0),$rootScope.$emit("update-variables-tree",createdVariable)):variableName=defaultName,variableName},deleteDefaultVariable:function(variableDetails){var filteredVariables=filterByVariableKeys(variableDetails,!1),owner=VARIABLE_CONSTANTS.OWNER.APP;filteredVariables.forEach(function(variable){variable.owner===VARIABLE_CONSTANTS.OWNER.PAGE&&(owner=$rootScope.isPrefabTemplate?MAIN_PAGE:$rootScope.activePageName),deleteVariable(variable.name,owner)})},getMappedServiceQueryParams:function(params){return _.map(_.reject(params,function(param){return _.includes(VARIABLE_CONSTANTS.PAGINATION_PARAMS,param.name)}),function(param){return param.name})},initiateCallback:initiateCallback,unload:unload,getAppVariables:getAppVariables,getPageVariables:getPageVariables,setPageVariables:setPageVariables,processRequestQueue:processRequestQueue,filterByVariableKeys:filterByVariableKeys,getBindMap:getBindMap,addVariableConfig:function(config){variableConfig[config.category]=config,variableCategoryToNameMap[config.category]=config.defaultName,self.variableNameIterator[config.category]=1},isSpinnerType:function(category){return variableConfig[category].spinnerInFlight},getVariableConfig:function(){return variableConfig},getEvaluatedOrderBy:getEvaluatedOrderBy}}],wm.variables.services.VariableService=function(BaseService){"use strict";return{create:function(params,successCallback,failureCallback){BaseService.send({target:"VariableService",action:"App"===params.pageName?"addAppVariables":"addPageVariables",urlParams:params,data:params.data},successCallback,failureCallback)},get:function(params,successCallback,failureCallback){BaseService.send({target:"VariableService",action:"App"===params.pageName?"getAppVariables":"getPageVariables",urlParams:params},successCallback,failureCallback)},update:function(params,successCallback,failureCallback){BaseService.send({target:"VariableService",action:"App"===params.pageName?"updateAppVariables":"updatePageVariables",urlParams:params,data:params.data},successCallback,failureCallback)},move:function(params,successCallback,failureCallback){BaseService.send({target:"VariableService",action:"App"===params.pageName?"moveAppVariables":"movePageVariables",urlParams:params,data:params.data},successCallback,failureCallback)},delete:function(params,successCallback,failureCallback){BaseService.send({target:"VariableService",action:"App"===params.pageName?"deleteAppVariables":"deletePageVariables",urlParams:params},successCallback,failureCallback)},getServiceOpInfo:function(params,successCallback,failureCallback){BaseService.send({target:"VariableService",action:"getServiceOpInfo",urlParams:params},successCallback,failureCallback)},getPrefabServiceOpInfo:function(params,successCallback,failureCallback){BaseService.send({target:"VariableService",action:"getPrefabServiceOpInfo",urlParams:params},successCallback,failureCallback)}}},wm.variables.factories.MetaDataFactory=["VariableService","$q","wmToaster",function(VariableService,$q,wmToaster){"use strict";function load(prefabName){var deferred=$q.defer(),method="getServiceOpInfo",scope="APP",params={};return prefabName&&(scope=prefabName,method="getPrefabServiceOpInfo",params={prefabName:prefabName}),metaInfo[scope]&&deferred.resolve(),VariableService[method](params,function(response){metaInfo[scope]=response,deferred.resolve()},function(errMsg){wmToaster.show("error","ERROR",errMsg||"Cannot fetch service definitions"),deferred.resolve()}),deferred.promise}function getByOperationId(operationId,prefabName){var scope=prefabName||"APP";return _.get(metaInfo[scope],[operationId,"wmServiceOperationInfo"])||{}}var metaInfo={};return{load:load,getByOperationId:getByOperationId
}}],wm.variables.services.BasicVariableService=["BaseVariablePropertyFactory","Utils",function(BaseVariablePropertyFactory,Utils){"use strict";var methods={getData:function(variable,options,success){return Utils.triggerFn(success,variable.dataSet),variable.dataSet},setData:function(variable,dataSet){return dataSet?variable.isList&&!WM.isArray(dataSet)?variable.dataSet:(variable.dataSet=dataSet,variable.dataSet):variable.dataSet},getValue:function(variable,key,index){return index=index||0,variable.isList?variable.dataSet[index][key]:variable.dataSet[key]},setValue:function(variable,key,value){return!key||variable.isList?variable.dataSet:(variable.dataSet[key]=value,variable.dataSet)},getItem:function(variable,index){return variable.isList?variable.dataSet[index]:variable.dataSet},setItem:function(variable,i,value){var index;return WM.isDefined(i)&&WM.isDefined(value)&&variable.isList?(index=WM.isObject(i)?_.findIndex(variable.dataSet,i):i,index>-1&&(variable.dataSet[index]=value),variable.dataSet):variable.dataSet},addItem:function(variable,value,index){return value&&variable.isList?(index=void 0!==index?index:variable.dataSet.length,variable.dataSet.splice(index,0,value),variable.dataSet):variable.dataSet},removeItem:function(variable,i,exactMatch){var index;return i=void 0!==i?i:variable.dataSet.length-1,WM.isObject(i)?(index=_.findIndex(variable.dataSet,i),index>-1&&(!exactMatch||exactMatch&&WM.equals(variable.dataSet[index],i))&&variable.dataSet.splice(index,1)):variable.dataSet.splice(i,1),variable.dataSet},clearData:function(variable){return variable.dataSet=variable.isList?[]:{},variable.dataSet},getCount:function(variable){return variable.isList?variable.dataSet.length:1}},basicVariableObj={getData:function(){return methods.getData(this)},setData:function(dataSet){return methods.setData(this,dataSet)},getValue:function(key,index){return methods.getValue(this,key,index)},setValue:function(key,value){return methods.setValue(this,key,value)},getItem:function(index){return methods.getItem(this,index)},setItem:function(index,value){return methods.setItem(this,index,value)},addItem:function(value,index){return methods.addItem(this,value,index)},removeItem:function(index,exactMatch){return methods.removeItem(this,index,exactMatch)},clearData:function(){return methods.clearData(this)},getCount:function(){return methods.getCount(this)}};return BaseVariablePropertyFactory.register("wm.Variable",basicVariableObj,[],methods),{}}],wm.variables.services.$liveVariable=["$rootScope","DatabaseService","Variables","BaseVariablePropertyFactory","CONSTANTS","Utils","VARIABLE_CONSTANTS","ProjectService","DB_CONSTANTS","wmToaster","ServiceFactory","$timeout",function($rootScope,DatabaseService,Variables,BaseVariablePropertyFactory,CONSTANTS,Utils,VARIABLE_CONSTANTS,ProjectService,DB_CONSTANTS,wmToaster,ServiceFactory,$timeout){"use strict";var projectDeployReqQueue,isDeployReqSourceChanged,isProjectDeployed=CONSTANTS.isRunMode,DataModelDesignManager=CONSTANTS.isStudioMode&&Utils.getService("DataModelDesignManager"),isProjectDeployInProgress=!1,callbackParams=[],requestQueue={},variableActive={},invalidVariables=[],packageDetails={},emptyArr=[],reset=function(){isProjectDeployed=CONSTANTS.isRunMode,isDeployReqSourceChanged=!0},getCompositeIDURL=function(primaryKeysData){var compositeId="";return _.forEach(primaryKeysData,function(paramValue,paramName){compositeId+=paramName+"="+encodeURIComponent(paramValue)+"&"}),compositeId=compositeId.slice(0,-1)},processBlobColumns=function(responseData,variable){if(responseData){var primaryKeys,blobCols=_.map(_.filter(variable.propertiesMap.columns,{type:"blob"}),"fieldName"),href="",deployedUrl=_.trim($rootScope.project.deployedUrl);_.isEmpty(blobCols)||(CONSTANTS.hasCordova&&CONSTANTS.isRunMode&&(href+=_.endsWith(deployedUrl,"/")?deployedUrl:deployedUrl+"/"),href+=(""!==variable._prefabName&&void 0!==variable._prefabName?"prefabs/"+variable._prefabName:"services")+"/"+variable.liveSource+"/"+variable.type+"/",primaryKeys=variable.propertiesMap.primaryFields||variable.propertiesMap.primaryKeys,_.forEach(responseData,function(data){data&&_.forEach(blobCols,function(col){var compositeKeysData={};null!==data[col]&&(variable.isCompositeKey(primaryKeys)?(primaryKeys.forEach(function(key){compositeKeysData[key]=data[key]}),data[col]=href+"composite-id/content/"+col+"?"+getCompositeIDURL(compositeKeysData)):data[col]=href+data[_.join(primaryKeys)]+"/content/"+col)})}))}},getHibernateOrSqlType=function(variable,fieldName,type){var column,relatedCols,relatedCol,columns=variable.propertiesMap.columns;return _.includes(fieldName,".")?(column=_.find(columns,function(col){return col.fieldName===fieldName.split(".")[0]}),relatedCols=column&&column.columns,relatedCol=_.find(relatedCols,function(col){return col.fieldName===fieldName.split(".")[1]}),relatedCol&&relatedCol[type]):(column=_.find(columns,function(col){return col.fieldName===fieldName||col.relatedColumnName===fieldName}),column&&column[type])},getSqlType=function(variable,fieldName){return getHibernateOrSqlType(variable,fieldName,"type")},isRelatedFieldMany=function(variable,fieldName){var index,column,columns=variable.propertiesMap.columns,columnsCount=columns.length;for(index=0;index<columnsCount;index+=1)if(column=columns[index],column.fieldName===fieldName)return!1;return!0},updateVariableDataset=function(variable,data,propertiesMap,pagingOptions){variable.dataSet={data:data,propertiesMap:propertiesMap,pagingOptions:pagingOptions}},setVariableProp=function(variable,writableVariable,propertyName,propertyValue){variable[propertyName]=propertyValue,writableVariable&&!WM.equals(writableVariable[propertyName],propertyValue)&&($rootScope.saveVariables=!0,writableVariable[propertyName]=propertyValue,Variables.updateVariable(writableVariable.name,writableVariable))},getTableMetaData=function(projectID,variable,writableVariable,options,callback,success){var tableDetails={};DataModelDesignManager.getDataModel(projectID,variable.liveSource,!1,function(database){var variableTable,variableType,firstPrimaryKey,tableNameToEntityNameMap={},entityNameToTableNameMap={},getJavaType=function(javaType){return DB_CONSTANTS.DATABASE_DATA_TYPES[javaType]?javaType=DB_CONSTANTS.DATABASE_DATA_TYPES[javaType].java_type:DB_CONSTANTS.DATABASE_SECONDARY_DATA_TYPES[javaType]&&(javaType=DB_CONSTANTS.DATABASE_DATA_TYPES[DB_CONSTANTS.DATABASE_SECONDARY_DATA_TYPES[javaType].java_type].java_type),javaType};return variable.relatedTables=[],variable.properties=[],_.forEach(database.tables,function(table){tableNameToEntityNameMap[table.name]=table.entityName,entityNameToTableNameMap[table.entityName]=table.name}),(variableType=entityNameToTableNameMap[variable.type])?(_.forEach(database.tables,function(table){var tableName=table.name,tablePackageName=database.packageName+"."+table.entityName,primaryKeys=table.primaryKey.columns||[],foreignKeys=[],columnsAdded=[];tableDetails[tableName]={},tableDetails[tableName].columns=[],tableDetails[tableName].primaryFields=[],packageDetails[tablePackageName]=packageDetails[tablePackageName]||{},packageDetails[tablePackageName].primaryFields=[],tableName===variableType&&(setVariableProp(variable,writableVariable,"package",tablePackageName),setVariableProp(variable,writableVariable,"tableName",table.name),setVariableProp(variable,writableVariable,"tableType",WM.isDefined(table.type)?table.type:"TABLE")),table.relations=_.sortBy(table.relations,function(relation){return[relation.composite===!1,"OneToOne"!==relation.cardinality]}),_.forEach(table.relations,function(relation){if(relation.primary){var newColumn,relatedCol,javaType,columnValue,sourceCols=_.map(relation.mappings,function(mapping){return mapping.sourceColumn}),isPrimaryKey=_.intersection(sourceCols,primaryKeys).length>0;foreignKeys=foreignKeys.concat(sourceCols),relatedCol=_.find(table.columns,function(col){return col.name===sourceCols[0]}),javaType=getJavaType(relatedCol.javaType),newColumn={fieldName:relation.fieldName,relatedColumnName:relatedCol.fieldName,type:javaType,fullyQualifiedType:javaType,columnName:sourceCols.join(","),isPrimaryKey:isPrimaryKey,notNull:!relatedCol.nullable,length:relatedCol.length,precision:relatedCol.precision,scale:relatedCol.scale,generator:relatedCol.generatorType,isRelated:!0,defaultValue:_.get(relatedCol,["columnValue","defaultValue"]),targetTable:relation.targetTable},columnValue=relatedCol.columnValue,columnValue&&"user-defined"!==columnValue.type&&(newColumn.systemInserted=newColumn.systemUpdated=!0),newColumn=_.omitBy(newColumn,function(value){return _.isUndefined(value)||_.isNull(value)}),_.intersection(columnsAdded,sourceCols).length&&(newColumn.readonly=!0),tableDetails[tableName].columns.push(newColumn),columnsAdded=columnsAdded.concat(sourceCols)}}),_.forEach(table.columns,function(column){if(_.includes(table.primaryKey.columns,column.name)&&(tableDetails[tableName].primaryFields.push(column.fieldName),packageDetails[tablePackageName].primaryFields.push(column.fieldName)),!_.includes(columnsAdded,column.name)){var javaType=getJavaType(column.javaType),isPrimaryKey=_.includes(primaryKeys,column.name),isForeignKey=_.includes(foreignKeys,column.name),newColumn={fieldName:column.fieldName,type:javaType,fullyQualifiedType:javaType,columnName:column.name,isPrimaryKey:isPrimaryKey,notNull:!column.nullable,length:column.length,precision:column.precision,scale:column.scale,generator:column.generatorType,isRelated:isForeignKey,defaultValue:_.get(column,["columnValue","defaultValue"])},columnValue=column.columnValue;columnValue&&"user-defined"!==columnValue.type&&(newColumn.systemInserted=newColumn.systemUpdated=!0),newColumn=_.omitBy(newColumn,function(value){return _.isUndefined(value)||_.isNull(value)}),tableDetails[tableName].columns.push(newColumn)}}),_.forEach(table.relations,function(relation){var relatedColumns=[];_.each(relation.mappings,function(mapping){relation.primary&&relatedColumns.push(mapping.sourceColumn)}),_.forEach(tableDetails[tableName].columns,function(column){var fkColumnName=column.columnName.split(",");column.isRelated&&_.isEqual(relatedColumns,fkColumnName)&&tableName===variableType&&(column.relatedTableName=relation.targetTable,column.relatedEntityName=tableNameToEntityNameMap[relation.targetTable],WM.element.inArray(relation.fieldName,variable.properties)===-1&&(variable.properties.push(relation.fieldName),variable.relatedTables.push({columnName:column.fieldName,relationName:relation.fieldName,type:tableNameToEntityNameMap[relation.targetTable],package:tablePackageName,watchOn:Utils.initCaps(variable.liveSource)+tableNameToEntityNameMap[relation.targetTable]+"Data"})))})})}),setVariableProp(variable,writableVariable,"properties",variable.properties||[]),setVariableProp(variable,writableVariable,"relatedTables",variable.relatedTables||[]),tableDetails[variableType].entityName=variable.type,tableDetails[variableType].fullyQualifiedName=variable.package,tableDetails[variableType].tableType=variable.tableType,variableTable=tableDetails[variableType],_.forEach(variableTable.columns,function(column){var columnDef;column.isRelated&&(column.columns=Utils.getClonedObject(tableDetails[column.relatedTableName].columns),column.relatedFieldName=column.fieldName+"."+tableDetails[column.relatedTableName].primaryFields[0],$rootScope.dataTypes[variable.package]&&(columnDef=$rootScope.dataTypes[variable.package].fields[column.fieldName],column.isList=!!columnDef&&columnDef.isList))}),setVariableProp(variable,writableVariable,"propertiesMap",tableDetails[variableType]),writableVariable&&writableVariable._isNew&&(firstPrimaryKey=_.head(variable.propertiesMap.primaryFields),!writableVariable.orderBy&&firstPrimaryKey&&setVariableProp(variable,writableVariable,"orderBy",firstPrimaryKey+" asc"),variable._isNew=writableVariable._isNew=!1),void Utils.triggerFn(callback,projectID,variable,options,success)):void invalidVariables.push(variable.name)},WM.noop)},isStringType=function(type){return _.includes(["text","string"],_.toLower(type))},wrapInLowerCase=function(value,options,ignoreCase,isField){var type=_.toLower(options.attributeType);if(!isField){if("datetime"===type)return"wm_dt("+value+")";if("timestamp"===type)return"wm_ts("+value+")";if("float"===type)return"wm_float("+value+")"}return ignoreCase&&isStringType(type)&&_.includes(DB_CONSTANTS.DATABASE_STRING_MODES,options.filterCondition)?"lower("+value+")":value},encodeWithQuotes=function(value,type){var encodedValue=encodeURIComponent(value);return type=_.toLower(type),Utils.isNumberType(type)&&"float"!==type||"boolean"===type?encodedValue:"'"+encodedValue+"'"},getParamValue=function(value,options,ignoreCase){var param,filterCondition=options.filterCondition,dbModes=DB_CONSTANTS.DATABASE_MATCH_MODES,type=options.attributeType;if(_.includes(DB_CONSTANTS.DATABASE_EMPTY_MATCH_MODES,filterCondition))return"";switch(filterCondition){case dbModes.start:param=encodeWithQuotes(value+"%",type),param=wrapInLowerCase(param,options,ignoreCase);break;case dbModes.end:param=encodeWithQuotes("%"+value,type),param=wrapInLowerCase(param,options,ignoreCase);break;case dbModes.anywhere:param=encodeWithQuotes("%"+value+"%",type),param=wrapInLowerCase(param,options,ignoreCase);break;case dbModes.exact:case dbModes.notequals:param=encodeWithQuotes(value,type),param=wrapInLowerCase(param,options,ignoreCase);break;case dbModes.between:param=_.join(_.map(value,function(val){return wrapInLowerCase(encodeWithQuotes(val,type),options,ignoreCase)})," and ");break;case dbModes.in:param=_.join(_.map(value,function(val){return wrapInLowerCase(encodeWithQuotes(val,type),options,ignoreCase)}),", "),param="("+param+")";break;default:param=encodeWithQuotes(value,type),param=wrapInLowerCase(param,options,ignoreCase)}return param||""},getSearchQuery=function(filterOptions,operator,ignoreCase){var query,params=[];return _.forEach(filterOptions,function(fieldValue){var matchModeExpr,paramValue,fieldName=fieldValue.attributeName,value=fieldValue.attributeValue,filterCondition=fieldValue.filterCondition,isValArray=_.isArray(value),dbModes=DB_CONSTANTS.DATABASE_MATCH_MODES;isValArray&&_.isEmpty(value)||!isValArray&&isNaN(value)&&Utils.isNumberType(fieldValue.attributeType)||(isValArray&&(filterCondition=filterCondition===dbModes.between?filterCondition:dbModes.in,fieldValue.filterCondition=filterCondition),matchModeExpr=DB_CONSTANTS.DATABASE_MATCH_MODES_WITH_QUERY[filterCondition],paramValue=getParamValue(value,fieldValue,ignoreCase),fieldName=wrapInLowerCase(fieldName,fieldValue,ignoreCase,!0),params.push(Utils.replace(matchModeExpr,[fieldName,paramValue])))}),query=_.join(params,operator)},getAttributeName=function(variable,fieldName){var attrName=fieldName;return variable.propertiesMap.columns.forEach(function(column){column.fieldName===fieldName&&column.isRelated&&(attrName=column.relatedFieldName)}),attrName},getSQLFieldType=function(variable,options){return _.includes(["timestamp","datetime","date"],options.type)?options.type:getSqlType(variable,options.fieldName)||options.type},getFilterCondition=function(filterCondition){return _.includes(DB_CONSTANTS.DATABASE_RANGE_MATCH_MODES,filterCondition)?filterCondition:DB_CONSTANTS.DATABASE_MATCH_MODES.exact},getFilterOptions=function(variable,filterFields,options){var filterOptions=[],matchModes=DB_CONSTANTS.DATABASE_MATCH_MODES;return _.each(filterFields,function(fieldOptions){var attributeName,filterOption,fieldName=fieldOptions.fieldName,fieldValue=fieldOptions.value,fieldType=getSQLFieldType(variable,fieldOptions),filterCondition=fieldOptions.filterCondition;if(fieldOptions.type=fieldType,WM.isObject(fieldValue)&&!WM.isArray(fieldValue))_.forEach(fieldValue,function(subFieldValue,subFieldName){subFieldValue&&!WM.isObject(subFieldValue)&&filterOptions.push(fieldName+"."+subFieldName+"="+subFieldValue)});else if(WM.isDefined(fieldValue)&&null!==fieldValue&&""!==fieldValue){switch(fieldType){case"integer":fieldValue=WM.isArray(fieldValue)?_.map(fieldValue,function(value){return parseInt(value,10)}):parseInt(fieldValue,10),filterCondition=filterCondition?getFilterCondition(filterCondition):matchModes.exact;break;case"date":case"datetime":case"timestamp":fieldValue=Utils.formatDate(fieldValue,fieldType),filterCondition=filterCondition?getFilterCondition(filterCondition):matchModes.exact;break;case"text":case"string":filterCondition=WM.isArray(fieldValue)?matchModes.exact:filterCondition||matchModes.anywhere;break;default:filterCondition=filterCondition?getFilterCondition(filterCondition):matchModes.exact}attributeName=getAttributeName(variable,fieldName),filterOption={attributeName:attributeName,attributeValue:fieldValue,attributeType:_.toUpper(fieldType),filterCondition:filterCondition},options.searchWithQuery&&(filterOption.isVariableFilter=fieldOptions.isVariableFilter),filterOptions.push(filterOption)}else _.includes(DB_CONSTANTS.DATABASE_EMPTY_MATCH_MODES,filterCondition)&&(attributeName=getAttributeName(variable,fieldName),fieldType&&!isStringType(fieldType)&&(filterCondition=DB_CONSTANTS.DATABASE_NULL_EMPTY_MATCH[filterCondition]),filterOption={attributeName:attributeName,attributeValue:"",attributeType:_.toUpper(fieldType),filterCondition:filterCondition},options.searchWithQuery&&(filterOption.isVariableFilter=fieldOptions.isVariableFilter),filterOptions.push(filterOption))}),filterOptions},prepareTableOptions=function(variable,options,clonedFields){_.isUndefined(options.searchWithQuery)&&(options.searchWithQuery=!0);var filterOptions,orderByFields,orderByOptions,query,optionsQuery,filterFields=[];return clonedFields=clonedFields||variable.filterFields,_.forEach(clonedFields,function(value,key){options.filterFields&&options.filterFields[key]&&"AND"!==options.filterFields[key].logicalOp||(value.fieldName=key,isStringType(getSQLFieldType(variable,value))&&(value.filterCondition=DB_CONSTANTS.DATABASE_MATCH_MODES[value.matchMode||variable.matchMode]),value.isVariableFilter=!0,filterFields.push(value))}),_.forEach(options.filterFields,function(value,key){value.fieldName=key,value.filterCondition=DB_CONSTANTS.DATABASE_MATCH_MODES[value.matchMode||options.matchMode],filterFields.push(value)}),"read"===variable.operation&&(filterOptions=getFilterOptions(variable,filterFields,options)),options.searchWithQuery&&filterOptions.length&&(query=getSearchQuery(_.filter(filterOptions,{isVariableFilter:!0})," AND ",variable.ignoreCase),optionsQuery=getSearchQuery(_.filter(filterOptions,{isVariableFilter:void 0})," "+(options.logicalOp||"AND")+" ",variable.ignoreCase),optionsQuery&&(query=query?query+" AND ( "+optionsQuery+" )":optionsQuery),query="q="+query),orderByFields=Variables.getEvaluatedOrderBy(variable.orderBy,options.orderBy),orderByOptions=orderByFields?"sort="+orderByFields:"",{filter:filterOptions,sort:orderByOptions,query:query}},initiateCallback=Variables.initiateCallback,processRequestQueue=Variables.processRequestQueue,getPrimaryTableData=function(projectID,variable,options,success,error){var tableOptions,dbOperation,callBackScope,promiseObj,output,newDataSet,clonedFields,requestData,variableOwner=variable.owner,dataObj={},handleError=function(response){CONSTANTS.isRunMode&&initiateCallback(VARIABLE_CONSTANTS.EVENT.RESULT,variable,response),options.skipDataSetUpdate||updateVariableDataset(variable,emptyArr,variable.propertiesMap),Utils.triggerFn(error,response),CONSTANTS.isRunMode&&$timeout(function(){initiateCallback(VARIABLE_CONSTANTS.EVENT.ERROR,variable,response),variable.canUpdate=!0,initiateCallback(VARIABLE_CONSTANTS.EVENT.CAN_UPDATE,variable,response),variableActive[variable.activeScope.$id][variable.name]=!1,processRequestQueue(variable,requestQueue[variable.activeScope.$id],deployProjectAndFetchData)},null,!1)};if(CONSTANTS.isRunMode){if(clonedFields=Utils.getClonedObject(variable.filterFields),output=initiateCallback(VARIABLE_CONSTANTS.EVENT.BEFORE_UPDATE,variable,clonedFields),output===!1)return variableActive[variable.activeScope.$id][variable.name]=!1,processRequestQueue(variable,requestQueue[variable.activeScope.$id],deployProjectAndFetchData),void $rootScope.$emit("toggle-variable-state",variable.name,!1);variable.canUpdate=!1}tableOptions=prepareTableOptions(variable,options,_.isObject(output)?output:clonedFields),options.searchWithQuery?(dbOperation="searchTableDataWithQuery",requestData=tableOptions.query):(dbOperation=tableOptions.filter&&tableOptions.filter.length?"searchTableData":"readTableData",requestData=tableOptions.filter),promiseObj=DatabaseService[dbOperation]({projectID:projectID,service:variable._prefabName?"":"services",dataModelName:variable.liveSource,entityName:variable.type,page:options.page||1,size:options.pagesize||(CONSTANTS.isRunMode?variable.maxResults||20:variable.designMaxResults||20),sort:tableOptions.sort,data:requestData,filterMeta:tableOptions.filter,url:variable._prefabName?$rootScope.project.deployedUrl+"/prefabs/"+variable._prefabName:$rootScope.project.deployedUrl},function(response){return response&&response.error||!response||!WM.isArray(response.content)?void Utils.triggerFn(handleError,response.error):(processBlobColumns(response.content,variable),dataObj.data=response.content,dataObj.pagingOptions={dataSize:response?response.totalElements:null,maxResults:variable.maxResults,currentPage:response?response.number+1:null},options.skipDataSetUpdate||(callBackScope="App"===variableOwner?$rootScope||{}:variable._prefabName?options.scope||{}:options.scope&&options.scope.$$childTail?options.scope.$$childTail:{},CONSTANTS.isRunMode&&(initiateCallback(VARIABLE_CONSTANTS.EVENT.RESULT,variable,dataObj.data),newDataSet=initiateCallback(VARIABLE_CONSTANTS.EVENT.PREPARE_SETDATA,variable,dataObj.data),newDataSet&&(dataObj.data=newDataSet)),updateVariableDataset(variable,dataObj.data,variable.propertiesMap,dataObj.pagingOptions),CONSTANTS.isRunMode&&(variable._options=variable._options||{},variable._options.orderBy=options&&options.orderBy,variable._options.filterFields=options&&options.filterFields,$timeout(function(){initiateCallback(VARIABLE_CONSTANTS.EVENT.SUCCESS,variable,dataObj.data),variable.canUpdate=!0,initiateCallback(VARIABLE_CONSTANTS.EVENT.CAN_UPDATE,variable,dataObj.data)}))),CONSTANTS.isRunMode&&(variableActive[variable.activeScope.$id][variable.name]=!1,processRequestQueue(variable,requestQueue[variable.activeScope.$id],deployProjectAndFetchData)),void Utils.triggerFn(success,dataObj.data,variable.propertiesMap,dataObj.pagingOptions))},function(error){Utils.triggerFn(handleError,error)}),CONSTANTS.isRunMode&&(variable.promise=promiseObj)},getTableData=function(projectID,variable,options,success,error){var variableIndex=WM.element.inArray(variable.name,invalidVariables);variableIndex===-1?getPrimaryTableData(projectID,variable,options,success,error):invalidVariables.splice(variableIndex,1)},getDataFromService=function(variable,options,success,error){var projectID=$rootScope.project.id||$rootScope.projectName;"read"===variable.operation&&getTableData(projectID,variable,options,success,error)},deployProjectAndFetchData=function(variable,options,success,error){return isProjectDeployed?void getDataFromService(variable,options,success,error):void(isProjectDeployInProgress?isDeployReqSourceChanged&&!projectDeployReqQueue?(projectDeployReqQueue={variable:variable,options:options,success:success,error:error},isDeployReqSourceChanged=void 0):callbackParams.push({variable:variable,options:options,success:success,error:error}):(isProjectDeployInProgress=!0,ProjectService.run({projectId:$rootScope.project.id},function(result){return $rootScope.project.deployedUrl=Utils.removeProtocol(result),projectDeployReqQueue?(isProjectDeployed=!1,isProjectDeployInProgress=!1,deployProjectAndFetchData(projectDeployReqQueue.variable,projectDeployReqQueue.options,projectDeployReqQueue.success,projectDeployReqQueue.error),callbackParams.push({variable:variable,options:options,success:success,error:error}),projectDeployReqQueue=void 0,void 0):(getDataFromService(variable,options,success,error),isProjectDeployed=!0,isProjectDeployInProgress=!1,callbackParams.length&&(_.forEach(callbackParams,function(callbackParam){deployProjectAndFetchData(callbackParam.variable,callbackParam.options,callbackParam.success,callbackParam.error)}),callbackParams=[]),!0)},function(error){wmToaster.show("error",$rootScope.locale.MESSAGE_ERROR_TITLE,$rootScope.locale.MESSAGE_INFO_DATABASE_DATA_LOADING_FAILED+" : "+error),isProjectDeployInProgress=!1,updateVariableDataset(variable,{error:!0,errorMessage:$rootScope.locale.MESSAGE_INFO_DATABASE_DATA_LOADING_FAILED},variable.propertiesMap,{}),callbackParams.length&&(_.forEach(callbackParams,function(callbackParam){updateVariableDataset(callbackParam.variable,{error:!0,errorMessage:$rootScope.locale.MESSAGE_INFO_DATABASE_DATA_LOADING_FAILED},callbackParam.variable.propertiesMap,{})}),callbackParams=[])})))},getFieldType=function(fieldName,variable,relatedField){var fieldType,columns,result;return variable.propertiesMap&&(columns=variable.propertiesMap.columns||[],result=_.find(columns,function(obj){return obj.fieldName===fieldName}),relatedField&&result&&(result=_.find(result.columns,function(obj){return obj.fieldName===relatedField})),fieldType=result&&result.type),fieldType},hasBlob=function(variable){return _.find(_.get(variable,["propertiesMap","columns"]),{type:"blob"})},prepareFormData=function(variableDetails,rowObject){var formData=new FormData;return _.forEach(rowObject,function(colValue,colName){"blob"===getFieldType(colName,variableDetails)&&(WM.isObject(colValue)&&(WM.isArray(colValue)?_.forEach(colValue,function(fileObject){formData.append(colName,fileObject,fileObject.name)}):formData.append(colName,colValue,colValue.name)),rowObject[colName]=null!==colValue?"":null)}),formData.append("wm_data_json",new Blob([JSON.stringify(rowObject)],{type:"application/json"})),formData},performDataAction=function(action,variableDetails,options,success,error){var dbName,prevData,callBackScope,promiseObj,id,columnName,clonedFields,output,compositeId="",projectID=$rootScope.project.id||$rootScope.projectName,rowObject={},primaryKey=variableDetails.getPrimaryKey(),isFormDataSupported=window.File&&window.FileReader&&window.FileList&&window.Blob,compositeKeysData={},prevCompositeKeysData={},inputFields=options.inputFields||variableDetails.inputFields;if(callBackScope="App"===variableDetails.owner?$rootScope||{}:options.scope&&options.scope.$$childTail?options.scope.$$childTail:{},CONSTANTS.isRunMode){if(clonedFields=Utils.getClonedObject(inputFields),output=initiateCallback(VARIABLE_CONSTANTS.EVENT.BEFORE_UPDATE,variableDetails,clonedFields),output===!1)return variableActive[variableDetails.activeScope.$id][variableDetails.name]=!1,processRequestQueue(variableDetails,requestQueue[variableDetails.activeScope.$id],deployProjectAndFetchData),void $rootScope.$emit("toggle-variable-state",variableDetails.name,!1);inputFields=_.isObject(output)?output:clonedFields,variableDetails.canUpdate=!1}switch(options.row?(rowObject=options.row,_.forEach(rowObject,function(value,key){var fieldValue,fieldType=getFieldType(key,variableDetails);Utils.isDateTimeType(fieldType)&&(fieldValue=Utils.formatDate(value,fieldType),rowObject[key]=fieldValue)}),_.forEach(inputFields,function(attrValue,attrName){attrValue&&!rowObject[attrName]&&(rowObject[attrName]=attrValue)})):_.forEach(inputFields,function(fieldValue,fieldName){var fieldType,primaryKeys=variableDetails.propertiesMap.primaryFields||variableDetails.propertiesMap.primaryKeys;WM.isDefined(fieldValue)&&""!==fieldValue&&("deleteTableData"===action&&(compositeId=fieldValue),"updateTableData"===action&&primaryKeys.forEach(function(key){fieldName===key&&(compositeId=fieldValue)}),("deleteTableData"!==action||variableDetails.isCompositeKey(primaryKey))&&(fieldType=getFieldType(fieldName,variableDetails),Utils.isDateTimeType(fieldType)&&(fieldValue=Utils.formatDate(fieldValue,fieldType)),rowObject[fieldName]=fieldValue),WM.isObject(fieldValue)&&!WM.isArray(fieldValue)&&_.forEach(fieldValue,function(val,key){"blob"===getFieldType(fieldName,variableDetails,key)&&(fieldValue[key]=null===val?val:"")}))}),action){case"updateTableData":prevData=options.prevData||{},variableDetails.isCompositeKey(primaryKey)?(variableDetails.isNoPrimaryKey(primaryKey)?(prevCompositeKeysData=prevData||options.rowData||rowObject,compositeKeysData=rowObject):primaryKey.forEach(function(key){compositeKeysData[key]=rowObject[key],prevCompositeKeysData[key]=prevData[key]||options.rowData&&options.rowData[key]||rowObject[key]}),options.row=compositeKeysData,options.compositeKeysData=prevCompositeKeysData):(primaryKey.forEach(function(key){key.indexOf(".")===-1?id=prevData[key]||options.rowData&&options.rowData[key]||rowObject[key]:(columnName=key.split("."),id=prevData[columnName[0]][columnName[1]])}),options.id=id,options.row=rowObject);break;case"deleteTableData":variableDetails.isCompositeKey(primaryKey)?(variableDetails.isNoPrimaryKey(primaryKey)?compositeKeysData=rowObject:primaryKey.forEach(function(key){compositeKeysData[key]=rowObject[key]}),options.compositeKeysData=compositeKeysData):WM.element.isEmptyObject(rowObject)||(primaryKey.forEach(function(key){key.indexOf(".")===-1?id=rowObject[key]:(columnName=key.split("."),id=rowObject[columnName[0]][columnName[1]])}),options.id=id)}if(("updateTableData"===action||"insertTableData"===action)&&hasBlob(variableDetails)&&isFormDataSupported&&(action="updateTableData"===action?"updateMultiPartTableData":"insertMultiPartTableData",rowObject=prepareFormData(variableDetails,rowObject)),options.compositeKeysData){switch(action){case"updateTableData":action="updateCompositeTableData";break;case"deleteTableData":action="deleteCompositeTableData";break;case"updateMultiPartTableData":action="updateMultiPartCompositeTableData"}compositeId=getCompositeIDURL(options.compositeKeysData)}dbName=variableDetails.liveSource,WM.element.isEmptyObject(rowObject)&&"deleteTableData"===action&&(rowObject=void 0),promiseObj=DatabaseService[action]({projectID:projectID,service:variableDetails._prefabName?"":"services",dataModelName:dbName,entityName:variableDetails.type,id:WM.isDefined(options.id)?encodeURIComponent(options.id):compositeId,data:rowObject,url:variableDetails._prefabName?$rootScope.project.deployedUrl+"/prefabs/"+variableDetails._prefabName:$rootScope.project.deployedUrl},function(response){if(response&&response.error)CONSTANTS.isRunMode&&(initiateCallback(VARIABLE_CONSTANTS.EVENT.RESULT,variableDetails,response),$timeout(function(){initiateCallback(VARIABLE_CONSTANTS.EVENT.ERROR,variableDetails,response.error),variableDetails.canUpdate=!0,initiateCallback(VARIABLE_CONSTANTS.EVENT.CAN_UPDATE,variableDetails,response.error)},null,!1)),Utils.triggerFn(error,response.error);else{if(CONSTANTS.isRunMode){if(initiateCallback(VARIABLE_CONSTANTS.EVENT.RESULT,variableDetails,response),"read"!==variableDetails.operation){var newDataSet=initiateCallback(VARIABLE_CONSTANTS.EVENT.PREPARE_SETDATA,variableDetails,response);newDataSet&&(response=newDataSet),variableDetails.dataSet=response}$timeout(function(){initiateCallback(VARIABLE_CONSTANTS.EVENT.SUCCESS,variableDetails,response),variableDetails.canUpdate=!0,initiateCallback(VARIABLE_CONSTANTS.EVENT.CAN_UPDATE,variableDetails,response)},null,!1)}Utils.triggerFn(success,response)}},function(response){CONSTANTS.isRunMode&&(initiateCallback(VARIABLE_CONSTANTS.EVENT.RESULT,variableDetails,response),$timeout(function(){options.skipNotification||initiateCallback(VARIABLE_CONSTANTS.EVENT.ERROR,variableDetails,response),variableDetails.canUpdate=!0,initiateCallback(VARIABLE_CONSTANTS.EVENT.CAN_UPDATE,variableDetails,response)},null,!1)),Utils.triggerFn(error,response)}),CONSTANTS.isRunMode&&(variableDetails.promise=promiseObj)},update=function(options,success,error){var name=this.name;options=options||{},options.scope=this.activeScope,CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!options.skipToggleState),methods.getData(this,options,function(data,propertiesMap,pageOptions){
CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!1),Utils.triggerFn(success,data,propertiesMap,pageOptions)},function(errMsg){CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!1),Utils.triggerFn(error,errMsg)})},insertRecord=function(options,success,error){var name=this.name;options=options||{},options.scope=this.activeScope,CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!0),methods.insertRecord(this,options,function(response){CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!1),Utils.triggerFn(success,response)},function(errMsg){CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!1),Utils.triggerFn(error,errMsg)})},updatePagination=function(variable,flag){var pagination=_.get(variable.dataSet,"pagingOptions");pagination&&(flag?(pagination.dataSize+=1,pagination.maxResults+=1):(pagination.dataSize-=1,pagination.maxResults-=1))},methods={getPrimaryKey:function(variable){if(variable.propertiesMap.primaryFields)return variable.propertiesMap.primaryFields;var primaryKey=[];return WM.element.each(variable.propertiesMap.columns,function(index,column){column.isPrimaryKey&&(column.isRelated&&WM.element.inArray(column.relatedFieldName,primaryKey)===-1?primaryKey.push(column.relatedFieldName):WM.element.inArray(column.fieldName,primaryKey)===-1&&primaryKey.push(column.fieldName))}),primaryKey},isCompositeKey:function(variable,primaryKey){return!primaryKey||primaryKey&&(!primaryKey.length||primaryKey.length>1)},isNoPrimaryKey:function(variable,primaryKey){return!primaryKey||primaryKey&&!primaryKey.length},getData:function(variable,options,success,error){function execute(){if(variable.name=variableName,CONSTANTS.isRunMode){if(variableActive[variable.activeScope.$id]=variableActive[variable.activeScope.$id]||{},variableActive[variable.activeScope.$id][variableName])return requestQueue[variable.activeScope.$id]=requestQueue[variable.activeScope.$id]||{},requestQueue[variable.activeScope.$id][variableName]=requestQueue[variable.activeScope.$id][variableName]||[],"read"===variable.operation?options.filterFields=options.filterFields||Utils.getClonedObject(variable.filterFields):options.inputFields=options.row||Utils.getClonedObject(variable.inputFields),void requestQueue[variable.activeScope.$id][variableName].push({variable:variable,options:options,success:success,error:error});variableActive[variable.activeScope.$id][variableName]=!0}CONSTANTS.isRunMode||variable._prefabName||variable._partialname||(writableVariable=Variables.getVariableByName(variable.name),getTableMetaData(projectID,variable,writableVariable,options,function(){updateVariableDataset(variable,emptyArr,variable.propertiesMap,{}),Utils.triggerFn(success,emptyArr,variable.propertiesMap,{},{dataSize:null,maxResults:variable.maxResults})})),CONSTANTS.isRunMode&&"read"!==variable.operation&&updateVariableDataset(variable,emptyArr,variable.propertiesMap,{}),options.skipFetchData||deployProjectAndFetchData(variable,options,success,error)}var writableVariable,variableName=variable.name,projectID=$rootScope.project.id||$rootScope.projectName;Utils.isEmptyObject(variable)||!CONSTANTS.isRunMode&&!variable._prefabName?CONSTANTS.isStudioMode&&!Utils.isEmptyObject(variable)&&ServiceFactory.getServicesWithType(function(services){_.find(services,{name:variable.liveSource,type:"DataService"})&&execute()}):execute()},download:function(variable,options){var tableOptions,dbOperation="exportTableData",projectID=$rootScope.project.id||$rootScope.projectName;options.searchWithQuery=!0,tableOptions=prepareTableOptions(variable,options),DatabaseService[dbOperation]({projectID:projectID,service:variable._prefabName?"":"services",dataModelName:variable.liveSource,entityName:variable.type,sort:tableOptions.sort,url:variable._prefabName?$rootScope.project.deployedUrl+"/prefabs/"+variable._prefabName:$rootScope.project.deployedUrl,data:tableOptions.query||"",filterMeta:tableOptions.filter,exportFormat:options.exportFormat,size:options.size})},updateRelatedData:function(variable,options,success,error){var projectID=$rootScope.project.id||$rootScope.projectName;options.relatedFieldName&&isRelatedFieldMany(variable,options.relatedFieldName)&&DatabaseService.readTableRelatedData({projectID:projectID,service:variable._prefabName?"":"services",dataModelName:variable.liveSource,entityName:variable.type,id:options.id,relatedFieldName:options.relatedFieldName,page:options.page||1,size:CONSTANTS.isRunMode?variable.maxResults||20:variable.designMaxResults||20,url:variable._prefabName?$rootScope.project.deployedUrl+"/prefabs/"+variable._prefabName:$rootScope.project.deployedUrl},function(response){return response&&response.error||!response||!WM.isArray(response.content)?void Utils.triggerFn(error,response.error):(response.content.forEach(function(rowData){var tempData;rowData&&WM.isObject(rowData.id)&&(tempData=rowData.id,delete rowData.id,WM.extend(rowData,tempData))}),void Utils.triggerFn(success,response.content,void 0,{},{dataSize:response?response.totalElements:null,maxResults:variable.maxResults}))},function(error){Utils.triggerFn(error,error)})},deleteRecord:function(variable,options,success,error){performDataAction("deleteTableData",variable,options,success,error)},updateRecord:function(variable,options,success,error){performDataAction("updateTableData",variable,options,success,error)},insertRecord:function(variable,options,success,error){performDataAction("insertTableData",variable,options,success,error)},setOrderBy:function(variable,expression){return variable.orderBy=expression,variable.autoUpdate&&variable.update(),variable.orderBy},getDataSet:function(variable){return variable.dataSet},clearData:function(variable){return variable.dataSet={},variable.dataSet},cancel:function(variable){variableActive[variable.activeScope.$id][variable.name]&&variable.promise&&variable.promise.abort()},setInput:function(variable,key,val,options){var paramObj={},targetObj={};if(WM.isObject(options))switch(options.type){case"file":val=Utils.getBlob(val,options.contentType);break;case"number":val=_.isNumber(val)?val:parseInt(val)}return WM.isObject(key)?paramObj=key:paramObj[key]=val,variable.inputFields||(variable.inputFields={}),targetObj=variable.inputFields,_.forEach(paramObj,function(paramVal,paramKey){targetObj[paramKey]=paramVal}),targetObj},setFilter:function(variable,key,val){var paramObj={},targetObj={};return WM.isObject(key)?paramObj=key:paramObj[key]=val,variable.filterFields||(variable.filterFields={}),targetObj=variable.filterFields,_.forEach(paramObj,function(paramVal,paramKey){targetObj[paramKey]={value:paramVal}}),targetObj},getRelatedTableData:function(variable,columnName,options,success,error){var orderBy,filterOptions,query,action,projectID=$rootScope.project.id||$rootScope.projectName,relatedTable=_.find(variable.relatedTables,function(table){return table.relationName===columnName||table.columnName===columnName}),selfRelatedCols=_.map(_.filter(variable.relatedTables,function(o){return o.type===variable.type}),"relationName"),filterFields=[];_.forEach(options.filterFields,function(value,key){value.fieldName=key,value.type=getFieldType(columnName,variable,key),filterFields.push(value)}),filterOptions=getFilterOptions(variable,filterFields,options),query=getSearchQuery(filterOptions," "+(options.logicalOp||"AND")+" ",variable.ignoreCase),query=query?"q="+query:"",action="searchTableDataWithQuery",orderBy=_.isEmpty(options.orderBy)?"":"sort="+options.orderBy,DatabaseService[action]({projectID:projectID,service:variable._prefabName?"":"services",dataModelName:variable.liveSource,entityName:relatedTable.type,page:options.page||1,size:options.pagesize||void 0,url:variable._prefabName?$rootScope.project.deployedUrl+"/prefabs/"+variable._prefabName:$rootScope.project.deployedUrl,data:query||"",filterMeta:filterOptions,sort:orderBy},function(response){var data=_.map(response.content,function(o){return _.omit(o,selfRelatedCols)});Utils.triggerFn(success,data,void 0,response?{dataSize:response.totalElements,maxResults:response.size,currentPage:response.number+1}:{})},function(errMsg){Utils.triggerFn(error,errMsg)})},getRelatedTablePrimaryKeys:function(variable,relatedField){var primaryKeys,result,relatedCols;if(variable.propertiesMap&&(result=_.find(variable.propertiesMap.columns||[],{fieldName:relatedField}))){if(relatedCols=result.columns,primaryKeys=_.map(_.filter(relatedCols,"isPrimaryKey"),"fieldName"),primaryKeys.length)return primaryKeys;if(relatedCols&&relatedCols.length)return relatedCols=_.find(relatedCols,{isRelated:!1}),relatedCols&&relatedCols.fieldName}},addItem:function(variable,item,index){var data=_.get(variable.dataSet,"data")||[];index=void 0!==index?index:data.length,data.splice(index,0,item),updatePagination(variable,!0)},removeItem:function(variable,item){var data=_.get(variable.dataSet,"data")||[];item=void 0!==item?item:data.length-1,WM.isObject(item)?(item=_.findIndex(data,item),item>-1&&data.splice(item,1)):data.splice(item,1),updatePagination(variable)},updateItem:function(variable,item,newItem){var data=_.get(variable.dataSet,"data")||[];item=void 0!==item?item:data.length-1,WM.isObject(item)?(item=_.findIndex(data,item),item>-1&&(data[item]=newItem)):data[item]=newItem}},liveVariableObj={update:update,listRecords:update,download:function(options){options=options||{},methods.download(this,options)},updateRecord:function(options,success,error){var name=this.name;options=options||{},options.scope=this.activeScope,CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!0),methods.updateRecord(this,options,function(response){CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!1),Utils.triggerFn(success,response)},function(errMsg){CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!1),Utils.triggerFn(error,errMsg)})},insertRecord:insertRecord,createRecord:insertRecord,deleteRecord:function(options,success,error){var name=this.name;options=options||{},options.scope=this.activeScope,CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!0),methods.deleteRecord(this,options,function(response){CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!1),Utils.triggerFn(success,response)},function(errMsg){CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!1),Utils.triggerFn(error,errMsg)})},updateRelatedData:function(options,success,error){options=options||{},options.scope=this.activeScope,methods.updateRelatedData(this,options,function(data,propertiesMap,pageOptions){Utils.triggerFn(success,data,propertiesMap,pageOptions)},function(errMsg){Utils.triggerFn(error,errMsg)})},isRelatedFieldMany:function(fieldName){return isRelatedFieldMany(this,fieldName)},getSqlType:function(fieldName){return getSqlType(this,fieldName)},getPrimaryKey:function(){return methods.getPrimaryKey(this)},isCompositeKey:function(primaryKey){return methods.isCompositeKey(this,primaryKey)},isNoPrimaryKey:function(primaryKey){return methods.isNoPrimaryKey(this,primaryKey)},setOrderBy:function(expression){return methods.setOrderBy(this,expression)},getData:function(){return methods.getDataSet(this)},clearData:function(){return methods.clearData(this)},cancel:function(){return methods.cancel(this)},setInput:function(key,val,options){return methods.setInput(this,key,val,options)},setFilter:function(key,val){return methods.setFilter(this,key,val)},getRelatedTableData:function(columnName,options,success,error){return methods.getRelatedTableData(this,columnName,options,success,error)},getRelatedTablePrimaryKeys:function(columnName){return methods.getRelatedTablePrimaryKeys(this,columnName)},addItem:function(item,index){return methods.addItem(this,item,index)},updateItem:function(item,newItem){return methods.updateItem(this,item,newItem)},removeItem:function(item){return methods.removeItem(this,item)},init:function(){"read"===this.operation&&(Object.defineProperty(this,"firstRecord",{get:function(){return _.get(methods.getDataSet(this),"data[0]",{})}}),Object.defineProperty(this,"lastRecord",{get:function(){var data=_.get(methods.getDataSet(this),"data",[]);return data[data.length-1]}}))}};return BaseVariablePropertyFactory.register("wm.LiveVariable",liveVariableObj,["wm.Variable","wm.ServiceVariable"],methods),{reset:reset,getTableMetaData:getTableMetaData,updateVariableDataset:updateVariableDataset}}],wm.variables.services.$servicevariable=["Variables","BaseVariablePropertyFactory","WebService","ServiceFactory","$rootScope","CONSTANTS","Utils","ProjectService","VARIABLE_CONSTANTS","WS_CONSTANTS","$timeout","$base64",function(Variables,BaseVariablePropertyFactory,WebService,ServiceFactory,$rootScope,CONSTANTS,Utils,ProjectService,VARIABLE_CONSTANTS,WS_CONSTANTS,$timeout,$base64){"use strict";function isPrimitiveType(type,modelTypes){return WS_CONSTANTS.PRIMITIVE_DATA_TYPES.indexOf(type)!==-1||_.get(modelTypes,'["'+type+'"].primitiveType')||_.isEmpty(_.get(modelTypes,'["'+type+'"].fields'))}function prepareServiceModel(type,parentNode,startNode,variable,typeChain){var typeChainArr,modelTypes=variable._prefabName?prefabDataTypes[variable._prefabName]:$rootScope.dataTypes;if(startNode)modelTypes[type]&&modelTypes[type].fields&&WM.forEach(modelTypes[type].fields,function(field,fieldName){fieldName===startNode?prepareServiceModel(field.type,parentNode,null,variable):prepareServiceModel(field.type,parentNode,startNode,variable)});else if(_.isUndefined(typeChain)&&isPrimitiveType(type,modelTypes))variable.isList||(parentNode.value=""),variable._buildTreeFromDataSet=!0;else if(type&&modelTypes[type]){if(typeChain=typeChain||"",typeChainArr=typeChain.split("~"),typeChainArr.indexOf(type)!==-1)return;typeChain+="~"+type,WM.forEach(modelTypes[type].fields,function(field,fieldName){if(modelTypes[field.type]&&modelTypes[field.type].fields){if("DataService"===variable.serviceType&&_.get(modelTypes[type].fields,[fieldName,"isList"])&&"ProcedureExecution"!==variable.controller)return;parentNode[fieldName]=field.isList?[{}]:{},prepareServiceModel(field.type,field.isList?parentNode[fieldName][0]:parentNode[fieldName],"",variable,typeChain)}else parentNode[fieldName]=field.isList?[]:""})}}function transformData(data,variable){data.wmTransformedData=[];var columnsArray=variable.transformationColumns,dataArray=data[variable.dataField]||[],transformedData=data.wmTransformedData;return WM.forEach(dataArray,function(datum,index){transformedData[index]={},WM.forEach(columnsArray,function(column,columnIndex){transformedData[index][column]=datum[columnIndex]})}),data}function cloakHeadersForProxy(headers){var _headers={},UNCLOAKED_HEADERS=["CONTENT-TYPE","ACCEPT","CONTENT-LENGTH","ACCEPT-ENCODING","ACCEPT-LANGUAGE"],CLOAK_PREFIX="X-WM-";return WM.forEach(headers,function(val,key){_.includes(UNCLOAKED_HEADERS,key.toUpperCase())?_headers[key]=val:_headers[CLOAK_PREFIX+key]=val}),_headers}function isQueryServiceVar(variable){return variable.controller===CONTROLLER_TYPE_QUERY&&variable.serviceType===VARIABLE_CONSTANTS.SERVICE_TYPE_DATA}function processRequestBody(inputData,params){var paramValue,requestBody={},missingParams=[];return _.forEach(params,function(param){paramValue=inputData[param.name],WM.isDefined(paramValue)&&""!==paramValue?requestBody[param.name]=Utils.isDateTimeType(param.type)?Utils.formatDate(paramValue,param.type):paramValue:param.required&&missingParams.push(param.name||param.id)}),{requestBody:requestBody,missingParams:missingParams}}function constructRestRequestParams(operationInfo,variable){function getFormDataObj(){return formData?formData:formData=new FormData}variable=variable||{};var bodyInfo,requestBody,url,target,pathParamRex,invokeParams,uname,pswd,method,formData,isProxyCall,queryParams="",directPath=operationInfo.directPath||"",relativePath=operationInfo.basePath?operationInfo.basePath+operationInfo.relativePath:operationInfo.relativePath,headers={},requiredParamMissing=[],authType=AUTH_TYPE_NONE,isBodyTypeQueryProcedure=ServiceFactory.isBodyTypeQueryProcedure(variable);return operationInfo.proxySettings=operationInfo.proxySettings||{web:!0,mobile:!1},method=operationInfo.httpMethod||operationInfo.methodType,isProxyCall=function(){return CONSTANTS.hasCordova?operationInfo.proxySettings.mobile:operationInfo.proxySettings.web}(),url=isProxyCall?relativePath:directPath,_.forEach(operationInfo.parameters,function(param){var paramValue=param.sampleValue;if(WM.isDefined(paramValue)&&""!==paramValue||isBodyTypeQueryProcedure)switch("DataService"===variable.serviceType&&Utils.isDateTimeType(param.type)&&(paramValue=Utils.formatDate(paramValue,param.type)),param.parameterType.toUpperCase()){case"QUERY":if(_.isNull(paramValue)&&isQueryServiceVar(variable))break;queryParams?queryParams+="&"+param.name+"="+encodeURIComponent(paramValue):queryParams="?"+param.name+"="+encodeURIComponent(paramValue);break;case"AUTH":"wm_auth_username"===param.name?uname=paramValue:"wm_auth_password"===param.name&&(pswd=paramValue),uname&&pswd&&(headers[AUTH_HDR_KEY]="Basic "+$base64.encode(uname+":"+pswd),authType=AUTH_TYPE_BASIC);break;case"PATH":pathParamRex=new RegExp("\\s*\\{\\s*"+param.name+"(:\\.\\+)?\\s*\\}\\s*"),url=url.replace(pathParamRex,paramValue);break;case"HEADER":headers[param.name]=paramValue;break;case"BODY":isBodyTypeQueryProcedure?(bodyInfo=processRequestBody(variable.dataBinding,_.get(operationInfo,["definitions",param.type])),requestBody=bodyInfo.requestBody,requiredParamMissing=_.concat(requiredParamMissing,bodyInfo.missingParams)):requestBody=paramValue;break;case"FORMDATA":requestBody=Utils.getFormData(getFormDataObj(),param,paramValue)}else if(param.required)return requiredParamMissing.push(param.name||param.id),!1}),(requiredParamMissing=requiredParamMissing.join(", "))?{error:{type:"required_field_missing",field:requiredParamMissing,message:'Required field(s) missing: "'+requiredParamMissing+'"',skipDefaultNotification:!0}}:(_.includes(WS_CONSTANTS.NON_BODY_HTTP_METHODS,(method||"").toUpperCase())||(operationInfo.consumes&&operationInfo.consumes[0]===WS_CONSTANTS.CONTENT_TYPES.MULTIPART_FORMDATA?headers["Content-Type"]=void 0:headers["Content-Type"]=operationInfo.consumes&&operationInfo.consumes[0]||"application/json"),_.includes(operationInfo.consumes,WS_CONSTANTS.CONTENT_TYPES.FORM_URL_ENCODED)&&!_.includes(WS_CONSTANTS.NON_BODY_HTTP_METHODS,(method||"").toUpperCase())?(queryParams&&(requestBody=(requestBody?requestBody+"&":"")+queryParams.substring(1)),headers["Content-Type"]=WS_CONSTANTS.CONTENT_TYPES.FORM_URL_ENCODED):url+=queryParams,isProxyCall&&(headers=variable.serviceType!==SERVICE_TYPE_REST||operationInfo.skipCloakHeaders?headers:cloakHeadersForProxy(headers),variable._prefabName&&REST_SUPPORTED_SERVICES.indexOf(variable.serviceType)!==-1&&variable._wmServiceOperationInfo?(url="/prefabs/"+variable._prefabName+url,target="invokePrefabRestService"):variable._prefabName||(url="/services"+url),url=$rootScope.project.deployedUrl+url),invokeParams={projectID:$rootScope.project.id,url:url,target:target,method:method,headers:headers,dataParams:requestBody,authType:authType,isDirectCall:!isProxyCall,isExtURL:variable.serviceType===SERVICE_TYPE_REST})}function processErrorResponse(variable,errMsg,errorCB,xhrObj,skipNotification,skipDefaultNotification){skipNotification||initiateCallback(VARIABLE_CONSTANTS.EVENT.ERROR,variable,errMsg,xhrObj,skipDefaultNotification),Utils.triggerFn(errorCB,errMsg),CONSTANTS.isRunMode&&(variableActive[variable.activeScope.$id][variable.name]=!1,variable.canUpdate=!0,processRequestQueue(variable,requestQueue[variable.activeScope.$id],getDataInRun),initiateCallback(VARIABLE_CONSTANTS.EVENT.CAN_UPDATE,variable,errMsg,xhrObj))}function processSuccessResponse(response,variable,options,success){var newDataSet;response=Utils.getValidJSON(response)||Utils.xmlToJson(response)||response,initiateCallback(VARIABLE_CONSTANTS.EVENT.RESULT,variable,response,options.xhrObj),variable.transformationColumns&&(response=transformData(response,variable)),newDataSet=initiateCallback(VARIABLE_CONSTANTS.EVENT.PREPARE_SETDATA,variable,response,options.xhrObj),WM.isDefined(newDataSet)&&(response=newDataSet),options.forceRunMode||options.skipDataSetUpdate||(variable.dataSet=WM.isObject(response)?response:{value:response}),Utils.triggerFn(success,response),$timeout(function(){initiateCallback(VARIABLE_CONSTANTS.EVENT.SUCCESS,variable,response,options.xhrObj),CONSTANTS.isRunMode&&(variableActive[variable.activeScope.$id][variable.name]=!1,variable.canUpdate=!0,processRequestQueue(variable,requestQueue[variable.activeScope.$id],getDataInRun)),initiateCallback(VARIABLE_CONSTANTS.EVENT.CAN_UPDATE,variable,response,options.xhrObj)})}function getMethodInfo(variable,inputFields,options){var methodInfo=Utils.getClonedObject(variable._wmServiceOperationInfo);return methodInfo.parameters&&methodInfo.parameters.forEach(function(param){param.sampleValue=inputFields[param.name],VARIABLE_CONSTANTS.PAGINATION_PARAMS.indexOf(param.name)!==-1&&("size"===param.name?param.sampleValue=options.size||param.sampleValue||parseInt(variable.maxResults,10):"page"===param.name?param.sampleValue=options.page||param.sampleValue:"sort"===param.name&&(param.sampleValue=Variables.getEvaluatedOrderBy(variable.orderBy,options.orderBy)||param.sampleValue))}),methodInfo}function getDataInRun(variable,options,success,error){var params,methodInfo,output,service=variable.service,operation=variable.operation,serviceType=variable.serviceType,dataParams=[],inputFields=Utils.getClonedObject(options.inputFields||variable.dataBinding);if(CONSTANTS.isRunMode){if(output=initiateCallback(VARIABLE_CONSTANTS.EVENT.BEFORE_UPDATE,variable,inputFields),output===!1)return;_.isObject(output)&&(inputFields=output),$rootScope.$emit("toggle-variable-state",variable.name,!options.skipToggleState),variableActive[variable.activeScope.$id][variable.name]=!0,variable.canUpdate=!1}if(WM.forEach(inputFields,function(param){dataParams.push(param)}),REST_SUPPORTED_SERVICES.indexOf(serviceType)!==-1&&variable._wmServiceOperationInfo){if(methodInfo=getMethodInfo(variable,inputFields,options),params=_.isEmpty(methodInfo)?{error:{type:"meta_data_missing",field:"_wmServiceOperationInfo",message:'Meta data for the service "'+variable.service+'" is missing. Please run the project again.'}}:constructRestRequestParams(methodInfo,variable),params.error&&params.error.message)return void processErrorResponse(variable,params.error.message,error,options.xhrObj,options.skipNotification,params.error.skipDefaultNotification)}else serviceType===SERVICE_TYPE_REST?(dataParams=[service,operation,Utils.getClonedObject(inputFields)],params={method:REST_METHOD_NAME,params:dataParams,url:$rootScope.project.deployedUrl,target:"invokeRestService"}):params={method:operation,serviceFile:service+".json",params:dataParams,url:$rootScope.project.deployedUrl};return variable._prefabName&&REST_SUPPORTED_SERVICES.indexOf(serviceType)===-1&&(params.url+="/prefabs/"+variable._prefabName,params.target="invokePrefabRestService"),WM.isArray(methodInfo.produces)&&_.includes(methodInfo.produces,WS_CONSTANTS.CONTENT_TYPES.OCTET_STREAM)?(Utils.simulateFileDownload(params),void(variableActive[variable.activeScope.$id][variable.name]=!1)):void(REST_SUPPORTED_SERVICES.indexOf(serviceType)!==-1&&variable._wmServiceOperationInfo&&(variable.promise=WebService.invokeJavaService(params,function(response,xhrObj){_.get(xhrObj,"status")===WS_CONSTANTS.HTTP_STATUS_CODE.CORS_FAILURE?processErrorResponse(variable,"Possible CORS Failure, try disabling Same-Origin Policy on the browser.",error,xhrObj,options.skipNotification):(options.xhrObj=xhrObj,processSuccessResponse(response,variable,options,success,error))},function(errorMsg,details,xhrObj){_.get(details,"status")===WS_CONSTANTS.HTTP_STATUS_CODE.CORS_FAILURE&&(errorMsg="Possible CORS Failure, try disabling Same-Origin Policy on the browser."),processErrorResponse(variable,errorMsg,error,xhrObj,options.skipNotification)})))}function getDataInStudio(variable,startNode,success){var service=variable.service,operationId=variable.operationId,serviceModel={};ServiceFactory.getServicesWithType(function(){ServiceFactory.getServiceOperations(service,function(){ServiceFactory.getServiceOperationParams(service,operationId,function(response){var variableTypeNode,transformationCols,typeRef=_.get(response,["return","typeRef"]),fieldValue=startNode?startNode.substring(variable.name.length+1,startNode.length):startNode;serviceModel={},variable.type=variable.type||typeRef,variable.isList=response.isList,variable._format=response.returnFormat,prepareServiceModel(variable.type,serviceModel,fieldValue,variable),variable.transformationColumns&&(serviceModel.wmTransformedData={},WM.forEach(variable.transformationColumns,function(columnName){serviceModel.wmTransformedData[columnName]=""}),variableTypeNode=$rootScope.dataTypes[variable.type],transformationCols=variable.transformationColumns,variableTypeNode.fields.wmTransformedData={type:variable.service+".wmTransformedData"},$rootScope.dataTypes[variable.service+".wmTransformedData"]={service:variable.service,fields:_.zipObject(transformationCols,_.fill(new Array(transformationCols.length),{type:"string, number, date, datetime"}))}),variable.dataSet=variable.isList?[serviceModel]:serviceModel,Utils.triggerFn(success,serviceModel)})})})}function getServiceOperationInfo(selectedOperation,selectedService,success,error,forceReload,controller){var operationInfo={};ServiceFactory.getServiceDef(selectedService,function(response){var paramDataType,i,nPaths,pathKey,path,j,nOps,opType,operation,pathsArr=Object.keys(response.paths),securityDefinitions=response.securityDefinitions,AUTH_TYPE_KEY="WM_Rest_Service_Authorization";for(i=0,nPaths=pathsArr.length;i<nPaths;i++){for(pathKey=pathsArr[i],path=response.paths[pathKey],j=0,nOps=supportedOperations.length;j<nOps;j++)if(opType=supportedOperations[j],operation=path[opType],operation&&operation[WS_CONSTANTS.OPERATION_NAME_KEY]===selectedOperation){if(controller&&controller+"Controller"!==path[CONTROLLER_KEY])continue;operationInfo.httpMethod=opType,operationInfo.operationId=operation.operationId,operationInfo.name=selectedOperation,operationInfo.relativePath=(path[BASE_PATH_KEY]||"")+path[RELATIVE_PATH_KEY],operation.consumes&&operation.consumes.length&&(operationInfo.consumes=operation.consumes),operation.produces&&operation.produces.length&&(operationInfo.produces=operation.produces),operationInfo.parameters=[],operation.parameters&&operation.parameters.length&&operation.parameters.forEach(function(parameter){paramDataType="formdata"===parameter[parameterTypeKey].toLowerCase()&&"array"===parameter.type?parameter.items&&parameter.items.type||parameter.type:parameter.type,operationInfo.parameters.push({name:parameter.name||parameter[parameterTypeKey]&&parameter[parameterTypeKey].toLowerCase(),parameterType:parameter[parameterTypeKey],type:paramDataType})}),securityDefinitions&&securityDefinitions[AUTH_TYPE_KEY]&&"basic"===securityDefinitions[AUTH_TYPE_KEY].type&&operation.security[0][AUTH_TYPE_KEY]&&(operationInfo.authorization=securityDefinitions[AUTH_TYPE_KEY].type,operationInfo.parameters.push({name:"wm_auth_username",parameterType:"auth"}),operationInfo.parameters.push({name:"wm_auth_password",parameterType:"auth"}));break}if(j<nOps)break}Utils.triggerFn(success,operationInfo)},function(errMsg){Utils.triggerFn(error,errMsg)},forceReload)}function getOperationId(selectedOperation,selectedService,success,error,forceReload){var operationId;ServiceFactory.getServiceDef(selectedService,function(response){_.forEach(response.paths,function(path){return _.forEach(supportedOperations,function(op){return _.get(path,[op,WS_CONSTANTS.OPERATION_NAME_KEY])===selectedOperation&&(operationId=_.get(path,[op,"operationId"])),!operationId}),!operationId}),Utils.triggerFn(success,operationId)},function(errMsg){Utils.triggerFn(error,errMsg)},forceReload)}function update(options,success,error){var name=this.name;options=options||{},options.scope=this.activeScope||options.scope,methods.getData(this,options,function(response){CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!1,response),Utils.triggerFn(success,response)},function(errMsg){CONSTANTS.isRunMode&&$rootScope.$emit("toggle-variable-state",name,!1),Utils.triggerFn(error,errMsg)})}var requestQueue={},variableActive={},prefabDataTypes={},methods={},serviceVariableObj={},REST_METHOD_NAME="executeRestCall",REST_SUPPORTED_SERVICES=VARIABLE_CONSTANTS.REST_SUPPORTED_SERVICES,SERVICE_TYPE_REST=VARIABLE_CONSTANTS.SERVICE_TYPE_REST,AUTH_TYPE_BASIC="BASIC",AUTH_TYPE_NONE="NONE",supportedOperations=WS_CONSTANTS.HTTP_METHODS.map(function(method){return method.toLowerCase()}),BASE_PATH_KEY="x-WM-BASE_PATH",RELATIVE_PATH_KEY="x-WM-RELATIVE_PATH",CONTROLLER_KEY="x-WM-TAG",parameterTypeKey="in",AUTH_HDR_KEY="Authorization",CONTROLLER_TYPE_QUERY="QueryExecution",initiateCallback=Variables.initiateCallback,processRequestQueue=Variables.processRequestQueue;return methods={getDataSet:function(variable){return variable.dataSet},getData:function(variable,options,success,error){var serviceModel,variableName=variable.name,startNode=options.startNode;if(Utils.isEmptyObject(variable))return void error();if(CONSTANTS.isRunMode||options.forceRunMode){if(CONSTANTS.isRunMode&&(variableActive[variable.activeScope.$id]=variableActive[variable.activeScope.$id]||{},requestQueue[variable.activeScope.$id]=requestQueue[variable.activeScope.$id]||{},variableActive[variable.activeScope.$id][variableName]))return options.inputFields=options.inputFields||Utils.getClonedObject(variable.dataBinding),requestQueue[variable.activeScope.$id][variableName]=requestQueue[variable.activeScope.$id][variableName]||[],void requestQueue[variable.activeScope.$id][variableName].push({variable:variable,options:options,success:success,error:error});options.forceRunMode?ProjectService.run({projectId:$rootScope.project.id},function(result){$rootScope.project.deployedUrl=Utils.removeProtocol(result),getDataInRun(variable,options,success,error)}):getDataInRun(variable,options,success,error)}else variable._prefabName?(serviceModel={},ServiceFactory.getPrefabTypes(variable._prefabName,function(types){prefabDataTypes[variable._prefabName]=types,prepareServiceModel(variable.type,serviceModel,null,variable),variable.dataSet=serviceModel,Utils.triggerFn(success,serviceModel)})):getDataInStudio(variable,startNode,success,error)},setService:function(variable,service){return service&&(variable.service=service),variable.service},setOperation:function(variable,operation){return operation&&(variable.operation=operation),variable.operation},clearData:function(variable){return variable.dataSet={},variable.dataSet},cancel:function(variable){variableActive[variable.activeScope.$id][variable.name]&&variable.promise&&variable.promise.abort()},setInput:function(variable,key,val,options){var keys,lastKey,targetObj=variable.dataBinding,paramObj={};if(WM.isObject(options))switch(options.type){case"file":val=Utils.getBlob(val,options.contentType);break;case"number":val=_.isNumber(val)?val:parseInt(val,10)}return WM.isObject(key)?paramObj=key:key.indexOf(".")>-1?(keys=key.split("."),lastKey=keys.pop(),targetObj=Utils.findValueOf(targetObj,keys.join("."),!0),key=lastKey,paramObj[key]=val):paramObj[key]=val,WM.forEach(paramObj,function(paramVal,paramKey){targetObj[paramKey]=paramVal}),variable.dataBinding}},serviceVariableObj={update:update,invoke:update,setService:function(service){return methods.setService(this,service)},setOperation:function(operation){return methods.setOperation(this,operation)},getData:function(){return methods.getDataSet(this)},clearData:function(){return methods.clearData(this)},cancel:function(){return methods.cancel(this)},setInput:function(key,val,options){return methods.setInput(this,key,val,options)},download:function(options,errorHandler){var requestParams,inputParams=Utils.getClonedObject(this.dataBinding),methodInfo=getMethodInfo(this,inputParams,options);
methodInfo.relativePath+="/export/"+options.exportFormat,requestParams=constructRestRequestParams(methodInfo,this),_.hasIn(requestParams,"error.message")?Utils.triggerFn(errorHandler,requestParams.error.message):Utils.simulateFileDownload(requestParams)},init:function(){this.isList&&(Object.defineProperty(this,"firstRecord",{get:function(){var dataSet=methods.getDataSet(this);return _.head(dataSet&&dataSet.content)||_.head(dataSet)||{}}}),Object.defineProperty(this,"lastRecord",{get:function(){var dataSet=methods.getDataSet(this);return _.last(dataSet&&dataSet.content)||_.last(dataSet)||{}}}))}},BaseVariablePropertyFactory.register("wm.ServiceVariable",serviceVariableObj,["wm.Variable"],methods),{getServiceModel:function(params){var model={},variable=params.variable,prefabName=_.get(variable,"_prefabName");return prefabName&&(prefabDataTypes[prefabName]=params.types),prepareServiceModel(params.typeRef,model,null,params.variable),model},getServiceOperationInfo:getServiceOperationInfo,getOperationId:getOperationId,constructRestRequestParams:constructRestRequestParams}}],wm.variables.services.$websocketvariable=["BaseVariablePropertyFactory","Variables","VARIABLE_CONSTANTS","$websocket","Utils","$servicevariable","ServiceFactory",function(BaseVariablePropertyFactory,Variables,VARIABLE_CONSTANTS,$websocket,Utils,$servicevariable,ServiceFactory){"use strict";function shouldAppendData(variable){return variable=variable||this,variable[PROPERTY.DATA_UPDATE_STRATEGY]!==DATA_UPDATE_STRATEGY.REFRESH}function shouldAppendLast(variable){return variable[PROPERTY.DATA_UPDATE_STRATEGY]===DATA_UPDATE_STRATEGY.APPEND}function getDataLimit(variable){return variable.dataLimit}function freeSocket(variable){_.set(scope_var_socket_map,[variable.activeScope.$id,variable.name],void 0)}function _onSocketOpen(variable,evt){variable._socketConnected=!0,initiateCallback(VARIABLE_CONSTANTS.EVENT.OPEN,variable,_.get(evt,"data"),evt)}function _onSocketClose(variable,evt){variable._socketConnected=!1,freeSocket(variable),initiateCallback(VARIABLE_CONSTANTS.EVENT.CLOSE,variable,_.get(evt,"data"),evt)}function _onSocketError(variable,evt){variable._socketConnected=!1,freeSocket(variable),initiateCallback(VARIABLE_CONSTANTS.EVENT.ERROR,variable,_.get(evt,"data")||"Error while connecting with "+variable.service,evt)}function _onSocketMessage(variable,evt){var value,dataLength,dataLimit,shouldAddToLast,insertIdx,data=_.get(evt,"data");data=Utils.getValidJSON(data)||Utils.xmlToJson(data)||data,value=initiateCallback(VARIABLE_CONSTANTS.EVENT.MESSAGE_RECEIVE,variable,data,evt),data=WM.isDefined(value)?value:data,shouldAppendData(variable)?(variable.dataSet=variable.dataSet||[],dataLength=variable.dataSet.length,dataLimit=getDataLimit(variable),shouldAddToLast=shouldAppendLast(variable),dataLimit&&dataLength>=dataLimit&&(shouldAddToLast?variable.dataSet.shift():variable.dataSet.pop()),insertIdx=shouldAddToLast?dataLength:0,variable.dataSet.splice(insertIdx,0,data)):variable.dataSet=WM.isDefined(value)?value:data}function _onBeforeSend(variable,message){return initiateCallback(VARIABLE_CONSTANTS.EVENT.BEFORE_SEND,variable,message)}function _onBeforeSocketClose(variable,evt){return initiateCallback(VARIABLE_CONSTANTS.EVENT.BEFORE_CLOSE,variable,_.get(evt,"data"),evt)}function _onBeforeSocketOpen(variable,evt){return initiateCallback(VARIABLE_CONSTANTS.EVENT.BEFORE_OPEN,variable,_.get(evt,"data"),evt)}function getURL(variable){var config,opInfo=Utils.getClonedObject(variable._wmServiceOperationInfo),inputFields=variable.dataBinding;return _.forEach(opInfo.parameters,function(param){param.sampleValue=inputFields[param.name]}),WM.extend(opInfo,{skipCloakHeaders:!0}),config=$servicevariable.constructRestRequestParams(opInfo),config.error&&config.error.message?void _onSocketError(variable,{data:config.error.message}):config.url}function getSocket(variable){var url=getURL(variable),_socket=_.get(scope_var_socket_map,[variable.activeScope.$id,variable.name]);return _socket?_socket:(_socket=$websocket(url),_socket.onOpen(_onSocketOpen.bind(void 0,variable)),_socket.onError(_onSocketError.bind(void 0,variable)),_socket.onMessage(_onSocketMessage.bind(void 0,variable)),_socket.onClose(_onSocketClose.bind(void 0,variable)),_.set(scope_var_socket_map,[variable.activeScope.$id,variable.name],_socket),variable._socket=_socket,_socket)}function open(){var socket,variable=this,shouldOpen=_onBeforeSocketOpen(variable);if(shouldOpen!==!1)return socket=getSocket(variable),variable.activeScope.$on("$destroy",function(){variable.close()}),socket}function close(){var variable=this,shouldClose=_onBeforeSocketClose(variable),socket=getSocket(variable);shouldClose!==!1&&socket.close()}function send(message){var response,variable=this,socket=getSocket(variable);message=message||_.get(variable,"dataBinding.RequestBody"),response=_onBeforeSend(variable,message),response!==!1&&(message=WM.isDefined(response)?response:message,message=WM.isObject(message)?JSON.stringify(message):message,socket.send(message))}function update(){var variable=this;variable._prefabName?ServiceFactory.getPrefabTypes(variable._prefabName,function(types){variable.dataSet=$servicevariable.getServiceModel({variable:variable,typeRef:variable.type,types:types}),variable.dataSet=shouldAppendData(variable)?[variable.dataSet]:variable.dataSet}):(variable.dataSet=$servicevariable.getServiceModel({variable:variable,typeRef:variable.type}),variable.dataSet=shouldAppendData(variable)?[variable.dataSet]:variable.dataSet)}function init(){shouldAppendData(this)&&(Object.defineProperty(this,"firstRecord",{get:function(){return this.dataSet[0]}}),Object.defineProperty(this,"lastRecord",{get:function(){var content=this.dataSet||[];return content[content.length-1]}}))}var serviceVariableObj,scope_var_socket_map={},initiateCallback=Variables.initiateCallback,PROPERTY={SERVICE:"service",DATA_UPDATE_STRATEGY:"dataUpdateStrategy",DATA_LIMIT:"dataLimit"},DATA_UPDATE_STRATEGY={REFRESH:"refresh",PREPEND:"prepend",APPEND:"append"};return serviceVariableObj={open:open,close:close,send:send,invoke:send,update:update,init:init,shouldAppendData:shouldAppendData},BaseVariablePropertyFactory.register("wm.WebSocketVariable",serviceVariableObj,[],serviceVariableObj),{}}],wm.variables.services.NavigationVariableService=function($rootScope,BaseVariablePropertyFactory,Utils,NavigationService){"use strict";var methods={navigate:function(variable,options){if(!Utils.isEmptyObject(variable)){var pageName,viewName,operation,sourceScope,urlParams;switch(operation=variable.operation,sourceScope=options.scope||$rootScope,pageName=variable.dataBinding&&variable.dataBinding.pageName||variable.pageName,variable.dataSet=options.data||variable.dataSet,urlParams=variable.dataSet,operation){case"goToPreviousPage":NavigationService.goToPrevious();break;case"gotoPage":try{NavigationService.goToPage(pageName,{transition:variable.pageTransitions,$event:options.$event,urlParams:urlParams}),sourceScope.$root.$safeApply(sourceScope)}catch(ignore){}break;case"gotoView":viewName=variable.dataBinding&&variable.dataBinding.viewName||variable.viewName;break;case"gotoTab":viewName=variable.dataBinding&&variable.dataBinding.tabName||variable.tabName;break;case"gotoAccordion":viewName=variable.dataBinding&&variable.dataBinding.accordionName||variable.accordionName;break;case"gotoSegment":viewName=variable.dataBinding&&variable.dataBinding.segmentName||variable.segmentName}viewName&&NavigationService.goToView(viewName,{pageName:pageName,transition:variable.pageTransitions,$event:options.$event,urlParams:urlParams})}},getProperty:function(variable,prop){return variable[prop]},setProperty:function(variable,prop,value){return variable[prop]=value,variable[prop]},getData:function(variable){return variable.dataSet},setData:function(variable,value,isDataQueryParam){return WM.isDefined(isDataQueryParam)&&(variable.isDataQueryParam=isDataQueryParam),methods.setProperty(variable,"dataSet",value)}},navigate=function(options){options=options||{},options.scope=options.scope||this.activeScope,methods.navigate(this,options)},basicVariableObj={navigate:navigate,invoke:navigate,setProperty:function(prop,value){return methods.setProperty(this,prop,value)},getProperty:function(prop,value){return methods.getProperty(this,prop,value)},getData:function(){return methods.getData(this)},setData:function(value,isDataQueryParam){return methods.setData(this,value,isDataQueryParam)}};return BaseVariablePropertyFactory.register("wm.NavigationVariable",basicVariableObj,[],methods),{goToView:function(viewName){NavigationService.goToView(viewName)}}},wm.variables.services.NotificationVariableService=function(BaseVariablePropertyFactory,DialogService,$rootScope,wmToaster,Variables){"use strict";var methods={notify:function(variable,options,success,error){function customNotificationOnClick(){variable.onClick?initiateCallback("onClick",variable,scope,options.data):wmToaster.hide()}function customNotificationOnHide(){variable.onHide&&initiateCallback("onHide",variable,scope,options.data)}var scope,variableName=variable.name,dialogId="notification"+variable.operation+"dialog",commonPageDialogId="Common"+_.capitalize(variable.operation)+"Dialog",variableOwner=variable.owner,operation=variable.operation,toasterOptions=WM.element("[toaster-options]").scope()&&WM.element("[toaster-options]").scope().config||{},initiateCallback=Variables.initiateCallback;if("toast"===operation){var type=(options.class||variable.dataBinding.class||"info").toLowerCase(),body=options.message||variable.dataBinding.text,timeout=parseInt(variable.dataBinding.duration),positionClass="toast-"+(options.position||variable.dataBinding.toasterPosition||"bottom right").replace(" ","-"),content=variable.dataBinding.page;toasterOptions.position=positionClass,scope="Application"===variableOwner?$rootScope||{}:options.scope||{},variable.dataBinding.content&&"page"===variable.dataBinding.content?content&&wmToaster.createCustomNotification(content,variableName,timeout,positionClass,customNotificationOnClick,customNotificationOnHide,scope):wmToaster.show(type,"",body,timeout,void 0,customNotificationOnClick,customNotificationOnHide)}else scope="Application"===variableOwner?$rootScope||{}:options.scope.$$childTail||{},dialogId="App"===variableOwner&&WM.element("[name="+commonPageDialogId+"]").length?commonPageDialogId:dialogId,DialogService.showDialog(dialogId,{resolve:{dialogParams:function(){return{notificationDetails:{title:options.title||variable.dataBinding.title,text:options.message||variable.dataBinding.text,okButtonText:options.okButtonText||variable.dataBinding.okButtonText,cancelButtonText:options.cancelButtonText||variable.dataBinding.cancelButtonText,alerttype:options.alerttype||variable.dataBinding.alerttype,onOk:variableName+"onOk",onCancel:variableName+"onCancel",onClose:variableName+"onClose"},onOk:function(){initiateCallback("onOk",variable,scope,options.data),DialogService.hideDialog(dialogId)},onCancel:function(){initiateCallback("onCancel",variable,scope,options.data),DialogService.hideDialog(dialogId)},onClose:function(){initiateCallback("onClose",variable,scope,options.data),DialogService.hideDialog(dialogId)}}}},scope:scope})},getOperation:function(variable){return variable.operation},getMessage:function(variable){return variable.dataBinding.text},setMessage:function(variable,text){return WM.isString(text)&&(variable.dataBinding.text=text),variable.dataBinding.text},getTitle:function(variable){return variable.dataBinding.title},setTitle:function(variable,text){return WM.isString(text)&&(variable.dataBinding.title=text),variable.dataBinding.title},getOkButtonText:function(variable){return variable.dataBinding.okButtonText},setOkButtonText:function(variable,text){return WM.isString(text)&&(variable.dataBinding.okButtonText=text),variable.dataBinding.okButtonText},getToasterDuration:function(variable){return variable.dataBinding.duration},setToasterDuration:function(variable,duration){return variable.dataBinding.duration=duration,variable.dataBinding.duration},getToasterClass:function(variable){return variable.dataBinding.class},setToasterClass:function(variable,type){return WM.isString(type)&&(variable.dataBinding.class=type),variable.dataBinding.class},getToasterPosition:function(variable){return variable.dataBinding.class},setToasterPosition:function(variable,position){return WM.isString(position)&&(variable.dataBinding.position=position),variable.dataBinding.position},getAlertType:function(variable){return variable.dataBinding.alerttype},setAlertType:function(variable,alerttype){return WM.isString(alerttype)&&(variable.dataBinding.alerttype=alerttype),variable.dataBinding.alerttype},getCancelButtonText:function(variable){return variable.dataBinding.cancelButtonText},setCancelButtonText:function(variable,text){return WM.isString(text)&&(variable.dataBinding.cancelButtonText=text),variable.dataBinding.cancelButtonText}},notify=function(options){options=options||{},options.scope=this.activeScope,methods.notify(this,options)},basicVariableObj={notify:notify,invoke:notify,getOperation:function(){return methods.getOperation(this,{scope:this.activeScope})},getMessage:function(){return methods.getMessage(this)},setMessage:function(text){return methods.setMessage(this,text)},getOkButtonText:function(){return methods.getOkButtonText(this)},setOkButtonText:function(text){return methods.setOkButtonText(this,text)},getToasterDuration:function(){return methods.getToasterDuration(this)},setToasterDuration:function(duration){return methods.setToasterDuration(this,duration)},getToasterClass:function(){return methods.getToasterClass(this)},setToasterClass:function(type){return methods.setToasterClass(this,type)},getToasterPosition:function(){return methods.getToasterPosition(this)},setToasterPosition:function(position){return methods.setToasterPosition(this,position)},getAlertType:function(){return methods.getAlertType(this)},setAlertType:function(alerttype){return methods.setAlertType(this,alerttype)},getCancelButtonText:function(){return methods.getCancelButtonText(this)},setCancelButtonText:function(text){return methods.setCancelButtonText(this,text)}};return BaseVariablePropertyFactory.register("wm.NotificationVariable",basicVariableObj,[],methods),{}},WM.module("wm.layouts.containers").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/container/accordion.html",'<div class="app-accordion panel-group" wmtransclude init-widget apply-styles="scrollable-container"></div>'),$templateCache.put("template/layout/container/accordion-pane.html",'<div class="app-accordion-panel panel" page-container init-widget wm-navigable-element="true" apply-styles="shell"><div class="panel-heading clearfix" ng-click="togglePane($event)" ng-class="{active: isActive}"><h3 class="panel-title"><a href="javascript:void(0);" class="accordion-toggle"><div class="pull-left"><i class="app-icon panel-icon {{iconclass}}" ng-show="iconclass"></i></div><div class="pull-left"><div class="heading" ng-bind-html="title"></div><div class="description" ng-bind-html="subheading"></div></div></a></h3><div class="panel-actions"><span class="label label-{{badgetype}}">{{badgevalue}}</span><button type="button" class="app-icon wi panel-action" ng-class="isActive ? \'wi-minus\': \'wi-plus\'"></button></div></div><div class="panel-collapse collapse"  ng-class="isActive ? \'collapse in\' : \'collapse\'"><div class="panel-body" wmtransclude page-container-target apply-styles="inner-shell"></div></div></div>')}]).directive("wmAccordion",["$templateCache","WidgetUtilService","PropertiesFactory","Utils",function($templateCache,WidgetUtilService,PropertiesFactory,Utils){"use strict";function propertyChangeHandler(scope,key,newVal){switch(key){case"defaultpaneindex":scope.activePane||(scope.activePane=scope.panes[newVal||0]),scope.activePane.expand()}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.accordion",["wm.base","wm.layouts.panel.defaults"]),notifyFor={defaultpaneindex:!0};return{restrict:"E",replace:!0,scope:{},transclude:!0,template:$templateCache.get("template/layout/container/accordion.html"),controller:function($scope){$scope.panes=[],this.paneIndex=0,this.register=function(paneScope){$scope.panes.push(paneScope),paneScope.paneId=this.paneIndex,this.paneIndex++},this.closeOthers=function(){$scope.closeothers&&WM.forEach($scope.panes,function(pane){pane.isActive&&Utils.triggerFn(pane.onCollapse),pane.isActive=!1})}},compile:function(){return{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs,ctrl){_.forEach(scope.panes,function(pane){pane.isdefaultpane&&!attrs.defaultpaneindex&&(scope.activePane=pane)}),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]).directive("wmAccordionpane",["$templateCache","WidgetUtilService","PropertiesFactory","Utils",function($templateCache,WidgetUtilService,PropertiesFactory,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.accordionpane",["wm.base"]);return{restrict:"E",replace:!0,scope:{},transclude:!0,template:$templateCache.get("template/layout/container/accordion-pane.html"),require:"^wmAccordion",compile:function(){return{pre:function(scope,element,attrs){attrs.heading&&!attrs.title&&(attrs.title=attrs.heading),scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,scope.$lazyLoad=WM.noop,element.removeAttr("title")},post:function(scope,element,attrs,panesCtrl){var parentScope=element.closest(".app-accordion").isolateScope();void 0!==scope.title||scope.bindtitle||(scope.title=scope.heading||scope.bindheading),panesCtrl.register(scope),scope.togglePane=function($event){var flag=!scope.isActive;flag?(element.find(".ng-isolate-scope").each(function(){Utils.triggerFn(WM.element(this).isolateScope().redraw)}),!scope.widgetid&&parentScope.onChange&&$event&&parentScope.onChange({$event:$event,$scope:parentScope,newPaneIndex:scope.paneId,oldPaneIndex:parentScope.activePane&&parentScope.activePane.paneId||0}),parentScope.activePane=scope,Utils.triggerFn(scope.$lazyLoad),Utils.triggerFn(scope.onExpand),panesCtrl.closeOthers(scope)):Utils.triggerFn(scope.onCollapse),scope.isActive=flag},scope.expand=function(){scope.isActive||scope.togglePane()},scope.collapse=function(){scope.isActive&&scope.togglePane()},WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.layouts.containers").run(["$templateCache",function($tc){"use strict";$tc.put("template/widget/medialist-design.html",'<div class="app-medialist" listen-property="dataset" init-widget apply-styles="shell"><div wmtransclude apply-styles="inner-shell"></div></div>'),$tc.put("template/widget/medialist.html",'<div class="app-medialist" ng-class="{\'singlerow\' : layout == \'Single-row\'}" init-widget apply-styles="shell"><ul class="list-unstyled list-inline app-media-thumbnail" wmtransclude apply-styles="inner-shell"></ul><div class="app-media-fullscreen" ng-show="selectedMediaIndex >= 0"><wm-mobile-navbar on-backbtnclick="exitFullScreen();" show-leftnav="false" backbuttoniconclass="wi wi-chevron-left" title= "{{selectedMediaIndex+1}}/{{fieldDefs.length}}"></wm-mobile-navbar><wm-content><wm-page-content><div class="media-content"><div class="image-container"  hm-swipe-left="showPrev()" hm-swipe-right="showNext()"><img class="center-block" ng-src="{{$eval(mediaurl, fieldDefs[selectedMediaIndex])}}" wm-image-cache="{{offline ? \'permanant\' : \'\'}}"><a class="app-media-fullscreen-nav-control left" ng-show="selectedMediaIndex > 0" ng-click="showNext()"><i class="wi wi-chevron-left"></i></a><a class="app-media-fullscreen-nav-control right" ng-show="selectedMediaIndex < fieldDefs.length-1" ng-click="showPrev()"><i class="wi wi-chevron-right"></i></a></div></div></wm-page-content></wm-content></div></div>'),$tc.put("template/widget/medialist-template.html",'<div init-widget ng-style="{\'width\': width, \'height\': height}" class="app-medialist-template thumbnail"><img class="thumbnail-image-template" ng-src="{{imagesource}}"><div class="thumbnail-details" wmtransclude></div></div>')}]).directive("wmMediaList",["$templateCache","$compile","PropertiesFactory","WidgetUtilService","CONSTANTS","Utils","DeviceService",function($templateCache,$compile,PropertiesFactory,WidgetUtilService,CONSTANTS,Utils,DeviceService){"use strict";function controllerFn(){var _map={};this.$set=function(key,value){_map[key]=value},this.$get=function(key){return _map[key]}}function templateFn(){return CONSTANTS.isStudioMode?$templateCache.get("template/widget/medialist-design.html"):$templateCache.get("template/widget/medialist.html")}function updateFieldDefs($is,$el,data){$is.fieldDefs=data,CONSTANTS.isRunMode&&($is.$mediaScope.fieldDefs=data)}function getVariable($is,variableName){if(variableName){var variables=$is.Variables||{};return variables[variableName]}}function onDataChange($is,$el,nv){if(nv){if(nv.data)nv=nv.data;else if(!_.includes($is.binddataset,"bind:Widgets.")){var boundVariableName=Utils.getVariableName($is),variable=getVariable($is,boundVariableName);if(variable&&"wm.LiveVariable"===variable.category)return}WM.isObject(nv)&&Utils.isPageable(nv)&&(nv=nv.content),WM.isObject(nv)&&!WM.isArray(nv)&&(nv=[nv]),$is.binddataset||WM.isString(nv)&&(nv=nv.split(",")),WM.isArray(nv)&&updateFieldDefs($is,$el,nv)}else CONSTANTS.isRunMode&&updateFieldDefs($is,$el,[])}function propertyChangeHandler($is,$el,attrs,key,nv){"dataset"===key&&onDataChange($is,$el,nv)}function applyWrapper($tmplContent){var tmpl=WM.element(elementsMarkup);return tmpl.find("> div > .thumbnail-details").append($tmplContent),tmpl}function prepareMediaListTemplate(tmpl,attrs){var $tmpl=WM.element(tmpl),$div=WM.element("<div></div>").append($tmpl);return attrs.dataset&&Utils.updateTmplAttrs($div,attrs.dataset,attrs.name),$tmpl=applyWrapper($tmpl)}function preLinkFn($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps}function createChildScope($is,$el,listCtrl){var _scope=$el.scope(),$liScope=_scope.$new(),thumbnailDim=listCtrl.$get("thumbnailDimensions");return WM.extend($liScope,{offline:$is.offline,thumbnailURL:$is.thumbnailurl,thumbnailWidth:thumbnailDim.width,thumbnailHeight:thumbnailDim.height}),$liScope}function runMode_postLinkFn($is,$el,attrs,listCtrl){var $mediaTemplate,backButtonListenerDeregister,$mediaScope=createChildScope($is,$el,listCtrl);backButtonListenerDeregister=DeviceService.onBackButtonTap(function(){if($is.selectedMediaIndex>=0)return $is.selectedMediaIndex=-1,!1}),$is.$on("$destroy",function(){backButtonListenerDeregister()}),$is.$mediaScope=$mediaScope,$mediaTemplate=prepareMediaListTemplate(listCtrl.$get("mediaListTemplate"),attrs),$el.find("> ul").append($mediaTemplate),$compile($mediaTemplate)($mediaScope),$mediaScope.showFullScreen=function(index){index<$mediaScope.fieldDefs.length&&($is.selectedMediaIndex=index)},$is.exitFullScreen=function(){$is.selectedMediaIndex=-1},$is.showPrev=function(){$mediaScope.showFullScreen($is.selectedMediaIndex+1)},$is.showNext=function(){$mediaScope.showFullScreen($is.selectedMediaIndex-1)},WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is,$el,attrs),$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs)}function studioMode_postLinkFn($is,$el,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is,$el,attrs),$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs)}var directiveDefn,widgetProps=PropertiesFactory.getPropertiesOf("wm.medialist",["wm.base","wm.base.editors"]),notifyFor={dataset:!0},elementsMarkup='<li ng-repeat="item in fieldDefs" class="app-media-item" ng-click="showFullScreen($index)"><div ng-style="{\'width\': thumbnailWidth, \'height\': thumbnailHeight}" class="thumbnail"><img class="thumbnail-image" ng-src="{{$eval(thumbnailURL, item)}}"  wm-image-cache="{{offline ? \'permanant\' : \'\'}}"><div class="thumbnail-details"></div></div></li>';return directiveDefn={restrict:"E",replace:!0,scope:{},template:templateFn,transclude:!0,link:{pre:preLinkFn}},CONSTANTS.isRunMode?(directiveDefn.link.post=runMode_postLinkFn,directiveDefn.controller=controllerFn):directiveDefn.link.post=studioMode_postLinkFn,directiveDefn}]).directive("wmMediaTemplate",["PropertiesFactory","WidgetUtilService","CONSTANTS","$templateCache","Utils",function(PropertiesFactory,WidgetUtilService,CONSTANTS,$tc,Utils){"use strict";function preLinkFn($is){$is.widgetProps=widgetProps}function studioMode_postLinkFn($is,$el,attrs){$is.imagesource=Utils.getImageUrl("resources/images/imagelists/default-image.png"),WidgetUtilService.postWidgetCreate($is,$el,attrs)}function runMode_preLinkFn($is,$el,attrs,listCtrl){listCtrl.$set("mediaListTemplate",$el.children()),listCtrl.$set("thumbnailDimensions",{width:attrs.width||widgetProps.width.value,height:attrs.height||widgetProps.height.value}),$el.remove()}var widgetProps,directiveDefn={restrict:"E",replace:!0};return widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.mediatemplate"),CONSTANTS.isStudioMode?WM.extend(directiveDefn,{transclude:!0,scope:{},template:$tc.get("template/widget/medialist-template.html"),link:{pre:preLinkFn,post:studioMode_postLinkFn}}):WM.extend(directiveDefn,{terminal:!0,require:"^wmMediaList",link:{pre:runMode_preLinkFn}}),directiveDefn}]),WM.module("wm.layouts.containers").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/container/form.html",'<form role="form" init-widget class="panel app-panel app-form" ng-class="[captionAlignClass, formClassName]" autocomplete="autocomplete" apply-styles="shell"><div class="panel-heading" ng-if="title || subheading || iconclass"><h3 class="panel-title"><div class="pull-left"><i class="app-icon panel-icon {{iconclass}}" ng-show="iconclass"></i></div><div class="pull-left"><div class="heading">{{title}}</div><div class="description">{{subheading}}</div></div></h3></div><div class="form-body panel-body" apply-styles="inner-shell"><wm-message ng-if=(messagelayout==="Inline") scopedataset="statusMessage" hideclose="false"></wm-message><div class="form-elements" wmtransclude><div class="overlay" ng-if="showNoFieldsMsg"><span>{{:: $root.locale.MESSAGE_CANNOT_GENERATE_FIELDS_IN_STUDIO}}</span></div></div><div class="hidden-form-elements"></div></div></form>')}]).directive("wmForm",["$rootScope","PropertiesFactory","WidgetUtilService","$compile","CONSTANTS","Utils","$timeout","LiveWidgetUtils","wmToaster",function($rootScope,PropertiesFactory,WidgetUtilService,$compile,CONSTANTS,Utils,$timeout,LiveWidgetUtils,wmToaster){"use strict";function setDefaultValues(scope){scope.formdata&&scope.elScope.formFields&&!_.isEmpty(scope.elScope.formFields)&&(_.forEach(scope.elScope.formFields,function(field){field.value=_.get(scope.formdata,field.key||field.name)}),scope.constructDataObject())}function setMarkupForFormField(field,columnWidth){var template="",widget="<wm-form-field";return _.forEach(field,function(value,key){widget=widget+" "+key+'="'+value+'"'}),widget+="></wm-form-field>",template+='<wm-gridcolumn columnwidth="'+columnWidth+'">'+widget+"</wm-gridcolumn>"}function generateFormFields(scope,element){var $fieldsMarkup,index,userFields,fields=scope.metadata?scope.metadata.data||scope.metadata:[],fieldTemplate="",$gridLayout=element.find(".form-elements .app-grid-layout:first"),noOfColumns=Number($gridLayout.attr("columns"))||1,colCount=0,columnWidth=12/noOfColumns;if(scope.elScope.formFields=[],$gridLayout.empty(),!_.isEmpty(fields)&&(scope.onBeforerender&&(userFields=scope.onBeforerender({$metadata:fields,$scope:scope}),userFields&&(fields=userFields)),_.isArray(fields))){for(;fields[colCount];){for(fieldTemplate+="<wm-gridrow>",index=0;index<noOfColumns;index++)fields[colCount]&&(fieldTemplate+=setMarkupForFormField(fields[colCount],columnWidth)),colCount++;fieldTemplate+="</wm-gridrow>"}$fieldsMarkup=WM.element(fieldTemplate),$gridLayout.prepend($fieldsMarkup),$compile($fieldsMarkup)(scope.elScope),setDefaultValues(scope)}}function propertyChangeHandler(scope,element,attrs,key,newVal){var value,resetBtnTemplate,$gridLayout;switch(key){case"captionsize":LiveWidgetUtils.setCaptionSize(element,newVal);break;case"captionalign":scope.captionAlignClass="align-"+newVal;break;case"captionposition":scope.elScope.captionposition=newVal;break;case"novalidate":newVal===!0||"true"===newVal?element.attr("novalidate",""):element.removeAttr("novalidate");break;case"autocomplete":value=newVal===!0||"true"===newVal?"on":"off",element.attr(key,value);break;case"submitbutton":newVal===!0||"true"===newVal?element.append($compile(submitBtnTemplate)(scope)):element.find(".form-submit").remove();break;case"resetbutton":newVal===!0||"true"===newVal?(resetBtnTemplate=$compile('<wm-button class="reset-submit" type="reset" caption="reset" '+(scope.widgetid?"":'on-click="resetForm();"')+" ></wm-button>")(scope),element.append(resetBtnTemplate)):element.find(".reset-submit").remove();break;case"method":scope.widgetProps.enctype.show="post"===newVal;break;case"action":attrs.$set("action",newVal);break;case"metadata":CONSTANTS.isRunMode?generateFormFields(scope,element):($gridLayout=element.find(".form-elements .app-grid-layout:first"),newVal?($gridLayout.hide(),scope.showNoFieldsMsg=!0):($gridLayout.show(),scope.showNoFieldsMsg=!1));break;case"formdata":CONSTANTS.isRunMode&&setDefaultValues(scope)}}function resetFormState($s){var ngForm=$s.elScope.ngform;ngForm&&(ngForm.$setUntouched(),ngForm.$setPristine())}function resetFormFields(element){var eleScope=element.scope();element.find('[role="input"]').each(function(){WM.element(this).isolateScope().reset()}),$rootScope.$safeApply(eleScope)}function resetForm($s,element){resetFormFields(element),resetFormState($s),$s.formFields?_.forEach($s.formFields,function(dataValue){"blob"===dataValue.type?(WM.element(element).find("[name="+dataValue.key+"]").val(""),dataValue.href="",dataValue.value=null):dataValue.value=void 0}):element.find('[data-role="form-field"]').each(function(){WM.element(this).isolateScope().datavalue=void 0}),$s.formdata=void 0,$s.dataoutput={},$rootScope.$safeApply($s)}function onResult(scope,data,status,event){Utils.triggerFn(scope.onResult,{$event:event,$isolateScope:scope,$data:data}),"success"===status?Utils.triggerFn(scope.onSuccess,{$event:event,$isolateScope:scope,$data:data}):Utils.triggerFn(scope.onError,{$event:event,$isolateScope:scope,$data:data})}function toggleMessage(scope,msg,type){msg&&$rootScope.$evalAsync(function(){"Inline"===scope.messagelayout?scope.statusMessage={caption:msg||"",type:type}:wmToaster.show(type,type.toUpperCase(),msg,void 0,"trustedHtml")})}function getFormVariable(scope,element){return scope.binddataset&&_.includes(scope.binddataset,"bind:Variables.")?scope.formVariable=Utils.getVariableNameFromExpr(scope.binddataset):scope.dataset&&(scope.formVariable=scope.dataset),element.scope().Variables[scope.formVariable]}function constructDataObject(scope,element){var formData={},formVariable=getFormVariable(scope,element);return _.forEach(scope.elScope.formFields,function(field){var fieldName,fieldTarget;fieldTarget=_.split(field.key||field.target,"."),fieldName=fieldTarget[0]||field.key||field.name,1===fieldTarget.length?formData[fieldName]=field.value:formVariable&&"wm.Variable"===formVariable.category?formData[fieldTarget[1]]=field.value:(formData[fieldTarget[0]]=formData[fieldTarget[0]]||{},formData[fieldTarget[0]][fieldTarget[1]]=field.value)}),scope.dataoutput=formData,formData}function submitForm(scope,element,event){var params,template,formData,formVariable=getFormVariable(scope,element);resetFormState(scope),formData=scope.constructDataObject(),LiveWidgetUtils.setFormWidgetsValues(element,formData),params={$event:event,
$scope:scope,$formData:formData},scope.onBeforesubmit&&scope.onBeforesubmit(params)===!1||(scope.onSubmit||formVariable)&&(formVariable?"wm.ServiceVariable"===formVariable.category?(formVariable.setInput(formData),formVariable.update({skipNotification:!0},function(data){toggleMessage(scope,scope.postmessage,"success"),onResult(scope,data,"success",event),Utils.triggerFn(scope.onSubmit,params),LiveWidgetUtils.closeDialog(element)},function(errMsg){template=scope.errormessage||errMsg,toggleMessage(scope,template,"error"),onResult(scope,errMsg,"error",event),Utils.triggerFn(scope.onSubmit,params)})):($timeout(function(){$rootScope.$emit("invoke-service",formVariable.name,{scope:scope})}),Utils.triggerFn(scope.onSubmit,params),LiveWidgetUtils.closeDialog(element)):(Utils.triggerFn(scope.onSubmit,params),LiveWidgetUtils.closeDialog(element)))}function bindEvents(scope,element){element.on("submit",function(event){submitForm(scope,element,event)}),element.bind("reset",function(){resetForm(scope,element)})}function clearMessage(scope){scope.statusMessage=void 0,$rootScope.$safeApply(scope)}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.form",["wm.base","wm.base.events.touch","wm.layouts.panel.defaults"]),notifyFor={captionsize:!0,novalidate:!0,autocomplete:!0,submitbutton:!0,resetbutton:!0,captionalign:!0,captionposition:!0,method:!0,action:!0,metadata:!0,formdata:!0},submitBtnTemplate='<wm-button class="form-submit" type="submit" caption="submit"></wm-button>';return{restrict:"E",replace:!0,scope:{},transclude:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/layout/container/form.html"),link:{pre:function(scope,element,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,scope.elScope=element.scope().$new(),scope.elScope.formFields=[],scope.elScope.isUpdateMode=!0,scope.elScope.constructDataObject=scope.constructDataObject=constructDataObject.bind(void 0,scope,element),element.removeAttr("title")},post:function(scope,element,attrs){var handlers=[];scope.statusMessage=void 0,WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element,attrs),scope,notifyFor),scope.widgetid?handlers.push($rootScope.$on("compile-form-fields",function(event,scopeId,markup){if(markup&&scope.$id===scopeId){scope.elScope.formFields=void 0,element.find(".form-elements").empty(),element.find(".hidden-form-elements").empty();var markupObj=WM.element("<div>"+markup+"</div>");$rootScope.$emit("prepare-element",markupObj,function(){element.find(".form-elements").append(markupObj),$compile(markupObj)(scope)})}})):(bindEvents(scope,element),scope.resetForm=resetForm.bind(void 0,scope,element),scope.reset=resetForm.bind(void 0,scope,element),scope.submit=submitForm.bind(void 0,scope,element)),scope.clearMessage=clearMessage.bind(void 0,scope),scope.elScope.ngform=scope[scope.name],WidgetUtilService.postWidgetCreate(scope,element,attrs),scope.formWidgets=LiveWidgetUtils.getFormFilterWidgets(element),scope.$on("$destroy",function(){handlers.forEach(Utils.triggerFn)})}}}}]),WM.module("wm.layouts.containers").directive("wmLayoutgrid",["PropertiesFactory","WidgetUtilService","CONSTANTS","$rootScope","$compile","Utils",function(PropertiesFactory,WidgetUtilService,CONSTANTS,$rs,$compile,Utils){"use strict";function setDefaultColumnWidth($grid){var $gridRows;$gridRows=$grid.children(".app-grid-row"),$gridRows.each(function(){var defaultWidth,$row=WM.element(this),$columns=$row.children(".app-grid-column"),cols=[],totalColWidth=12;$columns.each(function(){var $col=WM.element(this),width=$col.attr("columnwidth");width?totalColWidth-=width:cols.push($col)}),cols.length&&(defaultWidth=parseInt(totalColWidth/cols.length,10),cols.forEach(function($col){$col.isolateScope().columnwidth=defaultWidth}))})}function propertyChangeHandler($s,$is,$el,key,nv){$is._isInitialized&&"columns"===key&&$rs.$emit("update-layoutgrid-columns",$is.widgetid,+nv,function(markup){$el.contents().remove(),$el.append(markup),$compile($el.contents())($s),setDefaultColumnWidth($el)})}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.layoutgrid"),notifyFor=CONSTANTS.isStudioMode?{columns:!0}:void 0;return{restrict:"E",replace:!0,scope:{},transclude:!0,template:'<div init-widget class="app-grid-layout clearfix" apply-styles="container" wmtransclude></div>',link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs){setDefaultColumnWidth($el),CONSTANTS.isStudioMode&&WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$el.scope(),$is,$el),$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]).directive("wmGridrow",["PropertiesFactory","WidgetUtilService",function(PropertiesFactory,WidgetUtilService){"use strict";function propertyChangeHandler(scope,key){switch(key){case"height":scope.overflow="auto"}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.gridrow"),notifyFor={height:!0};return{restrict:"E",replace:!0,scope:{},transclude:!0,template:'<div init-widget class="app-grid-row clearfix" apply-styles="container" wmtransclude></div>',link:{pre:function(scope){scope.widgetProps=widgetProps},post:function(scope,element,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]).directive("wmGridcolumn",["PropertiesFactory","WidgetUtilService","$rootScope",function(PropertiesFactory,WidgetUtilService,$rootScope){"use strict";function setColumnWidth(element,nv,ov){element.removeClass(prefix+ov).addClass(prefix+nv)}function propertyChangeHandler(element,key,newVal,oldVal){switch(key){case"columnwidth":setColumnWidth(element,newVal,oldVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.gridcolumn"),notifyFor={columnwidth:!0},prefix=$rootScope.isMobileApplicationType?"col-xs-":"col-sm-";return{restrict:"E",replace:!0,scope:{},transclude:!0,template:'<div init-widget class="app-grid-column" apply-styles="container"><div class="app-ng-transclude" wmtransclude></div></div>',link:{pre:function(scope,element,attrs){scope.widgetProps=widgetProps,attrs.columnwidth&&setColumnWidth(element,attrs.columnwidth)},post:function(scope,element,attrs){"hide"===attrs.show&&element.addClass(attrs.show),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.layouts.containers").directive("wmList",["PropertiesFactory","WidgetUtilService",function(PropertiesFactory,WidgetUtilService){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.list");return{restrict:"E",replace:!0,scope:{},transclude:!0,template:'<ul class="app-list" ng-class="[layout]" apply-styles="container" data-element-type="wmList" wmtransclude init-widget></ul>',link:{pre:function(scope){scope.widgetProps=widgetProps},post:function(scope,element,attrs){WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]).directive("wmListItem",["PropertiesFactory","WidgetUtilService",function(PropertiesFactory,WidgetUtilService){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.listitem");return{restrict:"E",replace:!0,scope:{},transclude:!0,template:'<li init-widget class="app-list-item" apply-styles="container" wmtransclude></li>',link:{pre:function(scope){scope.widgetProps=widgetProps},post:function(scope,element,attrs){WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.layouts.containers").directive("wmBreadcrumb",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";function getNodes(scope,newVal){var nodes=[];return WM.isString(newVal)?(newVal=newVal.trim(),newVal&&(nodes=newVal.split(",").map(function(item){return{label:item&&item.trim()}}))):WM.isArray(newVal)?_.forEach(newVal,function(item){nodes.push({label:WidgetUtilService.getEvaluatedData(scope,item,{expressionName:"itemlabel"})||item.label,icon:WidgetUtilService.getEvaluatedData(scope,item,{expressionName:"itemicon"})||item.icon,link:WidgetUtilService.getEvaluatedData(scope,item,{expressionName:"itemlink"})||item.link})}):WM.isObject(newVal)&&(nodes=[{label:newVal[scope.itemlabel||"label"],icon:newVal[scope.itemicon||"icon"],link:newVal[scope.itemlink||"link"]}]),nodes}function propertyChangeHandler(scope,key,newVal){var dataset=scope.dataset||{};switch(key){case"scopedataset":case"dataset":dataset=newVal;case"itemicon":case"itemlabel":case"itemlink":scope.nodes=getNodes(scope,dataset.data||dataset)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.breadcrumb",["wm.containers","wm.tabbar.dataProps"]),notifyFor={dataset:!0,scopedataset:!0,itemicon:!0,itemlabel:!0,itemlink:!0};return{restrict:"E",replace:!0,scope:{scopedataset:"=?"},transclude:!0,template:'<ol class="breadcrumb app-breadcrumb" apply-styles data-element-type="wmBreadCrumb" init-widget listen-property="dataset"><li ng-repeat="item in nodes" ng-class="{\'active\':$last}"><i class="{{item.icon}}"></i> <a title="{{item.label}}" href="{{item.link}}" ng-if="!$last">{{item.label}}</a><label ng-if="$last">{{item.label}}</label></li></ol> ',link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){var onPropertyChange=propertyChangeHandler.bind(void 0,scope);WidgetUtilService.registerPropertyChangeListener(onPropertyChange,scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs),!attrs.widgetid&&attrs.scopedataset&&scope.$watch("scopedataset",function(newVal){onPropertyChange("scopedataset",newVal)},!0)}}}}]),WM.module("wm.layouts.containers").directive("wmNav",["Utils","PropertiesFactory","WidgetUtilService","$rootScope","$compile","$routeParams","CONSTANTS","FormWidgetUtils","$window",function(Utils,PropertiesFactory,WidgetUtilService,$rs,$compile,$routeParams,CONSTANTS,FormWidgetUtils,$window){"use strict";function getNodes($is,nv){var nodes=[];return WM.isString(nv)?(nv=_.trim(nv),nv&&(nodes=nv.split(",").map(function(item){return{label:_.trim(item)}}))):WM.isArray(nv)?(nv=FormWidgetUtils.getOrderedDataSet(nv,$is.orderby),nodes=nv):WM.isObject(nv)&&(nodes=[nv]),$is.newcolumns&&($is.newcolumns=!1,$is.itemlabel="",$is.itemchildren="",$is.itemicon="",$is.itemlink="",$rs.$emit("set-markup-attr",$is.widgetid,{itemlabel:$is.itemlabel,itemchildren:$is.itemchildren,itemicon:$is.itemicon,itemlink:$is.itemlink})),$is.widgetid&&nv&&($is.keys=WidgetUtilService.updatePropertyPanelOptions($is).terminals),nodes}function constructNav($el,$is){if($el.empty(),$is._nodes=[],$is.nodes&&$is.nodes.length){var iconField=$is.itemicon||"icon",labelField=$is.itemlabel||"label",itemField=$is.itemlink||"link",badgeField=$is.itembadge||"badge",childrenField=$is.itemchildren||"children",actionField=$is.itemaction||"action";$is.nodes=$is.nodes.reduce(function(result,node,index){if(Utils.validateAccessRoles(node[$is.userrole||"role"])){result.push(node);var $menu,routeRegex,$a=WM.element('<a class="app-anchor"></a>'),$a_caption=WM.element('<span class="anchor-caption"></span>'),$li=WM.element('<li class="app-nav-item"></li>').data("node-data",node),$i=WM.element('<i class="app-nav-icon"></i>'),$badge=WM.element('<span class="badge"></span>'),itemLabel=node[labelField],itemClass=node[iconField],itemLink=node[itemField],itemBadge=node[badgeField],itemAction=node[actionField],itemChildren=node[childrenField];$is._nodes.push(node[childrenField]),routeRegex=new RegExp("^(#/|#)"+$routeParams.name+"$"),itemLink&&routeRegex.test(itemLink)&&$li.addClass("active"),itemChildren&&WM.isArray(itemChildren)?($menu=WM.element("<wm-menu>"),$menu.attr({caption:itemLabel,dataset:"bind:_nodes["+index+"]",itemlabel:labelField,itemlink:itemField,itemaction:itemAction,itemicon:iconField,itemchildren:childrenField,type:"anchor",iconclass:itemClass||"","on-select":"_onMenuItemSelect($event, $item)",autoclose:$is.autoclose}),$li.append($menu),$el.append($li)):($i.addClass(itemClass),$a.append($a_caption.html(itemLabel)).prepend($i),itemBadge&&$a.append($badge.html(itemBadge)),$li.append($a),$el.append($li))}return result},[]),$compile($el.contents())($is)}}function propertyChangeHandler($s,$is,$el,key,nv){var variable;switch(key){case"dataset":variable=$s.Variables[Utils.getVariableName($is,$s)],variable&&"wm.LiveVariable"===variable.category&&(nv=nv.data);case"scopedataset":$is.nodes=getNodes($is,nv),constructNav($el,$is),$is.widgetid&&$rs.$emit("nav-dataset-modified",{widgetName:$is.name});break;case"itemicon":case"itemlabel":case"itemlink":case"itemchildren":case"orderby":constructNav($el,$is)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.nav",["wm.containers"]),notifyFor={dataset:!0,scopedataset:!0,itemicon:!0,itemlabel:!0,itemlink:!0,itemchildren:!0,orderby:!0};return{restrict:"E",replace:!0,scope:{scopedataset:"=?"},transclude:!0,template:function(tEl,tAttrs){var cls;if(CONSTANTS.isRunMode){switch(cls='class = "nav app-nav ',tAttrs.type){case"pills":cls+="nav-pills";break;case"tabs":cls+="nav-tabs";break;case"navbar":cls+="navbar-nav"}tAttrs.layout&&(cls+=" nav-"+tAttrs.layout),cls+='"'}else cls="class=\"nav app-nav\" ng-class=\"{'nav-pills': type === 'pills','nav-tabs': type === 'tabs','navbar-nav': type === 'navbar','nav-stacked': layout === 'stacked','nav-justified': layout === 'justified'}\"";return'<ul apply-styles="container" data-element-type="wmNav" wmtransclude init-widget '+cls+"></ul>"},link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs){var onPropertyChange=propertyChangeHandler.bind(void 0,$el.scope(),$is,$el);WidgetUtilService.registerPropertyChangeListener(onPropertyChange,$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs),attrs.widgetid?$el.parent().closest("[widgetid]").is(".app-navbar")&&($is.widgetProps.type.show=!1,$is.widgetProps.layout.show=!1):(attrs.scopedataset&&$is.$watch("scopedataset",function(nv){onPropertyChange("scopedataset",nv)}),$el.on("click.on-select",".app-anchor",function(e){var itemLink,itemAction,$target=WM.element(this),$li=$target.closest(".app-nav-item");$li.closest("ul.app-nav").children("li.app-nav-item").removeClass("active"),$li.addClass("active"),$rs.$safeApply($is,function(){$is.selecteditem=$li.data("node-data"),Utils.triggerFn($is.onSelect,{$event:e,$scope:$is,$item:$is.selecteditem}),$is.selecteditem&&(itemLink=$is.selecteditem[$is.itemlink]||$is.selecteditem.link,itemAction=$is.selecteditem[$is.itemaction]||$is.selecteditem.action,itemAction?Utils.evalExp($el.scope(),itemAction).then(function(){itemLink&&($window.location.href=itemLink)}):itemLink&&($window.location.href=itemLink))})}),$is._onMenuItemSelect=function(e,$item){$is.selecteditem=$item,Utils.triggerFn($is.onSelect,{$event:e,$scope:$is,$item:$item})})}}}}]).directive("wmNavItem",["PropertiesFactory","WidgetUtilService","Utils","$routeParams",function(PropertiesFactory,WidgetUtilService,Utils,$routeParams){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.navitem",["wm.base"]);return{restrict:"E",replace:!0,scope:{},transclude:!0,template:'<li init-widget listen-property="dataset" class="app-nav-item" apply-styles="container" wmtransclude></li>',link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs){var firstChild=$el.children().first();firstChild.length&&firstChild.hasClass("app-anchor")&&$routeParams.name===(firstChild[0].hash&&firstChild[0].hash.substring(2))&&$el.addClass("active"),WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]),WM.module("wm.layouts.containers").directive("wmNavbar",["PropertiesFactory","WidgetUtilService","Utils","$timeout",function(PropertiesFactory,WidgetUtilService,Utils,$timeout){"use strict";function propertyChangeHandler(scope,key,newVal){switch(key){case"imgsrc":scope.imagesrc=Utils.getImageUrl(newVal)}}function toggleNavCollapse(element){element.toggleClass("in")}function delayToggleNavCollapse(element){$timeout(function(){toggleNavCollapse(element)},500)}function toggleCollapse(element){element.animate({height:"toggle"}),element.hasClass("in")?delayToggleNavCollapse(element):toggleNavCollapse(element)}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.navbar",["wm.base"]),notifyFor={imgsrc:!0};return{restrict:"E",replace:!0,scope:{},transclude:!0,template:'<nav class="navbar navbar-default app-navbar" apply-styles="container" data-element-type="wmNavbar" init-widget><div class="container-fluid"><div class="navbar-header"> <button type="button" class="btn-transparent navbar-toggle collapsed" data-toggle="collapse" ng-click="toggleCollapse()"><span class="sr-only">Toggle navigation</span><i class="{{menuiconclass}}"></i></button><a class="navbar-brand" href="#/" ng-if="title || imagesrc"><img data-identifier="img" class="brand-image" alt="{{title}}" height="20" ng-if="imgsrc" ng-src="{{imagesrc}}"/> <span class="title">{{title}}</span></a></div><div class="collapse navbar-collapse" id="collapse-content" wmtransclude></div></div></nav> ',link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){var collapseContent=element.children().find("> #collapse-content");WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope),scope,notifyFor),scope.toggleCollapse=toggleCollapse.bind(void 0,collapseContent),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.layouts.containers").run(["$templateCache",function($tc){"use strict";$tc.put("template/layout/container/panel.html",'<div page-container init-widget listen-property="actions" class="app-panel panel" ng-class="[helpClass, {\'fullscreen\':fullscreen}]" apply-styles="shell" wm-navigable-element="true"><div class="panel-heading" ng-class="helpClass" ng-if="toggleHeader()"><h3 class="panel-title"><a href="javascript:void(0)" class="panel-toggle" ng-click="expandCollapsePanel()"><div class="pull-left"><i class="app-icon panel-icon {{iconclass}}" ng-if="iconclass && !iconurl"></i><img data-identifier="img" class="panel-image-icon" ng-src="{{iconsrc}}"  ng-if="iconurl" ng-style="{width:iconwidth ,height:iconheight, margin:iconmargin}"/></div><div class="pull-left"><div class="heading">{{title}}</div><div class="description">{{subheading}}</div></div></a><div class="panel-actions"><span ng-if="badgevalue" class="label label-{{badgetype}}">{{badgevalue}}</span><wm-menu type="anchor" class="panel-action" scopedataset="actions" iconclass="wi wi-more-vert" ng-if="actions" title="{{::$root.appLocale.LABEL_ACTIONS}}" on-select="onActionsclick({$item:$item})" datafield="{{datafield}}" itemlabel="{{binditemlabel || itemlabel}}" menuposition="down,left" itemicon="{{binditemicon || itemicon}}" itemaction="{{binditemaction || itemaction}}" userrole="{{binduserrole || userrole}}" itemlink="{{binditemlink || itemlink}}" itemchildren="{{binditemchildren || itemchildren}}"></wm-menu><button type="button" class="app-icon panel-action wi wi-question" title="{{::$root.appLocale.LABEL_HELP}}" ng-if="helptext" ng-click="toggleHelp()"></button><button type="button" class="app-icon wi panel-action" ng-if="collapsible" title="{{::$root.appLocale.LABEL_COLLAPSE}}/{{::$root.appLocale.LABEL_EXPAND}}" ng-class="expanded ? \'wi-minus\': \'wi-plus\'" ng-click="expandCollapsePanel($event);"></button><button type="button" class="app-icon wi panel-action" ng-if="enablefullscreen" title="{{::$root.appLocale.LABEL_FULLSCREEN}}/{{::$root.appLocale.LABEL_EXITFULLSCREEN}}" ng-class="fullscreen ? \'wi-fullscreen-exit\': \'wi-fullscreen\'" ng-click="toggleFullScreen($event);"></button><button type="button" class="app-icon wi panel-action wi-close" title="{{::$root.appLocale.LABEL_CLOSE}}" ng-if="closable" ng-click="closePanel();onClose({$event: $event, $scope: this})"></button></div></h3></div><div class="panel-content" ng-show="expanded"><div class="panel-body" ng-class="helpClass" wmtransclude page-container-target apply-styles="inner-shell"></div><aside class="panel-help-message" ng-class="helpClass"><h5 class="panel-help-header">{{::$root.appLocale.LABEL_HELP}}</h5><div class="panel-help-content" ng-bind-html="helptext"></div></aside></div></div>'),$tc.put("template/layout/container/panel-footer.html",'<div class="app-panel-footer panel-footer clearfix" ng-show="expanded" wmtransclude></div>')}]).directive("wmPanel",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";function toggleFullScreen(element,val,panelHeight){var inlineHeight,headerHeight=element.find(".panel-heading").outerHeight(),$footerEl=element.find(".panel-footer"),$contentEl=element.find(".panel-content"),vwHeight=WM.element(window).height();inlineHeight=val?$footerEl.length?vwHeight-($footerEl.outerHeight()+headerHeight):vwHeight-headerHeight:panelHeight||"",$contentEl.css("height",inlineHeight)}function toggleHeader($is){return $is.iconurl||$is.iconclass||$is.collapsible||$is.actions||$is.title||$is.subheading||$is.enablefullscreen}function propertyChangeHandler(scope,key,newVal){switch(key){case"actions":scope.itemlabel=scope.itemlabel||scope.displayfield;break;case"iconurl":scope.iconsrc=Utils.getImageUrl(newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.panel",["wm.base","wm.base.events.touch","wm.menu.dataProps","wm.layouts.panel.defaults"]),notifyFor={actions:!0,iconurl:!0};return{restrict:"E",replace:!0,scope:{},transclude:!0,template:function(tElement,tAttrs){var isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),template=WM.element(WidgetUtilService.getPreparedTemplate("template/layout/container/panel.html",tElement,tAttrs));return isWidgetInsideCanvas||tAttrs.hasOwnProperty("onEnterkeypress")&&template.attr("ng-keypress","onKeypress({$event: $event, $scope: this})"),template[0].outerHTML},controller:function(){this.registerFooter=function(footer){this.footer=footer}},compile:function($tEl){return{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,attrs.description&&!attrs.subheading&&($is.subheading=attrs.subheading=attrs.description,WM.element($tEl.context).attr("subheading",$is.subheading),delete attrs.description),!attrs.widgetid&&"true"===attrs.collapsible&&attrs.content&&"false"===attrs.expanded&&($is.$lazyLoad=_.noop),$el.removeAttr("title")},post:function($is,$el,attrs,panelCtrl){void 0===$is.expanded&&($is.expanded=!0),$is.expandCollapsePanel=function($event){$is.collapsible&&($is.expanded?$is.onCollapse&&$is.onCollapse({$event:$event,$scope:this}):$is.onExpand&&$is.onExpand({$event:$event,$scope:this}),Utils.triggerFn($is.$lazyLoad),$is.expanded=!$is.expanded,panelCtrl.footer&&(panelCtrl.footer.isolateScope().expanded=$is.expanded))},$is.toggleFullScreen=function($event){$is.enablefullscreen&&($is.fullscreen?$is.onExitfullscreen&&$is.onExitfullscreen({$event:$event,$scope:this}):$is.onFullscreen&&$is.onFullscreen({$event:$event,$scope:this}),$el.find(".ng-isolate-scope").each(function(){Utils.triggerFn(WM.element(this).isolateScope().redraw)}),$is.fullscreen=!$is.fullscreen),toggleFullScreen($el,$is.fullscreen,$is.height)},$is.toggleHelp=function(){$is.helpClass=$is.helpClass?null:"show-help"},$is.closePanel=function(){$is.show=!1},$is.toggleHeader=toggleHeader.bind(void 0,$is),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is),$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs),$is.widgetid||($is.onKeypress=function(args){var action=Utils.getActionFromKey(args.$event);"ENTER"===action&&$is.onEnterkeypress(args)}),panelCtrl.footer&&$el.append(panelCtrl.footer)}}}}}]).directive("wmPanelFooter",["$templateCache",function($tc){"use strict";return{restrict:"E",replace:!0,scope:{},transclude:!0,require:"^wmPanel",template:$tc.get("template/layout/container/panel-footer.html"),link:function($is,$el,attrs,panelCtrl){$is.expanded=!0,panelCtrl.registerFooter($el)}}}]),WM.module("wm.layouts.containers").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/container/card.html",'<div init-widget class="app-card card app-panel" listen-property="actions" apply-styles="shell"><div class="app-card-header panel-heading" ng-show="title || subheading || iconclass || iconurl || actions"><div class="app-card-avatar" ng-show="iconclass || iconurl"><i class="app-icon {{iconclass}}" ng-if="iconclass && !iconurl"></i><wm-picture shape="circle" picturesource="{{iconurl}}" ng-if="iconurl"></wm-picture></div><div class="app-card-header-text"><h4 class="card-heading">{{title}}</h4><h5 class="card-subheading text-muted">{{subheading}}</h5></div><div class="panel-actions"><wm-menu type="anchor" class="panel-action" scopedataset="actions" iconclass="wi wi-more-vert" ng-if="actions" title="{{::$root.appLocale.LABEL_ACTIONS}}" datafield="{{datafield}}" itemlabel="{{binditemlabel || itemlabel}}" menuposition="down,left" itemicon="{{binditemicon || itemicon}}" itemlink="{{binditemlink || itemlink}}" itemchildren="{{binditemchildren || itemchildren}}"></wm-menu></div></div><div class="app-card-image" ng-if="bindpicturesource || picturesource" ng-style="{\'height\':imageheight}"><wm-picture class="card-image" picturesource="{{picturesource}}"></wm-picture></div><div ng-transclude="content" apply-styles="inner-shell"></div><div ng-transclude="actions"></div><div ng-transclude="footer"></div></div>'),$templateCache.put("template/layout/container/card-content.html",'<div init-widget page-container class="app-card-content card-body card-block"><div page-container-target apply-styles="container" wmtransclude></div></div>'),$templateCache.put("template/layout/container/card-footer.html",'<div apply-styles="container" init-widget wmtransclude  class="app-card-footer text-muted card-footer"></div>'),$templateCache.put("template/layout/container/card-actions.html",'<div apply-styles="container" class="app-card-actions" init-widget wmtransclude ></div>')}]).directive("wmCard",["PropertiesFactory","WidgetUtilService","Utils","CONSTANTS",function(PropertiesFactory,WidgetUtilService,Utils,CONSTANTS){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.card",["wm.base","wm.base.events","wm.menu.dataProps"]);return{restrict:"E",replace:!0,scope:{},transclude:{content:"?wmCardContent",footer:"?wmCardFooter",actions:"?wmCardActions"},template:function(tElement,tAttrs){var template=WM.element(WidgetUtilService.getPreparedTemplate("template/layout/container/card.html",tElement,tAttrs));return template[0].outerHTML},controller:["$scope",function($s){this.register=function(name,ele){$s[name]=ele.isolateScope()}}],link:{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){void 0!==scope.title||scope.bindtitle||(scope.title=scope.heading||scope.bindheading),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]).directive("wmCardContent",["PropertiesFactory","$templateCache","WidgetUtilService","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.cardcontent",["wm.base","wm.layouts"]);return{restrict:"E",scope:{},transclude:!0,template:$templateCache.get("template/layout/container/card-content.html"),replace:!0,require:"^wmCard",link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs,controller){controller.register("content",$el),WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]).directive("wmCardActions",["PropertiesFactory","$templateCache","WidgetUtilService","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.cardactions",["wm.base"]);return{restrict:"E",scope:{},transclude:!0,template:$templateCache.get("template/layout/container/card-actions.html"),replace:!0,require:"^wmCard",link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs,controller){controller.register("action",$el),WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]).directive("wmCardFooter",["PropertiesFactory","$templateCache","WidgetUtilService","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.cardfooter",["wm.base"]);return{restrict:"E",scope:{},transclude:!0,template:$templateCache.get("template/layout/container/card-footer.html"),replace:!0,require:"^wmCard",link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs,controller){controller.register("footer",$el),WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]),WM.module("wm.layouts.containers").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/container/container.html",'<div page-container init-widget class="app-container" apply-styles="container" wmtransclude page-container-target></div>')}]).directive("wmContainer",["PropertiesFactory","WidgetUtilService","Utils","CONSTANTS",function(PropertiesFactory,WidgetUtilService,Utils,CONSTANTS){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.container",["wm.containers","wm.base.events.touch"]);return{restrict:"E",replace:!0,scope:{},transclude:!0,template:function(tElement,tAttrs){var isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),$template=WM.element(WidgetUtilService.getPreparedTemplate("template/layout/container/container.html",tElement,tAttrs));return isWidgetInsideCanvas||tAttrs.hasOwnProperty("onEnterkeypress")&&$template.attr("ng-keypress","onKeypress({$event: $event, $scope: this})"),$template[0].outerHTML},link:{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.postWidgetCreate(scope,element,attrs),scope.widgetid||(scope.onKeypress=function(args){var action=Utils.getActionFromKey(args.$event);"ENTER"===action&&scope.onEnterkeypress(args)})}}}}]),WM.module("wm.layouts.containers").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/tile/tile.html",'<div init-widget class="app-tile" apply-styles="container" ng-style="{width:width}" wm-navigable-element="true" wmtransclude></div>')}]).directive("wmTile",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.tile",["wm.containers","wm.base.events.touch"]);return{restrict:"E",replace:!0,scope:{},transclude:!0,template:function(tElement,tAttrs){var isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),$template=WM.element(WidgetUtilService.getPreparedTemplate("template/layout/tile/tile.html",tElement,tAttrs));return isWidgetInsideCanvas||tAttrs.hasOwnProperty("onEnterkeypress")&&$template.attr("ng-keypress","onKeypress({$event: $event, $scope: this})"),$template[0].outerHTML},link:{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.postWidgetCreate(scope,element,attrs),scope.widgetid||(scope.onKeypress=function(args){var action=Utils.getActionFromKey(args.$event);"ENTER"===action&&scope.onEnterkeypress(args)})}}}}]),WM.module("wm.layouts.containers").run(["$templateCache",function($templateCache){
"use strict";$templateCache.put("template/layout/container/tabs.html",'<div class="app-tabs clearfix" init-widget apply-styles="container" tabindex="-1"><ul class="nav nav-tabs" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}"></ul><div class="tab-content" ng-class="{\'tab-stacked\': vertical, \'tab-justified\': justified}" wmtransclude hm-swipe-left="_onSwipeLeft();" hm-swipe-right="_onSwipeRight()"></div></div>'),$templateCache.put("template/layout/container/tab-pane.html",'<div class="tab-pane" page-container init-widget ng-class="{disabled: isDisabled, active: isActive}" wm-navigable-element="true"><div class="tab-body" apply-styles="container" page-container-target wmtransclude></div></div>')}]).directive("wmTabs",["PropertiesFactory","$templateCache","WidgetUtilService","Utils","CONSTANTS","$rootScope","$compile","$timeout",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils,CONSTANTS,$rootScope,$compile,$timeout){"use strict";function propertyChangeHandler(scope,key,newVal){switch(key){case"tabsposition":scope.setTabsPosition(newVal);break;case"defaultpaneindex":scope.activeTab||(scope.activeTab=scope.tabs[newVal||0]),scope.selectTab(scope.activeTab,!1,!0)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.tabs",["wm.base"]),notifyFor={tabsposition:!0,defaultpaneindex:!0};return{restrict:"E",scope:{},replace:!0,transclude:!0,template:$templateCache.get("template/layout/container/tabs.html"),controller:function($scope,$element){var $tabHeaderTarget=$element.find("> .nav.nav-tabs");$scope.tabs=[],this.tabIndex=0,this.register=function(tabScope){$scope.tabs.push(tabScope)},this.registerHeader=function(tabScope){tabScope.tabId=this.tabIndex,tabScope._headerElement.attr("data-tab-id",this.tabIndex),$tabHeaderTarget.append(tabScope._headerElement),$compile(tabScope._headerElement)(tabScope),this.tabIndex++},this.unRegisterHeader=function(tabScope){$tabHeaderTarget.find("[data-tab-id="+tabScope.tabId+"]").remove()},this.unregister=function(tab){var i,len=$scope.tabs.length;for(i=0;i<len&&$scope.tabs[i].$id!==tab.$id;i++);$scope.tabs.splice(i,1),$element.find('[data-tab-id="'+tab.widgetid+'"]').remove()},this.selectTab=function(tab,skipOnSelect,skipActiveWidget){var i,_tab=$scope.activeTab,tabs=$scope.tabs;for(_tab&&(Utils.triggerFn(_tab.onDeselect),_tab.isActive=!1),$scope.activeTab=tab,tab.isActive=!0,i=0;i<tabs.length;i++)if($scope.activeTab.$id===tabs[i].$id){$scope.activeTabIndex=i;break}skipOnSelect||Utils.triggerFn(tab.onSelect),tab&&tab._animateIn($element.hasClass("has-transition")),CONSTANTS.isStudioMode&&!skipActiveWidget&&$rootScope.$emit("set-active-widget",tab.widgetid),Utils.triggerFn(tab.$lazyLoad)},$scope.selectTab=this.selectTab},link:{pre:function(scope,element,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,!CONSTANTS.isRunMode||!attrs.transition||"none"===attrs.transition||attrs.tabsposition&&"top"!==attrs.tabsposition&&"bottom"!==attrs.tabsposition||element.addClass("has-transition"),CONSTANTS.isStudioMode&&(scope._select=function(el){el.selectedIndex&&$rootScope.$safeApply($rootScope,function(){WM.element(el).children().eq(el.selectedIndex).scope().select()})},element.append('<select class=tabs-list onchange="WM.element(this).scope()._select(this)" title="Select a Tab"><option hidden></option></select>'))},post:function(scope,element,attrs){function selectTab(tab,onBeforeSwitchTab){Utils.triggerFn(onBeforeSwitchTab),tab&&tab.select()}function _scrollHeader(delta){var left=$ul[0].scrollLeft,_delta=-1*delta;$ul.animate({scrollLeft:left+_delta},{duration:10})}var activeTab,tab,$li,tabs=scope.tabs,$ul=element.find("> ul");tabs.forEach(function(tab){activeTab?tab.isActive=!1:tab.isdefaulttab&&!attrs.defaultpaneindex&&(activeTab=tab,activeTab.isActive=!0)}),scope.activeTab=activeTab,scope.next=function(onBeforeSwitchTab){selectTab(tabs[scope.activeTabIndex+1],onBeforeSwitchTab)},scope.previous=function(onBeforeSwitchTab){selectTab(tabs[scope.activeTabIndex-1],onBeforeSwitchTab)},scope.goToTab=function(tabNum,onBeforeSwitchTab){WM.isNumber(tabNum)&&tabNum>0&&tabNum<=tabs.length&&(tab=tabs[tabNum-1],selectTab(tab,onBeforeSwitchTab))},scope.setTabsPosition=function(tabsposition){var _tabs=element.find(">ul.nav-tabs");element.removeClass("inverted"),"bottom"===tabsposition||"right"===tabsposition?(element.addClass("inverted"),element.append(_tabs)):element.prepend(_tabs),scope.vertical="left"===tabsposition||"right"===tabsposition},CONSTANTS.isRunMode&&(scope.transition&&"none"!==scope.transition&&(scope._onSwipeLeft=function(){selectTab(tabs[scope.activeTabIndex+1])},scope._onSwipeRight=function(){selectTab(tabs[scope.activeTabIndex-1])}),$timeout(function(){$li=$ul.children(),$li.last().position().left>$ul.width()&&$ul.on("mousewheel",function(e){e.stopPropagation(),e.preventDefault(),_scrollHeader(e.originalEvent.wheelDelta)})})),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs),scope.setTabsPosition(attrs.tabsposition||("true"===attrs.vertical?"left":"top"))}}}}]).directive("wmTabpane",["PropertiesFactory","$templateCache","WidgetUtilService","Utils","$rootScope","CONSTANTS","$compile",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils,$rs,CONSTANTS,$compile){"use strict";function propertyChangeHandler(scope,key,newVal){switch(key){case"disabled":scope.isDisabled=newVal}}var $opt,widgetProps=PropertiesFactory.getPropertiesOf("wm.tabpane",["wm.base","wm.layouts"]),$headerEle='<li class="tab-header" ng-class="{active: isActive, disabled: isDisabled}" ng-show="show" ng-click="select($event)" role="tab" tabindex="-1" hm-swipe-left="_onHeaderSwipeLeft($event);" hm-swipe-right="_onHeaderSwipeRight($event);"><a href="javascript:void(0);" role="button" tabindex="0"><div class="tab-heading"><i class="app-icon {{paneicon}}" ng-if="paneicon"></i> <span ng-bind="title"></span><span ng-if="badgevalue" class="label label-{{badgetype}}">{{badgevalue}}</span></div></a></li>',notifyFor={disabled:CONSTANTS.isRunMode};return{restrict:"E",scope:{},replace:!0,require:"^wmTabs",transclude:!0,template:$templateCache.get("template/layout/container/tab-pane.html"),compile:function(){return{pre:function(scope,element,attrs){attrs.heading&&!attrs.title&&(attrs.title=attrs.heading),scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,scope.$lazyLoad=WM.noop},post:function(scope,element,attrs,ctrl){function _scrollHeader(delta){var $ul=element.parent(),left=$ul[0].scrollLeft,_delta=-2*delta;$ul.animate({scrollLeft:left+_delta},{duration:10})}var parentScope=element.closest(".app-tabs").isolateScope();void 0!==scope.title||scope.bindtitle||(scope.title=scope.heading||scope.bindheading),scope._headerElement=WM.element($headerEle),ctrl.registerHeader(scope),ctrl.register(scope),scope.$on("$destroy",function(){ctrl.unRegisterHeader(scope),ctrl.unregister(scope)}),scope.select=function($event){return $event&&($event.stopPropagation(),$event.preventDefault()),scope.isActive||scope.disabled&&CONSTANTS.isRunMode?void(scope.isActive&&$rs.$emit("set-active-widget",scope.widgetid)):(element.find(".ng-isolate-scope").each(function(){Utils.triggerFn(WM.element(this).isolateScope().redraw)}),scope.isActive=!0,CONSTANTS.isRunMode&&parentScope.onChange&&parentScope.onChange({$event:$event,$scope:parentScope,newPaneIndex:scope.tabId,oldPaneIndex:parentScope.activeTab.tabId||0}),void ctrl.selectTab(scope))},scope._animateIn=function(hasTransition){var delta,ul,$prevHeaderEle,index=element.index(),$parent=element.parent();hasTransition?(delta=index*$parent.width(),$parent.animate({scrollLeft:delta},{duration:"fast",start:function(){element.addClass("active")},complete:function(){element.siblings(".active").removeClass("active")}})):(element.siblings(".active").removeClass("active"),element.addClass("active")),ul=scope._headerElement.parent()[0],scope.tabId?($prevHeaderEle=scope._headerElement.prev(),$prevHeaderEle.length&&(ul.scrollLeft=$prevHeaderEle[0].offsetLeft)):ul.scrollLeft=0},CONSTANTS.isRunMode?(scope._onHeaderSwipeLeft=function(e){_scrollHeader(e.deltaX)},scope._onHeaderSwipeRight=function(e){_scrollHeader(e.deltaX)}):($opt=WM.element('<option ng-bind-html="title"></option>'),$opt=$compile($opt)(scope),element.closest(".app-tabs").children("select").append($opt),scope.$on("$destroy",function(){$opt&&$opt.remove()})),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.layouts.containers").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/container/wizard.html",'<div class="app-wizard panel clearfix" init-widget apply-styles="shell"><div class="app-wizard-heading"><ul class="app-wizard-steps nav nav-pills {{stepClass}}"></ul></div><div class="app-wizard-body panel-body" apply-styles="inner-shell"><wm-message scopedataset="message"></wm-message><div wmtransclude></div></div><div class="app-wizard-actions panel-footer"><a class="app-wizard-skip" name="skipStep_{{name}}" ng-if="currentStep.enableskip" title="Skip step" ng-click="skip()">Skip &raquo;</a><div class="app-wizard-actions-right"><button type="button" name="cancelBtn_{{name}}" class="btn app-button btn-secondary" ng-if="cancelable" ng-click="cancel()" title="{{cancelbtnlabel}}">{{cancelbtnlabel}}</button><button type="button" name="previousBtn_{{name}}" class="btn app-button btn-secondary" ng-if="steps.indexOf(currentStep) > 0" ng-click="prev()"><i class="app-icon wi wi-chevron-left"></i><span class="btn-caption">{{previousbtnlabel}}</span></button><button type="button" name="nextBtn_{{name}}" class="btn app-button btn-primary" ng-if="steps.indexOf(currentStep) !== steps.length - 1" ng-click="next()" ng-disabled="currentStep.disablenext || currentStep.isFormInvalid"><span class="btn-caption">{{nextbtnlabel}}</span><i class="app-icon wi wi-chevron-right"></i></button><button type="button" name="doneBtn_{{name}}" class="btn app-button btn-success" ng-if="(steps.indexOf(currentStep) === steps.length - 1) || currentStep.enabledone" ng-click="done()" ng-disabled="currentStep.isFormInvalid"><i class="app-icon wi wi-done"></i><span class="btn-caption">{{donebtnlabel}}</span></button></div></div></div>'),$templateCache.put("template/layout/container/wizard-step.html",'<form init-widget wmtransclude class="app-wizard-step-content" ng-class="{\'current\': status === \'CURRENT\'}" data-step-id="{{stepIndex}}"></form>')}]).directive("wmWizard",["PropertiesFactory","$templateCache","WidgetUtilService","$compile","CONSTANTS","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,$compile,CONSTANTS,Utils){"use strict";function propertyChangeHandler($s,key,newVal,oldVal){switch(key){case"stepstyle":$s.stepClass=newVal&&"justified"===newVal?"nav-justified":""}}function navigateToStep($is,stepIndex){$is.currentStep=$is.steps[stepIndex],$is.currentStep.status=STEP_STATUS.CURRENT}var widgetProps=PropertiesFactory.getPropertiesOf("wm.wizard",["wm.base","wm.layouts","wm.containers"]),STEP_STATUS={COMPLETED:"COMPLETED",CURRENT:"CURRENT",DISABLED:"DISABLED"},notifyFor={stepstyle:!0};return{restrict:"E",scope:{onDone:"&",onCancel:"&"},replace:!0,transclude:!0,template:$templateCache.get("template/layout/container/wizard.html"),controller:["$scope","$element",function($is,$element){var stepHeaderTarget=$element.find(".app-wizard-steps");$is.steps=[],this.dataStepId=0,this.register=function(stepScope){$is.steps.push(stepScope)},this.registerStepHeader=function(stepScope){stepScope.stepIndex=this.dataStepId,stepScope._headerElement.attr("data-step-id",this.dataStepId),stepHeaderTarget.append(stepScope._headerElement),$compile(stepScope._headerElement)(stepScope),this.dataStepId++},this.unRegisterHeaderElement=function(stepScope){stepHeaderTarget.find('[data-step-id="'+stepScope.stepIndex+'"]').remove(),$is.steps.splice(stepScope.stepIndex,1),$is.steps.length&&($is.currentStep=$is.steps[0],$is.currentStep.status=STEP_STATUS.CURRENT)},CONSTANTS.isRunMode&&($is.next=function(){var params={$isolateScope:$is,currentStep:$is.currentStep,stepIndex:$is.currentStep.stepIndex};$is.currentStep.onNext&&$is.currentStep.onNext(params)===!1||($is.currentStep.status=STEP_STATUS.COMPLETED,navigateToStep($is,$is.currentStep.stepIndex+1))},$is.prev=function(){var params;$is.currentStep.onPrev&&(params={$isolateScope:$is,currentStep:$is.currentStep,stepIndex:$is.currentStep.stepIndex},$is.currentStep.onPrev(params)===!1)||($is.currentStep.status=STEP_STATUS.DISABLED,navigateToStep($is,$is.currentStep.stepIndex-1))},$is.skip=function(){var params;$is.currentStep.onSkip&&(params={$isolateScope:$is,currentStep:$is.currentStep,stepIndex:$is.currentStep.stepIndex},$is.currentStep.onSkip(params)===!1)||$is.currentStep.stepIndex+1<$is.steps.length&&($is.currentStep.status=STEP_STATUS.COMPLETED,navigateToStep($is,$is.currentStep.stepIndex+1))},$is.done=function(){var params;$is.onDone&&(params={$isolateScope:$is,steps:$is.steps},$is.onDone(params)===!1)},$is.cancel=function(){var params;$is.onCancel&&(params={$isolateScope:$is,steps:$is.steps},$is.onCancel(params)===!1)})}],link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,element,attrs){$is.currentStep=$is.steps[0],$is.currentStep.status=STEP_STATUS.CURRENT,WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is),$is,notifyFor),WidgetUtilService.postWidgetCreate($is,element,attrs)}}}}]).directive("wmWizardstep",["PropertiesFactory","$templateCache","WidgetUtilService","CONSTANTS","$rootScope","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,CONSTANTS,$rs,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.wizardstep",["wm.base"]),STEP_STATUS={COMPLETED:"COMPLETED",CURRENT:"CURRENT",DISABLED:"DISABLED"},$headerElement='<li class="app-wizard-step" ng-class="{active: status === \'COMPLETED\', current: status === \'CURRENT\', disabled: status === \'DISABLED\'}"><a href="javascript:void(0)"><span class="arrow"></span><i class="app-icon {{iconclass}}" ng-if="iconclass"></i> <span class="step-title" ng-bind="title"></span></a></li>';return{restrict:"E",scope:{onNext:"&",onPrev:"&",onLoad:"&",onSkip:"&"},transclude:!0,template:$templateCache.get("template/layout/container/wizard-step.html"),replace:!0,require:"^wmWizard",link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs,ctrl){var $parentElement=$el.parent().closest(".app-wizard"),parentIs=$parentElement.isolateScope();$is._headerElement=WM.element($headerElement),$is._formElement=$el,$is.status=STEP_STATUS.DISABLED,ctrl.registerStepHeader($is),ctrl.register($is),CONSTANTS.isStudioMode?$is.$on("$destroy",function(){ctrl.unRegisterHeaderElement($is)}):$is.$watch($is.name+".$valid",function(newVal){$is.isFormInvalid=!newVal}),$is.$watch("status",function(nv){nv===STEP_STATUS.CURRENT&&(CONSTANTS.isRunMode&&$is.onLoad&&$is.onLoad({$isolateScope:$is}),$el.find(".ng-isolate-scope").each(function(){Utils.triggerFn(WM.element(this).isolateScope().redraw)}))}),$parentElement.on("click",".app-wizard-step",function(event){event.stopPropagation();var $headerEles=$parentElement.find(".app-wizard-step"),currentStepId=WM.element(event.currentTarget).attr("data-step-id"),$stepPanes=$parentElement.find(".app-wizard-step-content"),$currentStepEle=$parentElement.find(".app-wizard-step-content[data-step-id="+currentStepId+"]"),currentStep=$currentStepEle.isolateScope(),widgetId=$currentStepEle.attr("widgetid");CONSTANTS.isStudioMode?(_.forEach($headerEles,function(headerEle){WM.element(headerEle).scope().status=STEP_STATUS.DISABLED}),$stepPanes.removeClass("current"),$currentStepEle.addClass("current"),parentIs.currentStep=currentStep,currentStep.status=STEP_STATUS.CURRENT,$rs.$emit("set-active-widget",widgetId)):currentStep.status===STEP_STATUS.COMPLETED&&(_.forEach(parentIs.steps,function(step,index){step.status=index<currentStep.stepIndex?STEP_STATUS.COMPLETED:STEP_STATUS.DISABLED}),parentIs.currentStep=currentStep,parentIs.currentStep.status=STEP_STATUS.CURRENT),$rs.$safeApply($is)}),WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]),WM.module("wm.layouts.device").service("DeviceViewService",["Utils","$rootScope",function(Utils,$rootScope){"use strict";function roleSelector(roleName){return"[data-role='"+roleName+"']"}function classSelector(className){return"."+className}function getLeftPanelScope(){return WM.element(roleSelector(LEFT_PANEL_CLASS_NAME)).isolateScope()}function hidePageContainers(){var leftPanelScope=getLeftPanelScope();Utils.isMobile()&&(leftPanelScope&&leftPanelScope.collapse(),WM.element(roleSelector(HEADER_CLASS_NAME)+" "+classSelector(SEARCH_CONTAINER_CLASS_NAME)).hide(),$rootScope.sidebarCollapsed=!0)}function bindTapEvtHandler(selector,handler){WM.element(selector).off("click.deviewview").on("click.deviewview",handler)}function toggleSearchContainer(ele){var searchEle=WM.element(ele);"none"===searchEle.css("display")?(hidePageContainers(),searchEle.css("display","inline-table")):hidePageContainers()}function bindLeftPanelEvents(){bindTapEvtHandler(roleSelector(SWIPE_ELEM_CLASS_NAME),function(){var leftPanelEl,leftPanel=getLeftPanelScope(),searchEl=WM.element(roleSelector(HEADER_CLASS_NAME)+" "+classSelector(SEARCH_CONTAINER_CLASS_NAME));leftPanel&&leftPanel.toggle(),leftPanelEl=WM.element(roleSelector(LEFT_PANEL_CLASS_NAME)),leftPanelEl.length&&leftPanelEl.hasClass("visible")&&searchEl.length&&searchEl.hide()})}function bindSearchIconEvent(searchElements){WM.forEach(searchElements,function(ele){var searchEle=WM.element('<a class="app-header-action wi wi-search"></a>');WM.element(ele).before(searchEle),bindTapEvtHandler(searchEle,function(){toggleSearchContainer(ele)})})}function bindContentEvents(){bindTapEvtHandler(classSelector(CONTENT_CLASS_NAME),hidePageContainers)}function bindRightPanelEvents(){bindTapEvtHandler(roleSelector(RIGHT_PANEL_CLASS_NAME),hidePageContainers)}var LEFT_PANEL_CLASS_NAME="page-left-panel",RIGHT_PANEL_CLASS_NAME="page-right-panel",SWIPE_ELEM_CLASS_NAME="page-left-panel-icon",SEARCH_CONTAINER_CLASS_NAME="app-search",CONTENT_CLASS_NAME="app-content-column",HEADER_CLASS_NAME="page-header";return{update:function(element,hasLeftNav,hasRightNav,searchElements){bindContentEvents(),hasLeftNav?bindLeftPanelEvents():element.find(roleSelector(SWIPE_ELEM_CLASS_NAME)).remove(),hasRightNav&&bindRightPanelEvents(),searchElements&&bindSearchIconEvent(searchElements)}}}]),WM.module("wm.layouts.page").service("ViewService",[function(){"use strict";var viewsScope=[],hideActiveView=function(viewGroup){var i;for(i=0;i<viewsScope.length;i+=1)viewsScope[i].show&&viewsScope[i].viewgroup===viewGroup&&(viewsScope[i].show=!1)},goToView=function(viewGroup,viewName){var i;for(i=0;i<viewsScope.length;i+=1)if(viewsScope[i].viewgroup===viewGroup&&viewsScope[i].name===viewName){hideActiveView(viewGroup),viewsScope[i].show=!0,viewsScope[i].initialize();break}},registerView=function(scope){viewsScope.push(scope)},unregisterView=function(scope){viewsScope.splice(viewsScope.indexOf(scope),1)},showView=function(name){var i,view=WM.element("[name="+name+"]"),parentViews=view.parents(".app-view");for(i=0;i<parentViews.length;i+=1)goToView(parentViews.attr("viewgroup")||"default",parentViews.attr("name"));view.length>0&&goToView(view.isolateScope().viewgroup,name)},hideView=function(name){hideActiveView(WM.element("[name="+name+"]").isolateScope().viewgroup)},getViews=function(){return viewsScope},clearViews=function(){viewsScope=[]};return{registerView:registerView,unregisterView:unregisterView,hideView:hideView,showView:showView,getViews:getViews,clearViews:clearViews}}]),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/page/column.html",'<div init-widget class="app-column" apply-styles="container"><div class="app-ng-transclude" wmtransclude></div></div>')}]).directive("wmColumn",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";function propertyChangeHandler(element,key,newVal,oldVal){switch(key){case"columnwidth":element.removeClass("col-md-"+oldVal+" col-sm-"+oldVal).addClass("col-md-"+newVal+" col-sm-"+newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.column",["wm.layouts","wm.base.events.touch"]),notifyFor={columnwidth:!0};return{restrict:"E",replace:!0,scope:{},transclude:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/layout/page/column.html"),compile:function(){return{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.columnwidth&&WM.element(element).addClass("col-md-"+scope.columnwidth+" col-sm-"+scope.columnwidth),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/page/pagecontent.html",'<div init-widget class="app-page-content app-content-column" apply-styles="container"><div class="app-ng-transclude" wmtransclude></div></div>'),$templateCache.put("template/layout/page/pagecontent-loader.html",'<div class="app-page-content-loader"><div class="loader bg-primary"></div><div class="load-info"></div></div>')}]).directive("wmPageContent",["$route","$rootScope","$templateCache","$timeout","PropertiesFactory","WidgetUtilService","CONSTANTS","Utils",function($route,$rootScope,$templateCache,$timeout,PropertiesFactory,WidgetUtilService,CONSTANTS,Utils){"use strict";function propertyChangeHandler(element,key,newVal,oldVal){switch(key){case"columnwidth":element.removeClass("col-md-"+oldVal+" col-sm-"+oldVal).addClass("col-md-"+newVal+" col-sm-"+newVal)}}function waitForTransition($ele){var $spinnerEl,iScope=$ele.isolateScope();$ele.addClass("load"),$spinnerEl=WM.element($templateCache.get("template/layout/page/pagecontent-loader.html")),$spinnerEl.appendTo($ele),Utils.listenOnce($rootScope,"page-transition-end",function(){iScope.__load(),Utils.triggerFn($ele.scope().onPagePartLoad)}),Utils.listenOnce($rootScope,"page-startupdate-variables-loaded",function(){$timeout(function(){$spinnerEl.remove(),$ele.removeClass("load")},100)}),iScope.loadmode="after-select",Utils.triggerFn($ele.scope().registerPagePart)}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.pagecontent",["wm.layouts","wm.base.events.touch"]),notifyFor={columnwidth:!0};return{restrict:"E",replace:!0,scope:{},transclude:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/layout/page/pagecontent.html"),compile:function(){return{pre:function(scope,element){scope.widgetProps=widgetProps,CONSTANTS.isRunMode&&!$route.current.transitionCompleted&&waitForTransition(element)},post:function(scope,element,attrs){scope.columnwidth&&WM.element(element).addClass("col-md-"+scope.columnwidth+" col-sm-"+scope.columnwidth),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/page/content.html",'<main  data-role="page-content" init-widget class="app-content clearfix" apply-styles><div class="row app-content-row clearfix" wmtransclude></div></main>')}]).directive("wmContent",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.content",["wm.layouts","wm.base.events.touch"]);return{restrict:"E",replace:!0,transclude:!0,scope:{},template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/layout/page/content.html"),compile:function(){return{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/page/footer.html",'<footer data-role="page-footer" page-container page-container-target init-widget class="app-footer clearfix" apply-styles="container" wmtransclude></footer>')}]).directive("wmFooter",["PropertiesFactory","WidgetUtilService","CONSTANTS","Utils",function(PropertiesFactory,WidgetUtilService,CONSTANTS,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.footer",["wm.layouts","wm.base.events.touch"]);return{restrict:"E",replace:!0,scope:{},transclude:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/layout/page/footer.html"),compile:function(){return{pre:function(iScope,element){CONSTANTS.isStudioMode?iScope.widgetProps=Utils.getClonedObject(widgetProps):(iScope.widgetProps=widgetProps,element.scope().layout.footer=!0)},post:function(scope,element,attrs){WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/page/header.html",'<header data-role="page-header"  page-container init-widget class="app-header clearfix" apply-styles="container"><div class="app-header-menu" data-role="page-left-panel-icon"><a class="app-header-action wi wi-menu"></a></div><div class="app-header-container" wmtransclude page-container-target></div></header>')}]).directive("wmHeader",["PropertiesFactory","WidgetUtilService","CONSTANTS","Utils",function(PropertiesFactory,WidgetUtilService,CONSTANTS,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.header",["wm.layouts","wm.base.events.touch"]);return{restrict:"E",replace:!0,scope:{},transclude:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/layout/page/header.html"),compile:function(){return{pre:function(iScope,element){CONSTANTS.isStudioMode?iScope.widgetProps=Utils.getClonedObject(widgetProps):(iScope.widgetProps=widgetProps,element.scope().layout.header=!0)},post:function(scope,element,attrs){WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/page/leftpanel.html",'<aside data-role="page-left-panel" page-container init-widget class="app-left-panel" hm-swipe-left="collapse();" data-ng-class="animation" apply-styles="container"><div class="app-ng-transclude" wmtransclude page-container-target></div></aside>')}]).directive("wmLeftPanel",["PropertiesFactory","WidgetUtilService","$rootScope","$timeout","CONSTANTS","Utils",function(PropertiesFactory,WidgetUtilService,$rootScope,$timeout,CONSTANTS,Utils){"use strict";function propertyChangeHandler(element,key,newVal,oldVal){switch(key){case"columnwidth":element.removeClass("col-md-"+oldVal+" col-sm-"+oldVal).addClass("col-md-"+newVal+" col-sm-"+newVal);break;case"animation":var appPage=element.closest(".app-page");"slide-in"===newVal?appPage.addClass("slide-in-left-panel-container"):appPage.removeClass("slide-in-left-panel-container")}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.leftpanel",["wm.layouts","wm.base.events.touch"]),notifyFor={columnwidth:!0,animation:!0};return{restrict:"E",replace:!0,scope:{},transclude:!0,template:function(tElement,tAttrs){var isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),template=WM.element(WidgetUtilService.getPreparedTemplate("template/layout/page/leftpanel.html",tElement,tAttrs));return isWidgetInsideCanvas||tAttrs.columnwidth||template.attr("columnwidth","2"),template[0].outerHTML},compile:function(){return{pre:function(iScope){CONSTANTS.isStudioMode?iScope.widgetProps=Utils.getClonedObject(widgetProps):iScope.widgetProps=widgetProps},post:function(scope,element,attrs){scope.columnwidth&&WM.element(element).addClass("col-md-"+scope.columnwidth+" col-sm-"+scope.columnwidth);var eventName="click.leftNavToggle";scope.toggle=function(){element.hasClass("visible")?scope.collapse():scope.expand()},scope.expand=function(){var appPage=element.closest(".app-page"),skipEvent=!0;element.addClass("visible"),"slide-in"===scope.animation&&appPage.addClass("slide-in-left-panel-container slide-left"),element.on(eventName,function(){skipEvent=!0}),appPage.addClass("left-panel-container"),appPage.on(eventName,function(){skipEvent||scope.collapse(),skipEvent=!1})},scope.collapse=function(){var appPage=element.closest(".app-page");appPage.removeClass("left-panel-container"),element.removeClass("visible"),element.off(eventName),appPage.off(eventName),"slide-in"===scope.animation&&(appPage.removeClass("slide-left"),$timeout(function(){appPage.removeClass("slide-in-left-panel-container")},600))},WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs),scope.collapse()}}}}}]),WM.module("wm.layouts.page").directive("wmPage",["DeviceViewService","CONSTANTS","$rootScope","$routeParams","Utils","$timeout","Variables","NavigationVariableService","$location",function(DeviceViewService,CONSTANTS,$rs,$routeParams,Utils,$timeout,Variables,NavigationVariableService,$location){"use strict";function updatePageTitle($s,$el,pageTitle){var expr,unregister;WM.isDefined(pageTitle)?_.startsWith(pageTitle,"bind:")?(expr=_.replace(pageTitle,"bind:",""),unregister=$s.$watch(expr,function(nv){WM.isDefined(nv)&&(document.title=nv)}),$s.$on("$destroy",unregister),$el.on("$destroy",unregister)):document.title=pageTitle:document.title=$rs.activePageName+" - "+$rs.projectName}var appVariableReadyFired=!1;return{restrict:"E",replace:!0,transclude:!0,template:'<div data-role="pageContainer" class="app-page container" wmtransclude no-animate></div>',link:{pre:function($s,$el,attrs){var pageName,variableScope,containerScope,count,subView,AppManager;pageName=$s.prefabname||$rs.isPrefabTemplate&&"Main"||attrs.ngController.replace("PageController",""),variableScope=!CONSTANTS.isStudioMode||$s.prefabname||$s.$parent.partialname?$s:$rs.domScope,CONSTANTS.isRunMode&&($s.Variables={},$s.Widgets={},$rs.pageParams=$s.pageParams=$location.search(),$rs._pageReady=!1,$s.$parent.partialname||$s.prefabname||($rs.Widgets=$s.Widgets,$rs.$activePageEl=$el),$s.$parent.partialname&&(containerScope=$s.$parent.Widgets&&$s.$parent.Widgets[$s.$parent.partialcontainername],containerScope&&(containerScope.Widgets=$s.Widgets)),$routeParams.name===$rs.activePageName&&updatePageTitle($s,$el,attrs.pagetitle)),CONSTANTS.isStudioMode&&(containerScope=$s.$parent.Widgets&&$s.$parent.Widgets[$s.$parent.partialcontainername],containerScope&&WM.isDefined(containerScope.Widgets)&&(containerScope.Widgets=$s.Widgets={})),!$s.registerPageContainer&&CONSTANTS.isRunMode&&(count=0,$s.layout={leftSection:!1,rightSection:!1,header:!1,footer:!1,search:!1},$s._onPageLoad=function(){count||($routeParams&&$routeParams.name&&(subView=$routeParams.name.split("."),subView.length>1&&NavigationVariableService.goToView(subView.pop())),$s.layout.search=$el.find('[data-role="page-header"] .app-search'),$s.layout.leftSection=$el.find('[data-role="page-left-panel"]').length>0,$s.layout.rightSection=$el.find('[data-role="page-right-panel"]').length>0,$timeout(function(){DeviceViewService.update($el,$s.layout.leftSection,$s.layout.rightSection,$s.layout.search),$rs.$$postDigest(function(){$rs._pageReady=!0,$rs.$emit("page-ready",pageName),
$s.hasOwnProperty("onPageReady")&&(Utils.triggerFn($s.onPageReady),$s.registerPagePart=$s.onPagePartLoad=_.noop),$rs.hasOwnProperty("onPageReady")&&Utils.triggerFn($rs.onPageReady,pageName,$s,$el)})}))},$s.registerPagePart=function(){count++},$s.onPagePartLoad=function(){--count,$s._onPageLoad()},WM.isFunction($s.handleRoute)&&$s.handleRoute.apply(void 0,_.values($routeParams).slice(1))),CONSTANTS.isRunMode&&!$s.prefabname&&(AppManager=Utils.getService("AppManager"),Variables.setPageVariables(pageName,AppManager.getPageContent(pageName,"variables"))),Variables.getPageVariables(pageName,function(variables){Variables.register(pageName,variables,!0,variableScope),containerScope&&(containerScope.Variables=$s.Variables),appVariableReadyFired||(Utils.triggerFn($rs.onAppVariablesReady,$rs.Variables),appVariableReadyFired=!0),Utils.triggerFn($s.onPageVariablesReady)})},post:function($s,$el,attrs){var handlers=[];CONSTANTS.isRunMode&&(handlers.push($rs.$on("on-sessionTimeout",$s.onSessionTimeout)),Utils.triggerFn($s._onPageLoad),$el.on("$destroy",function(){Variables.unload(attrs.ngController.replace("PageController",""),$s),handlers.forEach(Utils.triggerFn)}))}}}}]).directive("wmPartial",["CONSTANTS","$rootScope","Utils","Variables","$timeout",function(CONSTANTS,$rs,Utils,Variables,$timeout){"use strict";function triggerOnReady($s){$timeout(function(){$rs.$$postDigest(function(){$rs.$emit("partial-ready",$s),$s.hasOwnProperty("onPageReady")&&(Utils.triggerFn($s.onPageReady),$s.registerPagePart=$s.onPagePartLoad=_.noop),Utils.triggerFn($s.$parent.onPagePartLoad)})})}function setVariables($s,containerScope,variableScope,pageName){Variables.getPageVariables(pageName,function(variables){$s.partialname&&_.forEach(variables,function(value){value._partialname=$s.partialname}),Variables.register(pageName,variables,!0,variableScope),CONSTANTS.isRunMode&&containerScope&&(containerScope.Variables=$s.Variables)})}return{restrict:"E",replace:!0,transclude:!0,template:'<section data-role="partial" class="app-partial clearfix" wmtransclude></section>',link:{pre:function($s,$el,attrs){var pageName,variableScope,containerScope,hasLazyWidgets,count=0;pageName=attrs.ngController.replace("PageController",""),variableScope=!CONSTANTS.isStudioMode||$s.prefabname||$s.$parent.partialname?$s:$rs.domScope,CONSTANTS.isRunMode?($s.Widgets={},$s.Variables={},containerScope=$s.$parent.Widgets&&$s.$parent.Widgets[$s.$parent.partialcontainername],containerScope&&(containerScope.Widgets=$s.Widgets),$s.registerPagePart=function(){count++,hasLazyWidgets=!0},$s.onPagePartLoad=function(){--count,count||triggerOnReady($s)},$s._onPartialLoad=function(){hasLazyWidgets&&count||triggerOnReady($s)}):(containerScope=$s.$parent.Widgets&&$s.$parent.Widgets[$s.$parent.partialcontainername],containerScope&&WM.isDefined(containerScope.Widgets)&&(containerScope.Widgets=$s.Widgets={})),setVariables($s,containerScope,variableScope,pageName)},post:function($s,$el,attrs){var handlers=[];CONSTANTS.isRunMode&&(handlers.push($rs.$on("on-sessionTimeout",function(){Utils.triggerFn($s.onSessionTimeout)})),$s._onPartialLoad(),$el.on("$destroy",function(){Variables.unload(attrs.ngController.replace("PageController",""),$s),handlers.forEach(Utils.triggerFn)}))}}}}]),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/defaults/header.html","<h1>HEADER</h1>"),$templateCache.put("template/defaults/topnav.html",'<div class="navbar navbar-default"><div class="container-fluid"><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="#">ACTIVE</a></li><li><a href="#">LINK</a></li></ul></div></div></div>'),$templateCache.put("template/defaults/leftnav.html",'<ul class="nav app-nav nav-pills nav-stacked"><li class="active"><a href="#" class="active">Active</a></li><li><a href="#">Link</a></li></ul>'),$templateCache.put("template/defaults/rightnav.html",'<ul class="nav app-nav nav-pills nav-stacked"><li class="active"><a href="#" class="active">Active</a></li><li><a href="#">Link</a></li></ul>'),$templateCache.put("template/defaults/footer.html","<h3>FOOTER</h3>"),$templateCache.put("template/layouts/template.html",'<div data-role="template" class="app-template app-page container" init-widget><header data-role="page-header" class="app-header clearfix" wm-template-container="{{header}}"></header><section data-role="page-topnav" class="app-top-nav" wm-template-container="{{topnav}}"></section><main  data-role="page-content" class="app-content clearfix"><div class="row app-content-row clearfix"><aside data-role="page-left-panel" class="app-left-panel col-md-2 col-sm-2" wm-template-container="{{leftnav}}"></aside><div class="app-page-content app-content-column"><div class="app-ng-transclude" wmtransclude></div></div><aside data-role="page-right-panel" class="app-right-panel col-md-2 col-sm-2" wm-template-container="{{rightnav}}"></aside></div></main><footer data-role="page-footer" class="app-footer clearfix" wm-template-container="{{footer}}"></footer></div>'),$templateCache.put("template/dialog/common/confirm.html",'<wm-view name="CommonConfirmDialogView" class="dialog-view"><wm-confirmdialog name="CommonConfirmDialog" controller="NotificationDialogController" notificationdialog="confirm" message="{{notification.text}}" title="{{notification.title}}" oktext="{{notification.okButtonText}}" canceltext="{{notification.cancelButtonText}}"on-ok="variableOnOk()" on-cancel="variableOnCancel()"></wm-confirmdialog></wm-view>'),$templateCache.put("template/dialog/common/alert.html",'<wm-view name="CommonAlertDialogView" class="dialog-view"><wm-alertdialog name="CommonAlertDialog" controller="NotificationDialogController" notificationdialog="alert" message="{{notification.text}}" title="{{notification.title}}" oktext="{{notification.okButtonText}}" alerttype="{{notification.alerttype}}"on-ok="variableOnOk()" on-close="variableOnClose()"></wm-alertdialog></wm-view>'),$templateCache.put("template/dialog/page/alert.html",'<wm-view name="notificationAlertDialogView" class="dialog-view"><wm-alertdialog name="notificationalertdialog" controller="NotificationDialogController" notificationdialog="alert" message="{{notification.text}}" title="{{notification.title}}" oktext="{{notification.okButtonText}}" alerttype="{{notification.alerttype}}"on-ok="variableOnOk()" on-close="variableOnClose()"></wm-alertdialog></wm-view>'),$templateCache.put("template/dialog/page/confirm.html",'<wm-view name="notificationConfirmDialogView" class="dialog-view"><wm-confirmdialog name="notificationconfirmdialog" controller="NotificationDialogController" notificationdialog="confirm" message="{{notification.text}}" title="{{notification.title}}" oktext="{{notification.okButtonText}}"on-ok="variableOnOk()" on-cancel="variableOnCancel()" on-close="variableOnClose()"></wm-confirmdialog></wm-view>')}]).directive("wmTemplate",["$templateCache","PropertiesFactory","WidgetUtilService","CONSTANTS","$compile","$rootScope","Utils",function($templateCache,PropertiesFactory,WidgetUtilService,CONSTANTS,$compile,$rootScope,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.template",[]),templateShowCaseRendered=!1;return{restrict:"E",replace:!0,transclude:!0,scope:{},template:$templateCache.get("template/layouts/template.html"),compile:function(){return{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.postWidgetCreate(scope,element,attrs),CONSTANTS.isRunMode&&!templateShowCaseRendered&&(templateShowCaseRendered=!0,$compile("<wm-template-showcase></wm-template-showcase>")(scope.$root)),$rootScope.$emit("template-ready")}}}}}]).directive("wmTemplateShowcase",["$location","Utils","$routeParams","$timeout",function($location,Utils,$routeParams,$timeout){"use strict";function postMessage(content){window.top.postMessage(Utils.isIE9()?JSON.stringify(content):content,"*")}var MSGS={HIDE_TEMPLATES_SHOW_CASE:"hide-templates-show-case",SHOW_TEMPLATES_SHOW_CASE:"show-templates-show-case",UPDATE_LOCATION:"update-location-path",SELECT_TEMPLATE:"select-template",TEMPLATEBUNDLE_CONFIG:"template-bundle-config",ON_LOAD:"on-load"};return{restrict:"E",scope:{},link:function(scope,element){var pageName=$routeParams.name;scope.showAll=!0,Utils.fetchContent("json",Utils.preventCachingOf("./config.json"),function(response){scope.templates=[],response.error||(scope.templates=response.templates,postMessage({key:MSGS.TEMPLATEBUNDLE_CONFIG,config:response}))},WM.noop,!0),scope.prev=function(){var i=--scope.activeTemplateIndex;i=i<0?0:i,scope.showTemplate(i)},scope.next=function(){var i=++scope.activeTemplateIndex,len=scope.templates.length;i=i>=len?len-1:i,scope.showTemplate(i)},scope.showTemplate=function(idx){var template=scope.templates[idx];scope.activeTemplateIndex=idx,$location.path(template.id)},scope.activeTemplateIndex=0,pageName&&scope.templates.some(function(template,idx){if(pageName===template.id)return scope.activeTemplateIndex=idx,!0}),WM.element("html > body:first").append(element),window.onmessage=function(msg){var key,msgData=null;if(msgData=Utils.isIE9()?JSON.parse(msg.data):msg.data,WM.isObject(msgData)){switch(key=msgData.key){case MSGS.HIDE_TEMPLATES_SHOW_CASE:scope.hideShowCase=!0;break;case MSGS.SELECT_TEMPLATE:scope.showTemplate(msgData.templateIndex)}scope.$root.$safeApply(scope)}},scope.$root.$on("$routeChangeSuccess",function(){postMessage({key:MSGS.UPDATE_LOCATION,location:$location.absUrl()})}),$timeout(function(){postMessage({key:MSGS.ON_LOAD})})}}}]).directive("wmTemplateContainer",function(FileService,CONSTANTS,$rootScope,Utils,$compile,$templateCache){"use strict";function hideContent($el){$el.html("").hide()}function getTemplatePath(templateName){var templatePath="pages/"+templateName+"/page.min.html";return CONSTANTS.isStudioMode?"../../../"+templatePath:templatePath}function displayDefaultContent(element){var key=element.attr("data-role"),url=ROLE_DEFAULTCONTENTURL_MAP[key],content=$templateCache.get(url);element.html(content).show()}function compileTemplate(scope,element,content){var $content=WM.element(content),_scope=scope.$new();$content=$content.contents(),_scope.Widgets={},$compile($content)(_scope),element.append($content).show()}function loadTemplate(scope,element,templateName){var pageContent;FileService.read({path:getTemplatePath(templateName),projectID:$rootScope.project.id},function(response){pageContent=Utils.parseCombinedPageContent(response,templateName),compileTemplate(scope,element,pageContent.html)},function(){element.html(ERROR_CONTENT)})}var ERROR_CONTENT='<div class="app-partial-info"><div class="partial-message">Content for the container is unavailable.</div></div>',ROLE_DEFAULTCONTENTURL_MAP={"page-header":"template/defaults/header.html","page-topnav":"template/defaults/topnav.html","page-left-panel":"template/defaults/leftnav.html","page-right-panel":"template/defaults/rightnav.html","page-footer":"template/defaults/footer.html"};return{link:function(scope,element,attrs){attrs.wmTemplateContainer&&attrs.$observe("wmTemplateContainer",function(nv){nv?"_nocontent"===nv?hideContent(element):"_defaultcontent"===nv?displayDefaultContent(element):loadTemplate(scope,element,nv):hideContent(element)})}}}),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/page/rightpanel.html",'<aside  data-role="page-right-panel" page-container init-widget class="app-right-panel" apply-styles="container"><div class="app-ng-transclude" wmtransclude page-container-target></div></aside>')}]).directive("wmRightPanel",["PropertiesFactory","WidgetUtilService","CONSTANTS","Utils",function(PropertiesFactory,WidgetUtilService,CONSTANTS,Utils){"use strict";function propertyChangeHandler(scope,element,key,newVal,oldVal){switch(key){case"columnwidth":element.removeClass("col-md-"+oldVal+" col-sm-"+oldVal).addClass("col-md-"+newVal+" col-sm-"+newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.rightpanel",["wm.layouts","wm.base.events.touch"]),notifyFor={columnwidth:!0};return{restrict:"E",replace:!0,scope:{},transclude:!0,template:function(tElement,tAttrs){var isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),template=WM.element(WidgetUtilService.getPreparedTemplate("template/layout/page/rightpanel.html",tElement,tAttrs));return isWidgetInsideCanvas||tAttrs.columnwidth||template.attr("columnwidth","2"),template[0].outerHTML},compile:function(){return{pre:function(iScope){CONSTANTS.isStudioMode?iScope.widgetProps=Utils.getClonedObject(widgetProps):iScope.widgetProps=widgetProps},post:function(scope,element,attrs){scope.columnwidth&&WM.element(element).addClass("col-md-"+scope.columnwidth+" col-sm-"+scope.columnwidth),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/page/row.html",'<div init-widget class="row app-row clearfix" apply-styles wmtransclude></div>')}]).directive("wmRow",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.row",["wm.layouts","wm.base.events.touch"]);return{restrict:"E",replace:!0,scope:{},transclude:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/layout/page/row.html"),link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/page/topnav.html",'<section data-role="page-topnav" page-container init-widget class="app-top-nav" apply-styles wmtransclude page-container-target></section>')}]).directive("wmTopNav",["PropertiesFactory","WidgetUtilService","CONSTANTS","Utils",function(PropertiesFactory,WidgetUtilService,CONSTANTS,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.topnav",["wm.layouts","wm.base.events.touch"]);return{restrict:"E",replace:!0,scope:{},transclude:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/layout/page/topnav.html"),compile:function(){return{pre:function(iScope,element){CONSTANTS.isStudioMode?iScope.widgetProps=Utils.getClonedObject(widgetProps):(iScope.widgetProps=widgetProps,element.scope().layout.navigationBar=!0)},post:function(scope,element,attrs){WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.layouts.page").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/layout/page/view.html",'<div init-widget class="app-view clearfix" apply-styles="container" wmtransclude wm-navigable-element="true"> </div>')}]).directive("wmView",["PropertiesFactory","WidgetUtilService","CONSTANTS","ViewService","Utils","DialogService",function(PropertiesFactory,WidgetUtilService,CONSTANTS,ViewService,Utils,DialogService){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.view",["wm.layouts","wm.base.events.touch"]);return{restrict:"E",replace:!0,scope:{},transclude:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/layout/page/view.html"),link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){ViewService.registerView(scope),scope.setActive=function(){ViewService.showView(scope.name)};var dialogId,newScope,targetScope,isDialogView=element.hasClass("dialog-view");isDialogView&&(CONSTANTS.isStudioMode&&element.attr("wm-droppable",!1),CONSTANTS.isRunMode&&(scope.show=!1,newScope=scope.$new(!0),dialogId=element.find("script").attr("id"),targetScope=element.scope(),targetScope.Widgets[dialogId]=newScope,newScope.open=Utils.openDialog.bind(void 0,dialogId),newScope.close=DialogService.close.bind(void 0,dialogId))),scope.initialize=function(){element.find(".ng-isolate-scope").each(function(){Utils.triggerFn(WM.element(this).isolateScope().redraw)})},WidgetUtilService.postWidgetCreate(scope,element,attrs),element.on("$destroy",function(){ViewService.unregisterView(scope)})}}}}]),WM.module("wm.widgets.base",[]).constant("WIDGET_CONSTANTS",{EVENTS_OPTIONS:["No Event","Javascript","Stop Propagation"]}).factory("PropertiesFactory",["WIDGET_CONSTANTS","CONSTANTS","Utils","$rootScope",function(WIDGET_CONSTANTS,CONSTANTS,Utils,$rs){"use strict";function getAdvancedProperties(){var advancedProperties=[];return _.forEach(advancedPropertyGroups,function(group){group.parent&&_.forEach(group.properties,function(prop){advancedProperties.push(prop)})}),advancedProperties}function getPropertiesOf(widget,parents){var widgetProps,parentsArr,mobileProps,advancedProperties;return"wm.chart"===widget&&(advancedProperties=getAdvancedProperties()),parents?(parentsArr=WM.isArray(parents)?parents:[parents],parentsArr.push(widget),widgetProps={},parentsArr.forEach(function(parent){WM.isObject(properties[parent])&&Object.keys(properties[parent]).forEach(function(propName){var propObj=properties[parent][propName];widgetProps[propName]||(widgetProps[propName]={}),Object.keys(propObj).forEach(function(key){ignoreList[key]||(widgetProps[propName][key]=propObj[key])})})})):widgetProps=Utils.getClonedObject(properties[widget]),$rs.isMobileApplicationType&&(mobileProps=properties[widget+".mobile"],mobileProps&&_.assign(widgetProps,mobileProps)),CONSTANTS.isStudioMode?_.keys(widgetProps).forEach(function(key){var property=widgetProps[key];property.hasOwnProperty("show")||(property.show=!0),advancedProperties&&_.includes(advancedProperties,key)&&!property.hasOwnProperty("showindesigner")&&(property.showindesigner=!0),property.disabled=property.disabled||!1}):Object.keys(widgetProps).forEach(function(propName){var propDetails=widgetProps[propName];widgetProps[propName]=_.pick(propDetails,["type","value","bindable","displaytype"])}),widgetProps}function getPropertyGroups(){return propertyGroups}function getAdvancedPropertyGroups(){return advancedPropertyGroups}function getPrimaryPropertyGroups(){var primaryPropertyGroups=[];return propertyGroups.forEach(function(propertyGroup){propertyGroup.parent||primaryPropertyGroups.push(propertyGroup)}),primaryPropertyGroups}function getGroupProperties(group){var groupProperties=[];return propertyGroups.forEach(function(propertyGroup){propertyGroup.parent===group&&(groupProperties=groupProperties.concat(propertyGroup.properties))}),groupProperties}function getPropertyGroup(name){return _.find(propertyGroups,function(group){return group.name===name})}function setRoles(pRoles){roles.length=0,WM.isArray(pRoles)&&pRoles.forEach(function(pRole){roles.push(pRole)})}function getRoles(){return roles||[]}var properties,propertyGroups,advancedPropertyGroups,ignoreList,widgetEventOptions=Utils.getClonedObject(WIDGET_CONSTANTS.EVENTS_OPTIONS),showInDeviceOptions=[{name:"All",value:"all"},{name:"Mobile",value:"xs"},{name:"Tab Portrait",value:"sm"},{name:"Laptop\\Tab Landscape",value:"md"},{name:"Large Screen",value:"lg"}],daysOptions=Utils.getDaysOptions(),nameRegex="^[a-zA-Z_][A-Za-z0-9_]+$",numberRegex="(^$|[0-9]+$)",classRegex="(^$|^-?[_a-zA-Z ]+[_a-zA-Z0-9- ]*)$",dimensionRegex="(^$|^(auto|0)$|^[+-]?[0-9]+.?([0-9]+)?(em|ex|%|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin|vmax)?$)",zindexRegex="(^$|auto|initial|inherit|^[0-9]+$)",maxRatingRegex="^(?:10|[1-9])$|^bind.*$",roles=[],numberFormatOptions=[{name:"Decimal Digits",groupOptions:{".f":"9",".1f":"9.9",".2f":"9.99",".3f":"9.999"}},{name:"Precision",groupOptions:{".1g":"9e+7",".2g":"9.9e+7",".3g":"9.99e+7"}},{name:"Percentage",groupOptions:{"%":"99%"}},{name:"Round Options",groupOptions:{",r":"99,999,999",Thousand:"Thousand (Eg: 9K)",Million:"Million (Eg: 9M)",Billion:"Billion (Eg: 9B)"}}],dateOptions=[{name:"Date",groupOptions:{"%x":"mm/dd/yyyy","%c":"Date and Time"}},{name:"Time",groupOptions:{"%X":"Time(%H:%M:%S)","%H":"In 24 hours [00-23]","%I":"In 12 hours [01-12]","%M":"Mintues [00-59]","%S":"Seconds [00-59]","%L":"MilliSeconds [000, 999]","%p":"either AM or PM","%Z":"Time zone offset"}},{name:"Day",groupOptions:{"%d":"Zero padded day of month (Eg: 01)","%e":"Space padded day of month (Eg:  1)","%j":"Day of the year (Eg: 01-31-2016 returns 031)"}},{name:"Week",groupOptions:{"%a":"Abbreviated weekday name (Eg: Wed)","%A":"Full weekday name (Eg: Wednesday)","%U":"Week number of the year(Sunday first day) (Eg: 01-31-2016 returns 05)","%W":"Week number of the year(Monday first day) (Eg: 01-31-2016 returns 04)","%w":"Week day[0(Sunday),6]  (Eg: 01-30-2016 returns 6)"}},{name:"Month",groupOptions:{"%b":"Abbreviated month name (Eg: Mar)","%B":"Full month name  (Eg: March)","%m":"Month number  (Eg: 02) [01-12]"}},{name:"Year",groupOptions:{"%y":"yy (Eg: 16)","%Y":"yyyy (Eg: 2016)"}}],PLATFORM_TYPE={WEB:"WEB",MOBILE:"MOBILE",DEFAULT:"DEFAULT"},dateTimeTypes="timestamp, date, time, datetime, string, number",animationOptions=[" ","bounce","bounceIn","bounceInDown","bounceInLeft","bounceInRight","bounceInUp","bounceOut","bounceOutDown","bounceOutLeft","bounceOutRight","bounceOutUp","fadeIn","fadeInDown","fadeInDownBig","fadeInLeft","fadeInLeftBig","fadeInRight","fadeInRightBig","fadeInUp","fadeInUpBig","fadeOut","fadeOutDown","fadeOutDownBig","fadeOutLeft","fadeOutLeftBig","fadeOutRight","fadeOutRightBig","fadeOutUp","fadeOutUpBig","flash","flipInX","flipInY","flipOutX","flipOutY","hinge","lightSpeedIn","lightSpeedOut","pulse","rollIn","rollOut","rotateIn","rotateInDownLeft","rotateInDownRight","rotateInUpLeft","rotateInUpRight","rotateOut","rotateOutDownLeft","rotateOutDownRight","rotateOutUpLeft","rotateOutUpRight","rubberBand","shake","slideInDown","slideInLeft","slideInRight","slideInUp","slideOutDown","slideOutLeft","slideOutRight","slideOutUp","swing","tada","wobble","zoomIn","zoomInDown","zoomInLeft","zoomInRight","zoomInUp","zoomOut","zoomOutDown","zoomOutLeft","zoomOutRight","zoomOutUp"],spinnerAnimationOptions=[" ","bounce","fadeIn","fadeOut","flash","flipInX","flipInY","pulse","shake","spin","swing","tada","wobble","zoomIn","zoomOut"],visibilityOptions=["collapse","hidden","initial","inherit","visible"],displayOptions=["block","flex","inherit","initial","inline","inline-block","inline-flex","inline-table","list-item","run-in","table","table-caption","table-cell","table-column","table-column-group","table-header-group","table-footer-group","table-row","table-row-group","none"],popoverOptions=[{value:"top",label:"Top"},{value:"bottom",label:"Bottom"},{value:"left",label:"Left"},{value:"right",label:"Right"}],EVERYONE="Everyone",result={properties:{"wm.base":{name:{type:"string",pattern:nameRegex,maxlength:32},show:{type:"boolean",value:!0,bindable:"in-bound"},deferload:{type:"boolean",value:!1,show:!1,ignoreGetterSetters:!0},class:{type:"string",pattern:classRegex},accessroles:{type:"access-roles-select",options:roles,value:EVERYONE},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"block"}},"wm.base.editors":{width:{type:"string",pattern:dimensionRegex},hint:{type:"string",bindable:"in-bound"},height:{type:"string",pattern:dimensionRegex},margin:{type:"string",widget:"box-model"},fontweight:{type:"string",options:["bold"],hidelabel:!0,widget:"icons-checkbox"},fontsize:{type:"number",hidelabel:!0,hint:"Font size",pattern:numberRegex},fontunit:{type:"string",options:["em","px","pt"],value:"px",hidelabel:!0,widget:"icons-radio"},textalign:{type:"string",options:["left","center","right"],hidelabel:!0,widget:"icons-align"},textdecoration:{type:"string",options:["underline"],hidelabel:!0,widget:"icons-checkbox"},fontstyle:{type:"string",options:["italic"],hidelabel:!0,widget:"icons-checkbox"},fontfamily:{type:"string",hidelabel:!0,hint:"Arial, Geneva"},color:{type:"string",hidelabel:!0,widget:"color"}},"wm.base.advancedformwidgets":{hint:{type:"string",bindable:"in-bound"},width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align"},margin:{type:"string",widget:"box-model"},fontweight:{type:"string",options:["bold"],hidelabel:!0,widget:"icons-checkbox"},fontsize:{type:"number",hidelabel:!0,hint:"Font size",pattern:numberRegex},fontunit:{type:"string",options:["em","px","pt"],value:"px",hidelabel:!0,widget:"icons-radio"},textalign:{type:"string",options:["left","center","right"],hidelabel:!0,widget:"icons-align"},textdecoration:{type:"string",options:["underline"],hidelabel:!0,widget:"icons-checkbox"},fontstyle:{type:"string",options:["italic"],hidelabel:!0,widget:"icons-checkbox"},fontfamily:{type:"string",hidelabel:!0,hint:"Arial, Geneva"},color:{type:"string",hidelabel:!0,widget:"color"},borderwidth:{type:"string",widget:"box-model"},borderstyle:{type:"string",options:["dashed","dotted","none","solid"],widget:"border-style"},bordercolor:{type:"string",widget:"color"},padding:{type:"string",widget:"box-model"},backgroundcolor:{type:"string",widget:"color"},backgroundgradient:{type:"string"},backgroundimage:{type:"string",bindable:"in-bound"},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"]},backgroundsize:{type:"string",hint:"width, height"},backgroundposition:{type:"string",hint:"top, left"},backgroundattachment:{type:"list",options:["fixed","local","scroll"]},display:{type:"list",options:displayOptions,show:!1}},"wm.base.editors.abstracteditors":{hint:{type:"string",bindable:"in-bound"},disabled:{type:"boolean",bindable:"in-bound"},required:{type:"boolean",bindable:"in-bound"},tabindex:{type:"number",value:"0"},onClick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onTap:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseenter:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseleave:{type:"event",options:widgetEventOptions,widget:"eventlist"},onFocus:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBlur:{type:"event",options:widgetEventOptions,widget:"eventlist"},onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.base.editors.dataseteditors":{startupdate:{type:"boolean"},scopedataset:{type:"string"},datafield:{type:"list",options:["All Fields"],datasetfilter:"terminals",allfields:!0},displayfield:{type:"list",options:[""],datasetfilter:"terminals"},displayexpression:{type:"string",bindable:"in-bound",bindonly:"expression"},displaytype:{type:"list",options:["Currency","Date","Number","Text","Time"]},orderby:{type:"list",widget:"order-by",datasetfilter:"terminals"}},"wm.base.navigation":{navigation:{type:"list",options:["Basic","Pager","Classic"],value:"Basic"},showrecordcount:{type:"boolean"},maxsize:{type:"number",value:3,show:!1},boundarylinks:{type:"boolean",value:!1,show:!1},forceellipses:{type:"boolean",value:!0,show:!1},directionlinks:{type:"boolean",value:!0,show:!1},navigationalign:{type:"string",options:["left","center","right"],widget:"icons-align",value:"left"}},"wm.base.events":{onTap:{type:"event",options:widgetEventOptions,widget:"eventlist"},onDoubletap:{type:"event",options:widgetEventOptions,widget:"eventlist"},onClick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onDblclick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseenter:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseleave:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.base.events.touch":{onSwipeup:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSwipedown:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSwipeleft:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSwiperight:{type:"event",options:widgetEventOptions,widget:"eventlist"},onPinchin:{type:"event",options:widgetEventOptions,widget:"eventlist"},onPinchout:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.base.events.keyboard":{onKeypress:{type:"event",options:widgetEventOptions,widget:"eventlist"},onKeydown:{type:"event",options:widgetEventOptions,widget:"eventlist"},onKeyup:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.base.events.focus":{onFocus:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBlur:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.base.events.change":{onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.base.events.successerror":{onSuccess:{type:"event",options:widgetEventOptions,widget:"eventlist"},onError:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.abstractinput":{type:{type:"string",value:"text"}},"wm.html":{content:{type:"string",bindable:"in-out-bound",widget:"textarea"},textalign:{type:"string",options:["left","center","right"],hidelabel:!0,widget:"icons-align",show:!1}},"wm.icon":{hint:{type:"string",bindable:"in-bound"},caption:{type:"string",bindable:"in-out-bound",maxlength:256,showPrettyExprInDesigner:!0},iconposition:{type:"list",options:["left","right"],value:"left"},iconclass:{type:"string",value:"wi wi-star-border",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex},iconsize:{type:"string",pattern:dimensionRegex},animation:{type:"list",options:animationOptions},color:{type:"string",widget:"color"},opacity:{type:"string",widget:"slider"}},"wm.iframe":{iframesrc:{type:"string",bindable:"in-bound",widget:"string"},encodeurl:{type:"boolean",value:!1},width:{type:"string",value:"300px",pattern:dimensionRegex},height:{type:"string",value:"150px",pattern:dimensionRegex},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all"}},"wm.button":{iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex},badgevalue:{type:"string",bindable:"in-out-bound"},caption:{type:"string",bindable:"in-out-bound",maxlength:256,showPrettyExprInDesigner:!0},iconurl:{type:"string",bindable:"in-bound"},iconwidth:{type:"string",pattern:dimensionRegex},iconheight:{type:"string",pattern:dimensionRegex},iconmargin:{type:"string",pattern:dimensionRegex},iconposition:{type:"list",options:["left","top","right"]},disabled:{type:"boolean",bindable:"in-bound"},type:{type:"list",options:["button","reset","submit"],value:"button"},tabindex:{type:"number",value:"0"},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"inline-block"},animation:{type:"list",options:animationOptions},shortcutkey:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",value:"btn-default",options:["btn-default","btn-primary","btn-info","btn-warning","btn-success","btn-danger","btn-inverse","btn-lg","btn-sm","btn-xs","btn-raised","btn-fab","btn-link","btn-transparent","no-border","jumbotron"]},margin:{type:"string",widget:"box-model"},horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align",show:!1}},"wm.rating":{hint:{show:!1},maxvalue:{type:"number",value:5,pattern:maxRatingRegex,bindable:"in-bound"},readonly:{type:"boolean",value:!1,bindable:"in-bound"},scopedatavalue:{type:"string"},datavalue:{type:"number",value:"",bindable:"in-out-bound"},caption:{type:"string",bindable:"in-out-bound",maxlength:256,show:!1},iconsize:{type:"string",pattern:dimensionRegex},onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"},width:{type:"string",pattern:dimensionRegex,show:!1},height:{type:"string",pattern:dimensionRegex,show:!1},tabindex:{type:"number",value:"0"},iconcolor:{type:"string",widget:"color"},scopedataset:{type:"string"},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},datafield:{type:"list",options:[""],value:"",datasetfilter:"terminals"},displayfield:{
type:"list",options:[""],datasetfilter:"terminals"},displayexpression:{type:"string",bindable:"in-bound",bindonly:"expression"},showcaptions:{type:"boolean",value:!0}},"wm.camera":{capturetype:{type:"list",options:["IMAGE","VIDEO"],value:"IMAGE"},datavalue:{type:"string",value:"",bindable:"in-bound"},localFilePath:{type:"string",value:"",bindable:"out-bound"},localFile:{type:"string",value:"",bindable:"out-bound"},iconclass:{type:"string",value:"wi wi-photo-camera",widget:"select-icon",bindable:"in-bound",pattern:classRegex},iconsize:{type:"string",pattern:dimensionRegex,value:"2em"},imagequality:{type:"number",value:80},imageencodingtype:{type:"list",options:["JPEG","PNG"],value:"JPEG"},savetogallery:{type:"boolean",value:!1},allowedit:{type:"boolean",value:!1},imagetargetwidth:{type:"number"},imagetargetheight:{type:"number"},onSuccess:{type:"event",options:widgetEventOptions,widget:"eventlist"},width:{type:"string",pattern:dimensionRegex,show:!1},height:{type:"string",pattern:dimensionRegex,show:!1}},"wm.barcodescanner":{datavalue:{type:"string",bindable:"in-out-bound"},caption:{type:"string",value:"",bindable:"in-bound",maxlength:256,showPrettyExprInDesigner:!0},iconclass:{type:"string",value:"glyphicon glyphicon-barcode",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex},iconsize:{type:"string",pattern:dimensionRegex,value:"2em"},onSuccess:{type:"event",options:widgetEventOptions,widget:"eventlist"},width:{type:"string",pattern:dimensionRegex,show:!1},height:{type:"string",pattern:dimensionRegex,show:!1}},"wm.buttongroup":{width:{type:"string",pattern:dimensionRegex},vertical:{type:"boolean"},horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align"},padding:{type:"string",widget:"box-model"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["btn-group-lg","btn-group-sm","btn-group-xs","btn-group-raised","btn-toolbar","btn-group-vertical"]},addchild:{hidelabel:!0,options:[{label:"Add Button",widgettype:"wm-button",defaults:{margin:""}}],widget:"add-widget"}},"wm.switch":{width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},datavalue:{type:"string, object",bindable:"in-out-bound",widget:"string",getTypeFrom:"dataset"},scopedatavalue:{type:"string"},dataset:{type:"array, string",bindable:"in-bound",widget:"string",value:"yes, no, maybe",showPrettyExprInDesigner:!0,defaultvalue:"yes, no, maybe"},scopedataset:{type:"string"},datafield:{type:"list",options:["All Fields"],value:"All Fields",datasetfilter:"terminals",allfields:!0},displayfield:{type:"list",options:[""],value:"",datasetfilter:"terminals"},tabindex:{type:"number",value:"0"},orderby:{type:"list",widget:"order-by",datasetfilter:"terminals"},margin:{type:"string",widget:"box-model"},onFocus:{show:!1},onBlur:{show:!1}},"wm.menu":{name:{type:"string",pattern:nameRegex,maxlength:32},show:{type:"boolean",value:!0,bindable:"in-bound"},accessroles:{type:"access-roles-select",options:roles,value:EVERYONE},scopedataset:{type:"string"},dataset:{type:"array, object",bindable:"in-bound",widget:"string",value:"Menu Item 1, Menu Item 2, Menu Item 3"},caption:{type:"string",bindable:"in-out-bound",maxlength:256,showPrettyExprInDesigner:!0},menulayout:{type:"list",options:["vertical","horizontal"]},menuclass:{type:"string",pattern:classRegex,widget:"list-picker",options:["btn-default","btn-primary","btn-info","btn-danger","btn-warning","btn-success","btn-lg","btn-sm","btn-xs","btn-link","btn-transparent","jumbotron"]},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex},menuposition:{type:"list",options:["","down,right","down,left","up,right","up,left","inline"],value:""},onSelect:{type:"event",options:widgetEventOptions,widget:"eventlist"},linktarget:{type:"list",options:["_blank","_parent","_self","_top"],widget:"data-list"},tabindex:{type:"number",value:"0"},animateitems:{type:"list",options:["","slide","fade","scale"]},shortcutkey:{type:"string"},orderby:{type:"list",widget:"order-by",datasetfilter:"terminals"},class:{type:"string",pattern:classRegex,show:!1},autoclose:{type:"list",options:["outsideClick","always","disabled"],value:"always"}},"wm.menu.dataProps":{itemlabel:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},itemlink:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},itemicon:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},itemchildren:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"objects"},itemaction:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},userrole:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"}},"wm.tree":{scopedataset:{type:"string"},dataset:{type:"array, object",bindable:"in-bound",widget:"string",value:"node1, node2, node3"},onSelect:{type:"event",options:widgetEventOptions,widget:"eventlist"},selecteditem:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",getTypeFrom:"dataset"},treeicons:{type:"list",widget:"list",options:["folder","plus-minus","circle-plus-minus","chevron","menu","triangle","expand-collapse"]},nodelabel:{type:"string",widget:"list",datasetfilter:"terminals",bindable:"in-bound",bindonly:"expression"},nodeicon:{type:"string",widget:"list",datasetfilter:"terminals",bindable:"in-bound",bindonly:"expression"},nodechildren:{type:"string",widget:"list",datasetfilter:"objects",bindable:"in-bound",bindonly:"expression"},nodeid:{type:"string",widget:"list",datasetfilter:"terminals",bindable:"in-bound",bindonly:"expression"},tabindex:{type:"number",value:"0"},levels:{type:"number",value:0,min:"0",max:"10",step:"1"},datavalue:{type:"string, number, boolean, date, time, object",bindable:"in-out-bound",widget:"tree-datavalue",getTypeFrom:"expr:getDataValueType()"},orderby:{type:"list",widget:"order-by",datasetfilter:"terminals"}},"wm.text":{autofocus:{type:"boolean"},autocomplete:{type:"boolean",value:!0},readonly:{type:"boolean",bindable:"in-bound"},updateon:{type:"list",value:"blur",widget:"update-on"},updatedelay:{type:"number",value:0},type:{type:"list",options:["color","date","datetime-local","email","month","number","password","search","tel","text","time","url","week"],value:"text"},accept:{type:"data-list",options:["image/*","audio/*","video/*"],show:!1},datavalue:{type:"string",value:"",bindable:"in-out-bound",getTypeFrom:"expr:getPropertyType('datavalue')"},scopedatavalue:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["input-lg","input-sm"]},backgroundcolor:{type:"string",widget:"color"},regexp:{type:"string",value:".*"},placeholder:{type:"string",value:"Enter text",bindable:"in-bound"},maxchars:{type:"number",bindable:"in-bound"},changeOnkey:{type:"boolean"},minvalue:{type:"string",bindable:"in-bound"},maxvalue:{type:"string",bindable:"in-bound"},step:{type:"number"},shortcutkey:{type:"string"},displayformat:{type:"string",options:["999-99-9999","(999) 999-9999","(999) 999-9999 ext. 999","(999) 999-9999 ext. ?9?9?9","(?9?9?9) ?9?9?9-?9?9?9?9","(999) 999-9999 ext. 999","(**: AAA-999)","9999 9999 9999 9999","AA-9999"],widget:"data-list",bindable:"in-bound",show:!1}},"wm.currency":{datavalue:{type:"number",bindable:"in-out-bound"},scopedatavalue:{type:"string"},minvalue:{type:"number",bindable:"in-bound"},maxvalue:{type:"number",bindable:"in-bound"},readonly:{type:"boolean",bindable:"in-bound"},step:{type:"number"},currency:{type:"list",value:"USD",options:["AED","AFN","ALL","AMD","ARS","AUD","AZN","BAM","BDT","BGN","BHD","BIF","BND","BOB","BRL","BWP","BYR","BZD","CAD","CDF","CHF","CLP","CNY","COP","CRC","CVE","CZK","DJF","DKK","DOP","DZD","EEK","EGP","ERN","ETB","EUR","GBP","GEL","GHS","GNF","GTQ","HKD","HNL","HRK","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KHR","KMF","KRW","KWD","KZT","LBP","LKR","LTL","LVL","LYD","MAD","MDL","MGA","MKD","MMK","MOP","MUR","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SDG","SEK","SGD","SOS","SYP","THB","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VEF","VND","XAF","XOF","YER","ZAR","ZMK"]},placeholder:{type:"string",value:"Enter value",bindable:"in-bound"},backgroundcolor:{type:"string",widget:"color"},shortcutkey:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["input-group-sm","input-group-lg"]}},"wm.base.datetime":{datavalue:{type:"string",bindable:"in-out-bound"},scopedatavalue:{type:"string"},tabindex:{type:"number",value:"0"},margin:{type:"string",widget:"box-model"},color:{type:"string",hidelabel:!0,widget:"color"}},"wm.date":{placeholder:{type:"string",value:"Select date",bindable:"in-bound"},width:{type:"string",pattern:dimensionRegex},autofocus:{type:"boolean"},showweeks:{type:"boolean",value:!1,bindable:"in-bound"},readonly:{type:"boolean",bindable:"in-bound"},disabled:{type:"boolean",bindable:"in-bound"},mindate:{type:dateTimeTypes,widget:"data-list",options:["CURRENT_DATE"],bindable:"in-bound",hint:"yyyy-MM-dd"},maxdate:{type:dateTimeTypes,widget:"data-list",options:["CURRENT_DATE"],bindable:"in-bound",hint:"yyyy-MM-dd"},datepattern:{value:"yyyy-MM-dd",type:"list",options:[],widget:"date-patterns"},outputformat:{value:"yyyy-MM-dd",type:"list",options:[],widget:"date-patterns"},datavalue:{type:dateTimeTypes,widget:"data-list",options:["CURRENT_DATE"],bindable:"in-out-bound",hint:"yyyy-MM-dd"},timestamp:{type:dateTimeTypes,widget:"string",show:"false",bindable:"out-bound"},excludedays:{type:"select-all",options:daysOptions,displaytype:"block",value:" "},excludedates:{type:"datetime, timestamp, date, array, string",bindable:"in-bound",widget:"string",hint:"yyyy-MM-dd"},tabindex:{type:"number",value:"0"},shortcutkey:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["input-group-sm","input-group-lg"]},showbuttonbar:{type:"boolean",value:!0}},"wm.date.mobile":{datepattern:{show:!1},excludedays:{show:!1},excludedates:{show:!1},showweeks:{show:!1}},"wm.calendar":{backgroundcolor:{type:"string",widget:"color"},width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},scopedataset:{type:"string"},selectionmode:{type:"list",widget:"select-by-object",value:"none",options:[{label:"None",value:"none"},{label:"Single",value:"single"},{label:"Multiple",value:"multiple"}]},selecteddates:{type:"object",widget:"string",bindable:"in-out-bound",getTypeFrom:"expr:getPropertyType('selecteddates')"},currentview:{type:"object",widget:"string",bindable:"in-out-bound",getTypeFrom:"expr:getPropertyType('currentview')"},selecteddata:{type:"array, object",isList:!0,show:!1,bindable:"out-bound",getTypeFrom:"expr.getPropertyType('selecteddata')"},calendartype:{type:"list",options:["basic","agenda"],value:"basic"},eventstart:{type:"list",value:"start",options:[""],datasetfilter:"terminals"},eventend:{type:"list",value:"end",options:[""],datasetfilter:"terminals"},eventallday:{type:"list",value:"allday",options:[""],datasetfilter:"terminals"},eventtitle:{type:"list",value:"title",options:[""],datasetfilter:"terminals"},eventclass:{type:"list",value:"class",options:[""],datasetfilter:"terminals"},view:{type:"list",options:["month","week","day"],value:"month"},controls:{type:"list",options:"navigation, today, month, week, day",value:"navigation, today, month, week, day",widget:"select-all"},onViewrender:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSelect:{type:"event",options:widgetEventOptions,widget:"eventlist"},onEventdrop:{type:"event",options:widgetEventOptions,widget:"eventlist"},onEventresize:{type:"event",options:widgetEventOptions,widget:"eventlist"},onEventclick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onEventrender:{type:"event",options:widgetEventOptions,widget:"eventlist"},tabindex:{type:"number",value:"0"}},"wm.calendar.mobile":{view:{type:"list",options:["day","month","year"],value:"day"},controls:{show:!1},multiselect:{show:!1},calendartype:{show:!1},selectionmode:{show:!1},onEventdrop:{show:!1},onEventresize:{show:!1},eventstart:{type:"list",value:"start",options:[""],datasetfilter:"terminals"},eventend:{type:"list",value:"end",options:[""],datasetfilter:"terminals",show:!1},eventallday:{type:"list",value:"allday",options:[""],datasetfilter:"terminals",show:!1},eventtitle:{type:"list",value:"title",options:[""],datasetfilter:"terminals",show:!1},eventclass:{type:"list",value:"class",options:[""],datasetfilter:"terminals",show:!1}},"wm.time":{placeholder:{type:"string",value:"Select time",bindable:"in-bound"},autofocus:{type:"boolean"},readonly:{type:"boolean",bindable:"in-bound"},disabled:{type:"boolean",bindable:"in-bound"},hourstep:{type:"number",value:1},timepattern:{value:"hh:mm a",type:"list",options:[],widget:"time-patterns"},minutestep:{type:"number",value:15},outputformat:{value:"HH:mm:ss",type:"list",options:[],widget:"time-patterns"},required:{type:"boolean"},datavalue:{type:"time, date, string, number",widget:"data-list",options:["CURRENT_TIME"],bindable:"in-out-bound",hint:"HH:mm"},timestamp:{type:"time, date, string, number",widget:"string",show:"false",bindable:"out-bound"},tabindex:{type:"number",value:"0"},shortcutkey:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["input-group-sm","input-group-lg"]}},"wm.time.mobile":{hourstep:{type:"number",value:1,show:!1},minutestep:{type:"number",value:15,show:!1},timepattern:{show:!1}},"wm.datetime":{placeholder:{type:"string",value:"Select date time",bindable:"in-bound"},width:{type:"string",pattern:dimensionRegex},autofocus:{type:"boolean"},showweeks:{type:"boolean",value:!1},readonly:{type:"boolean",bindable:"in-bound"},disabled:{type:"boolean",bindable:"in-bound"},hourstep:{type:"number",value:1},minutestep:{type:"number",value:15},mindate:{type:dateTimeTypes,widget:"data-list",options:["CURRENT_DATE"],bindable:"in-bound",hint:"yyyy-MM-dd"},maxdate:{type:dateTimeTypes,widget:"data-list",options:["CURRENT_DATE"],bindable:"in-bound",hint:"yyyy-MM-dd"},datepattern:{value:"yyyy-MM-dd hh:mm:ss a",type:"list",options:[],widget:"date-time-patterns"},outputformat:{value:"timestamp",type:"list",options:[],widget:"date-time-patterns"},datavalue:{type:dateTimeTypes,widget:"data-list",options:["CURRENT_DATE"],bindable:"in-out-bound",hint:"yyyy-MM-dd HH:mm:ss"},timestamp:{type:dateTimeTypes,widget:"string",show:"false",bindable:"out-bound"},excludedays:{type:"select-all",options:daysOptions,displaytype:"block",value:" "},excludedates:{type:"datetime, timestamp, date, array, string",bindable:"in-bound",widget:"string",hint:"yyyy-MM-dd"},tabindex:{type:"number",value:"0"},shortcutkey:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["input-group-sm","input-group-lg"]},showbuttonbar:{type:"boolean",value:!0}},"wm.datetime.mobile":{datepattern:{value:"yyyy-MM-dd hh:mm:ss a",type:"list",show:!1},hourstep:{type:"number",value:1,show:!1},minutestep:{type:"number",value:15,show:!1},showweeks:{show:!1},excludedays:{show:!1},excludedates:{show:!1}},"wm.message":{type:{type:"string",options:["error","info","loading","success","warning"],value:"success",bindable:"in-out-bound",widget:"list"},caption:{type:"string",value:"Message",bindable:"in-out-bound",maxlength:256,showPrettyExprInDesigner:!0},onClose:{type:"event",options:widgetEventOptions,widget:"eventlist"},animation:{type:"list",options:animationOptions},width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},hideclose:{type:"boolean",value:!1}},"wm.composite":{captionposition:{type:"list",options:["left","right","top"]},required:{type:"boolean"},margin:{type:"string",widget:"box-model"}},"wm.radio":{autofocus:{type:"boolean"},disabled:{value:!1,bindable:"in-bound"},scopedatavalue:{type:"string"},datavalue:{type:"string",bindable:"in-out-bound"},checkedvalue:{type:"string"},radiogroup:{type:"string"},caption:{type:"string",bindable:"in-out-bound",maxlength:256},shortcutkey:{type:"string"},width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},margin:{type:"string",widget:"box-model"}},"wm.radioset":{width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},margin:{type:"string",widget:"box-model"},tabindex:{type:"number",value:"0"},disabled:{type:"boolean",value:!1,bindable:"in-bound"},readonly:{type:"boolean",value:!1,bindable:"in-bound"},layout:{type:"list",options:["","inline","stacked"]},itemclass:{type:"string",pattern:classRegex,widget:"list-picker",options:["list-group","media-list"]},listclass:{type:"string",pattern:classRegex,widget:"list-picker",options:["list-group-item","media"]},onClick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onTap:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseenter:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseleave:{type:"event",options:widgetEventOptions,widget:"eventlist"},onFocus:{type:"event",options:widgetEventOptions,widget:"eventlist",show:!1},onBlur:{type:"event",options:widgetEventOptions,widget:"eventlist",show:!1},onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"},datavalue:{type:"string",bindable:"in-out-bound",show:!1,getTypeFrom:"dataset"},scopedatavalue:{type:"string"},dataset:{type:"array, object",bindable:"in-bound",widget:"string",value:"Option 1, Option 2, Option 3",showPrettyExprInDesigner:!0,defaultvalue:"Option 1, Option 2, Option 3"},usekeys:{type:"boolean"},required:{type:"boolean",bindable:"in-bound",value:!1},selectedvalue:{type:"string, number, boolean, date, time, object",widget:"string",bindable:"in-bound",getTypeFrom:"dataset"},displayValue:{type:"string",show:!1,bindable:"out-bound"}},"wm.colorpicker":{readonly:{type:"boolean",value:!1,bindable:"in-bound"},disabled:{type:"boolean",value:!1,bindable:"in-bound"},required:{type:"boolean",value:!1,bindable:"in-bound"},datavalue:{type:"string",bindable:"in-out-bound"},scopedatavalue:{type:"string"},placeholder:{type:"string",value:"Select Color",bindable:"in-bound"},tabindex:{type:"number",value:"0"},shortcutkey:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["input-group-sm","input-group-lg"]},onDblclick:{show:!1},onDoubletap:{show:!1}},"wm.inputcolorpicker":{defaultcolor:{value:"#fff"}},"wm.inputslider":{caption:{value:"slider",maxlength:256}},"wm.slider":{hint:{type:"string"},readonly:{type:"boolean",value:!1,bindable:"in-bound"},disabled:{type:"boolean",value:!1,bindable:"in-bound"},minvalue:{type:"number",bindable:"in-out-bound"},maxvalue:{type:"number",bindable:"in-out-bound"},step:{type:"number"},datavalue:{type:"string, number",widget:"string",bindable:"in-out-bound"},scopedatavalue:{type:"string"},tabindex:{type:"number",value:"0"},shortcutkey:{type:"string"},width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},margin:{type:"string",widget:"box-model"}},"wm.checkbox":{width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},backgroundcolor:{type:"string",widget:"color"},margin:{type:"string",widget:"box-model"},datavalue:{type:"boolean, string",bindable:"in-out-bound",widget:"string"},checkedvalue:{type:"string"},uncheckedvalue:{type:"string"},scopedatavalue:{type:"string"},caption:{type:"string",bindable:"in-out-bound",maxlength:256,showPrettyExprInDesigner:!0},shortcutkey:{type:"string"}},"wm.checkboxset":{width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},margin:{type:"string",widget:"box-model"},tabindex:{type:"number",value:"0"},disabled:{type:"boolean",value:!1,bindable:"in-bound"},readonly:{type:"boolean",value:!1,bindable:"in-bound"},layout:{type:"list",options:["","inline","stacked"]},itemclass:{type:"string",pattern:classRegex,widget:"list-picker",options:["list-group","media-list"]},listclass:{type:"string",pattern:classRegex,widget:"list-picker",options:["list-group-item","media"]},onClick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onTap:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseenter:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseleave:{type:"event",options:widgetEventOptions,widget:"eventlist"},onFocus:{type:"event",options:widgetEventOptions,widget:"eventlist",show:!1},onBlur:{type:"event",options:widgetEventOptions,widget:"eventlist",show:!1},onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"},datavalue:{type:"string, array",bindable:"in-out-bound",show:!1,widget:"string",getTypeFrom:"dataset"},scopedatavalue:{type:"string"},dataset:{type:"array, object",bindable:"in-bound",widget:"string",value:"Option 1, Option 2, Option 3",showPrettyExprInDesigner:!0,defaultvalue:"Option 1, Option 2, Option 3"},usekeys:{type:"boolean"},selectedvalues:{type:"string, object",isList:!0,bindable:"in-bound",widget:"string",getTypeFrom:"dataset"},onReady:{type:"event",options:widgetEventOptions,widget:"eventlist"},displayValue:{type:"string, array",isList:!0,show:!1,bindable:"out-bound"}},"wm.chips":{readonly:{type:"boolean",value:!1,bindable:"in-bound"},scopedatavalue:{type:"string"},datavalue:{type:"string",bindable:"in-out-bound",widget:"string",getTypeFrom:"dataset"},scopedataset:{type:"string"},dataset:{type:"array, object",bindable:"in-bound",widget:"string",value:"Option 1, Option 2, Option 3"},displayimagesrc:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},disabled:{type:"boolean",bindable:"in-bound"},placeholder:{type:"string",value:"Type here...",bindable:"in-bound"},maxsize:{type:"number"},allowonlyselect:{type:"boolean",value:!1},class:{type:"string",pattern:classRegex},backgroundcolor:{type:"string",widget:"color"},onBeforeadd:{type:"event",options:widgetEventOptions,widget:"eventlist"},onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.select":{autofocus:{type:"boolean"},readonly:{type:"boolean",value:!1,bindable:"in-bound"},scopedatavalue:{type:"string"},datavalue:{type:"string, number, boolean, date, time, object",bindable:"in-out-bound",widget:"string",getTypeFrom:"dataset",getIsListFrom:"expr:multiple"},scopedataset:{type:"string"},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},allownone:{type:"boolean"},hasdownarrow:{type:"boolean",value:!0},restrictvalues:{type:"boolean",value:!0},disabled:{value:!1,bindable:"in-bound"},multiple:{type:"boolean",value:!1},placeholder:{type:"string",value:"",bindable:"in-bound"},shortcutkey:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["input-lg","input-sm"]},backgroundcolor:{type:"string",widget:"color"},displayValue:{type:"string",getIsListFrom:"expr:multiple",show:!1,bindable:"out-bound"}},"wm.marquee":{height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},direction:{type:"list",options:["up","down","left","right"]},behavior:{type:"list",options:["scroll","slide","alternate"]},scrolldelay:{type:"number"},scrollamount:{type:"number"}},"wm.label":{caption:{type:"date, string, number",widget:"string",value:"Label",bindable:"in-out-bound",maxlength:256,showPrettyExprInDesigner:!0},required:{type:"boolean"},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"inline-block"},animation:{type:"list",options:animationOptions},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["h1","h2","h3","h4","h5","h6","p","text-ellipsis","text-left","text-right","text-center","text-muted","text-primary","text-success","text-info","text-warning","text-danger","label-default","label-primary","label-success","label-info","label-warning","label-danger","vertical-align-top","vertical-align-middle","vertical-align-bottom","lead","badge","form-control-static","control-label"]},whitespace:{type:"list",options:[" ","normal","nowrap","pre","pre-line","pre-wrap"],value:" "},wordbreak:{type:"list",options:["break-word","normal"]},horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align",show:!1}},"wm.picture":{hint:{type:"string",bindable:"in-bound"},height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},picturesource:{type:"string",value:"resources/images/imagelists/default-image.png",bindable:"in-out-bound",showPrettyExprInDesigner:!0},encodeurl:{type:"boolean",value:!1},pictureaspect:{type:"list",options:["Both","H","None","V"],value:"None"},disabled:{type:"boolean",show:!1,bindable:"in-bound"},tabindex:{type:"number",value:"0"},shape:{type:"list",options:["","rounded","circle","thumbnail"]},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"inline-block"},animation:{type:"list",options:animationOptions},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["img-responsive"]},margin:{type:"string",widget:"box-model"},borderwidth:{type:"string",widget:"box-model"},borderstyle:{type:"string",options:["dashed","dotted","none","solid"],widget:"border-style"},bordercolor:{type:"string",widget:"color"},padding:{type:"string",widget:"box-model"},backgroundcolor:{type:"string",widget:"color"},backgroundgradient:{type:"string"},backgroundimage:{type:"string",bindable:"in-bound"},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"]},backgroundsize:{type:"string",hint:"width, height"},backgroundposition:{type:"string",hint:"top, left"},backgroundattachment:{type:"list",options:["fixed","local","scroll"]},cursor:{type:"list",options:["default","pointer"]}},"wm.picture.mobile":{offline:{type:"boolean",value:!0}},"wm.textarea":{autofocus:{type:"boolean"},readonly:{type:"boolean",bindable:"in-bound"},datavalue:{type:"string",bindable:"in-out-bound"},scopedatavalue:{type:"string"},placeholder:{type:"string",value:"Place your text",bindable:"in-bound"},maxchars:{type:"number",bindable:"in-bound"},updateon:{type:"list",value:"blur",widget:"update-on"},updatedelay:{type:"number",value:0},shortcutkey:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["input-lg","input-sm"]},backgroundcolor:{type:"string",widget:"color"}},"wm.basicdialog":{show:{type:"boolean",show:!1},height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},onOpened:{type:"event",options:widgetEventOptions,widget:"eventlist"},animation:{type:"list",options:animationOptions},tabindex:{type:"number",value:"0"},title:{type:"string",maxlength:256,bindable:"in-bound",showPrettyExprInDesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex},iconwidth:{type:"string",pattern:dimensionRegex},iconheight:{type:"string",pattern:dimensionRegex},iconmargin:{type:"string",pattern:dimensionRegex},actiontitle:{type:"string",show:!1,pattern:dimensionRegex},actionlink:{type:"string",show:!1,pattern:dimensionRegex},closable:{type:"boolean",show:!1},contentclass:{type:"string",pattern:classRegex,show:!1}},"wm.dialog.dialogheader":{caption:{type:"string",maxlength:256,bindable:"in-bound",showPrettyExprInDesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex},iconwidth:{type:"string",pattern:dimensionRegex},iconheight:{type:"string",pattern:dimensionRegex},iconmargin:{type:"string",pattern:dimensionRegex},closable:{type:"boolean",show:!1}},"wm.dialog.onOk":{onOk:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.alertdialog":{title:{type:"string",value:"Alert",bindable:"in-bound",showPrettyExprInDesigner:!0},oktext:{type:"string",value:"OK",bindable:"in-bound"},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",value:"wi wi-warning",pattern:classRegex},message:{type:"string",value:"I am an alert box!",bindable:"in-bound",showPrettyExprInDesigner:!0},alerttype:{type:"list",options:["error","information","success","warning"],value:"error"},modal:{type:"boolean",value:!1},keyboard:{type:"boolean",value:!0}},"wm.confirmdialog":{title:{type:"string",value:"Confirm",bindable:"in-bound",showPrettyExprInDesigner:!0},canceltext:{type:"string",value:"CANCEL",bindable:"in-bound"},oktext:{type:"string",value:"OK",bindable:"in-bound"},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",value:"wi wi-done",pattern:classRegex},message:{type:"string",value:"I am confirm box!",bindable:"in-bound",showPrettyExprInDesigner:!0},onCancel:{type:"event",options:widgetEventOptions,widget:"eventlist"},modal:{type:"boolean",value:!1},keyboard:{type:"boolean",value:!0}},"wm.iframedialog":{title:{type:"string",value:"External Content",bindable:"in-bound",showPrettyExprInDesigner:!0},url:{type:"string",value:"http://www.wavemaker.com",bindable:"in-out-bound"},encodeurl:{type:"boolean",value:!1},height:{type:"string",value:"400",pattern:dimensionRegex},onClose:{type:"event",options:widgetEventOptions,widget:"eventlist"},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",value:"wi wi-globe",pattern:classRegex},oktext:{type:"string",value:"OK",bindable:"in-bound"},closable:{type:"boolean",value:!0},showactions:{type:"boolean",value:!0},showheader:{type:"boolean",value:!0},modal:{type:"boolean",value:!1},keyboard:{type:"boolean",value:!0}},"wm.pagedialog":{title:{type:"string",value:"Page Content",bindable:"in-bound",showPrettyExprInDesigner:!0},oktext:{type:"string",value:"OK",bindable:"in-bound"},onClose:{type:"event",options:widgetEventOptions,widget:"eventlist"},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",value:"wi wi-file",pattern:classRegex},closable:{type:"boolean",value:!0},showactions:{type:"boolean",value:!0},modal:{type:"boolean",value:!1},keyboard:{type:"boolean",value:!0}},"wm.logindialog":{tabindex:{show:!1},height:{type:"string",show:!1,pattern:dimensionRegex},onClose:{type:"event",options:widgetEventOptions,widget:"eventlist"},closable:{type:"boolean",value:!0},modal:{type:"boolean",value:!0},keyboard:{type:"boolean",value:!0},onSubmit:{type:"event",options:widgetEventOptions,widget:"eventlist"},title:{type:"string",maxlength:256,bindable:"in-bound",showPrettyExprInDesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex},iconwidth:{type:"string",pattern:dimensionRegex},iconheight:{type:"string",pattern:dimensionRegex},iconmargin:{type:"string",pattern:dimensionRegex}},"wm.designdialog":{modal:{type:"boolean",value:!1},onClose:{type:"event",options:widgetEventOptions,widget:"eventlist"},keyboard:{type:"boolean",value:!0},closable:{type:"boolean",value:!0},title:{type:"string"},showheader:{type:"boolean",value:!0}},"wm.spinner":{show:{type:"boolean",value:!1},caption:{type:"string",value:"Loading...",maxlength:256},servicevariabletotrack:{type:"list",options:[]},iconclass:{type:"string",value:"fa fa-circle-o-notch",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex},iconsize:{type:"string",pattern:dimensionRegex},image:{type:"string",bindable:"in-bound"},imagewidth:{type:"string",value:"20px"},imageheight:{type:"string"},animation:{type:"list",value:"spin",options:spinnerAnimationOptions},type:{type:"list",value:"icon",options:["image","icon"]},backgroundcolor:{type:"string",widget:"color"},backgroundgradient:{type:"string"},backgroundimage:{type:"string",bindable:"in-bound"},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"]},backgroundsize:{type:"string",hint:"width, height"},backgroundposition:{type:"string",hint:"top, left"},backgroundattachment:{type:"list",
options:["fixed","local","scroll"]},color:{type:"string",hidelabel:!0,widget:"color"},fontweight:{type:"string",options:["bold"],hidelabel:!0,widget:"icons-checkbox"},fontsize:{type:"number",hidelabel:!0,hint:"Font size",pattern:numberRegex},fontunit:{type:"string",options:["em","px","pt"],value:"px",hidelabel:!0,widget:"icons-radio"},textdecoration:{type:"string",options:["underline"],hidelabel:!0,widget:"icons-checkbox"},fontstyle:{type:"string",options:["italic"],hidelabel:!0,widget:"icons-checkbox"},fontVariant:{type:"list",options:["normal","small-caps"]},fontfamily:{type:"string",hidelabel:!0,hint:"Arial, Geneva"}},"wm.layouts":{name:{type:"string",pattern:nameRegex,maxlength:32},class:{type:"string",pattern:classRegex},borderwidth:{type:"string",widget:"box-model"},borderstyle:{type:"string",options:["dashed","dotted","none","solid"],widget:"border-style"},bordercolor:{type:"string",widget:"color"},padding:{type:"string",widget:"box-model"},backgroundcolor:{type:"string",widget:"color"},backgroundgradient:{type:"string"},backgroundimage:{type:"string",bindable:"in-bound"},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"]},backgroundsize:{type:"string",hint:"width, height"},backgroundposition:{type:"string",hint:"top, left"},backgroundattachment:{type:"list",options:["fixed","local","scroll"]},color:{type:"string",hidelabel:!0,widget:"color"},overflow:{type:"list",options:["visible","hidden","scroll","auto","initial","inherit"]},accessroles:{type:"access-roles-select",options:roles,value:EVERYONE}},"wm.containers":{name:{type:"string",pattern:nameRegex,maxlength:32},class:{type:"string",pattern:classRegex},show:{type:"boolean",value:!0,bindable:"in-bound"},deferload:{type:"boolean",value:!1,show:!1,ignoreGetterSetters:!0},height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},accessroles:{type:"access-roles-select",options:roles,value:EVERYONE},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"block"},padding:{type:"string",widget:"box-model"},backgroundcolor:{type:"string",widget:"color"},backgroundgradient:{type:"string"},backgroundimage:{type:"string",bindable:"in-bound"},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"]},backgroundsize:{type:"string",hint:"width, height"},backgroundposition:{type:"string",hint:"top, left"},backgroundattachment:{type:"list",options:["fixed","local","scroll"]},color:{type:"string",hidelabel:!0,widget:"color"},fontweight:{type:"string",options:["bold"],hidelabel:!0,widget:"icons-checkbox"},fontsize:{type:"number",hidelabel:!0,hint:"Font size",pattern:numberRegex},fontunit:{type:"string",options:["em","px","pt"],value:"px",hidelabel:!0,widget:"icons-radio"},textdecoration:{type:"string",options:["underline"],hidelabel:!0,widget:"icons-checkbox"},fontstyle:{type:"string",options:["italic"],hidelabel:!0,widget:"icons-checkbox"},fontfamily:{type:"string",hidelabel:!0,hint:"Arial, Geneva"},horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align"}},"wm.containers.borderstyle":{borderwidth:{type:"string",widget:"box-model"},borderstyle:{type:"string",options:["dashed","dotted","none","solid"],widget:"border-style"},bordercolor:{type:"string",widget:"color"}},"wm.containers.lazy":{loadmode:{type:"list",options:["","after-select","after-delay"],value:""},loaddelay:{type:"number",min:"10",value:"10"},onReady:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.layouts.header":{height:{type:"string",pattern:dimensionRegex}},"wm.layouts.list":{height:{type:"string",pattern:dimensionRegex},show:{type:"boolean",value:!0,bindable:"in-out-bound"},layout:{type:"list",options:["inline","vertical"],value:"vertical"},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"block"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["list-inline","list-group"]},name:{type:"string",pattern:nameRegex,maxlength:32},overflow:{type:"list",options:["visible","hidden","scroll","auto","initial","inherit"]}},"wm.layouts.breadcrumb":{height:{type:"string",pattern:dimensionRegex},show:{type:"boolean",value:!0,bindable:"in-out-bound"},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},scopedataset:{type:"string"}},"wm.layouts.nav":{height:{type:"string",pattern:dimensionRegex},show:{type:"boolean",value:!0,bindable:"in-out-bound"},layout:{type:"list",options:["","stacked","justified"]},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},scopedataset:{type:"string"},type:{type:"list",options:["pills","tabs"]},itemicon:{type:"list",options:[""],datasetfilter:"terminals"},itemlabel:{type:"list",options:[""],datasetfilter:"terminals"},itemlink:{type:"list",options:[""],datasetfilter:"terminals"},itembadge:{type:"list",options:[""],datasetfilter:"terminals"},itemaction:{type:"list",options:[""],datasetfilter:"terminals"},itemchildren:{type:"list",options:[""],datasetfilter:"objects"},userrole:{type:"list",options:[""],datasetfilter:"terminals"},addchild:{hidelabel:!0,options:[{label:"Anchor",widgettype:"wm-anchor",defaults:{"wm-anchor":{iconclass:"wi wi-file",margin:""}}},{label:"Menu",widgettype:"wm-menu",defaults:{"wm-menu":{iconclass:"wi wi-file",type:"anchor"}}},{label:"Popover",widgettype:"wm-popover",defaults:{"wm-popover":{iconclass:"wi wi-file"}}},{label:"Button",widgettype:"wm-button",defaults:{"wm-button":{iconclass:"wi wi-file"}}}],widget:"add-widget"},selecteditem:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",getTypeFrom:"dataset"},onSelect:{type:"event",options:widgetEventOptions,widget:"eventlist"},class:{type:"string",pattern:classRegex},orderby:{type:"list",widget:"order-by",datasetfilter:"terminals"},overflow:{type:"list",options:["visible","hidden","scroll","auto","initial","inherit"]},margin:{type:"string",widget:"box-model"},autoclose:{type:"list",options:["outsideClick","always","disabled"],value:"always"}},"wm.layouts.navbar":{height:{type:"string",pattern:dimensionRegex},show:{type:"boolean",value:!0,bindable:"in-out-bound"},menuiconclass:{type:"string",widget:"select-icon",pattern:classRegex,value:"wi wi-more-vert"},title:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},imgsrc:{type:"string",bindable:"in-bound"},backgroundcolor:{type:"string",widget:"color"},backgroundgradient:{type:"string"},backgroundimage:{type:"string",bindable:"in-bound"},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"]},backgroundsize:{type:"string",hint:"width, height"},backgroundposition:{type:"string",hint:"top, left"},backgroundattachment:{type:"list",options:["fixed","local","scroll"]},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["navbar-inverse"]}},"wm.layouts.mobile.navbar":{height:{type:"string",pattern:dimensionRegex},show:{type:"boolean",value:!0,bindable:"in-out-bound"},title:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},leftnavpaneliconclass:{type:"string",widget:"select-icon",pattern:classRegex,value:"wi wi-menu"},backbutton:{type:"boolean",value:!0},backbuttoniconclass:{type:"string",widget:"select-icon",pattern:classRegex,value:"wi wi-back"},backbuttonlabel:{type:"string"},searchbutton:{type:"boolean",value:!1},searchbuttoniconclass:{type:"string",widget:"select-icon",pattern:classRegex,value:"wi wi-search",show:!1},searchbuttonlabel:{type:"string",show:!1},searchplaceholder:{type:"string",value:"Search",show:!1},onSearch:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBackbtnclick:{type:"event",options:widgetEventOptions,widget:"eventlist"},imgsrc:{type:"string",bindable:"in-bound"},scopedatavalue:{type:"string"},datavalue:{type:"string, object",widget:"string",bindable:"in-out-bound",getTypeFrom:"dataset"},scopedataset:{type:"string"},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},searchkey:{type:"string",widget:"select-all",datasetfilter:"terminals"},displaylabel:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},displayimagesrc:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},datafield:{type:"list",options:["All Fields"],value:"All Fields",datasetfilter:"terminals",allfields:!0},defaultview:{type:"select-by-object",options:[{label:"action-view",value:"actionview"},{label:"search-view",value:"searchview"}],value:"actionview",displayfield:"label",datafield:"value"},query:{type:"string",bindable:"in-out-bound",value:""},addchild:{label:"Add",hidelabel:!0,options:[{label:"Anchor",widgettype:"wm-anchor",defaults:{iconclass:"wi wi-plus",caption:"",margin:""}},{label:"Menu",widgettype:"wm-menu",defaults:{iconclass:"wi wi-plus",type:"anchor",caption:""}},{label:"Popover",widgettype:"wm-popover",defaults:{iconclass:"wi wi-plus",caption:""}},{label:"Button",widgettype:"wm-button",defaults:{iconclass:"wi wi-plus",class:"navbar-btn btn-primary",caption:""}}],widget:"add-widget"},backgroundcolor:{type:"string",widget:"color"},backgroundgradient:{type:"string"},backgroundimage:{type:"string",bindable:"in-bound"},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"]},backgroundsize:{type:"string",hint:"width, height"},backgroundposition:{type:"string",hint:"top, left"},backgroundattachment:{type:"list",options:["fixed","local","scroll"]}},"wm.layouts.listtemplate":{name:{type:"string",pattern:nameRegex,maxlength:32}},"wm.layouts.mediatemplate":{width:{type:"string",pattern:dimensionRegex,value:"100pt"},height:{type:"string",pattern:dimensionRegex,value:"100pt"}},"wm.layouts.listitem":{height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},name:{type:"string",pattern:nameRegex,maxlength:32},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["list-group-item","list-group-item-success","list-group-item-info","list-group-item-warning","list-group-item-danger"]}},"wm.layouts.topnav":{height:{type:"string",pattern:dimensionRegex}},"wm.layouts.leftpanel":{columnwidth:{type:"list",options:["1","2","3","4","5","6","7","8","9","10","11","12"],value:"2"},animation:{type:"list",options:["slide-in","slide-over"],value:"slide-in"}},"wm.layouts.rightpanel":{columnwidth:{type:"list",options:["1","2","3","4","5","6","7","8","9","10","11","12"],value:"2"}},"wm.layouts.content":{height:{type:"string",pattern:dimensionRegex}},"wm.layouts.panel":{height:{type:"string",pattern:dimensionRegex},title:{type:"string",value:"Title",bindable:"in-bound",showPrettyExprInDesigner:!0},subheading:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex,label:"Title Icon Class"},iconurl:{type:"string",bindable:"in-bound"},iconwidth:{type:"string",pattern:dimensionRegex},iconheight:{type:"string",pattern:dimensionRegex},iconmargin:{type:"string",pattern:dimensionRegex},collapsible:{type:"boolean"},enablefullscreen:{type:"boolean"},expanded:{type:"boolean",value:!0},closable:{type:"boolean"},helptext:{type:"string",bindable:"in-out-bound",widget:"textarea"},actions:{type:"array, object",bindable:"in-bound",widget:"string"},badgevalue:{type:"string, number",widget:"string",bindable:"in-out-bound"},badgetype:{type:"string",widget:"list",options:["default","primary","success","info","warning","danger"],value:"default",bindable:"in-out-bound"},margin:{type:"string",widget:"box-model"},onEnterkeypress:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseenter:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseleave:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseout:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseover:{type:"event",options:widgetEventOptions,widget:"eventlist"},onClose:{type:"event",options:widgetEventOptions,widget:"eventlist"},onExpand:{type:"event",options:widgetEventOptions,widget:"eventlist"},onCollapse:{type:"event",options:widgetEventOptions,widget:"eventlist"},onFullscreen:{type:"event",options:widgetEventOptions,widget:"eventlist"},onExitfullscreen:{type:"event",options:widgetEventOptions,widget:"eventlist"},onActionsclick:{type:"event",options:widgetEventOptions,widget:"eventlist"},animation:{type:"list",options:animationOptions}},"wm.layouts.panel.defaults":{class:{type:"string",pattern:classRegex,widget:"list-picker",options:["panel-default","panel-primary","panel-success","panel-info","panel-warning","panel-danger"]}},"wm.layouts.card":{title:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},subheading:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex,label:"Title Icon Class"},iconurl:{type:"string",bindable:"in-bound"},margin:{type:"string",widget:"box-model"},picturesource:{type:"string",value:"",bindable:"in-out-bound"},picturetitle:{type:"string",bindable:"in-bound"},imageheight:{type:"string",value:"200px"},width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},actions:{type:"array, object",bindable:"in-bound",widget:"string"},onEnterkeypress:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseenter:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseleave:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseout:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseover:{type:"event",options:widgetEventOptions,widget:"eventlist"},animation:{type:"list",options:animationOptions},class:{type:"string",pattern:classRegex}},"wm.layouts.cardcontent":{width:{type:"string",pattern:dimensionRegex,show:!1}},"wm.layouts.cardactions":{horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align"}},"wm.layouts.cardfooter":{horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align"}},"wm.layouts.container":{margin:{type:"string",widget:"box-model"},borderwidth:{type:"string",widget:"box-model"},borderstyle:{type:"string",options:["dashed","dotted","none","solid"],widget:"border-style"},bordercolor:{type:"string",widget:"color"},opacity:{type:"string",widget:"slider"},cursor:{type:"list",options:["crosshair","default","e-resize","help","move","n-resize","ne-resize","nw-resize","pointer","progress","s-resize","se-resize","sw-resize","text","wait","w-resize"]},zindex:{type:"string",pattern:zindexRegex},visibility:{type:"list",options:visibilityOptions},display:{type:"list",options:displayOptions},onEnterkeypress:{type:"event",options:widgetEventOptions,widget:"eventlist"},onClick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onDblclick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onTap:{type:"event",options:widgetEventOptions,widget:"eventlist"},onDoubletap:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseenter:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseleave:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseout:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseover:{type:"event",options:widgetEventOptions,widget:"eventlist"},animation:{type:"list",options:animationOptions},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["well","alert","alert-success","alert-info","alert-warning","alert-danger","bordered"]},overflow:{type:"list",options:["visible","hidden","scroll","auto","initial","inherit"]}},"wm.layouts.tile":{margin:{type:"string",widget:"box-model"},onEnterkeypress:{type:"event",options:widgetEventOptions,widget:"eventlist"},onClick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onDblclick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onTap:{type:"event",options:widgetEventOptions,widget:"eventlist"},onDoubletap:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseenter:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseleave:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseout:{type:"event",options:widgetEventOptions,widget:"eventlist"},onMouseover:{type:"event",options:widgetEventOptions,widget:"eventlist"},animation:{type:"list",options:animationOptions},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["card","well","bg-primary","bg-success","bg-info","bg-warning","bg-danger"]}},"wm.layouts.footer":{height:{type:"string",pattern:dimensionRegex},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["card-footer"]}},"wm.layouts.layoutgrid":{name:{type:"string",pattern:nameRegex,maxlength:32},class:{type:"string",pattern:classRegex,widget:"list-picker",value:"condensed",options:["condensed","standard","bordered"]},height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},show:{type:"boolean",value:!0,bindable:"in-bound"},deferload:{type:"boolean",value:!1,show:!1,ignoreGetterSetters:!0},insert:{type:"toolbar",actions:[{action:"addrow",label:"LABEL_PROPERTY_ADDROW",icon:"add-row"}]},columns:{type:"list",options:["1","2","3","4","6","12"]},backgroundcolor:{type:"string",widget:"color",show:!1},backgroundgradient:{type:"string",show:!1},backgroundimage:{type:"string",bindable:"in-bound",show:!1},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"],show:!1},backgroundsize:{type:"string",hint:"width, height",show:!1},backgroundposition:{type:"string",hint:"top, left",show:!1},backgroundattachment:{type:"list",options:["fixed","local","scroll"],show:!1},padding:{type:"string",widget:"box-model",show:!1}},"wm.layouts.gridcolumn":{name:{type:"string",pattern:nameRegex,maxlength:32},horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align"},borderwidth:{type:"string",widget:"box-model",show:!1},borderstyle:{type:"string",options:["dashed","dotted","none","solid"],widget:"border-style",show:!1},bordercolor:{type:"string",widget:"color",show:!1},padding:{type:"string",widget:"box-model"},backgroundcolor:{type:"string",widget:"color",show:!1},backgroundgradient:{type:"string",show:!1},backgroundimage:{type:"string",bindable:"in-bound",show:!1},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"],show:!1},backgroundsize:{type:"string",hint:"width, height",show:!1},backgroundposition:{type:"string",hint:"top, left",show:!1},backgroundattachment:{type:"list",options:["fixed","local","scroll"],show:!1},height:{type:"string",pattern:dimensionRegex},columnwidth:{type:"list",options:["1","2","3","4","5","6","7","8","9","10","11","12"]},insert:{type:"toolbar",actions:[{action:"addcolumnleft",label:"LABEL_PROPERTY_ADDCOLUMNLEFT",icon:"add-column-left"},{action:"addcolumnright",label:"LABEL_PROPERTY_ADDCOLUMNRIGHT",icon:"add-column-right"}]},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["visible-xs-block","visible-sm-block","visible-md-block","visible-lg-block","hidden-xs","hidden-sm","hidden-md","hidden-lg","bordered","bordered-left","bordered-right","bordered-top","bordered-bottom"]}},"wm.layouts.gridrow":{name:{type:"string",pattern:nameRegex,maxlength:32},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["bordered-top","bordered-bottom"]},borderwidth:{type:"string",widget:"box-model",show:!1},borderstyle:{type:"string",options:["dashed","dotted","none","solid"],widget:"border-style",show:!1},bordercolor:{type:"string",widget:"color",show:!1},padding:{type:"string",widget:"box-model"},backgroundcolor:{type:"string",widget:"color",show:!1},height:{type:"string",pattern:dimensionRegex},overflow:{type:"list",options:["visible","hidden","scroll","auto","initial","inherit"]},insert:{type:"toolbar",actions:[{action:"addrowbelow",label:"LABEL_PROPERTY_ADDROWBELOW",icon:"add-row-below"},{action:"addrowabove",label:"LABEL_PROPERTY_ADDROWABOVE",icon:"add-row-above"},{action:"addcolumn",label:"LABEL_PROPERTY_ADDCOLUMN",icon:"add-column"}]}},"wm.layouts.column":{columnwidth:{type:"list",options:["1","2","3","4","5","6","7","8","9","10","11","12"]}},"wm.layouts.pagecontent":{columnwidth:{type:"list",options:["1","2","3","4","5","6","7","8","9","10","11","12"]},padding:{type:"string",widget:"box-model"}},"wm.layouts.row":{show:{type:"boolean",value:!0}},"wm.layouts.view":{show:{type:"boolean",value:!0,bindable:"in-out-bound"},deferload:{type:"boolean",value:!1,show:!1,ignoreGetterSetters:!0},viewgroup:{type:"string",value:"default"},animation:{type:"list",options:animationOptions}},"wm.layouts.form":{title:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},subheading:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},novalidate:{type:"boolean",value:!1,showindesigner:!0},autocomplete:{type:"boolean",value:!0,showindesigner:!0},action:{type:"string",bindable:"in-bound",showindesigner:!0},target:{type:"list",options:["_blank","_parent","_self","_top"],value:"",widget:"data-list",showindesigner:!0},method:{type:"list",options:["post","put","delete"],showindesigner:!0},height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},dataset:{type:"array, object",widget:"string",bindable:"in-bound"},captionsize:{type:"string",showindesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-bound",pattern:classRegex,label:"Title Icon Class"},formdata:{type:"object",bindable:"in-bound",widget:"string",getTypeFrom:"dataset"},dataoutput:{type:"object",bindable:"out-bound",widget:"string",getTypeFrom:"dataset"},messagelayout:{type:"list",options:["Inline","Toaster"],value:"Inline",showindesigner:!0},postmessage:{type:"string",value:"Data posted successfully",bindable:"in-bound",showindesigner:!0},errormessage:{type:"string",value:"An error occured. Please try again!",bindable:"in-bound",showindesigner:!0},captionalign:{type:"list",options:["left","center","right"],value:"left",showindesigner:!0,widget:"icons-align"},enctype:{type:"list",options:["application/x-www-form-urlencoded","multipart/form-data","text/plain"],showindesigner:!0},metadata:{type:"array, object",bindable:"in-bound",widget:"string",show:!1},advancedsettings:{type:"button",hidelabel:!0,iconclass:"settings"},captionposition:{type:"list",options:["left","right","top"],value:"left",showindesigner:!0,widget:"icons-radio",prefix:"position-"},onResult:{type:"event",options:widgetEventOptions,widget:"eventlist"},onError:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSuccess:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSubmit:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBeforerender:{type:"event",options:widgetEventOptions,widget:"eventlist",show:!1},onBeforesubmit:{type:"event",options:widgetEventOptions,widget:"eventlist"},tabindex:{type:"number",value:"0"},backgroundcolor:{type:"string",widget:"color"},backgroundgradient:{type:"string"},backgroundimage:{type:"string",bindable:"in-bound"},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"]},backgroundsize:{type:"string",hint:"width, height"},backgroundposition:{type:"string",hint:"top, left"},backgroundattachment:{type:"list",options:["fixed","local","scroll"]},margin:{type:"string",widget:"box-model"},formWidgets:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",isWidgetMap:!0}},"wm.layouts.login":{height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},onSubmit:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBeforerender:{type:"event",options:widgetEventOptions,widget:"eventlist"},class:{type:"string",pattern:classRegex,widget:"list-picker"},margin:{type:"string",widget:"box-model"}},"wm.layouts.liveform":{title:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},subheading:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},formlayout:{type:"switch",options:[{label:"INLINE",value:"inline"},{label:"PAGE",value:"page"}],value:"inline",show:!1,displayfield:"label",datafield:"value"},autocomplete:{type:"boolean",value:!1,showindesigner:!0},captionsize:{type:"string",value:"",showindesigner:!0},captionalign:{type:"string",options:["left","center","right"],value:"left",showindesigner:!0,widget:"icons-align"},captionposition:{type:"string",options:["left","right","top"],value:"left",showindesigner:!0,widget:"icons-radio",prefix:"position-"},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},advancedsettings:{type:"button",hidelabel:!0,iconclass:"settings"},height:{type:"string",pattern:dimensionRegex},rowdata:{type:"string"},formdata:{type:"object",bindable:"in-bound",widget:"string",getTypeFrom:"dataset"},dataoutput:{type:"object",bindable:"out-bound",widget:"string",getTypeFrom:"dataset"},novalidate:{type:"boolean",value:!0,showindesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-bound",pattern:classRegex,label:"Title Icon Class"},horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align",show:!1},defaultmode:{type:"switch",options:[{label:"READ ONLY",value:"View"},{label:"EDITABLE",value:"Edit"}],value:"View",showindesigner:!0,displayfield:"label",datafield:"value"},width:{type:"string",pattern:dimensionRegex},messagelayout:{type:"list",options:["Inline","Toaster"],value:"Toaster",showindesigner:!0},insertmessage:{type:"string",value:"Record added successfully",bindable:"in-bound",showindesigner:!0},updatemessage:{type:"string",value:"Record updated successfully",bindable:"in-bound",showindesigner:!0},deletemessage:{type:"string",value:"Record deleted successfully",bindable:"in-bound",showindesigner:!0},errormessage:{type:"string",value:"An error occured. Please try again!",bindable:"in-bound",showindesigner:!0},onBeforeservicecall:{type:"event",options:widgetEventOptions,widget:"eventlist"},onResult:{type:"event",options:widgetEventOptions,widget:"eventlist"},onError:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSuccess:{type:"event",options:widgetEventOptions,widget:"eventlist"},tabindex:{type:"number",value:"0"},onBackbtnclick:{type:"event",options:widgetEventOptions,widget:"eventlist",show:!1},backgroundcolor:{type:"string",widget:"color"},backgroundgradient:{type:"string"},backgroundimage:{type:"string",bindable:"in-bound"},backgroundrepeat:{type:"list",options:["no-repeat","repeat","repeat-x","repeat-y"]},backgroundsize:{type:"string",hint:"width, height"},backgroundposition:{type:"string",hint:"top, left"},backgroundattachment:{type:"list",options:["fixed","local","scroll"]},margin:{type:"string",widget:"box-model"},formWidgets:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",isWidgetMap:!0}},"wm.layouts.segmentedcontrol":{onBeforesegmentchange:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSegmentchange:{type:"event",options:widgetEventOptions,widget:"eventlist"},width:{show:!1},height:{type:"string",pattern:dimensionRegex},tabindex:{type:"number",value:"0"},addchild:{label:"Add",hidelabel:!0,options:[{label:"Segmented Content",widgettype:"wm-segment-content"}],widget:"add-widget"}},"wm.layouts.segmentcontent":{caption:{type:"string",bindable:"in-out-bound",maxlength:256,showPrettyExprInDesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex}},"wm.grid":{width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},scopedataset:{type:"string"},pagesize:{type:"number"},advancedsettings:{type:"button",hidelabel:!0,iconclass:"settings"},gridfirstrowselect:{type:"boolean",showindesigner:!0},confirmdelete:{type:"string",value:"Are you sure you want to delete this?",bindable:"in-bound",show:!0,showindesigner:!0},deleterow:{type:"boolean",bindable:"in-bound",show:!1},updaterow:{type:"boolean",bindable:"in-bound",show:!1},showheader:{type:"boolean",value:!0,showindesigner:!0},gridsearch:{type:"boolean",show:!1,showindesigner:!1},rowclass:{type:"string",value:"",showindesigner:!0},rowngclass:{showindesigner:"true",widget:"conditional-expression"},filtermode:{type:"select-by-object",options:[{label:"No Filter",value:""},{label:"Search",value:"search"},{label:"Multi-column",value:"multicolumn"}],value:"",displayfield:"label",datafield:"value",showindesigner:!0},searchlabel:{type:"string",value:"Search",bindable:"in-bound",show:!1,showindesigner:!1,alignright:!0},enablesort:{type:"boolean",value:!0,showindesigner:!0},enablecolumnselection:{type:"boolean",value:!1,showindesigner:!0},showrowindex:{type:"boolean",showindesigner:!0},multiselect:{type:"boolean",showindesigner:!0},radioselect:{type:"boolean",showindesigner:!0},insertrow:{type:"boolean",bindable:"in-bound",show:!1},editmode:{type:"string",value:"",show:!1},showrecordcount:{type:"boolean",show:!1,showindesigner:!0},navigation:{type:"list",options:["Basic","Pager","Classic","None"],value:"Basic",showindesigner:!0},navigationalign:{type:"string",options:["left","center","right"],widget:"icons-align",value:"left",showindesigner:!0},filternullrecords:{type:"boolean",value:!0},nodatamessage:{type:"string",value:"No data found.",bindable:"in-bound",showindesigner:!0},loadingdatamsg:{type:"string",value:"Loading...",bindable:"in-bound",showindesigner:!0},loadingicon:{type:"string",widget:"select-icon",bindable:"in-bound",value:"fa fa-spinner fa-spin",pattern:classRegex},deletemessage:{type:"string",value:"Record deleted successfully",bindable:"in-bound",show:!0,showindesigner:!0},errormessage:{type:"string",value:"",bindable:"in-bound",showindesigner:!0},insertmessage:{type:"string",value:"Record added successfully",bindable:"in-bound",showindesigner:!0},updatemessage:{type:"string",value:"Record updated successfully",bindable:"in-bound",showindesigner:!0},selecteditem:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",getTypeFrom:"dataset",getIsListFrom:"expr:multiselect"},title:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},subheading:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-bound",pattern:classRegex,label:"Title Icon Class"},spacing:{type:"list",options:["normal","condensed"],value:"normal"},exportformat:{type:"list",widget:"select-all",options:["EXCEL","CSV"],showindesigner:!0},exportdatasize:{type:"number",value:100,showindesigner:!0},margin:{type:"string",widget:"box-model",show:!1},onClick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onTap:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSelect:{type:"event",options:widgetEventOptions,widget:"eventlist"},onDeselect:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSort:{type:"event",options:widgetEventOptions,widget:"eventlist"},onHeaderclick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onShow:{type:"event",options:widgetEventOptions,widget:"eventlist"},onHide:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBeforeformrender:{type:"event",options:widgetEventOptions,widget:"eventlist"},onFormrender:{type:"event",options:widgetEventOptions,widget:"eventlist"},onRowdelete:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBeforerowinsert:{type:"event",options:widgetEventOptions,widget:"eventlist"},onRowinsert:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBeforerowupdate:{type:"event",options:widgetEventOptions,widget:"eventlist"},onRowupdate:{type:"event",options:widgetEventOptions,widget:"eventlist"},onRowclick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onRowdblclick:{type:"event",options:widgetEventOptions,widget:"eventlist"},onColumnselect:{type:"event",options:widgetEventOptions,widget:"eventlist"},onColumndeselect:{type:"event",options:widgetEventOptions,widget:"eventlist"},onEnterkeypress:{
type:"event",options:widgetEventOptions,widget:"eventlist"},onSetrecord:{type:"event",options:widgetEventOptions,widget:"eventlist"},onDatarender:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBeforedatarender:{type:"event",options:widgetEventOptions,widget:"eventlist"},gridclass:{type:"string",value:"table-bordered table-striped table-hover",pattern:classRegex,widget:"list-picker",options:["table-hover","table-bordered","table-striped"]},tabindex:{type:"number",value:"0"}},"wm.livegrid":{formlayout:{type:"list",options:["inline","dialog"],value:"inline"}},"wm.fileupload":{service:{type:"list",widget:"list"},operation:{type:"list",widget:"list"},multiple:{type:"boolean",value:!1},contenttype:{type:"list",widget:"list-picker",options:["image/*","audio/*","video/*",".txt",".zip",".rar",".js",".json",".xls",".xlsx",".pdf",".csv",".xml",".doc",".docx",".log",".rtf",".bmp",".gif",".jpe",".jpg",".jpeg",".tif",".tiff",".pbm",".png",".ico","mp3",".ogg",".webm",".wma",".3gp",".wav","mp4",".ogg",".webm",".wmv",".mpeg",".mpg",".avi"]},fileuploadmessage:{type:"string",bindable:"in-out-bound",value:"You can also browse for files"},tabindex:{type:"number",value:"0"},uploadedFiles:{type:"array",isList:!0,bindable:"in-out-bound",getTypeFrom:"expr:getPropertyType('uploadedFiles')"},selectedFiles:{type:"array, file",isList:!0,bindable:"in-out-bound",show:"false",getTypeFrom:"expr:getPropertyType('selectedFiles')"},mode:{type:"list",options:["Upload","Select"],value:"Upload"},destination:{type:"string",widget:"fileupload-relativepath",bindable:"in-out-bound",value:"",info:"/resources/uploads/"},maxfilesize:{type:"string",widget:"fileupload-relativepath",value:"",info:"size in MB"},caption:{type:"string",value:"Upload",bindable:"in-out-bound",maxlength:256,showPrettyExprInDesigner:!0},disabled:{type:"boolean",value:!1,bindable:"in-bound"},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",value:"wi wi-file-upload",pattern:classRegex},filelistheight:{type:"string",pattern:dimensionRegex,show:!1},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["bg-primary","bg-success","bg-info","bg-warning","bg-danger"]},onSelect:{type:"event",options:widgetEventOptions,widget:"eventlist"},onProgress:{type:"event",options:widgetEventOptions,widget:"eventlist"},onAbort:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.fileupload.mobile":{fileuploadmessage:{show:!1},contenttype:{widget:"list",options:["image","audio","video","files"]}},"wm.youtube":{width:{value:"800px",pattern:dimensionRegex},height:{value:"125px",pattern:dimensionRegex},uploadpath:{type:"string"}},"wm.anchor":{iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex},iconurl:{type:"string",bindable:"in-bound"},iconwidth:{type:"string",pattern:dimensionRegex},iconheight:{type:"string",pattern:dimensionRegex},iconmargin:{type:"string",pattern:dimensionRegex},iconposition:{type:"list",options:["left","top","right"]},caption:{type:"string",value:"Link",bindable:"in-out-bound",maxlength:256,showPrettyExprInDesigner:!0},badgevalue:{type:"string",bindable:"in-out-bound"},hyperlink:{type:"string",bindable:"in-out-bound"},encodeurl:{type:"boolean",value:!1},target:{type:"list",options:["_blank","_parent","_self","_top"],value:"_self",widget:"data-list"},tabindex:{type:"number",value:"0"},whitespace:{type:"list",options:[" ","normal","nowrap","pre","pre-line","pre-wrap"],value:" "},wordbreak:{type:"list",options:["break-word","normal"]},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"inline"},animation:{type:"list",options:animationOptions},shortcutkey:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["h1","h2","h3","h4","h5","h6","btn-primary","btn-success","btn-info","btn-warning","btn-danger","btn-lg","btn-sm","btn-xs","btn-link","text-ellipsis","text-left","text-right","text-center","text-muted","text-primary","text-success","text-info","text-warning","text-danger","vertical-align-top","vertical-align-middle","vertical-align-bottom","lead","badge"]},horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align",show:!1}},"wm.popover":{contentsource:{type:"list",options:["inline","partial"],value:"partial"},content:{type:"string",options:[],widget:"pages-list",value:"",bindable:"in-bound"},inlinecontent:{type:"string",widget:"textarea"},hyperlink:{type:"string",value:"",show:!1},target:{type:"string",value:"",show:!1},popoverwidth:{type:"string"},popoverheight:{type:"string"},popoverarrow:{type:"boolean",value:!0},popoverautoclose:{type:"boolean",value:!0,show:!1},interaction:{type:"select-by-object",options:[{label:"Click",value:"click"},{label:"Hover",value:"hover"},{label:"Click and Hover",value:"default"}],value:"click"},popoverplacement:{type:"select-by-object",options:popoverOptions,value:"bottom"},title:{type:"string",bindable:"in-bound"},onShow:{type:"event",options:widgetEventOptions,widget:"eventlist"},onHide:{type:"event",options:widgetEventOptions,widget:"eventlist"},onLoad:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.prefabs":{margin:{type:"string",widget:"box-model"},debugurl:{type:"string",show:!1},width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},onLoad:{type:"event",options:widgetEventOptions,widget:"eventlist"},onDestroy:{type:"event",options:widgetEventOptions,widget:"eventlist"},animation:{type:"list",options:animationOptions},tabindex:{type:"number",value:"0"}},"wm.accordion":{addchild:{hidelabel:!0,options:[{label:"Add Accordion Pane",widgettype:"wm-accordionpane"}],widget:"add-widget"},closeothers:{type:"boolean",value:!0},height:{type:"string",pattern:dimensionRegex},tabindex:{type:"number",value:"0"},defaultpaneindex:{type:"number",value:0,bindable:"in-bound"},onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.accordionpane":{height:{type:"string",pattern:dimensionRegex},onExpand:{type:"event",options:widgetEventOptions,widget:"eventlist"},onCollapse:{type:"event",options:widgetEventOptions,widget:"eventlist"},title:{type:"string",value:"Title",bindable:"in-bound",showPrettyExprInDesigner:!0},subheading:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex,label:"Title Icon Class"},badgevalue:{type:"string",bindable:"in-out-bound"},badgetype:{type:"string",widget:"list",options:["default","primary","success","info","warning","danger"],value:"default",bindable:"in-out-bound"},tabindex:{type:"number",value:"0"},isdefaultpane:{type:"boolean",bindable:"in-bound",show:!1},padding:{type:"string",widget:"box-model"},backgroundcolor:{type:"string",widget:"color"},color:{type:"string",hidelabel:!0,widget:"color"},accessroles:{type:"access-roles-select",options:roles,value:EVERYONE}},"wm.richtexteditor":{hint:{type:"string"},show:{type:"boolean",value:!0},readonly:{type:"boolean",bindable:"in-bound"},datavalue:{type:"string",value:"",bindable:"in-out-bound"},showpreview:{type:"boolean",value:!1},placeholder:{type:"string",bindable:"in-bound"},tabindex:{type:"number",value:"0"},scopedatavalue:{type:"string"},onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"},width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex}},"wm.tabs":{addchild:{hidelabel:!0,options:[{label:"Add Tab Pane",widgettype:"wm-tabpane"}],widget:"add-widget"},tabsposition:{type:"list",options:["left","top","right","bottom"],value:"top"},taborder:{type:"list",widget:"tab-order",dataset:[]},transition:{type:"list",options:["none","slide"],value:"none"},name:{type:"string",pattern:nameRegex,maxlength:32},height:{type:"string",pattern:dimensionRegex},horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align"},defaultpaneindex:{type:"number",value:0,bindable:"in-bound"},onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.tab":{title:{type:"string",bindable:"in-bound"}},"wm.tabpane":{disabled:{type:"boolean",bindable:"in-bound"},onSelect:{type:"event",options:widgetEventOptions,widget:"eventlist"},onDeselect:{type:"event",options:widgetEventOptions,widget:"eventlist"},title:{type:"string",value:"Tab Title",bindable:"in-bound",showPrettyExprInDesigner:!0},paneicon:{type:"string",widget:"select-icon",bindable:"in-bound",pattern:classRegex,label:"Title Icon Class"},isdefaulttab:{type:"boolean",bindable:"in-bound",show:!1},tabindex:{type:"number",value:"0"},badgevalue:{type:"string",bindable:"in-out-bound"},badgetype:{type:"string",widget:"list",options:["default","primary","success","info","warning","danger"],value:"default",bindable:"in-out-bound"}},"wm.wizard":{addchild:{hidelabel:!0,options:[{label:"Add Step",widgettype:"wm-wizardstep"}],widget:"add-widget"},nextbtnlabel:{type:"string",value:"Next",bindable:"in-bound"},cancelbtnlabel:{type:"string",value:"Cancel",bindable:"in-bound"},previousbtnlabel:{type:"string",value:"Previous",bindable:"in-bound"},donebtnlabel:{type:"string",value:"Done",bindable:"in-bound"},onDone:{type:"event",options:widgetEventOptions,widget:"eventlist"},onCancel:{type:"event",options:widgetEventOptions,widget:"eventlist"},cancelable:{type:"boolean",value:!0,bindable:"in-bound"},stepstyle:{type:"list",options:["auto","justified"],value:"auto"}},"wm.wizardstep":{title:{type:"string",value:"Step Title",bindable:"in-bound",showPrettyExprInDesigner:!0},disablenext:{type:"boolean",value:!1,show:!1},enabledone:{type:"boolean",value:!1,show:!1},enableskip:{type:"boolean",value:!1,bindable:"in-bound"},iconclass:{type:"string",widget:"select-icon",bindable:"in-out-bound",pattern:classRegex,label:"Title Icon Class"},onNext:{type:"event",options:widgetEventOptions,widget:"eventlist"},onPrev:{type:"event",options:widgetEventOptions,widget:"eventlist"},onLoad:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSkip:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.carousel":{addchild:{hidelabel:!0,options:[{label:"Add Carousel",widgettype:"wm-carousel-content"}],widget:"add-widget"},dataset:{type:"array, object",bindable:"in-bound",widget:"string",show:!1},animationinterval:{type:"number",value:"3"},type:{type:"string",show:!1},currentslide:{type:"object",bindable:"out-bound",widget:"string",getTypeFrom:"dataset"},animation:{type:"list",options:["auto","none"],value:"auto"},controls:{type:"list",options:["navs","indicators","both","none"],value:"both"},class:{type:"string",pattern:classRegex},show:{type:"boolean",value:!0,bindable:"in-bound"},height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},accessroles:{type:"access-roles-select",options:roles,value:EVERYONE},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"block"},onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"},currentItem:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",getTypeFrom:"dataset"},nodatamessage:{type:"string",value:"No data found",bindable:"in-bound"}},"wm.tabbar":{dataset:{type:"array, object",bindable:"in-bound",widget:"string"},onSelect:{type:"event",options:widgetEventOptions,widget:"eventlist"},morebuttoniconclass:{type:"string",widget:"select-icon",pattern:classRegex,value:"wi wi-more-horiz"},morebuttonlabel:{type:"string",value:"more"}},"wm.tabbar.dataProps":{itemlabel:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},itemlink:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},itemicon:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"}},"wm.livelist":{name:{type:"string",pattern:nameRegex,maxlength:32},title:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},subheading:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},show:{type:"boolean",value:!0,bindable:"in-bound"},enablereorder:{type:"boolean"},accessroles:{type:"access-roles-select",options:roles,value:EVERYONE},onSelectionlimitexceed:{type:"event",options:widgetEventOptions,widget:"eventlist"},onReorder:{type:"event",options:widgetEventOptions,widget:"eventlist"},pagesize:{type:"number"},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},scopedataset:{type:"string"},selectionlimit:{type:"number",bindable:"in-bound"},itemsperrow:{type:"string",widget:"device-config"},selecteditem:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",getTypeFrom:"dataset",getIsListFrom:"expr:multiselect"},onEnterkeypress:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSetrecord:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBeforedatarender:{type:"event",options:widgetEventOptions,widget:"eventlist"},onPaginationchange:{type:"event",options:widgetEventOptions,widget:"eventlist"},itemclass:{type:"string",pattern:classRegex,widget:"list-picker",options:["list-group-item","media"],bindable:"in-bound"},listclass:{type:"string",pattern:classRegex,widget:"list-picker",options:["list-group","list-inline","media-list"]},iconclass:{type:"string",widget:"select-icon",bindable:"in-bound",value:"",pattern:classRegex,label:"Title Icon Class"},navigation:{type:"select-by-object",options:[{value:"Basic",label:"Basic"},{value:"Pager",label:"Pager"},{value:"Classic",label:"Classic"},{value:"Scroll",label:"Infinite Scroll"},{value:"Inline",label:"Horizontal Slider"},{value:"None",label:"None"},{value:"On-Demand",label:"On Demand"}],value:"None"},navigationalign:{type:"string",options:["left","center","right"],widget:"icons-align",value:"left"},selectfirstitem:{type:"boolean",value:!1,bindable:"in-bound"},tabindex:{type:"number",value:"0"},groupby:{type:"list",show:!0,widget:"list-typeahead",datasetfilter:"terminals"},match:{type:"list-group",nonGroupOptions:["alphabet","word"],options:[{name:"TIME",groupOptions:{hour:"hour",day:"day",week:"week",month:"month",year:"year"}}],show:!1,value:"word",datasetfilter:"none"},dateformat:{type:"list",options:[],widget:"date-time-patterns",show:!1},orderby:{type:"list",widget:"order-by",datasetfilter:"terminals"},nodatamessage:{type:"string",value:"No data found",bindable:"in-bound"},loadingdatamsg:{type:"string",value:"Loading...",bindable:"in-bound"},selectedItemWidgets:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",isWidgetMap:!0},currentItemWidgets:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",isWidgetMap:!0},currentItem:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",getTypeFrom:"dataset"},multiselect:{type:"boolean",value:!1},collapsible:{type:"boolean",show:!1},showcount:{type:"boolean",show:!1},disableitem:{type:"boolean",bindable:"in-bound",value:!1},ondemandmessage:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0,value:"Load More"},loadingicon:{type:"string",widget:"select-icon",bindable:"in-bound",value:"fa fa-circle-o-notch",pattern:classRegex},paginationclass:{type:"string",pattern:classRegex,widget:"list-picker",value:"btn-default",options:["pagination-sm","pagination-lg","btn-default","btn-primary","btn-info","btn-warning","btn-success","btn-danger","btn-inverse","btn-lg","btn-sm","btn-xs","btn-raised","btn-fab","btn-link","btn-transparent","jumbotron"]}},"wm.medialist":{dataset:{type:"array, object",bindable:"in-bound",widget:"string"},thumbnailurl:{type:"list",options:["All Fields"],value:"All Fields",datasetfilter:"terminals"},mediaurl:{type:"list",options:["All Fields"],value:"All Fields",datasetfilter:"terminals"},layout:{type:"list",options:["Single-row","Multi-row"],value:"Single-row"},tabindex:{type:"number",value:"0"},currentItem:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",getTypeFrom:"dataset"}},"wm.medialist.mobile":{offline:{type:"boolean",value:!0}},"wm.livefilter":{title:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},subheading:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},autocomplete:{type:"boolean",value:!0,showindesigner:!0},captionsize:{type:"string",value:"",showindesigner:!0},captionalign:{type:"string",options:["left","center","right"],value:"left",showindesigner:!0,widget:"icons-align"},captionposition:{type:"string",options:["left","right","top"],value:"left",showindesigner:!0,widget:"icons-radio",prefix:"position-"},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},scopedataset:{type:"string"},advancedsettings:{type:"button",hidelabel:!0,iconclass:"settings"},result:{type:"object",bindable:"out-bound",isList:!0,widget:"string",show:"false",getTypeFrom:"dataset"},pagesize:{type:"number",value:20},horizontalalign:{type:"string",options:["left","center","right"],widget:"icons-align",show:!1},iconclass:{type:"string",widget:"select-icon",bindable:"in-bound",value:"wi wi-filter-list",pattern:classRegex,label:"Title Icon Class"},autoupdate:{type:"boolean",showindesigner:!0},onBeforeservicecall:{type:"event",options:widgetEventOptions,widget:"eventlist"},onError:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSuccess:{type:"event",options:widgetEventOptions,widget:"eventlist"},tabindex:{type:"number",value:"0"},collapsible:{type:"boolean",showindesigner:!0},expanded:{type:"boolean",value:!0,showindesigner:!0},enableemptyfilter:{type:"select-all",options:["null","empty"],displaytype:"block",value:" ",showindesigner:!0},height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},margin:{type:"string",widget:"box-model"},backgroundcolor:{type:"string",widget:"color"},filterWidgets:{type:"object",bindable:"in-out-bound",show:!1,widget:"string",isWidgetMap:!0}},"wm.search":{scopedatavalue:{type:"string"},datavalue:{type:"string, object",widget:"string",bindable:"in-out-bound",getTypeFrom:"dataset"},scopedataset:{type:"string"},query:{type:"string",bindable:"out-bound"},searchkey:{type:"string",widget:"select-all",datasetfilter:"terminals"},displaylabel:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},displayimagesrc:{type:"string",widget:"list",options:[""],bindable:"in-bound",bindonly:"expression",datasetfilter:"terminals"},datafield:{type:"list",options:["All Fields"],value:"All Fields",datasetfilter:"terminals",allfields:!0},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},limit:{type:"number"},placeholder:{type:"string",value:"Search",bindable:"in-bound"},onSubmit:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSelect:{type:"event",options:widgetEventOptions,widget:"eventlist"},show:{type:"boolean",value:!0,bindable:"in-out-bound"},tabindex:{type:"number",value:"0"},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"inline-block"},width:{type:"string",value:"100%",pattern:dimensionRegex},shortcutkey:{type:"string"},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["input-group-sm","input-group-lg"]},casesensitive:{type:"boolean",show:"false",value:!1},navsearchbar:{type:"string",show:"false"},readonly:{type:"boolean",bindable:"in-bound"},type:{type:"string",widget:"list",options:["search","autocomplete"],value:"search",show:!0},orderby:{type:"list",widget:"order-by",datasetfilter:"terminals"},loadingdatamsg:{type:"string",value:"Loading items...",bindable:"in-bound"},datacompletemsg:{type:"string",value:"No more data to load",bindable:"in-bound"},height:{type:"string",pattern:dimensionRegex},imagewidth:{type:"string",value:"16px"},onClick:{type:"event",options:widgetEventOptions,widget:"eventlist",show:!1},onTap:{type:"event",options:widgetEventOptions,widget:"eventlist",show:!1},onMouseenter:{type:"event",options:widgetEventOptions,widget:"eventlist",show:!1},onMouseleave:{type:"event",options:widgetEventOptions,widget:"eventlist",show:!1},onChange:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.chart":{title:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},subheading:{type:"string",bindable:"in-bound",showPrettyExprInDesigner:!0},iconclass:{type:"string",widget:"select-icon",bindable:"in-bound",pattern:classRegex,label:"Title Icon Class"},advancedsettings:{type:"button",hidelabel:!0,iconclass:"settings"},height:{type:"string",value:"210px",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},type:{type:"string",widget:"list",options:["Area","Bar","Bubble","Column","Cumulative Line","Donut","Line","Pie"],bindable:"in-out-bound",show:!1},scopedataset:{type:"string"},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},formattype:{type:"select-by-object",options:[{label:"toNumber",value:"integer"},{label:"toDate",value:"date"}],value:"",displayfield:"label",datafield:"value",showindesigner:!1},xaxisdatakey:{type:"list",widget:"list",datasetfilter:"custom"},xaxislabel:{type:"string"},xunits:{type:"string"},xnumberformat:{type:"list-group",options:numberFormatOptions},xdateformat:{type:"list-group",options:dateOptions},yaxisdatakey:{type:"list",widget:"multi-select",datasetfilter:"custom"},yaxislabel:{type:"string"},yunits:{type:"string"},ynumberformat:{type:"list-group",options:numberFormatOptions},bubblesize:{type:"string",widget:"list",datasetfilter:"custom"},shape:{type:"string",widget:"list",options:["circle","cross","diamond","random","square","triangle-down","triangle-up"],value:"circle"},show:{type:"boolean",value:!0,bindable:"in-out-bound"},highlightpoints:{type:"boolean"},linethickness:{type:"string"},tooltips:{type:"boolean",value:!0},showlegend:{type:"list",options:["hide","top","bottom"],value:"top"},showxaxis:{type:"boolean",value:!0},showyaxis:{type:"boolean",value:!0},legendtype:{type:"list",options:["classic","furious"],value:"furious",disabled:!1,show:!1},showvalues:{type:"boolean",value:!1},showlabels:{type:"list",options:["hide","inside","outside"],value:"outside"},viewtype:{type:"list",options:["Grouped","Stacked"],value:"Grouped"},interpolation:{type:"list",options:["linear","cardinal","step"],value:"linear"},areaviewtype:{type:"list",options:["stack","stream","expand"],value:"stack"},staggerlabels:{type:"boolean",value:!1},reducexticks:{type:"boolean",value:!0},labeltype:{type:"list",options:["key","value","percent"],value:"percent"},offset:{type:"string",widget:"box"},offsettop:{type:"number",value:25,pattern:numberRegex},offsetbottom:{type:"number",value:55,pattern:numberRegex},offsetleft:{type:"number",value:75,pattern:numberRegex},offsetright:{type:"number",value:25,pattern:numberRegex},barspacing:{type:"list",options:["small","medium","large"],value:"medium"},donutratio:{type:"list",options:["small","medium","large"],value:"medium"},centerlabel:{type:"string",bindable:"in-bound",show:!1},showlabelsoutside:{type:"boolean",value:!0},xaxislabeldistance:{type:"number",value:12},yaxislabeldistance:{type:"number",value:12},showxdistance:{type:"boolean",value:!1},showydistance:{type:"boolean",value:!1},aggregation:{type:"list",options:["average","count","maximum","minimum","none","sum"],value:"none",disabled:!0},aggregationcolumn:{type:"list",widget:"list",disabled:!0,datasetfilter:"custom"},groupby:{type:"list",widget:"multi-select",datasetfilter:"custom"},orderby:{type:"list",widget:"order-by",datasetfilter:"terminals"},theme:{type:"list",options:["Annabelle","Azure","Flyer","GrayScale","Luminosity","Mellow","Orient","Retro","Terrestrial"]},customcolors:{type:"array",bindable:"in-bound",widget:"string"},nodatamessage:{type:"string",value:"No Data Available.",bindable:"in-bound",show:!1},xdomain:{type:"list",options:["Default","Min"],value:"Default"},ydomain:{type:"list",options:["Default","Min"],value:"Default"},borderwidth:{type:"string",widget:"box-model"},borderstyle:{type:"string",options:["dashed","dotted","none","solid"],widget:"border-style"},bordercolor:{type:"string",widget:"color"},backgroundcolor:{type:"string",widget:"color"},backgroundimage:{type:"string",bindable:"in-bound"},color:{type:"string",hidelabel:!0,widget:"color"},selecteditem:{type:"object",bindable:"out-bound",widget:"string",getTypeFrom:"dataset"},onTransform:{type:"event",options:widgetEventOptions,widget:"eventlist"},onSelect:{type:"event",options:widgetEventOptions,widget:"eventlist"},loadingdatamsg:{type:"string",value:"Loading...",bindable:"in-bound",show:!1}},"wm.datanavigator":{show:{type:"boolean",value:!0,bindable:"in-bound"},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},result:{type:"object",bindable:"out-bound",widget:"string",show:"false",getTypeFrom:"dataset"},onSetrecord:{type:"event",options:widgetEventOptions,widget:"eventlist"},onPaginationchange:{type:"event",options:widgetEventOptions,widget:"eventlist"},tabindex:{type:"number",value:"0"},navigationsize:{type:"list",options:["small","large"],show:!1},class:{type:"string",pattern:classRegex,widget:"list-picker",options:["pagination-sm","pagination-lg"]}},"wm.login":{show:{type:"boolean",value:!0,bindable:"in-bound"},errormessage:{type:"string"},onSubmit:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.pagecontainer":{content:{type:"string",options:[],widget:"pages-list",value:"",bindable:"in-bound"},onLoad:{type:"event",options:widgetEventOptions,widget:"eventlist"}},"wm.video":{hint:{type:"string",bindable:"in-bound"},mp4format:{type:"string",value:"",bindable:"in-out-bound"},oggformat:{type:"string",value:"",bindable:"in-out-bound"},webmformat:{type:"string",value:"",bindable:"in-out-bound"},subtitlelang:{type:"string",value:"en",bindable:"in-out-bound"},subtitlesource:{type:"string",value:"",bindable:"in-out-bound"},videoposter:{type:"string",value:"resources/images/imagelists/default-image.png",bindable:"in-out-bound"},controls:{type:"boolean"},videosupportmessage:{type:"string",value:"Your browser does not support the video tag."},autoplay:{type:"boolean"},loop:{type:"boolean"},muted:{type:"boolean"},videopreload:{type:"list",options:["none","metadata","auto"],value:"none"},tabindex:{type:"number",value:"0"},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"inline-block"},class:{type:"string",pattern:classRegex},show:{type:"boolean",value:!0,bindable:"in-bound"},height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},accessroles:{type:"access-roles-select",options:roles,value:EVERYONE}},"wm.audio":{hint:{type:"string",bindable:"in-bound"},mp3format:{type:"string",value:"",bindable:"in-out-bound"},controls:{type:"boolean"},audiosupportmessage:{type:"string",value:"Your browser does not support the audio tag."},autoplay:{type:"boolean"},loop:{type:"boolean"},muted:{type:"boolean",value:!1},audiopreload:{type:"list",options:["none","metadata","auto"],value:"none"},tabindex:{type:"number",value:"0"},showindevice:{type:"select-all",options:showInDeviceOptions,value:"all",displaytype:"inline-block"},class:{type:"string",pattern:classRegex},show:{type:"boolean",value:!0,bindable:"in-bound"},height:{type:"string",pattern:dimensionRegex},width:{type:"string",pattern:dimensionRegex},accessroles:{type:"access-roles-select",options:roles,value:EVERYONE}},"wm.progress":{hint:{type:"string",bindable:"in-bound"},minvalue:{type:"number",value:0,bindable:"in-bound"},maxvalue:{type:"number",value:100,bindable:"in-bound"},datavalue:{type:"number, string",bindable:"in-out-bound",widget:"string"},dataset:{type:"array, object",bindable:"in-bound",widget:"string"},pollinterval:{type:"number"},displayformat:{type:"list",options:["9","9.9","9.99","9.999","9%","9.9%","9.99%","9.999%"]},captionplacement:{type:"list",options:["inside","hidden"],value:"hidden"},type:{type:"list",options:["default","default-striped","success","success-striped","info","info-striped","warning","warning-striped","danger","danger-striped"],value:"default",bindable:"in-bound"},width:{type:"string",pattern:dimensionRegex},height:{type:"string",pattern:dimensionRegex},onStart:{type:"event",options:widgetEventOptions,widget:"eventlist"},onComplete:{type:"event",options:widgetEventOptions,widget:"eventlist"},onBeforeupdate:{type:"event",options:widgetEventOptions,widget:"eventlist"},margin:{type:"string",widget:"box-model"},tabindex:{type:"number",value:"0"}},"wm.template":{header:{type:"list",options:[],widget:"templates-list",value:"_nocontent"},topnav:{type:"list",options:[],widget:"templates-list",value:"_nocontent"},leftnav:{type:"list",options:[],widget:"templates-list",value:"_nocontent"},rightnav:{type:"list",options:[],widget:"templates-list",value:"_nocontent"},footer:{type:"list",options:[],widget:"templates-list",value:"_nocontent"}}}};return CONSTANTS.isStudioMode&&(result.propertyGroups=[{name:"properties",parent:"",show:!0,feature:"project.editor.design.basic"},{name:"styles",parent:"",show:!0,feature:"project.editor.design.style"},{name:"events",parent:"",show:!0,feature:"project.editor.design.events"},{name:"device",parent:"",show:!0,feature:"project.editor.design.mobile"},{name:"security",parent:"",show:!0,feature:"project.editor.design.security"},{properties:["widget","caption","gridcaption","title","displayname","heading","subheading","name","debugurl","type","inputtype","accept","filetype","extensions","placeholder","currency","description","message","oktext","canceltext","servicevariabletotrack","valuetype","alerttype","iframesrc","insert","dropposition","spacing","advancedsettings","addchild","badgevalue","badgetype"],parent:"properties"},{name:"accessibility",properties:["hint","tabindex","shortcutkey","helptext"],parent:"properties"},{name:"captionforsteps",properties:["nextbtnlabel","previousbtnlabel","donebtnlabel","cancelbtnlabel"],parent:"properties"},{name:"picture",properties:["imageheight","picturesource","pictureaspect","shape","picturetitle"],parent:"properties"},{name:"layout",properties:["width","height","filelistheight","treeicons","menulayout","menuposition","levels","imgsrc","layoutkind","columns","layout","stepstyle","navtype","stacked","justified","formlayout","showheader","header","topnav","leftnav","rightnav","footer","addrow","addcolumn","popoverwidth","popoverheight","tabsposition","gridsearch","filtermode","searchlabel"],parent:"properties"},{name:"video",properties:["videoposter","mp4format","oggformat","webmformat","videopreload","videosupportmessage","subtitlesource","subtitlelang"],parent:"properties"},{name:"audio",properties:["mp3format","audiopreload","audiosupportmessage"],parent:"properties"},{name:"content",properties:["contentsource","content","inlinecontent","url"],parent:"properties"},{name:"partialparams",properties:[],parent:"properties"},{name:"display",properties:["modal","vertical","avatar"],parent:"properties"},{name:"dataset",properties:["service","operation","scopedataset","dataset","options","hyperlink","formfield","metadata","searchkey","displaylabel","displayimagesrc","usekeys","datafield","displayfield","displayexpression","groupby","match","scale","dateformat","aggregation","aggregationcolumn","orderby","orderbycolumn","nodelabel","nodeicon","nodechildren","nodeid","thumbnailurl","mediaurl"],parent:"properties"},{name:"values",properties:["scopedatavalue","datavalue","defaultvalue","minvalue","maxvalue","formdata","selectedvalue","selectedvalues","discretevalues","integervalues","minimum","maximum","step","defaultcolor","checkedvalue","uncheckedvalue"],parent:"properties"},{name:"valuedisplay",properties:["datepattern","timepattern","hourstep","minutestep","limit"],parent:"properties"},{name:"output",properties:["outputformat"],parent:"properties"},{name:"eventsdata",properties:["eventtitle","eventstart","eventend","eventallday","eventclass"],parent:"properties"},{name:"actions",properties:["actions","itemlabel","itemicon","itemlink","itemaction","userrole","itembadge","itemchildren"],parent:"properties"},{name:"xaxis",properties:["xaxisdatakey"],parent:"properties"
},{name:"yaxis",properties:["yaxisdatakey"],parent:"properties"},{name:"zaxis",properties:["bubblesize"],parent:"properties"},{name:"validation",properties:["required","validationmessage","regexp","mindate","maxdate","excludedays","excludedates","novalidate","maxchars"],parent:"properties"},{name:"behavior",properties:["method","action","enctype","target","defaultview","defaultmode","defaultpaneindex","pollinterval","radiogroup","viewgroup","showweeks","showbuttonbar","autofocus","readonly","ignoreparentreadonly","editmode","scrolldelay","scrollamount","direction","multiple","maxsize","allowonlyselect","enablereorder","fileuploadmessage","mode","show","deferload","hideclose","calendartype","controls","view","disabled","disableitem","pagesize","dynamicslider","selectionclick","closeothers","collapsible","showcount","enablefullscreen","lock","freeze","autoscroll","closable","showactions","expanded","destroyable","showDirtyFlag","link","linktarget","uploadpath","contenttype","origin","destination","maxfilesize","isdefaulttab","disablenext","enabledone","enableskip","cancelable","isdefaultpane","autocomplete","showpreview","autoplay","loop","muted","xpadding","ypadding","popoverplacement","popoverarrow","popoverautoclose","interaction","autoclose","transition","animation","animateitems","animationinterval","leftnavpaneliconclass","backbutton","backbuttoniconclass","backbuttonlabel","searchbutton","morebuttoniconclass","menuiconclass","morebuttonlabel","capturetype","loadmode","loaddelay","selectionlimit","showcaptions","multiselect","radioselect","enablesort","enablecolumnselection","gridfirstrowselect","selectfirstitem","enableemptyfilter","autoupdate","displayformat","captionplacement","updateon","updatedelay","actionlink","actiontitle","offline","encodeurl","keyboard"],parent:"properties"},{name:"navigation",properties:["navigation","shownavigation","showrecordcount","navigationalign","ondemandmessage"],parent:"properties"},{name:"searchproperties",properties:["searchbuttoniconclass","searchbuttonlabel","searchplaceholder"],parent:"properties"},{name:"datagrid",properties:["showrowindex","exportformat","exportdatasize"],parent:"properties"},{name:"caption",properties:["captionalign","captionposition","captionsize","mineditorwidth"],parent:"properties"},{name:"graphics",properties:["imagelist","imageindex","paneicon","loadingicon","iconclass","iconsize","iconurl","iconwidth","iconheight","iconmargin","iconposition","image","imagewidth"],parent:"properties"},{name:"format",properties:["showtooltip","horizontalalign","verticalalign","columnwidth","taborder"],parent:"properties"},{name:"selection",properties:["selectionmode"],parent:"properties"},{name:"operations",properties:["insertrow","deleterow","updaterow","submitbutton","resetbutton"],parent:"properties"},{name:"message",properties:["messagelayout","errormessage","insertmessage","updatemessage","confirmdelete","deletemessage","nodatamessage","loadingdatamsg","datacompletemsg","postmessage"],parent:"properties"},{properties:["class","menuclass","listclass","itemclass","paginationclass","gridclass","contentclass"],parent:"styles"},{name:"textstyle",properties:["fontsize","fontunit","fontfamily","color","fontweight","fontstyle","textdecoration","textalign","whitespace"],parent:"styles"},{name:"backgroundstyle",properties:["backgroundcolor","backgroundimage","backgroundrepeat","backgroundposition","backgroundsize","backgroundattachment"],parent:"styles"},{name:"border",properties:["bordercolor","borderstyle","borderwidth"],parent:"styles"},{name:"displaystyle",properties:["iconcolor","padding","margin","opacity","overflow","cursor","zindex","visibility","display"],parent:"styles"},{name:"prefablifecycleevents",properties:["onLoad","onDestroy"],parent:"events"},{name:"event",properties:["onChange","onFocus","onBlur"],parent:"events"},{name:"mouseevents",properties:["onClick","onDblclick","onMousedown","onMouseup","onMouseover","onMouseout","onMousemove","onMouseenter","onMouseleave"],parent:"events",platforms:[PLATFORM_TYPE.WEB,PLATFORM_TYPE.DEFAULT]},{name:"touchevents",properties:["onTap","onDoubletap","onSwipeup","onSwipedown","onSwipeleft","onSwiperight","onPinchin","onPinchout"],parent:"events"},{name:"keyboardevents",properties:["onKeydown","onKeypress","onKeyup","onEnterkeypress"],parent:"events"},{name:"callbackevents",properties:["onReady","onStart","onComplete","onBeforeupdate","onBeforeadd","onShow","onHide","onOk","onBeforesubmit","onSubmit","onCancel","onClose","onOpened","onExpand","onCollapse","onSelect","onDeselect","onViewrender","onBeforerender","onProgress","onTransform","onAbort","onSort","onGridbuttonclick","onHeaderclick","onRowclick","onRowdblclick","onColumnselect","onColumndeselect","onBeforeformrender","onFormrender","onRowdelete","onBeforerowinsert","onRowinsert","onBeforerowupdate","onRowupdate","onResult","onSuccess","onError","onBeforeservicecall","onActionsclick","onBeforesegmentchange","onSegmentchange","onSearch","onBackbtnclick","onEventdrop","onEventresize","onEventclick","onEventrender","onReorder","onSelectionlimitexceed","onFullscreen","onExitfullscreen","onNext","onPrev","onSkip","onDone","onBeforedatarender","onDatarender","onPaginationchange","onSetrecord"],parent:"events"},{name:"security",properties:["accessroles"],parent:"security"},{name:"devicesize",properties:["showindevice","itemsperrow"],parent:"device"},{name:"gridstyles",properties:["rowclass","rowngclass"],parent:"properties"},{name:"imageproperties",properties:["imagetargetwidth","imagetargetheight","imagequality","imageencodingtype","correctorientation","sourcetype","savetogallery","allowedit"],parent:"properties"}],result.advancedPropertyGroups=[{name:"chart",show:!0},{name:"xaxis",show:!0,icon:"wi wi-border-bottom"},{name:"yaxis",show:!0,icon:"wi wi-border-left"},{name:"value",show:!0,icon:"wi wi-data-usage"},{name:"",properties:["centerlabel"],parent:"chart"},{name:"colors",properties:["theme","customcolors"],parent:"chart"},{name:"message",properties:["nodatamessage","loadingdatamsg"],parent:"chart"},{name:"layout",properties:["offset"],parent:"chart"},{name:"legend",properties:["showlegend"],parent:"chart"},{name:"behavior",properties:["tooltips","donutratio","highlightpoints","linethickness"],parent:"chart"},{name:"datarendering",properties:["viewtype","interpolation","areaviewtype"],parent:"chart"},{name:"",properties:["showxaxis","xaxislabel","xunits","xaxislabeldistance","xdomain","showvalues","staggerlabels","reducexticks","barspacing","showxdistance"],parent:"xaxis"},{name:"xaxisformat",properties:["formattype","xnumberformat","xdateformat"],parent:"xaxis"},{name:"",properties:["showyaxis","yaxislabel","yunits","yaxislabeldistance","ydomain","showydistance"],parent:"yaxis"},{name:"yaxisformat",properties:["ynumberformat"],parent:"yaxis"},{name:"value",properties:["showlabels","labeltype"],parent:"value"},{name:"valueformat",properties:["ynumberformat"],parent:"value"}]),properties=result.properties,propertyGroups=result.propertyGroups,advancedPropertyGroups=result.advancedPropertyGroups,ignoreList=CONSTANTS.isRunMode?{accessroles:!0,updateon:!0,updatedelay:!0}:{},{getPropertiesOf:getPropertiesOf,getPropertyGroups:getPropertyGroups,getAdvancedPropertyGroups:getAdvancedPropertyGroups,getPrimaryPropertyGroups:getPrimaryPropertyGroups,getGroupProperties:getGroupProperties,getPropertyGroup:getPropertyGroup,getRoles:getRoles,setRoles:setRoles}}]).directive("ngController",function($rootScope,CONSTANTS){"use strict";return CONSTANTS.isRunMode&&($rootScope.Widgets={}),{restrict:"A",compile:function(){return{pre:function(scope){scope.ctrlScope=scope}}}}}).directive("onFileChange",function(){"use strict";return{link:function(scope,element,attrs){element[0].onchange=function(){scope[attrs.onFileChange](element[0])}}}}).directive("wmtransclude",["CONSTANTS","$timeout",function(CONSTANTS,$timeout){"use strict";return{restrict:"A",link:function(scope,element,attrs,nullCtrl,transcludeFn){attrs.widgetid?element.attr("data-droptarget-for",attrs.widgetid):scope.widgetid&&element.attr("data-droptarget-for",scope.widgetid);var eleScope=element.scope(),onTranscludeFn=scope.__onTransclude||WM.noop;eleScope.hasOwnProperty("$$isolateBindings")&&!eleScope.__compileWithIScope&&(eleScope=eleScope.$parent),scope.__load=WM.noop,CONSTANTS.isRunMode&&"after-select"===scope.loadmode?scope.__load=function(){transcludeFn(eleScope,function(clone){element.append(clone),scope.__load=WM.noop,$timeout(onTranscludeFn,void 0,!1)})}:CONSTANTS.isRunMode&&"after-delay"===scope.loadmode?$timeout(function(){transcludeFn(eleScope,function(clone){element.append(clone),$timeout(onTranscludeFn,void 0,!1)})},scope.loaddelay):transcludeFn(eleScope,function(clone){element.append(clone),onTranscludeFn()})}}}]).directive("noAnimate",function($animate){"use strict";return{link:function($s,$el){$animate.enabled($el,!1)}}}).directive("accessroles",function(CONSTANTS,$rootScope,$compile,Utils){"use strict";function matchRoles(widgetRoles,userRoles){return widgetRoles.some(function(item){return _.includes(userRoles,item)})}function hasAccessToWidget(widgetRoles,userRoles){return!!_.includes(widgetRoles,"Everyone")||(!(!_.includes(widgetRoles,"Anonymous")||$rootScope.isUserAuthenticated)||(!(!_.includes(widgetRoles,"Authenticated")||!$rootScope.isUserAuthenticated)||$rootScope.isUserAuthenticated&&matchRoles(widgetRoles,userRoles)))}var directive={};return CONSTANTS.isRunMode&&$rootScope.isSecurityEnabled&&(directive={restrict:"A",priority:1e4,terminal:!0,link:{pre:function(scope,element,attrs){var clonedElement,userRoles=$rootScope.userRoles||[],widgetRoles=Utils.getWidgetRolesArrayFromStr(attrs.accessroles);hasAccessToWidget(widgetRoles,userRoles)?(clonedElement=element.clone(),clonedElement.removeAttr("accessroles"),element.replaceWith(clonedElement),$compile(clonedElement)(scope)):(scope.$emit("security:before-child-remove",scope,element,attrs),element.remove())}}}),directive}).service("WidgetUtilService",["$parse","$rootScope","CONSTANTS","Utils","$templateCache","$timeout",function($parse,$rootScope,CONSTANTS,Utils,$templateCache,$timeout){"use strict";function cleanupMarkup(element){$rICQueue.length||$rIC(function(){var i;for(i=0;i<$rICQueue.length;i++)$rICQueue[i].removeAttr(attrsToBeRemoved);$rICQueue.length=0,element.removeAttr(attrsToBeRemoved)}),$rICQueue.push(element)}function onScopeValueChangeProxy($is,$el,attrs,key,nv,ov,listeners){var $hiddenEleNode,$hiddenEl;if("placeholder"===key||"type"===key)$el.is("input")||$el.is("textarea")?attrs.$set(key,nv):$el.find("input").attr(key,nv);else if("backgroundimage"===key)$is.picturesource=Utils.getBackGroundImageUrl(nv);else if("class"===key)ov?$el.removeClass(ov).addClass(nv):$el.addClass(nv);else if("name"===key)attrs.$set("name",nv);else if("showindevice"===key){if(CONSTANTS.isRunMode){var newValues=nv?nv.split(","):nv,classesToRemove="",classesToAdd="";0===WM.element.inArray("all",newValues)?(_.forEach(deviceSizeArray.all.classToRemove,function(device){classesToRemove+=" "+(device+$is.widgetProps.showindevice.displaytype||"block")}),$el.removeClass(classesToRemove)):(_.forEach(newValues,function(value){classesToAdd+=" "+(deviceSizeArray[value].class+($is.widgetProps.showindevice.displaytype||"block"))}),$el.addClass(classesToAdd))}}else"animation"===key?CONSTANTS.isRunMode&&$el.addClass("animated "+nv):"show"===key&&($is.widgetid&&"wm-form-field"===$is.widgettype?($hiddenEleNode=WM.element('<div class="wm-widget-hidden-msg-overlay"><span class="pull-right badge">'+$rootScope.locale.MESSAGE_HIDDEN_FIELD+"</span></div>"),nv?($hiddenEl=$el.find(".wm-widget-hidden-msg-overlay"),$hiddenEl.remove()):$el.append($hiddenEleNode)):nv?$el.removeClass("ng-hide"):$el.addClass("ng-hide"));listeners||(listeners=$is.propertyManager.get($is.propertyManager.ACTIONS.CHANGE)),listeners.forEach(function(handler){var notifyFor=handler.notifyFor;(notifyFor&&notifyFor[key]||!notifyFor)&&handler(key,nv,ov)})}function triggerInitValueChange($is,$el,attrs){var listeners=$is.propertyManager.get($is.propertyManager.ACTIONS.CHANGE);Object.keys($is._initState).forEach(function(key){var value=$is[key];WM.isDefined(value)&&onScopeValueChangeProxy($is,$el,attrs,key,value,void 0,listeners)}),$is._applyCSSFns.forEach(Utils.triggerFn),$is._cssObj=void 0,$is._isInitialized=!0,$is.__onTransclude||Utils.triggerFn($is.onReady,$is,$el,attrs)}function postWidgetCreate($is,$el,attrs){cleanupMarkup($el),$is&&$is._initState&&triggerInitValueChange($is,$el,attrs)}function findCtrlScope(scope){if(!scope.ctrlScope&&scope.$id!==$rootScope.$id){var tScope=scope;do if(tScope=tScope.$parent,tScope.ctrlScope){scope.ctrlScope=tScope.ctrlScope;break}while(tScope.$id!==$rootScope.$id)}}function injectModelUpdater(element,model){function getModelValue(){return"wm-search"===iScope._widgettype?iScope.query:iScope.datavalue}function updateModel(){_model&&ctrlScope&&_model.assign&&_model.assign(ctrlScope,iScope._model_)}var _model,dotIdx,braceIdx,idx,name,iScope=element.isolateScope(),ctrlScope=element.scope();model&&(_model=$parse(model)),ctrlScope.ctrlScope||findCtrlScope(ctrlScope),ctrlScope.ctrlScope&&(model&&(dotIdx=model.indexOf("."),braceIdx=model.indexOf("["),dotIdx===-1&&braceIdx===-1?ctrlScope=ctrlScope.ctrlScope:(idx=braceIdx===-1?dotIdx:dotIdx===-1?braceIdx:Math.min(dotIdx,braceIdx),idx>0&&(name=model.substring(0,idx),WM.isDefined(ctrlScope.ctrlScope[name])||(ctrlScope.ctrlScope[name]={}),WM.isUndefined(ctrlScope[name])&&Object.defineProperty(ctrlScope,name,{get:function(){return ctrlScope.ctrlScope[name]}})))),$rootScope.$evalAsync(function(){iScope._ngModelOldVal=getModelValue()}),iScope._onChange=function($event){updateModel(),$event&&iScope.onChange&&(CONSTANTS.isRunMode?$timeout(function(){var modelVal=getModelValue();iScope.onChange({$event:$event,$scope:iScope,newVal:modelVal,oldVal:iScope._ngModelOldVal}),iScope._ngModelOldVal=modelVal}):(iScope.onChange({$event:$event,$scope:iScope,newVal:iScope.datavalue,oldVal:iScope._ngModelOldVal}),iScope._ngModelOldVal=iScope.datavalue))},model&&ctrlScope&&iScope.$on("$destroy",ctrlScope.$watch(model,function(newVal){iScope.datavalue!==newVal&&(iScope.datavalue=newVal)},!0)))}function addEventAttributes($template,tAttrs,customEventsMap){if(!tAttrs.widgetid){var eventsMap=customEventsMap||EventsMap;return Object.keys(eventsMap).forEach(function(evtName){var evtDetails=eventsMap[evtName];tAttrs[evtName]&&$template.attr(evtDetails.name,evtDetails.value)}),$template}}function getPreparedTemplate(templateId,tElement,tAttrs){var template,$template,isInsideCanvs=tAttrs.widgetid;return template=$templateCache.get(templateId),isInsideCanvs?template:($template=WM.element(template),addEventAttributes($template,tAttrs),$template[0].outerHTML)}function registerPropertyChangeListener(listener,iScope,notifyFor){listener.notifyFor=notifyFor,iScope.propertyManager.add(iScope.propertyManager.ACTIONS.CHANGE,listener)}function getObjValueByKey(obj,strKey){if(strKey){var val;return strKey.replace(/\[(\w+)\]/g,".$1").split(".").forEach(function(key){val=val&&val[key]||obj[key]}),val}return obj}function getUpdatedExpr(expr){var ch,next,i,j,matchCh,matchCount,isQuotedStr,subStr,isQuotedStrEvaluated,updated="";for(expr=expr.replace(/\$\[data\[\$i\]/g,"$[__1"),i=0;i<expr.length;i++)if(ch=expr[i],next=expr[i+1],"$"===ch&&"["===next){for(matchCount=1,subStr="",isQuotedStrEvaluated=!1,isQuotedStr=!1,j=i+2;j<expr.length;j++)if(matchCh=expr[j]," "!==matchCh&&(isQuotedStrEvaluated||(isQuotedStr='"'===expr[j]||"'"===expr[j],isQuotedStrEvaluated=!0),"["===matchCh?matchCount++:"]"===matchCh&&matchCount--,!matchCount)){subStr=expr.substring(i+2,j),updated+=isQuotedStr?"__1["+subStr+"]":subStr;break}i=j}else updated+=ch;return updated}function updateAndEvalExp(dataObj,expressionValue,scope){var val=Utils.getEvaluatedExprValue(dataObj,expressionValue,scope);return WM.isDefined(val)&&val||scope.$eval(getUpdatedExpr(expressionValue.replace("bind:","")),_.assign({},dataObj,{__1:dataObj}))}function getEvaluatedData(scope,dataObj,propertyObj,value){var expressionValue,keyForUpdatedExpr,boundExpressionName=propertyObj?"bind"+propertyObj.expressionName:void 0;return scope[boundExpressionName]?(keyForUpdatedExpr="__"+boundExpressionName,scope[keyForUpdatedExpr]||(expressionValue=scope[boundExpressionName].replace("bind:",""),expressionValue=getUpdatedExpr(expressionValue),scope[keyForUpdatedExpr]=expressionValue),scope.$eval(scope[keyForUpdatedExpr],_.assign({},dataObj,{__1:dataObj}))):propertyObj&&scope[propertyObj.expressionName]?Utils.getEvaluatedExprValue(dataObj,scope[propertyObj.expressionName],scope):value?getObjValueByKey(dataObj,value):propertyObj&&scope[propertyObj.fieldName]?getObjValueByKey(dataObj,scope[propertyObj.fieldName]):void 0}function updateOptions(scope,name,prop,options){if("multi-select"===prop.widget)scope.widgetDataset=scope.widgetDataset||{},scope.widgetDataset[name]=options;else if("list-typeahead"===prop.widget){var optionObjects=[],defaultOptions=[],optionCategoryName="Field";"wm-livelist"===scope.widgettype&&(defaultOptions=[{name:"Javascript",category:"Script"}],_.includes(scope[prop],"(")&&defaultOptions.push({category:"Script",name:scope[prop]})),optionObjects=defaultOptions,options.forEach(function(option){optionObjects.push({category:optionCategoryName,name:option})}),prop.options=optionObjects}else prop.options=options}function updatePropertyPanelOptions(scope){var keys,filter,bindExpr,typeUtils,options,fieldObjects,ALLFIELDS="All Fields",checkboxsetTypeWidgets=["multi-select","select-all","list-typeahead","order-by"],dataSetProp=_.includes(["wm-panel","wm-card"],scope.widgettype)?"actions":"dataset",requiredProps={},resetProps={};return bindExpr=scope["bind"+dataSetProp],typeUtils=Utils.getService("TypeUtils"),fieldObjects=typeUtils.getFieldsForExpr(bindExpr,{getFieldInfo:!0}),keys={objects:_.map(_.filter(fieldObjects,{type:"object"}),"field"),terminals:_.map(_.filter(fieldObjects,{type:"terminal"}),"field")},keys.all=_.union(keys.objects,keys.terminals),_.forEach(scope.widgetProps,function(prop,name){prop.datasetfilter&&(requiredProps[name]=prop,resetProps[name]="datafield"===name&&prop.allfields?ALLFIELDS:"")}),scope.newcolumns&&(scope.newcolumns=!1,_.forEach(resetProps,function(prop,name){scope[name]=prop}),scope.$root.$emit("set-markup-attr",scope.widgetid,resetProps),Utils.triggerFn(scope.onPropertyChange,scope)),_.forEach(requiredProps,function(prop,name){if(filter=prop.datasetfilter,filter&&"none"!==filter){if(_.isEmpty(keys))options=[];else{switch(filter){case"all":options=keys.all;break;case"objects":options=keys.objects;break;case"terminals":options=keys.terminals;break;case"custom":options=scope.getCutomizedOptions(scope,name,keys.terminals)}prop.allfields&&(options=[ALLFIELDS].concat(options)),_.includes(checkboxsetTypeWidgets,prop.widget)||(options=[""].concat(options))}updateOptions(scope,name,prop,options)}}),keys}var $rIC,$rICQueue,attrsToBeRemoved,deviceSizeArray={all:{class:"",classToRemove:["visible-xs-","visible-sm-","visible-md-","visible-lg-"]},xs:{class:"visible-xs-"},sm:{class:"visible-sm-"},md:{class:"visible-md-"},lg:{class:"visible-lg-"}},EventsMap={onClick:{name:"ng-click",value:"onClick({$event: $event, $scope: this})"},onDblclick:{name:"ng-dblclick",value:"onDblclick({$event: $event, $scope: this})"},onMouseenter:{name:"ng-mouseenter",value:"onMouseenter({$event: $event, $scope: this})"},onMouseleave:{name:"ng-mouseleave",value:"onMouseleave({$event: $event, $scope: this})"},onMouseover:{name:"ng-mouseover",value:"onMouseover({$event: $event, $scope: this})"},onMouseout:{name:"ng-mouseout",value:"onMouseout({$event: $event, $scope: this})"},onFocus:{name:"ng-focus",value:"onFocus({$event: $event, $scope: this})"},onBlur:{name:"ng-blur",value:"onBlur({$event: $event, $scope: this})"},onKeypress:{name:"ng-keypress",value:"onKeypress({$event: $event, $scope: this})"},onKeydown:{name:"ng-keydown",value:"onKeydown({$event: $event, $scope: this})"},onKeyup:{name:"ng-keyup",value:"onKeyup({$event: $event, $scope: this})"},onSwipeup:{name:"hm-swipe-up",value:"onSwipeup({$event: $event, $scope: this})"},onSwipedown:{name:"hm-swipe-down",value:"onSwipedown({$event: $event, $scope: this})"},onSwipeleft:{name:"hm-swipe-left",value:"onSwipeleft({$event: $event, $scope: this})"},onSwiperight:{name:"hm-swipe-right",value:"onSwiperight({$event: $event, $scope: this})"},onPinchin:{name:"hm-pinch-in",value:"onPinchin({$event: $event, $scope: this})"},onPinchout:{name:"hm-pinch-out",value:"onPinchout({$event: $event, $scope: this})"},onTap:{name:"ng-click",value:"onTap({$event: $event, $scope: this})"},onDoubletap:{name:"ng-dblclick",value:"onDoubletap({$event: $event, $scope: this})"}};return attrsToBeRemoved=" ng-style ng-change ng-click ng-dblclick ng-mouseout ng-mouseover ng-blur ng-focus ng-show ng-hide ng-readonly ng-disabled ng-required ng-attr-placeholder ng-attr-name on-change on-focus on-blur on-click on-dblclick on-mouseover on-mouseout on-rowclick on-columnselect on-columndeselect  backgroundattachment backgroundcolor backgroundgradient backgroundposition backgroundrepeat backgroundsize bordercolor borderradius  borderstyle color cursor display fontfamily fontstyle fontvariant fontweight horizontalalign lineheight  opacity overflow padding picturesource avatar textalign textdecoration verticalalign visibility  whitespace wordbreak zindex borderwidth margin fontsize fontunit show hint caption animation backgroundimage iconposition iconclass",$rIC=window.requestIdelCallback||window.setTimeout,$rICQueue=[],{postWidgetCreate:postWidgetCreate,injectModelUpdater:injectModelUpdater,onScopeValueChangeProxy:onScopeValueChangeProxy,getPreparedTemplate:getPreparedTemplate,addEventAttributes:addEventAttributes,registerPropertyChangeListener:registerPropertyChangeListener,getObjValueByKey:getObjValueByKey,getEvaluatedData:getEvaluatedData,updateAndEvalExp:updateAndEvalExp,updatePropertyPanelOptions:updatePropertyPanelOptions}}]).directive("applyStyles",["WidgetUtilService","$rootScope",function(WidgetUtilService,$rs){"use strict";function setDimensionProp(cssObj,key,nv){function setVal(prop,value){value===UNSET&&(value=""),cssObj[cssKey+prop+suffix]=value}var val,top,right,bottom,left,cssKey=key,SEPARATOR=" ",UNSET="unset",suffix="";"borderwidth"===key&&(suffix="Width",cssKey="border"),val=nv,val.indexOf(UNSET)!==-1?(val=val.split(SEPARATOR),top=val[0],right=val[1]||val[0],bottom=val[2]||val[0],left=val[3]||val[1]||val[0],setVal("Top",top),setVal("Right",right),setVal("Bottom",bottom),setVal("Left",left)):("borderwidth"===key&&(cssKey="borderWidth"),cssObj[cssKey]=nv)}function applyCSS($is,applyType,targetObj,key,nv){var obj=targetObj,cssName=propNameCSSKeyMap[key];if("shell"!==applyType||!MAP_SHELL_TYPE_IGNORE_LIST[key]){if("inner-shell"===applyType){if(!MAP_SHELL_TYPE_IGNORE_LIST[key])return;"height"===key&&(obj.overflow=nv?"auto":"")}if("container"!==applyType||!MAP_CONTAINER_TYPE_IGNORE_LIST[key]){if("scrollable-container"===applyType){if(MAP_SCROLLABLE_CONTAINER_TYPE_IGNORE_LIST[key])return;"height"===key&&(obj.overflow=nv?"auto":"")}return MAP_DIMENSION_PROPS[key]?setDimensionProp(obj,key,$is[key]):cssName?obj[cssName]=nv:"fontsize"===key||"fontunit"===key?obj.fontSize=""===$is.fontsize?"":$is.fontsize+$is.fontunit:"backgroundimage"===key&&(obj.backgroundImage=$is.picturesource),obj}}}function flushCSS(css,$el){var keys=Object.keys(css),style=$el[0].style;keys.length&&(WM.isDefined(css.width)&&css.width==+css.width&&(css.width+="px"),WM.isDefined(css.height)&&css.height==+css.height&&(css.height+="px"),keys.forEach(function(k){style[k]="",style[k]=css[k]}))}function onCSSPropertyChange($is,$el,attrs,key,nv){var toBeAppliedCSS={};$is._isInitialized?(applyCSS($is,attrs.applyStyles,toBeAppliedCSS,key,nv),flushCSS(toBeAppliedCSS,$el)):$is._cssObj[key]=nv}function __applyCSS($is,$el,attrs){var toBeAppliedCSS={},cssObj=$is._cssObj;Object.keys(cssObj).forEach(function(key){applyCSS($is,attrs.applyStyles,toBeAppliedCSS,key,cssObj[key])}),$rAFQueue.length||$rAF(function(){var i;for(i=0;i<$rAFQueue.length;i++)$rAFQueue[i]();$rAFQueue.length=0}),$rAFQueue.push(flushCSS.bind(void 0,toBeAppliedCSS,$el))}var DIMENSION_PROPS,propNameCSSKeyMap,SHELL_TYPE_IGNORE_LIST,CONTAINER_TYPE_IGNORE_LIST,SCROLLABLE_CONTAINER_TYPE_IGNORE_LIST,MAP_SHELL_TYPE_IGNORE_LIST,MAP_CONTAINER_TYPE_IGNORE_LIST,MAP_SCROLLABLE_CONTAINER_TYPE_IGNORE_LIST,MAP_DIMENSION_PROPS,temp,$rAF,$rAFQueue,notifyFor={};return $rAF=window.requestAnimationFrame||window.setTimeout,$rAFQueue=[],propNameCSSKeyMap={backgroundattachment:"backgroundAttachment",backgroundcolor:"backgroundColor",backgroundgradient:"backgroundGradient",backgroundposition:"backgroundPosition",backgroundrepeat:"backgroundRepeat",backgroundsize:"backgroundSize",bordercolor:"borderColor",borderradius:"borderRadius",borderstyle:"borderStyle",color:"color",cursor:"cursor",display:"display",fontfamily:"fontFamily",fontstyle:"fontStyle",fontvariant:"fontVariant",fontweight:"fontWeight",height:"height",horizontalalign:"textAlign",lineheight:"lineHeight",opacity:"opacity",overflow:"overflow",picturesource:"backgroundImage",textalign:"textAlign",textdecoration:"textDecoration",verticalalign:"verticalAlign",visibility:"visibility",whitespace:"whiteSpace",width:"width",wordbreak:"wordbreak",zindex:"zIndex"},SHELL_TYPE_IGNORE_LIST="height overflow padding",CONTAINER_TYPE_IGNORE_LIST="textalign",SCROLLABLE_CONTAINER_TYPE_IGNORE_LIST="textalign width",MAP_SHELL_TYPE_IGNORE_LIST={},MAP_CONTAINER_TYPE_IGNORE_LIST={},MAP_SCROLLABLE_CONTAINER_TYPE_IGNORE_LIST={},MAP_DIMENSION_PROPS={},temp=_.split(SHELL_TYPE_IGNORE_LIST," "),_.forEach(temp,function(k){MAP_SHELL_TYPE_IGNORE_LIST[k]=!0,notifyFor[k]=!0}),temp=_.split(CONTAINER_TYPE_IGNORE_LIST," "),_.forEach(temp,function(k){MAP_CONTAINER_TYPE_IGNORE_LIST[k]=!0,notifyFor[k]=!0}),temp=_.split(SCROLLABLE_CONTAINER_TYPE_IGNORE_LIST," "),_.forEach(temp,function(k){MAP_SCROLLABLE_CONTAINER_TYPE_IGNORE_LIST[k]=!0}),_.keys(propNameCSSKeyMap).forEach(function(propName){notifyFor[propName]=!0}),DIMENSION_PROPS=["padding","borderwidth","margin"],_.forEach(DIMENSION_PROPS,function(k){MAP_DIMENSION_PROPS[k]=!0,notifyFor[k]=!0}),notifyFor.fontsize=!0,notifyFor.fontunit=!0,notifyFor.backgroundimage=!0,$rs.$on("apply-box-model-property",function(evt,$target,key,nv){var cssObj={};setDimensionProp(cssObj,key,nv),flushCSS(cssObj,$target)}),{link:function($s,$el,attrs){var $is=$el.closest("[init-widget]").isolateScope();$is._cssObj={},$is._applyCSSFns.push(__applyCSS.bind(void 0,$is,$el,attrs)),WidgetUtilService.registerPropertyChangeListener(onCSSPropertyChange.bind(void 0,$is,$el,attrs),$is,notifyFor)}}}]).directive("listenProperty",["WidgetUtilService","CONSTANTS",function(WidgetUtilService,CONSTANTS){"use strict";return{link:function($is,$el,attrs){if(!CONSTANTS.isRunMode){var property="bind"+(attrs.listenProperty||"dataset");$is.$on("$destroy",$is.$watch(property,function(){WidgetUtilService.updatePropertyPanelOptions($is)}))}}}}]).directive("focusTarget",["CONSTANTS",function(CONSTANTS){"use strict";return CONSTANTS.isStudioMode?{}:{restrict:"A",link:function($s,$el){var $is,$root;$root=$el.closest("[init-widget]"),$is=$root.isolateScope(),$is&&$is.widgetProps.tabindex&&($el.attr("tabindex",$is.tabindex),$root.removeAttr("tabindex"))}}}]).service("Widgets",["$rootScope","wmToaster","CONSTANTS","Utils",function($rootScope,wmToaster,CONSTANTS,Utils){"use strict";function byId(widgetId){return registry[widgetId]}function byName(name){return byId(nameIdMap[name])}function $byType(types){if(!types)return registry;"string"==typeof types&&(types=_.includes(["form-widgets","page-container-widgets","dialog-widgets","spinner-widgets"],types)?Utils.getTypes(types):types.split(","));var collection={};return WM.forEach(types,function(type){type=type.trim(),WM.forEach(registry,function(widget){widget.widgettype===type&&(collection[widget.name]=widget)})}),collection}function $isValidName(name){var errMsgTitle,errMsgDesc,isValid=!0;return name?nameIdMap[name]&&(isValid=!1,errMsgTitle="MESSAGE_ERROR_DUPLICATE_WIDGETNAME_TITLE",errMsgDesc="MESSAGE_ERROR_DUPLICATE_WIDGETNAME_DESC"):(isValid=!1,errMsgTitle="MESSAGE_ERROR_INVALID_WIDGETNAME_TITLE",errMsgDesc="MESSAGE_ERROR_INVALID_WIDGETNAME_DESC"),isValid||wmToaster.show("error",$rootScope.locale[errMsgTitle],$rootScope.locale[errMsgDesc]),isValid}function $isExists(name){var _isExists=!1;return nameIdMap[name]&&(_isExists=!0),_isExists}function unregister(name){var widgetId=nameIdMap[name];delete registry[widgetId],delete nameIdMap[name],delete returnObj[name]}var registry={},nameIdMap={},returnObj={};return returnObj.$isValidName=$isValidName,returnObj.$isExists=$isExists,returnObj.$byType=$byType,$rootScope.$on("name-change",function(evt,widgetId,newName,oldName,scope){CONSTANTS.isStudioMode&&!widgetId||(delete nameIdMap[oldName],delete returnObj[oldName],widgetId=widgetId||newName,nameIdMap[newName]=widgetId,registry[widgetId]=scope,returnObj[newName]=byName(newName),scope.$on("$destroy",function(){unregister(scope.name)}))}),returnObj}]),WM.module("wm.widgets.base").directive("initWidget",["$rootScope","WidgetUtilService","Utils","CONSTANTS","$parse","$routeParams","BindingManager","$compile","AppDefaults","DataFormatService",function($rs,WidgetUtilService,Utils,CONSTANTS,$parse,$routeParams,BindingManager,$compile,AppDefaults){"use strict";function isBooleanAttr(key){return BOOLEAN_ATTRS[key]}function PropertyManager(){var handlers={change:[]};this.ACTIONS={CHANGE:"change"},this.add=function(action,handler){handlers[action].push(handler)},this.get=function(action){return handlers[action]}}function handleAppCustomEvent($s,isAnchor,$evt,customEvtName,iScope){var $currentEl,$listEl,$formEl,widgetId=customEvtName.split(".")[1],$dialogEl=WM.element('[id="wm-common-content"]').find('script[id="'+widgetId+'"]');$dialogEl.length&&($s=WM.element('[name="CommonPage"]').scope()),$evt&&($currentEl=WM.element(iScope.$element),$listEl=$currentEl.closest(".app-list-item").first(),$listEl.length&&($formEl=$listEl.find('[name="'+widgetId+'"]').first(),$formEl.length&&(_.includes(customEvtName,".cancel")||_.includes(customEvtName,".delete")||_.includes(customEvtName,".new")||_.includes(customEvtName,".reset")||_.includes(customEvtName,".save"))&&($s=$formEl.isolateScope(),customEvtName=customEvtName.split(".")[2]))),isAnchor&&$evt&&$evt.preventDefault(),Utils.evalExp($s,customEvtName)}function isActiveNavItem(fnName){var prefix="Variables.goToPage",suffix=$routeParams.name+".invoke()";return fnName===prefix+"_"+suffix||fnName===prefix+"-"+suffix}function overrideEventHandlers($is,$s,$el,attrs){var wp=$is.widgetProps;_.keys(attrs).filter(function(attrName){return wp[attrName]&&wp[attrName].type===EVENT}).forEach(function(evtName){var fn,getParentMethod,$parent,overrideFlg=!1,evtValue=attrs[evtName],isAnchor=$el.is("a");evtValue&&(fn=evtValue.split(";").map(function(fnName){var trimmedFnName=fnName.trim();return isActiveNavItem(trimmedFnName)&&($el.addClass("active"),isAnchor&&($parent=$el.parent(),$parent.hasClass("app-nav-item")&&$parent.addClass("active"))),_.includes(trimmedFnName,"(")&&!_.startsWith(trimmedFnName,"Variables.")&&!_.startsWith(trimmedFnName,"Widgets.")||_.includes(trimmedFnName,"=")?trimmedFnName:(overrideFlg=!0,"$rs._handleAppCustomEvent($s, "+isAnchor+', $event, "'+trimmedFnName+'", iScope)')}).join(";"),overrideFlg&&(attrs["_"+evtName]=fn,getParentMethod=$parse(fn),$is[evtName]=function(locals){locals=locals||{},locals.iScope=$is,locals.$s=$s,locals.$rs=$rs;var retVal=getParentMethod($s,locals);return $rs.$safeApply($s),retVal}))})}function onWatchExprValueChange($is,$s,key,propDetails,watchExpr,$el,newVal){var value,dataAttrKey="data-evaluated-"+key;$el.removeAttr(dataAttrKey),$is[key+"__updateFromWatcher"]=!0,$is.widgetid&&propDetails.showPrettyExprInDesigner&&propDetails.defaultvalue&&(_.isEmpty(newVal)||newVal.data&&_.isEmpty(newVal.data))?(value=propDetails.defaultvalue,
$el.attr(dataAttrKey,"")):WM.isDefined(newVal)&&null!==newVal&&""!==newVal?value=WM.isObject(newVal)&&Utils.isPageable(newVal)?$is.allowPageable?newVal:newVal.content:newVal:CONSTANTS.isStudioMode&&propDetails.showPrettyExprInDesigner&&(watchExpr=watchExpr.replace(".data[$i]",""),value=$is.widgetid||$s.partialcontainername||$s.prefabname?watchExpr:"",value===watchExpr&&($el.attr(dataAttrKey,""),value=$is.name)),$is[key]=value}function processEventAttr($is,attrName,attrValue){var onEvtName=_.camelCase(attrName);$is["__"+onEvtName]=attrValue}function isInterpolated(val){return _.includes(val,"{{")&&_.includes(val,"}}")}function watchProperty($is,attrs,attrName){attrs.$observe(attrName,function(nv){$is[attrName]=nv})}function setInitProp($is,propName,value){WM.isDefined(value)&&($is._initState[propName]=value)}function processAttr($is,$s,attrs,widgetProps,attrName,attrValue){var propValue=attrValue;widgetProps.hasOwnProperty(attrName)?"class"===attrName?setInitProp($is,attrName,propValue):$s.prefabname&&_.startsWith(propValue,"resources/")?(propValue=CONSTANTS.isRunMode?"./app/prefabs/"+$s.prefabname+"/"+propValue:"services/prefabs/"+$s.prefabid+"/files/webapp/"+propValue,setInitProp($is,attrName,propValue)):isInterpolated(propValue)?watchProperty($is,attrs,attrName):setInitProp($is,attrName,attrValue):isInterpolated(propValue)?watchProperty($is,attrs,attrName):$is[attrName]=attrs[attrName]}function processBoxModelProperties(el,$attrs){var removeAttrs,attrs=el.attributes,toBeUpdated={},UNSET="unset";["border","margin","padding"].forEach(function(key){var top,right,bottom,left,unit,_unit,hasDeprecatedAttr,topVal,rightVal,bottomVal,leftVal,value="",suffix="border"===key?"width":"";top=key+"top",right=key+"right",bottom=key+"bottom",left=key+"left",unit=key+"unit",(attrs[top]||attrs[right]||attrs[bottom]||attrs[left])&&(hasDeprecatedAttr=!0,removeAttrs=!0),WM.isUndefined(attrs[key])&&hasDeprecatedAttr&&(_unit=attrs[unit]?attrs[unit].value:"px",topVal=attrs[top]?attrs[top].value+_unit:UNSET,rightVal=attrs[right]?attrs[right].value+_unit:UNSET,bottomVal=attrs[bottom]?attrs[bottom].value+_unit:UNSET,leftVal=attrs[left]?attrs[left].value+_unit:UNSET,value=topVal===bottomVal&&leftVal===rightVal?topVal===leftVal?topVal:topVal+" "+leftVal:topVal+" "+rightVal+" "+bottomVal+" "+leftVal,el.setAttribute(key+suffix,value),$attrs[key+suffix]=value,toBeUpdated[key]=value),hasDeprecatedAttr&&(el.removeAttribute(top),el.removeAttribute(right),el.removeAttribute(bottom),el.removeAttribute(left),el.removeAttribute(unit))}),$attrs.widgetid&&removeAttrs&&$rs.$emit("wms:migrate-box-model-props",$attrs.widgetid,toBeUpdated)}function processAttrs($is,$s,$tEl,attrs){var widgetProps=$is.widgetProps;_.forEach($tEl.context.attributes,function(attr){var attrNameInCamelCase,fn,attrName=attr.name,attrValue=attr.value.trim();_.startsWith(attrName,"on-")?attrs.widgetid?processEventAttr($is,attrName,attrValue):(attrNameInCamelCase=_.camelCase(attrName),fn=$parse(attrs[attrNameInCamelCase]),$is[attrNameInCamelCase]=function(locals){locals=locals||{},locals.$scope||(locals.$scope=$is);var retVal=fn($s,locals);return $rs.$safeApply($s),retVal}):attrs.hasOwnProperty(attrName)&&!$is.$$isolateBindings[attrName]&&processAttr($is,$s,attrs,widgetProps,attrName,attrValue)})}function deregisterWatchersOniScope($is){_.values($is._watchers).forEach(Utils.triggerFn),$is._watchers={}}function toBoolean(val,identity){return val===!0||"true"===val||!!identity&&val===identity}function defineBindPropertyGetterSetters($is,$s,attrs,propDetails,key,value,$el){var bindKey="bind"+key,acceptedTypes=propDetails.type,acceptsArray=_.includes(acceptedTypes,"array"),_watchers=$is._watchers,isWidgetInsideCanvas=attrs.widgetid,isShowProperty="show"===key;Object.defineProperty($is,bindKey,{get:function(){return value},set:function(nv){var watchExpr,listenerFn,fn=_watchers[key];Utils.triggerFn(fn),nv?isWidgetInsideCanvas&&isShowProperty?($is.show=!0,_.set($is.widgetProps,"deferload.show",!0)):(watchExpr=nv.replace("bind:",""),listenerFn=onWatchExprValueChange.bind(void 0,$is,$s,key,propDetails,watchExpr,$el),_watchers[key]=BindingManager.register($s,watchExpr,listenerFn,{deepWatch:!0,allowPageable:$is.allowPageable,acceptsArray:acceptsArray},key)):(isWidgetInsideCanvas&&($el.removeAttr("data-evaluated-"+key),isShowProperty&&_.set($is.widgetProps,"deferload.show",!1)),_watchers[key]=void 0,nv=void 0),value=nv}})}function parseNgTrueNgFalseValue(val,$s,defalutVal){var parseFn;return val&&(parseFn=$parse(val),parseFn.constant)?parseFn($s):defalutVal}function defineDataValueGetterSetters($is,$el,attrs){function parseDataValue(val){var temp,modifiedVal=val;return isSelect&&attrs.multiple?modifiedVal=Utils.convertToArray(val):isNumberType?(temp=val,WM.isString(val)?val.length?(temp=+val,isNaN(temp)&&(temp=void 0)):temp=void 0:WM.isNumber(val)||(temp=void 0),modifiedVal=temp):isCheckbox?modifiedVal=val:isDate&&(modifiedVal=new Date(val)),modifiedVal}var flg,key,bindKey,_watchers,UPDATE_FROM_WATCHER,isSelect,isNumberType,isCheckbox,isDate;key="datavalue",bindKey="bind"+key,_watchers=$is._watchers,UPDATE_FROM_WATCHER=key+"__updateFromWatcher",isSelect=flg=$el.is("select"),isNumberType=flg=!flg&&$el.is("input[type=number], .app-currency, .app-slider, .app-ratings"),isCheckbox=flg=!flg&&$el.is(".app-checkbox"),isDate=!flg&&$el.is("input[type=date]")&&!$el.hasClass("app-dateinput"),Object.defineProperty($is,key,{get:function(){return $is._model_},set:function(nv){return $is[UPDATE_FROM_WATCHER]?$is[UPDATE_FROM_WATCHER]=!1:(Utils.triggerFn(_watchers[key]),_watchers[key]=void 0),_.startsWith(nv,"bind:")?void($is[bindKey]=nv):($is._model_=parseDataValue(nv),$is._ngModelOldVal=$is._model_,void Utils.triggerFn($is._onChange))}})}function hasValueChanged(nv,ov,doEqualsCheck){return doEqualsCheck?!WM.equals(nv,ov):nv!==ov||WM.isObject(nv)||WM.isObject(ov)}function definePropertyGetterSetters($is,$s,$el,attrs,propDetails,isBindableProperty,key,value){function parseValue(val){var numVal,modifiedValue=val;return isBooleanType?modifiedValue=toBoolean(val,_isBooleanAttr&&key):isNumberType&&(numVal=+val,isFontSize?WM.isString(val)&&val.trim().length&&(modifiedValue=numVal):modifiedValue=+val),modifiedValue}var flg,bindKey,UPDATE_FROM_WATCHER,_watchers,type,isBooleanType,isNumberType,_isBooleanAttr,isFontSize,isName;bindKey="bind"+key,UPDATE_FROM_WATCHER=key+"__updateFromWatcher",_watchers=$is._watchers,type=propDetails.type,isBooleanType=flg="boolean"===type,isNumberType=!flg&&"number"===type,_isBooleanAttr=isBooleanAttr(key),isFontSize="fontsize"===key,isName="name"===key,setInitProp($is,key,value),Object.defineProperty($is,key,{get:function(){return value},set:function(nv){var _nv,doEqualsCheck,ov=value;if(isBindableProperty){if($is[UPDATE_FROM_WATCHER]?$is[UPDATE_FROM_WATCHER]=!1:(Utils.triggerFn(_watchers[key]),_watchers[key]=void 0,doEqualsCheck=!0),_.startsWith(nv,"bind:"))return void($is[bindKey]=nv)}else doEqualsCheck=!0;_nv=parseValue(nv),hasValueChanged(_nv,ov,doEqualsCheck)&&(!$is.widgetid&&isBooleanType&&"disabled"===key&&(_nv?$el.attr("disabled","disabled"):$el.removeAttr("disabled")),isName&&(attrs.widgetid?$rs.$emit("name-change",attrs.widgetid,nv,ov,$is):$s.Widgets&&attrs.name&&($s.Widgets[attrs.name]=$is)),value=_nv,WidgetUtilService.onScopeValueChangeProxy($is,$el,attrs,key,_nv,ov))}})}function isBindableProperty(propDetails){return"in-bound"===propDetails.bindable||"in-out-bound"===propDetails.bindable}function defineGetterSettersForProp($is,$s,$el,attrs,hasModel,propName,propDetails){var _isBindableProperty;"datavalue"===propName&&hasModel?(defineBindPropertyGetterSetters($is,$s,attrs,propDetails,propName,void 0,$el),defineDataValueGetterSetters($is,$el,attrs)):propDetails.ignoreGetterSetters||(_isBindableProperty=isBindableProperty(propDetails),_isBindableProperty&&defineBindPropertyGetterSetters($is,$s,attrs,propDetails,propName,void 0,$el),definePropertyGetterSetters($is,$s,$el,attrs,propDetails,_isBindableProperty,propName,attrs[propName]?void 0:propDetails.value))}function defineGetterSettersForProps($is,$s,$el,attrs){var wp=$is.widgetProps,hasModel=attrs.hasOwnProperty("hasModel");Object.keys(wp).forEach(function(propName){var propDetails=wp[propName];$is.$$isolateBindings[propName]||propDetails.type===EVENT||defineGetterSettersForProp($is,$s,$el,attrs,hasModel,propName,propDetails)})}function applyAppDefaults($is,attrs){var config=JSON.parse(attrs.appDefaults);_.forEach(config,function(val,key){var appSetting=AppDefaults.get(val);_.trim(appSetting).length&&(attrs.hasOwnProperty(key)||($is[key]=appSetting,$is._initState[key]=appSetting,attrs[key]=appSetting))})}var $appConfirmDialog,BOOLEAN_ATTRS={},EVENT="event";return CONSTANTS.isRunMode&&($appConfirmDialog=WM.element('<wm-confirmdialog name="_app-confirm-dialog" keyboard="true"></wm-confirmdialog>'),WM.element(document.body).append($appConfirmDialog),$compile($appConfirmDialog)($rs)),["readonly","autofocus","disabled","startchecked","multiple","selected","required","controls","autoplay","loop","muted"].forEach(function(attr){BOOLEAN_ATTRS[attr]=!0}),CONSTANTS.isRunMode&&($rs._handleAppCustomEvent=handleAppCustomEvent),wm.baseClasses.FieldDef=function(){},wm.baseClasses.FieldDef.prototype={setProperty:function(field,newval){this.$is.setProperty.call(this,field,newval),this.$is.redraw&&this.$is.redraw(!0)},getProperty:function(field){return this.$is.getProperty.call(this,field)}},{restrict:"A",compile:function($tEl,$tAttrs){return processBoxModelProperties($tEl.context,$tAttrs),{pre:function($is,$el,attrs){var hasDataValue,datavalue_value,scopeVarName,$s=$el.scope(),delayed=[];$is&&$is.widgetProps&&($is.propertyManager=new PropertyManager,$is._watchers={},$is._applyCSSFns=[],$is.$on("$destroy",deregisterWatchersOniScope.bind(void 0,$is)),attrs.widgetid?$el.on("$destroy",$is.$destroy.bind($is)):$is._widgettype=$tEl.context.tagName.toLowerCase(),$is._initState={},attrs.appDefaults&&applyAppDefaults($is,attrs),attrs.hasOwnProperty("hasModel")&&!attrs.widgetid&&(scopeVarName=$tEl.context.attributes.scopedatavalue,scopeVarName=scopeVarName&&scopeVarName.value,scopeVarName&&isInterpolated(scopeVarName)?attrs.$observe("scopedatavalue",function(newValue){WidgetUtilService.injectModelUpdater($el,newValue)}):WidgetUtilService.injectModelUpdater($el,scopeVarName)),CONSTANTS.isStudioMode?WM.extend($is.widgetProps,{active:{}}):($is.setProperty=function(option,value){this[option]=value},$is.getProperty=function(option){return this[option]},$is.focus=function(){var $target=$el.find("[focus-target]");$target.length||($target=$el),$target.first().focus()}),defineGetterSettersForProps($is,$s,$el,attrs),processAttrs($is,$s,$tEl,attrs),$is._initState.hasOwnProperty("datavalue")&&(hasDataValue=!0,datavalue_value=$is._initState.datavalue,delete $is._initState.datavalue),Object.keys($is._initState).forEach(function(propName){var propVal=$is._initState[propName];_.startsWith(propVal,"bind:")?delayed.push({name:propName,value:propVal}):$is[propName]=propVal}),attrs.placeholder&&_.startsWith(attrs.placeholder,"bind:")&&attrs.$set("placeholder",""),delayed.forEach(function(prop){$is[prop.name]=prop.value}),hasDataValue&&($el.is(".app-checkbox")&&!_.startsWith(datavalue_value,"bind:")&&(datavalue_value=parseNgTrueNgFalseValue(datavalue_value,$s,!1)),$is.datavalue=datavalue_value),CONSTANTS.isRunMode&&(overrideEventHandlers($is,$s,$el,attrs),$is.$element=$el))}}}}}]).directive("hasModel",function(CONSTANTS){"use strict";return CONSTANTS.isStudioMode?{}:{restrict:"A",priority:200,compile:function($tEl){return{pre:function($s,$el,attrs){var dataValueAttr,scopeDataValueAttr;$el.closest(".app-livelist").length&&(dataValueAttr=attrs.datavalue,scopeDataValueAttr=attrs.scopedatavalue,dataValueAttr&&_.startsWith(dataValueAttr,"bind:item")&&!scopeDataValueAttr&&(scopeDataValueAttr=dataValueAttr.replace("bind:",""),WM.element($tEl.context).attr("scopedatavalue",scopeDataValueAttr).removeAttr("datavalue"),attrs.datavalue=void 0,attrs.scopedatavalue=scopeDataValueAttr))}}}}}).service("BindingManager",["$rootScope","Utils","CONSTANTS","$interval",function($rs,Utils,CONSTANTS,$interval){"use strict";function isArrayTypeExpr(expr){var matchers=expr.match(regex);return matchers&&matchers.length}function isDataSetTypeExpr(expr,key){return"datavalue"===key&&DATASET_REGEX.test(expr)}function destroyTFNWatcher(watcher){_.pullAt(TFNWatchers,_.indexOf(TFNWatchers,watcher)),0===TFNWatchers.length&&($interval.cancel(interval),interval=void 0)}function evalTFNFilterExprAndNotifyListener(watcher){watcher.$s&&!watcher.$s.$$destroyed&&watcher.listener(watcher.$s.$eval(watcher.expr))}function evalTFNFilterExprs(){var i,watcher;for(i=0;i<TFNWatchers.length;i++)watcher=TFNWatchers[i],evalTFNFilterExprAndNotifyListener(watcher),watcher.deRegister.destroy||(watcher.deRegister.destroy=destroyTFNWatcher.bind(void 0,watcher))}function registerWatchers(){$rs.$evalAsync(function(){var i,watcher;for(i=0;i<watchers.length;i++)watcher=watchers[i],watcher.deRegister.skip||watcher.$s&&!watcher.$s.$$destroyed&&(FILE_UPLOAD_REGEX.test(watcher.expr)?watcher.deRegister.destroy=watcher.$s.$watchCollection(watcher.expr,watcher.listener,watcher.deepWatch):watcher.deRegister.destroy=watcher.$s.$watch(watcher.expr,watcher.listener,watcher.deepWatch));watchers.length=0,TFNWatchers.length&&(interval?evalTFNFilterExprAndNotifyListener(TFNWatchers[TFNWatchers.length-1]):(evalTFNFilterExprs(),interval=$interval(evalTFNFilterExprs,TFN_INTERVAL)))})}function arrayConsumer(listenerFn,allowPageable,restExpr,newVal,oldVal){var formattedData,data=newVal;WM.isObject(data)&&Utils.isPageable(data)&&!allowPageable&&(data=data.content),WM.isArray(data)&&(formattedData=data.map(function(datum){return Utils.findValueOf(datum,restExpr)}),WM.isArray(formattedData[0])&&(formattedData=_.flatten(formattedData)),listenerFn(formattedData,oldVal))}function getUpdatedWatchExpr(expr,acceptsArray,allowPageable,listener){if(!acceptsArray)return{expr:expr.replace(regex,$0),listener:listener};var index=expr.lastIndexOf($I),_expr=expr.substr(0,index).replace($I,$0),restExpr=expr.substr(index+5),arrayConsumerFn=listener;return restExpr&&(arrayConsumerFn=arrayConsumer.bind(void 0,listener,allowPageable,restExpr)),{expr:_expr,listener:arrayConsumerFn}}function register($s,watchExpr,listenerFn,config,key){function isPageable(variable){return"wm.ServiceVariable"===variable.category&&"DataService"===variable.serviceType&&"ProcedureExecution"!==variable.controller&&variable.isList}var watchInfo,watcher,variableObject,regExp,index,_config=config||{},deepWatch=_config.deepWatch,allowPageable=_config.allowPageable,acceptsArray=_config.acceptsArray,isOnlyDataSet=isDataSetTypeExpr(watchExpr,key),deRegister={},isParentVariableExpr=watchExpr.indexOf("$parent.Variables")!==-1,variables=isParentVariableExpr?_.get($s,"$parent.Variables"):$s.Variables;if(isArrayTypeExpr(watchExpr)||isOnlyDataSet){if(CONSTANTS.isStudioMode&&!config.acceptsArray)return void listenerFn();isOnlyDataSet?(index="0",regExp=DATASET_REGEX):(index="$i",regExp=VARIABLE_REGEX),watchExpr=watchExpr.replace(regExp,function(match,varName){return variableObject=_.get(variables,varName),variableObject&&isPageable(variableObject)?"Variables."+varName+".dataSet.content["+index+"]":variableObject&&"wm.LiveVariable"===variableObject.category?"Variables."+varName+".dataSet.data["+index+"]":match}),watchInfo=getUpdatedWatchExpr(watchExpr,acceptsArray,allowPageable,listenerFn)}else watchInfo={expr:watchExpr,listener:listenerFn};return watcher={$s:$s,expr:watchInfo.expr,listener:watchInfo.listener,deepWatch:deepWatch,deRegister:deRegister},TFN_FILTER_REGEX.test(watchInfo.expr)?TFNWatchers.push(watcher):watchers.push(watcher),_registerWatchers(),function(){deRegister.destroy||(deRegister.skip=!0),Utils.triggerFn(deRegister.destroy)}}var interval,_registerWatchers,regex=/\[\$i\]/g,$I="[$i]",$0="[0]",watchers=[],TFNWatchers=[],VARIABLE_REGEX=/Variables\.(\w*)\.dataSet\[\$i\]/g,DATASET_REGEX=/Variables\.(\w*)\.dataSet$/,TFN_FILTER_REGEX=/\s*\|\s*timeFromNow/,TFN_INTERVAL=6e4,FILE_UPLOAD_REGEX=/Widgets\.\w+\.selectedFiles/;CONSTANTS.isRunMode&&$rs.$on("locale-change",function(){evalTFNFilterExprs()}),_registerWatchers=_.debounce(registerWatchers),this.register=register}]),function(){"use strict";if($.__isStudioMode)WM.module("wm.widgets.form").requires=WM.module("wm.widgets.form").requires.concat(["textAngular"]);else{var baseUri,typeConfigMap,module,directiveFn,prefix,componentLibsRoot;if(baseUri=WM.element('script[src$="wm-libs.min.js"]').attr("src"),!baseUri)return;baseUri=baseUri.substring(0,baseUri.indexOf("/scripts/")),prefix="/scripts/component-libs/",componentLibsRoot=baseUri+prefix,typeConfigMap={"wm-chart":{files:[componentLibsRoot+"chart.min.js"]},"wm-calendar":{files:[componentLibsRoot+"calendar.min.js"]},"wm-richtexteditor":{files:[componentLibsRoot+"richTextEditor.min.js"],name:"textAngular"}},directiveFn=function(directiveName,widgetType,$ocLazyLoad,$compile,$injector,Utils){function _compile($el,$s,attrs){$compile($el)($s)}function _compileWidgets($s){for(;compileFns.length;)compileFns.shift()();Utils.triggerFn($s.onPagePartLoad),delayPageReadyByTypeMap[widgetType]=!1}function _postLibsLoad($s){libsLoaded=!0,inProgress=!1;var definitions=$injector.get(directiveName+"Directive");_.remove(definitions,function(defn){return defn.name===directiveName&&defn.terminal}),_compileWidgets($s)}var libsLoaded,inProgress,compileFns=[],delayPageReadyByTypeMap={};return"wmCalendar"===directiveName&&Utils.isMobile()?{}:{restrict:"E",terminal:!0,priority:100,link:{pre:function($s,$el,attrs){var compileFn,config,_clone;delayPageReadyByTypeMap[widgetType]||(delayPageReadyByTypeMap[widgetType]=!0,Utils.triggerFn($s.registerPagePart)),_.forEach(attrs.$$element.context.attributes,function(attr){$el[0].setAttribute(attr.name,attr.value)}),_clone=$el.clone(!0),$el.replaceWith(_clone),compileFn=_compile.bind(void 0,_clone,$s,attrs),compileFns.push(compileFn),libsLoaded?_compileWidgets(widgetType):inProgress||(inProgress=!0,config=typeConfigMap[widgetType],$ocLazyLoad.jsLoader(config.files,function(){config.name?$ocLazyLoad.inject(config.name).then(_postLibsLoad.bind(void 0,$s),{}):_postLibsLoad($s)},{}))}}}},module=WM.module("wm.widgets.base"),_.keys(typeConfigMap).forEach(function(widgetType){var directiveName=_.camelCase(widgetType);module.directive(directiveName,["$ocLazyLoad","$compile","$injector","Utils",directiveFn.bind(void 0,directiveName,widgetType)])})}}(),function(){"use strict";function directiveFn(){return{restrict:"A",link:function($s,$el){$el.on("click",function(event){event.stopPropagation()})}}}function deferLoadDirective($compile,BindingManager){function compileFn($s,$el){$compile($el)($s)}return{restrict:"A",priority:1e3,terminal:!0,link:function($s,$el,attrs){$el.removeAttr("deferload");var showExpr,unregisterFn;showExpr=attrs.show,_.startsWith(showExpr,"bind:")&&"true"===attrs.deferload?(showExpr=_.replace(showExpr,"bind:",""),$el.addClass("ng-hide"),unregisterFn=BindingManager.register($s,showExpr,function(nv){"true"!==nv&&nv!==!0||(unregisterFn(),$el.removeClass("ng-hide"),compileFn($s,$el))})):compileFn($s,$el)}}}if(!$.__isStudioMode){var module=WM.module("wm.widgets.base");module.directive("uibDatepickerPopupWrap",directiveFn).directive("uibTimepicker",directiveFn).directive("uibTypeaheadPopup",directiveFn),module.directive("deferload",["$compile","BindingManager",deferLoadDirective])}}(),WM.module("wm.widgets.base").directive("pageContainer",["$compile","$rootScope","$routeParams","PropertiesFactory","Variables","FileService","CONSTANTS","Utils","WidgetUtilService","ProjectService","$timeout","$templateCache",function($compile,$rootScope,$routeParams,PropertiesFactory,Variables,FileService,CONSTANTS,Utils,WidgetUtilService,ProjectService,$timeout,$tc){"use strict";function evtHandler(e){e.stopPropagation(),e.preventDefault()}function bindEvtHandler(element){element.on("drop",evtHandler)}function unbindEvtHandler(element){element.off("drop",evtHandler)}function preCompilePartial(partialElement){partialElement.find('[on-click^="goToPage-"][on-click^="goToPage_"]').removeClass("active"),partialElement.find('[on-click="goToPage-'+(CONSTANTS.isRunMode?$routeParams.name:$rootScope.activePageName)+'"][on-click="goToPage_'+(CONSTANTS.isRunMode?$routeParams.name:$rootScope.activePageName)+'"]').addClass("active")}function compilePartialAndUpdateVariables(iScope,element,partialName,partialMarkup){var scope,target=iScope.target;if(Variables.setPageVariables(partialName,loadedPartials[partialName].variables),CONSTANTS.isRunMode&&"wm-popover"===iScope._widgettype&&"partial"===iScope.contentsource&&(iScope._popoverOptions.customclass="popover_"+iScope.$id+"_"+partialName+"_"+_.toLower($rootScope.activePageName)),partialMarkup=partialMarkup+'<div class="app-included-page">'+(loadedPartials[partialName].html||"")+"</div>",CONSTANTS.isRunMode?partialMarkup=WM.element(Utils.processMarkup(partialMarkup)):(partialMarkup+='<div class="content-overlay"></div>',partialMarkup=WM.element(partialMarkup),partialMarkup.find("wm-livelist, wm-login").removeAttr("data-ng-controller")),scope=element.scope(),scope&&(scope=scope.$new())){if(preCompilePartial(partialMarkup),scope.partialname=partialName,scope.partialcontainername=iScope.name,scope.pageParams=iScope.pageParams,"wm-popover"===iScope.widgettype||"wm-popover"===iScope._widgettype){var popoverTemplate="template/popoverPartials/"+iScope.$id+".html";$tc.put(popoverTemplate,"<div>"+partialMarkup[0].outerHTML+"</div>"),iScope._popoverOptions.contenturl=popoverTemplate}else target.html($compile(partialMarkup)(scope)),$timeout(function(){Utils.triggerFn(iScope.onLoad,{$isolateScope:iScope})},void 0,!1);CONSTANTS.isStudioMode&&(filteredPartials=_.filter(listPartials,function(partial){return partial===partialName}),listPartials.splice(_.indexOf(listPartials,partialName),1),1===filteredPartials.length&&(loadedPartials[partialName]=void 0),iScope.toolbar=target.find("button.wm-included-page-heading").first(),iScope.overlay=target.find("div.content-overlay").first(),$rootScope.$safeApply(iScope)),scope.$emit("on-pagecontainer-ready")}}function _compilePartialAndUpdateVariables(iScope,element,partialName,partialMarkup){$timeout(function(){compilePartialAndUpdateVariables(iScope,element,partialName,partialMarkup)})}function reloadPartial(iScope,element,attrs){$timeout.cancel(iScope._pageLoadTimer),iScope._pageLoadTimer=$timeout(function(){element.scope()&&onPageIncludeChange(iScope,element,attrs,iScope.content)},200)}function onPageIncludeChange(iScope,element,attrs,newVal,forceLoad){function onPageFetchSuccess(content){loadedPartials[newVal]=content,listPartials.push(newVal),_compilePartialAndUpdateVariables(iScope,element,newVal,el)}function onPageFetchError(){CONSTANTS.isRunMode?$s&&Utils.triggerFn($s.onPagePartLoad):(target=element[0].hasAttribute("page-container-target")?element:element.find("[page-container-target]").first(),target.html('<div class="app-partial-info"><div class="partial-message">Content for the container is unavailable.</div></div>'))}var addToolBar,target=iScope.target,el="",page="pages/"+newVal+"/",$s=element.scope();if(target||(iScope.target=target=WM.isDefined(attrs.pageContainerTarget)?element:element.find("[page-container-target]").eq(0)),element.attr("content",newVal),CONSTANTS.isStudioMode?target.find(".app-included-page, .app-included-page + .content-overlay, .wm-included-page-heading").remove():(iScope.pageParams={},_.forEach(iScope.partialParams,function(param){var watchExpr,paramName=param.name,paramVal=param.value;Utils.stringStartsWith(paramVal,"bind:")?(watchExpr=paramVal.replace("bind:",""),$s.$watch(":: "+watchExpr,function(nv1){var deregister=$s.$watch(watchExpr,function(nv2){nv2!==nv1&&(deregister(),reloadPartial(iScope,element,attrs))});iScope.pageParams[paramName]=nv1})):iScope.pageParams[paramName]=paramVal})),_.isString(newVal)&&newVal.trim().length)if(!loadedPartials[newVal]||forceLoad)if(CONSTANTS.isStudioMode)iScope.Widgets={},bindEvtHandler(element),addToolBar=WM.isDefined(attrs.widgetid),addToolBar&&(el='<button class="wm-included-page-heading button-primary" data-ng-click=_openPageWS("'+newVal+'"); title="edit '+newVal+'"><i class="wm-edit wi wi-pencil"></i></button>'),FileService.read({path:CONSTANTS.isStudioMode?"../../../"+page+"page.min.html":page+"page.min.html",projectID:$rootScope.project.id},function(pageContent){onPageFetchSuccess(Utils.parseCombinedPageContent(pageContent,newVal))},onPageFetchError);else{var AppManager=Utils.getService("AppManager");AppManager.loadPartial(newVal).then(onPageFetchSuccess,onPageFetchError)}else _compilePartialAndUpdateVariables(iScope,element,newVal,el);else CONSTANTS.isStudioMode&&(iScope.Widgets=void 0,"wm-top-nav"!==iScope.widgettype||element.children().length||$rootScope.$emit("canvas-add-widget",{widgetType:"wm-list",parentName:iScope.name},!0),element.find("> .app-partial-info").remove(),unbindEvtHandler(element))}function loadPartialParamProperties(iScope,element,attrs,partialName){var paramName,partiaParams=_.get(ProjectService.getPageInfo(partialName),"params");iScope.newcolumns&&(iScope.newcolumns=!1,iScope.partialParams=[],$rootScope.$emit("wms:partial-container-params-modified",{params:iScope.partialParams,widgetName:iScope.name})),_.forEach(partiaParams,function(param){paramName=param.name,_.find(iScope.partialParams,{name:paramName})||iScope.partialParams.push({name:param.name,value:"",type:param.type})});var removedParams=_.remove(iScope.partialParams,function(isparam){return!_.find(partiaParams,function(param){return isparam.name===param.name})});removedParams.length&&($rootScope.$emit("wms:partial-container-params-modified",{params:iScope.partialParams,widgetName:iScope.name}),$rootScope.$emit("wms:change-workspace-sanity",{params:iScope.partialParams,widgetName:iScope.name}))}function propertyChangeHandler(iScope,element,attrs,key,newVal){switch(key){case"content":newVal&&iScope.$lazyLoad&&!iScope.isActive?iScope.$lazyLoad=function(){var forceLoad="wm-popover"===iScope.widgettype||"wm-popover"===iScope._widgettype;onPageIncludeChange(iScope,element,attrs,newVal,forceLoad),forceLoad||(iScope.$lazyLoad=WM.noop)}:onPageIncludeChange(iScope,element,attrs,newVal),CONSTANTS.isStudioMode&&loadPartialParamProperties(iScope,element,attrs,newVal);break;case"active":if(!CONSTANTS.isStudioMode||!iScope.toolbar)return;newVal?(iScope.toolbar.addClass("active"),iScope.overlay.addClass("active")):(iScope.toolbar.removeClass("active"),iScope.overlay.removeClass("active"))}}var filteredPartials,props=PropertiesFactory.getPropertiesOf("wm.pagecontainer"),notifyFor={content:!0,active:!0},loadedPartials={},listPartials=[];return{priority:"1000",compile:function(){return{pre:function(iScope,element,attrs){var partialName=attrs.page||attrs.content;WM.extend(iScope.widgetProps||{},Utils.getClonedObject(props)),iScope["page-container"]=!0,iScope.partialParams=[],CONSTANTS.isRunMode&&partialName&&!iScope.$lazyLoad&&Utils.triggerFn(element.scope().registerPagePart)},post:function(iScope,element,attrs){CONSTANTS.isStudioMode&&"wm-pagedialog"===iScope.widgettype&&(iScope.widgetProps.content.widget="pagedialog-pages-list"),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,iScope,element,attrs),iScope,notifyFor),iScope.hasOwnProperty("page")&&!iScope.content&&(iScope.content=iScope.page)}}}}}]).directive("wmParam",[function(){"use strict";return{restrict:"E",replace:!0,link:function(iScope,element,attrs){var containerScope=element.closest("[page-container]").isolateScope();containerScope.partialParams.push({name:attrs.name,value:attrs.value,type:attrs.type})}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/anchor.html",'<a data-identifier="anchor" class="app-anchor" init-widget title="{{hint}}" apply-styles role="button" accesskey="{{::shortcutkey}}"><img data-identifier="img" class="anchor-image-icon" ng-src="{{iconsrc}}" ng-if="iconsrc" ng-style="{width:iconwidth ,height:iconheight, margin:iconmargin}"/><i class="app-icon {{iconclass}}" ng-style="{width:iconwidth, height:iconheight, margin:iconmargin}" ng-if="iconclass"></i> <span class="anchor-caption"></span><span ng-if="badgevalue" class="badge pull-right">{{badgevalue}}</span></a>')}]).directive("wmAnchor",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";function propertyChangeHandler(scope,element,attrs,key,newVal){switch(key){case"target":attrs.$set("target",newVal);break;case"iconposition":attrs.$set("icon-position",newVal);break;case"hyperlink":scope.encodeurl&&(newVal=Utils.encodeUrl(newVal)),Utils.stringStartsWith(newVal,"www.")&&(newVal="//"+newVal),attrs.$set("href",newVal);break;case"iconurl":scope.iconsrc=Utils.getImageUrl(newVal);break;case"caption":Utils.setNodeContent(element.children(".anchor-caption"),newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.anchor",["wm.base","wm.base.advancedformwidgets","wm.base.events","wm.base.events.focus"]),notifyFor={iconname:!0,iconurl:!0,target:!0,hyperlink:!0,caption:!0,iconposition:!0};return{restrict:"E",replace:!0,scope:{},template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/widget/anchor.html"),compile:function(tElement){return{pre:function(scope,element,attrs){!attrs.iconclass&&attrs.iconname&&(WM.element(tElement.context).attr("iconclass","wi wi-"+attrs.iconname),attrs.iconclass="wi wi-"+attrs.iconname),scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element,attrs),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs),attrs.hyperlink||attrs.href||element.attr("href","javascript:void(0)")}}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/icon.html",'<span class="app-icon-wrapper" init-widget><i class="app-icon"></i> <label class="app-label" ng-if="caption">{{caption}}</label></span>')}]).directive("wmIcon",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";function propertyChangeHandler($el,$iNode,attrs,key,newVal,oldVal){switch(key){case"iconposition":$el.attr("icon-position",newVal);break;case"iconsize":$el[0].style.fontSize=newVal;break;case"opacity":$el[0].style.opacity=newVal;break;case"color":$iNode[0].style.color=newVal;break;case"iconclass":$iNode.removeClass(oldVal).addClass(newVal);break;case"hint":attrs.$set("title",newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.icon",["wm.base"]),notifyFor={iconposition:!0,iconsize:!0,opacity:!0,iconclass:!0,hint:!0};return{restrict:"E",scope:{},replace:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/widget/icon.html"),link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,element,element.children().first(),attrs),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/htmlTemplate.html",'<div class="app-html-container" init-widget title="{{hint}}" apply-styles></div>')}]).directive("wmHtml",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";function propertyChangeHandler(element,key,newVal){switch(key){case"content":element.html(newVal);break;case"height":element.css("overflow",newVal?"auto":"")}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.html",["wm.base","wm.base.editors","wm.containers","wm.containers.borderstyle","wm.base.events"]),notifyFor={
content:!0,height:!0};return{restrict:"E",replace:!0,scope:{},template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/widget/htmlTemplate.html"),compile:function(tElement){return{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){var content=tElement.context.innerHTML;scope.content=attrs.content||content,element.html(scope.content),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/iframe.html",'<div class="embed-responsive app-iframe" init-widget ><iframe class="embed-responsive-item iframe-content" scrolling="auto" marginheight="0" marginwidth="0" frameborder="0" title="{{hint}}" seamless="seamless"></iframe><div class="wm-content-info {{class}} readonly-wrapper" ng-if="showContentLoadError"><p class="wm-message" title="{{hintMsg}}">{{errMsg}}</p></div></div>')}]).directive("wmIframe",["PropertiesFactory","$rootScope","WidgetUtilService","$sce","Utils",function(PropertiesFactory,$rootScope,WidgetUtilService,$sce,Utils){"use strict";function propertyChangeHandler(scope,element,key,newVal){switch(key){case"iframesrc":newVal&&WM.isString(newVal)&&newVal.indexOf("Variables")===-1?(newVal=scope.encodeurl?Utils.encodeUrl(newVal):newVal,scope._iframesrc=$sce.trustAsResourceUrl(newVal),Utils.isInsecureContentRequest(newVal)?(scope.showContentLoadError=!0,scope.errMsg=$rootScope.locale.MESSAGE_ERROR_CONTENT_DISPLAY+newVal,scope.hintMsg=$rootScope.locale.MESSAGE_ERROR_CONTENT_DISPLAY+newVal):scope.showContentLoadError=!1,element.children("iframe").attr("src",scope._iframesrc)):element.children("iframe").attr("src","");break;case"width":case"height":element.css(key,newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.iframe",["wm.base"]),notifyFor={iframesrc:!0,width:!0,height:!0};return{restrict:"E",scope:{},replace:!0,template:function(tElement,tAttrs){var template=WM.element(WidgetUtilService.getPreparedTemplate("template/widget/iframe.html",tElement,tAttrs));return template.find(".iframe-content").attr("name",tAttrs.name),template[0].outerHTML},link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/label.html",'<label class="app-label" init-widget apply-styles></label>')}]).directive("wmLabel",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";function propertyChangeHandler(element,attrs,key,newVal){switch(key){case"caption":Utils.setNodeContent(element,newVal);break;case"required":newVal&&"false"!==newVal?element.addClass("required"):element.removeClass("required");break;case"hint":attrs.$set("title",newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.label",["wm.base","wm.base.advancedformwidgets","wm.base.events"]),notifyFor={caption:!0,required:!0,hint:!0};return{restrict:"E",scope:{},replace:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/widget/label.html"),link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,element,attrs),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/message.html",'<p init-widget apply-styles class="alert app-message" ng-class="messageClass"><i title="{{type}} Alert" class="{{type}} icon {{messageIconClass}}"></i><span ng-bind-html="messageContent"></span><button title="Close" type="button" class="btn-transparent close" ng-hide="hideclose">&times;</button></p>')}]).directive("wmMessage",["PropertiesFactory","$templateCache","WidgetUtilService","$sce","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,$sce,Utils){"use strict";function setDataSet(dataset,scope){!WM.isArray(dataset)&&WM.isObject(dataset)?(scope.messageContent=$sce.trustAs($sce.HTML,dataset.caption),scope.type=dataset.type,scope.show=dataset.show=!0):scope.show=!1}function propertyChangeHandler(scope,attrs,key,newVal){switch(key){case"type":switch(newVal){case"success":scope.messageClass="alert-success",scope.messageIconClass="wi wi-done";break;case"error":scope.messageClass="alert-danger",scope.messageIconClass="wi wi-cancel";break;case"warn":case"warning":scope.messageClass="alert-warning",scope.messageIconClass="wi wi-bell";break;case"info":scope.messageClass="alert-info",scope.messageIconClass="wi wi-info";break;case"loading":scope.messageClass="alert-info alert-loading",scope.messageIconClass="fa fa-spinner fa-spin"}break;case"dataset":attrs.dataset&&setDataSet(newVal,scope);break;case"caption":scope.messageContent=$sce.trustAsHtml(newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.message",["wm.base"]),notifyFor={type:!0,dataset:!0,caption:!0};return{restrict:"E",replace:!0,scope:{scopedataset:"=?",onClose:"&"},template:function(tElement,tAttrs){var isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),template=WM.element($templateCache.get("template/widget/message.html"));return isWidgetInsideCanvas||template.children().last().attr("ng-click","dismiss({$event: $event, $scope: this})"),template[0].outerHTML},link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.hideclose=attrs.hideclose||attrs.hideClose||!1,scope.dismiss=function(eventObject){scope.onClose({$event:eventObject.$event,$scope:eventObject.$scope}),scope.dataset?(scope.dataset.show=!1,setDataSet(null,scope)):scope.scopedataset?(scope.scopedataset.show=!1,setDataSet(null,scope)):scope.show=!1},scope.toggle=function(showHide,caption,type){WM.isUndefined(showHide)?scope.show=!scope.show:(scope.show="show"===showHide||"hide"!==showHide&&showHide,scope.messageContent=caption||scope.messageContent,scope.type=type||scope.type)},WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,attrs),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs),!attrs.widgetid&&attrs.scopedataset&&scope.$watch("scopedataset",function(newVal){setDataSet(newVal,scope)})}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/picture.html",'<img init-widget ng-class="[imgClass]" class="app-picture" ng-src="{{imagesource}}" apply-styles>'),$templateCache.put("template/mobile/widget/picture.html",'<img init-widget ng-class="[imgClass]" class="app-picture" ng-src="{{imagesource}}" apply-styles wm-image-cache="{{offline ? \'permanant\' : \'\'}}">')}]).directive("wmPicture",["PropertiesFactory","WidgetUtilService","Utils","CONSTANTS",function(PropertiesFactory,WidgetUtilService,Utils,CONSTANTS){"use strict";function propertyChangeHandler(scope,element,attrs,key,newVal){switch(key){case"pictureaspect":switch(newVal){case"None":element.css({width:"",height:""});break;case"H":element.css({width:"100%",height:""});break;case"V":element.css({width:"",height:"100%"});break;case"Both":element.css({width:"100%",height:"100%"});break;case"hint":attrs.$set("title",newVal),attrs.$set("alt",newVal)}break;case"picturesource":scope.imagesource=WM.isDefined(newVal)?Utils.getImageUrl(newVal,scope.encodeurl):"//:0";break;case"shape":scope.imgClass="img-"+newVal}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.picture",["wm.base","wm.base.events"]),notifyFor={pictureaspect:!0,picturesource:!0,shape:!0,hint:!0};return{restrict:"E",replace:!0,scope:{},template:function($tEl,$tAttrs){var templateId="template/widget/picture.html";return CONSTANTS.hasCordova&&(templateId="template/mobile/widget/picture.html"),WidgetUtilService.getPreparedTemplate(templateId,$tEl,$tAttrs)},link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element,attrs),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.basic").directive("wmPopover",["PropertiesFactory","WidgetUtilService","Utils","CONSTANTS","$rootScope","$timeout","$templateCache","$compile",function(PropertiesFactory,WidgetUtilService,Utils,CONSTANTS,$rs,$timeout,$tc,$compile){"use strict";function transcludeContent($el,slotContent){if(slotContent.children.length&&"WM-PARAM"===slotContent.children[0].tagName){var $nodes=WM.element(slotContent.children);$el.append($nodes),$compile($nodes)($el.scope())}}function propertyChangeHandler($is,$el,slotContent,key,nv){var showIcon;switch(key){case"iconposition":$el.attr("icon-position",nv);break;case"contentsource":$is.widgetid&&("inline"===nv?($is.widgetProps.inlinecontent.show=!0,$is.widgetProps.content.show=!1):($is.widgetProps.content.show=!0,$is.widgetProps.inlinecontent.show=!1)),transcludeContent($el,slotContent);break;case"iconclass":$is.showicon="_none_"!==$is.iconclass&&""!==nv&&!$is.iconurl;break;case"iconurl":showIcon=""===nv,$is.showicon=showIcon,$is.showimage=!showIcon,$is.iconsrc=Utils.getImageUrl(nv);break;case"caption":Utils.setNodeContent($el.find(">span.anchor-caption"),nv);break;case"popoverplacement":nv&&($is._popoverOptions.placement="auto "+nv)}}function setStyleBlock($is){var arrowCss,styleBlock=document.head.getElementsByClassName("popover-styles"),css="."+$is._popoverOptions.customclass+"{height: "+Utils.formatStyle($is.popoverheight,"px")+"; width: "+Utils.formatStyle($is.popoverwidth,"px")+"}";$is.popoverarrow||(arrowCss="."+$is._popoverOptions.customclass+" .arrow {display: none !important;}"),styleBlock.length?(styleBlock[0].sheet.insertRule(css,0),arrowCss&&styleBlock[0].sheet.insertRule(arrowCss,0)):(styleBlock=document.createElement("style"),styleBlock.setAttribute("type","text/css"),styleBlock.setAttribute("class","popover-styles"),styleBlock.textContent=css+(arrowCss||""),document.head.appendChild(styleBlock))}function setHideTrigger($is){$timeout(function(){$is._popoverOptions.isPopoverActive||($is._popoverOptions.isOpen=!1)},500,!0)}var widgetProps=PropertiesFactory.getPropertiesOf("wm.popover",["wm.base","wm.base.advancedformwidgets","wm.anchor"]),notifyFor={iconclass:!0,iconurl:!0,caption:!0,iconposition:!0,contentsource:!0,popoverplacement:CONSTANTS.isRunMode},interaction={click:{outsideClick:"outsideClick"},hover:{mouseenter:"none"},default:{mouseenter:"none",outsideClick:"outsideClick"}};return{restrict:"E",replace:!0,scope:{},template:function(tElement,tAttrs){var template=WM.element(WidgetUtilService.getPreparedTemplate("template/widget/anchor.html",tElement,tAttrs));return template.attr({"page-container":"page-container"}),CONSTANTS.isRunMode&&(template.attr({"popover-class":'{{"app-popover " + _popoverOptions.customclass}}',"popover-placement":"{{_popoverOptions.placement}}","popover-trigger":"_popoverOptions.trigger","popover-title":"{{title}}","popover-is-open":"_popoverOptions.isOpen","popover-append-to-body":"true"}),template.attr("uib-popover-template","_popoverOptions.contenturl"),_.includes(["default","hover"],tAttrs.interaction)&&template.attr("ng-mouseleave","_popoverOptions.setHideTrigger()")),template[0].outerHTML},compile:function(tElement){return{pre:function($is,$el,attrs){var trigger=attrs.interaction?interaction[attrs.interaction]:interaction.click;$is._popoverOptions={trigger:trigger,setHideTrigger:setHideTrigger.bind(void 0,$is)},$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,$is.$lazyLoad=WM.noop,$el.removeAttr("title")},post:function($is,$el,attrs){var popoverScope,$popoverEl,isInlineContent="inline"===attrs.contentsource,_scope=$el.scope();if($is.appLocale=_scope.appLocale,CONSTANTS.isRunMode){if($is._isFirstTime=!0,isInlineContent){Object.defineProperties($is,{Variables:{get:function(){return _scope.Variables}},Widgets:{get:function(){return _scope.Widgets}},item:{get:function(){return _scope.item}}}),$is._popoverOptions.customclass="popover_"+$is.$id+"_"+_.toLower($rs.activePageName),setStyleBlock($is);var popoverTemplate="template/popover/inline-content/"+$is.$id+"/content.html";$tc.put(popoverTemplate,"<div>"+tElement.context.innerHTML+"</div>"),$is._popoverOptions.contenturl=popoverTemplate}popoverScope=$is.$$childHead,popoverScope&&popoverScope.$watch("isOpen",function(nv){nv||$is._isFirstTime?($popoverEl=WM.element("."+$is._popoverOptions.customclass),$popoverEl.length&&_.includes(["default","hover"],$is.interaction)&&($popoverEl.on("mouseenter",function(){$is._popoverOptions.isPopoverActive=!0,$rs.$safeApply($is)}),$popoverEl.on("mouseleave",function(){$is._popoverOptions.isPopoverActive=!1,$is._popoverOptions.setHideTrigger(!0)})),$is._popoverOptions.customclass&&setStyleBlock($is),isInlineContent||Utils.triggerFn($is.$lazyLoad),$timeout(function(){if(nv){if(!isInlineContent){if($popoverEl.length){var partialScope,$parEl=$popoverEl.find("> .popover-inner > .popover-content > div > section.app-partial");$parEl.length&&(partialScope=$parEl.scope(),$is.Widgets=partialScope.Widgets,$is.Variables=partialScope.Variables)}Utils.triggerFn($is.onLoad,{$isolateScope:$is})}Utils.triggerFn($is.onShow,{$isolateScope:$is})}}),$is._isFirstTime=!1):Utils.triggerFn($is.onHide,{$isolateScope:$is})})}WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is,$el,tElement.context),$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs),$is.widgetid&&isInlineContent&&($is.inlinecontent=tElement.context.innerHTML)}}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/video.html",'<div init-widget class="app-video" alt="{{hint}}" title="{{hint}}" apply-styles><video preload="{{videopreload}}" ng-attr-poster="{{postersource}}" ng-src="{{mp4videoUrl}}"><source type="video/mp4" ng-src="{{mp4videoUrl}}" ng-if="mp4videoUrl"><source type="video/webm" ng-src="{{webmvideoUrl}}" ng-if="webmvideoUrl"><source type="video/ogg" ng-src="{{oggvideoUrl}}" ng-if="oggvideoUrl"><track kind="subtitles" label="{{subtitlelang}}" ng-if="tracksource" ng-src="{{tracksource}}" srclang="{{subtitlelang}}" default>{{videosupportmessage}}</video></div>')}]).directive("wmVideo",["PropertiesFactory","$templateCache","WidgetUtilService","Utils","$sce","CONSTANTS",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils,$sce,CONSTANTS){"use strict";function toggleProperties($el,property,val){val===!1||"false"===val?$el.children().first().removeAttr(property):$el.children().first().attr(property,val)}function propertyChangeHandler(scope,element,key,newVal){switch(key){case"videoposter":scope.postersource=Utils.getImageUrl(newVal);break;case"mp4format":WM.isString(newVal)&&newVal.indexOf("Variables")===-1&&(scope.mp4videoUrl=$sce.trustAsResourceUrl(newVal));break;case"oggformat":WM.isString(newVal)&&newVal.indexOf("Variables")===-1&&(scope.oggvideoUrl=$sce.trustAsResourceUrl(newVal));break;case"webmformat":WM.isString(newVal)&&newVal.indexOf("Variables")===-1&&(scope.webmvideoUrl=$sce.trustAsResourceUrl(newVal));break;case"subtitlesource":WM.isString(newVal)&&newVal.length&&newVal.indexOf("Variables")===-1&&(scope.tracksource=Utils.getResourceUrl(newVal));break;case"controls":case"autoplay":case"loop":case"muted":toggleProperties(element,key,newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.video",["wm.base"]),notifyFor={videoposter:!0,mp4format:!0,oggformat:!0,webmformat:!0,subtitlesource:!0,controls:!0,autoplay:CONSTANTS.isRunMode,muted:CONSTANTS.isRunMode,loop:CONSTANTS.isRunMode};return{restrict:"E",replace:!0,scope:{},template:$templateCache.get("template/widget/video.html"),compile:function(tElement){return CONSTANTS.isStudioMode&&tElement.removeAttr("autoplay"),{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){attrs.controls&&toggleProperties(element,"controls",attrs.controls),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/audio.html",'<div class="app-audio" init-widget alt="{{hint}}" title="{{hint}}" apply-styles><audio preload="{{audiopreload}}" ng-src="{{mp3audioUrl}}"><source type="audio/mp3" ng-src="{{mp3audioUrl}}">{{audiosupportmessage}}</audio></div>')}]).directive("wmAudio",["PropertiesFactory","$templateCache","WidgetUtilService","$sce","CONSTANTS","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,$sce,CONSTANTS,Utils){"use strict";function toggleProperties($el,property,val){val===!1||"false"===val?$el.children().first().removeAttr(property):$el.children().first().attr(property,val)}function propertyChangeHandler(scope,element,key,newVal){switch(key){case"mp3format":WM.isString(newVal)&&newVal.indexOf("Variables")===-1&&(scope.mp3audioUrl=$sce.trustAsResourceUrl(newVal));break;case"controls":case"autoplay":case"loop":case"muted":toggleProperties(element,key,newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.audio",["wm.base"]),notifyFor={mp3format:!0,controls:!0,autoplay:CONSTANTS.isRunMode,muted:CONSTANTS.isRunMode,loop:CONSTANTS.isRunMode};return{restrict:"E",replace:!0,scope:{},template:$templateCache.get("template/widget/audio.html"),compile:function(tElement){return CONSTANTS.isStudioMode&&tElement.removeAttr("autoplay"),{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){attrs.controls&&toggleProperties(element,"controls",attrs.controls),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/searchlist.html",'<a><img ng-src="{{match.model.wmImgSrc}}" ng-if="match.model.wmImgSrc" width="{{match.model.wmImgWidth}}"><span ng-bind-html="match.label | uibTypeaheadHighlight:query" title="{{match.label}}"></span></a>'),$templateCache.put("template/widget/form/search.html",'<div class="app-search input-group" role="input" init-widget has-model listen-property="dataset"><span class="wi wi-arrow-left form-control-feedback back-btn" ng-click="closeSearch()"></span><input title="{{hint || query}}" type="text" class="app-textbox form-control list-of-objs" placeholder="{{placeholder}}"  ng-model="queryModel" ng-change="updateModel(true); _onChange({$event: $event, $scope: this});" ng-model-options="{debounce: 100}" tabindex="{{tabindex}}" accesskey="{{::shortcutkey}}" ng-readonly="readonly"  ng-required="required"  ng-disabled="disabled"  autocomplete="off" typeahead-loading="_loadingItems"  uib-typeahead="_getDisplayLabel(item) for item in _getItems($viewValue) | limitTo:limit"  typeahead-on-select="onTypeAheadSelect($event, $item, $model, $label)" typeahead-template-url="template/widget/form/searchlist.html" typeahead-is-open="isOpen" typeahead-min-length="minLength" focus-target><span ng-show="_loadingItems" class="fa fa-circle-o-notch fa-spin form-control-feedback"></span><span class="wi wi-close form-control-feedback clear-btn" ng-click="clearSearch()"></span><span class="input-group-addon" ng-class="{\'disabled\': disabled}" ng-if="showSearchIcon" ><form><button title="Search" ng-disabled="disabled" class="app-search-button wi wi-search" type="submit" ng-click="onTypeAheadSelect($event, $item, $model, $label)"></button></form></span></div>'),$templateCache.put("template/widget/form/navsearch.html",'<div class="app-mobile-search" role="input" init-widget has-model><input title="{{hint || query}}" type="text" class="form-control list-of-objs" placeholder="{{placeholder}}"  ng-model="queryModel" ng-change="updateModel(true); _onChange({$event: $event, $scope: this});" ng-model-options="{debounce: 100}" accesskey="{{::shortcutkey}}" ng-readonly="readonly"  ng-required="required"  ng-disabled="disabled"  uib-typeahead="_getDisplayLabel(item) for item in _getItems($viewValue) | limitTo:limit"  typeahead-on-select="onTypeAheadSelect($event, $item, $model, $label)" typeahead-template-url="template/widget/form/searchlist.html" typeahead-is-open="isOpen" typeahead-min-length="minLength" ><i class="btn-close wi wi-cancel" ng-show="showClosebtn" ng-click="clearText();"></i></div>')}]).filter("_custom_search_filter",function(){"use strict";return function(entries,keys,val,casesensitive){var filteredEntries;return keys?(keys=_.split(keys,","),filteredEntries=_.filter(entries,function(entry){return keys.some(function(key){var a=_.get(entry,key),b=val;return casesensitive||(a=_.toLower(_.toString(a)),b=_.toLower(_.toString(b))),_.includes(a,b)})})):filteredEntries=WM.isArray(entries)&&WM.isObject(entries[0])?_.filter(entries,function(entry){return _.includes(_.toLower(_.values(entry).join(" ")),_.toLower(val))}):_.filter(entries,function(entry){return _.includes(entry,val)}),filteredEntries}}).directive("wmSearch",["PropertiesFactory","WidgetUtilService","CONSTANTS","Utils","FormWidgetUtils","$rootScope","$timeout","Variables","$filter","$q","$templateCache","$compile","LiveWidgetUtils",function(PropertiesFactory,WidgetUtilService,CONSTANTS,Utils,FormWidgetUtils,$rs,$timeout,Variables,$filter,$q,$templateCache,$compile,LiveWidgetUtils){"use strict";function updateModel($is,$el,immediate){immediate?($is.page=1,$is.query=$el.val()):$timeout(function(){$is.query=$el.val()},100)}function getVariable($is,$s){return _.get($s,["Variables",Utils.getVariableName($is,$s)])}function fetchDefaultModel($is,$s){var variable=getVariable($is,$s),deferred=$q.defer();return"All Fields"===$is.datafield&&deferred.resolve($is._proxyModel),variable&&"wm.LiveVariable"===variable.category&&defaultQuery&&$is.datavalue&&$is.retrieveDefaultQueryModel().then(function(response){deferred.resolve(response)}),deferred.promise}function updateQueryModel($is,$el){return WM.isArray($is.formattedDataSet)&&!WM.isObject($is.formattedDataSet[0])?($is.queryModel=$is._proxyModel,void $is.updateModel()):$is.displaylabel||$is.binddisplaylabel?(WM.isObject($is.datavalue)&&($is.datavalue.wmDisplayLabel=WidgetUtilService.getEvaluatedData($is,$is.datavalue,{expressionName:"displaylabel"}),$is.datavalue.wmImgSrc=WidgetUtilService.getEvaluatedData($is,$is.datavalue,{expressionName:"displayimagesrc"})),$is.queryModel=_.find($is.formattedDataSet,function(item){return"All Fields"===$is.datafield||""===$is.datafield?_.isEqual(item,$is._proxyModel):_.get(item,$is.datafield)==$is._proxyModel}),$is.queryModel||fetchDefaultModel($is,$el.scope()).then(function(_model_){$is.queryModel=_model_}),void $is.updateModel()):void $is.updateModel()}function isVariableUpdateRequired($is,scope,calledFromSetDataSet){var variable=getVariable($is,scope),updateRequiredFor=["wm.LiveVariable","wm.ServiceVariable"],queryParams=[];if(!calledFromSetDataSet&&variable&&"wm.ServiceVariable"===variable.category)if(queryParams=Variables.getMappedServiceQueryParams(_.get(variable,"_wmServiceOperationInfo.parameters")),queryParams.length)$is.isQueryWithoutParams=!1;else if($is.isQueryWithoutParams=!0,$is.isVariableDataAvailable||$is.itemList&&$is.itemList.length)return!1;return variable&&_.includes(updateRequiredFor,variable.category)}function setDataSet(data,$is,element){var dataSet,defaultLabel;if(!data)return $rs.$emit("set-markup-attr",$is.widgetid,{searchkey:""}),void($is.itemList||($is.itemList=[]));if(CONSTANTS.isStudioMode&&(FormWidgetUtils.updatePropertyOptionsWithParams($is),$is.displaylabel||$is.binddisplaylabel||(defaultLabel=_.get($is.widgetProps,["displaylabel","options",1]),$is.displaylabel=defaultLabel,$rs.$emit("set-markup-attr",$is.widgetid,{displaylabel:defaultLabel}))),CONSTANTS.isRunMode){if(data=data&&data.data||data,dataSet=Utils.getClonedObject(data),WM.isArray(dataSet))_.remove(dataSet,function(o){return WM.isUndefined(o)||_.isNull(o)}),dataSet=FormWidgetUtils.getOrderedDataSet(dataSet,$is.orderby),WM.isObject(dataSet[0])?_.forEach(dataSet,function(eachItem,index){var itemValue=dataSet[index];WM.isObject(itemValue)&&(itemValue.wmDisplayLabel=WidgetUtilService.getEvaluatedData($is,eachItem,{expressionName:"displaylabel"}),itemValue.wmImgSrc=WidgetUtilService.getEvaluatedData($is,eachItem,{expressionName:"displayimagesrc"}),itemValue.wmImgWidth=$is.imagewidth)}):_.forEach(dataSet,function(val,index){dataSet[index]=_.toString(val)}),$is.itemList=$is.page>1?$is.itemList.concat(dataSet):dataSet;else{if(WM.isString(dataSet)&&dataSet.trim())return void setDataSet(_.split(dataSet,","),$is,element);if(WM.isObject(dataSet))return void setDataSet(_.join(Object.keys(dataSet),","),$is,element)}$is.formattedDataSet=dataSet,(!isVariableUpdateRequired($is,element.scope(),!0)||$is.formattedDataSet.length&&!$is.isDefaultValueExist&&$is.datavalue)&&(updateQueryModel($is,element),$is.isDefaultValueExist=!0)}}function updatePropertyPanelOptions(dataset,$is){WM.isDefined(dataset)&&null!==dataset&&(WidgetUtilService.updatePropertyPanelOptions($is),FormWidgetUtils.updatePropertyOptionsWithParams($is))}function onsearchSubmit($is){$is.onSearch&&$is.onSearch({$scope:$is})}function onKeyUp($is,element,event){var $navbarElScope,_action=Utils.getActionFromKey(event),inputVal=element.find("input").val();defaultQuery=!1,element.hasClass("app-mobile-search")&&($navbarElScope=element.closest('[data-role="mobile-navbar"]').isolateScope(),$is.query=inputVal,"ENTER"===_action&&onsearchSubmit($navbarElScope,element)),""===inputVal&&$is.datavalue&&($is.datavalue="",$is.onSubmit({$event:event,$scope:$is})),$is.query=inputVal,$rs.$evalAsync(function(){$is.showClosebtn=""!==inputVal,"ENTER"===_action&&element.find("input[uib-typeahead]").blur()})}function isMobileAutoComplete(type){return"autocomplete"===type&&(Utils.isMobile()||$rs.isMobileApplicationType)}function toggleSearchIcon($is,type){"search"===type?($is.showSearchIcon=!0,$is.minLength=1):($is.showSearchIcon=!1,$is.minLength=0)}function setDropDownWidth($is,element){var typeAheadInput,typeAheadDropDown;$is.show&&$timeout(function(){typeAheadInput=element.find("input[uib-typeahead]"),"true"===typeAheadInput.attr("typeahead-append-to-body")&&(typeAheadDropDown=WM.element("body").find("> [uib-typeahead-popup]#"+typeAheadInput.attr("aria-owns")),typeAheadDropDown.width(typeAheadInput.outerWidth()))})}function propertyChangeHandler($is,element,key,newVal){switch(key){case"dataset":setDataSet(newVal,$is,element);break;case"active":$is.widgetid&&newVal&&updatePropertyPanelOptions($is.dataset,$is,element);break;case"type":toggleSearchIcon($is,newVal);break;case"width":case"height":element.css(key,newVal);break;case"show":setDropDownWidth($is,element)}}function getServiceQueryRequestParams($is,variable,searchValue){var wmServiceInfo=variable._wmServiceOperationInfo,queryParams=wmServiceInfo?wmServiceInfo.parameters:[],searchKey=_.split($is.searchkey,","),inputFields={};return queryParams=Variables.getMappedServiceQueryParams(queryParams),_.map(variable.dataBinding,function(value,key){inputFields[key]=value}),_.forEach(searchKey,function(value){_.includes(queryParams,value)&&(inputFields[value]=searchValue)}),inputFields}function getQueryRequestParams($is,variable,searchValue,defaultQuery){var requestParams={},searchInputs=defaultQuery?_.split($is.datafield,","):_.split($is.searchkey,","),inputFields={};switch(requestParams={pagesize:$is.limit||$is.pagesize,page:$is.page||1,skipDataSetUpdate:!0,skipToggleState:!0},variable.category){case"wm.LiveVariable":_.forEach(searchInputs,function(colName){inputFields[colName]={value:searchValue,logicalOp:"AND"}}),requestParams.filterFields=inputFields,requestParams.logicalOp="OR",requestParams.searchWithQuery=!0,requestParams.orderBy=$is.orderby?_.replace($is.orderby,/:/g," "):"";break;case"wm.ServiceVariable":inputFields=getServiceQueryRequestParams($is,variable,searchValue),requestParams.inputFields=inputFields}return requestParams}function getTransformedData(variable,data){var operationResult=variable.operation+"Result",tempResponse=data[operationResult],tempObj={};return tempResponse?(_.set(tempObj,operationResult,tempResponse),data=[tempObj]):data=[data],data}function isDropUpRequired(element){var dropDownContainer=element.get(0),dimensions=dropDownContainer.getBoundingClientRect(),position=dimensions.top,buttonHeight=dimensions.height,menuHeight=element.find(".dropdown-menu").outerHeight(),$win=WM.element(window);return position>menuHeight&&$win.height()-position<buttonHeight+menuHeight}function getUniqObjsByDataField(data,dataField,displayField,isLocalSearch){var uniqData,isAllFields="All Fields"===dataField;return uniqData=isAllFields?_.uniqWith(data,_.isEqual):_.uniqBy(data,dataField),!displayField&&isLocalSearch?uniqData:_.filter(uniqData,function(obj){return isAllFields?_.trim(obj.wmDisplayLabel):_.trim(_.get(obj,dataField))&&_.trim(obj.wmDisplayLabel)})}function setLoadingItemsFlag($is,flag){$rs.$safeApply($is,function(){$is._loadingItems=flag})}function isLastPage(page,dataSize,maxResults){var pageCount=dataSize>maxResults?Math.ceil(dataSize/maxResults):dataSize<0?0:1;return page===pageCount}function fetchVariableData($is,el,searchValue,$s,defaultQuery){function handleQuerySuccess(response,props,pageOptions){var index,restExpr,formattedData,data=Utils.isPageable(response)?response.content:response,expressionArray=_.split($is.binddataset,"."),dataExpression=_.slice(expressionArray,_.indexOf(expressionArray,"dataSet")+1).join("."),$I="[$i]";pageOptions?($is.page=pageOptions.currentPage,$is.isLastPage=isLastPage($is.page,pageOptions.dataSize,pageOptions.maxResults),$is.isPaginatedData=!0):WM.isObject(response)&&Utils.isPageable(response)&&($is.page=response.number+1,$is.isLastPage=isLastPage($is.page,response.totalElements,response.size),$is.isPaginatedData=!0),dataExpression&&(index=dataExpression.lastIndexOf($I),restExpr=dataExpression.substr(index+5),WM.isArray(data)?formattedData=data.map(function(datum){return Utils.findValueOf(datum,restExpr)}):WM.isObject(data)&&(formattedData=_.get(data,dataExpression)),data=formattedData||data),_.isArray(data)||(data=getTransformedData(variable,data)),data.length?($is.datavalue&&($is.isDefaultValueExist=!0),setDataSet(data,$is,el,$s),$is.isQueryWithoutParams&&!$is.isVariableDataAvailable?(deferred.resolve(customFilter($is.itemList,$is.searchkey,searchValue,$is.casesensitive)),$is.isVariableDataAvailable=!0):deferred.resolve($is.itemList),$timeout(function(){isDropUpRequired(el)?el.addClass("dropup").find("ul").css("top","auto"):el.removeClass("dropup").find("ul").css("top","100%")})):deferred.resolve([])}function handleQueryError(){setLoadingItemsFlag($is,!1)}var variable=getVariable($is,$s),requestParams=getQueryRequestParams($is,variable,searchValue,defaultQuery),deferred=$q.defer(),customFilter=$filter("_custom_search_filter");return variable&&($is.searchkey?$is.relatedfield?variable.getRelatedTableData($is.relatedfield,requestParams,handleQuerySuccess,handleQueryError):variable.update(requestParams,handleQuerySuccess,handleQueryError):deferred.resolve(customFilter($is.itemList,$is.searchkey,searchValue,$is.casesensitive))),
deferred.promise}function retrieveDefaultQueryModel($is,$el){return fetchVariableData($is,$el,$is.datavalue,$el.scope(),!0).then(function(data){return data&&data[0]})}function setQuerySearchAttributes(template,tAttrs){var inputTpl=WM.element(template).find("input"),isBoundToVariable=Utils.stringStartsWith(tAttrs.dataset,"bind:Variables.");(isBoundToVariable&&inputTpl||"autocomplete"===tAttrs.type)&&inputTpl.attr("typeahead-wait-ms",CONSTANTS.DELAY.SEARCH_WAIT),isMobileAutoComplete(tAttrs.type)?(inputTpl.attr("typeahead-append-to-body",!1),inputTpl.attr("typeahead-focus-on-select",!1)):inputTpl.attr("typeahead-append-to-body",!0)}function triggerSearch($is,typeAheadInput,incrementPage){$is.page=incrementPage?$is.page+1:$is.page,typeAheadInput.controller("ngModel").$parsers[0]($is.query)}function _getDisplayLabel(item){return _.has(item,"wmDisplayLabel")?item.wmDisplayLabel:item}function _getItems($is,element,searchValue){var localSearchedData,typeAheadInput,typeAheadDropDown,$lastItem,customFilter=$filter("_custom_search_filter"),boundDataSet=$is.binddataset,$s=element.scope(),isBoundToVariable=boundDataSet&&Utils.stringStartsWith(boundDataSet,"bind:Variables.");return setLoadingItemsFlag($is,!0),isBoundToVariable&&isVariableUpdateRequired($is,$s)?fetchVariableData($is,element,searchValue,$s).then(function(data){return setLoadingItemsFlag($is,!1),$timeout(function(){isMobileAutoComplete($is.type)&&!$is._loadingItems&&!$is.isLastPage&&element.hasClass("full-screen")&&(typeAheadInput=element.find("input[uib-typeahead]"),typeAheadDropDown=element.find("> [uib-typeahead-popup]"),$lastItem=typeAheadDropDown.find("li").last(),$lastItem.length&&typeAheadDropDown.length&&typeAheadDropDown.height()+typeAheadDropDown.position().top>$lastItem.height()+$lastItem.position().top&&triggerSearch($is,typeAheadInput,!0))}),getUniqObjsByDataField(data,$is.datafield)}):(localSearchedData=customFilter($is.itemList,$is.searchkey,searchValue,$is.casesensitive),setLoadingItemsFlag($is,!1),getUniqObjsByDataField(localSearchedData,$is.datafield,$is.displaylabel,!0))}var defaultQuery,widgetProps=PropertiesFactory.getPropertiesOf("wm.search",["wm.base","wm.base.editors.abstracteditors"]),notifyFor={searchkey:!0,displaylabel:!0,dataset:!0,displayimagesrc:!0,active:!0,type:!0,width:!0,height:!0,show:!0};return{restrict:"E",replace:!0,scope:{scopedataset:"=?",onSubmit:"&",onSelect:"&",query:"=?"},template:function(tElement,tAttrs){var template,target,isWidgetInsideCanvas,url="";return url=tAttrs.navsearchbar?"template/widget/form/navsearch.html":"template/widget/form/search.html",template=WM.element($templateCache.get(url)),isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),setQuerySearchAttributes(template,tAttrs),target=template.find("input.form-control"),target.attr("name",tAttrs.name),isWidgetInsideCanvas||(tAttrs.hasOwnProperty("onFocus")&&target.attr("ng-focus","onFocus({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onBlur")&&target.attr("ng-blur","onBlur({$event: $event, $scope: this})")),template[0].outerHTML},link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,$is.widgetDataset={},$is.updateModel=updateModel.bind(void 0,$is,$el.find("input")),Object.defineProperty($is,"_model_",{get:function(){return $is._proxyModel?$is._proxyModel:""},set:function(newVal){return $is._proxyModel=newVal,WM.isDefined(newVal)?($is.queryModel=newVal,void updateQueryModel($is,$el)):($is.queryModel="",void $rs.$evalAsync($is.updateModel))}}),defaultQuery=$el.attr("datavalue")||$el.attr("scopedatavalue"),$is.retrieveDefaultQueryModel=retrieveDefaultQueryModel.bind(void 0,$is,$el)},post:function($is,element,attrs){var searchItem,typeAheadInput,typeAheadDropDown;$is.minLength=1,$is.page=1,$is.isLastPage=!0,WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is,element),$is,notifyFor),$is.onTypeAheadSelect=function($event,$item,$model,$label){$event=$event||{},$item&&$item.wmImgSrc&&($item=Utils.getClonedObject($item),delete $item.wmImgSrc),$item=searchItem=$item||($is.datavalue===_.get(searchItem,$is.datafield)?searchItem:void 0),$event.data={item:$item,model:$model,label:$label,query:$label},$is.datavalue=$is.datafield&&"All Fields"!==$is.datafield?$item&&_.get($item,$is.datafield):$item,$is.queryModel=$item,$is.query=$label,$is.closeSearch(),$is.onSelect({$event:$event,$scope:$is,selectedValue:$is.datavalue}),$is.onSubmit({$event:$event,$scope:$is})},$is.clearText=function(){element.find("input").val(""),$is.showClosebtn=!1},WidgetUtilService.postWidgetCreate($is,element,attrs),element.removeAttr("tabindex"),!attrs.widgetid&&attrs.scopedataset&&$is.$watch("scopedataset",function(newVal){setDataSet(newVal,$is,element)}),!attrs.widgetid&&_.includes($is.binddataset,"selecteditem.")&&LiveWidgetUtils.fetchDynamicData($is,element.scope(),function(data){setDataSet(data,$is,element)}),$is._getItems=_getItems.bind(void 0,$is,element),$is._getDisplayLabel=_getDisplayLabel.bind(void 0),CONSTANTS.isRunMode&&(element.bind("keyup",onKeyUp.bind(void 0,$is,element)),element.hasClass("app-mobile-search")&&element.find("input").focus(),$timeout(function(){typeAheadInput=element.find("input[uib-typeahead]"),"true"===typeAheadInput.attr("typeahead-append-to-body")?(typeAheadDropDown=WM.element("body").find("> [uib-typeahead-popup]#"+typeAheadInput.attr("aria-owns")),typeAheadDropDown.addClass("app-search")):(typeAheadDropDown=element.find("> [uib-typeahead-popup]"),typeAheadInput.bind("focus",function(){element.addClass("full-screen"),$is.query&&triggerSearch($is,typeAheadInput)})),typeAheadDropDown.append($compile('<div class="status" ng-show="isOpen && _loadingItems"><i class="fa fa-circle-o-notch fa-spin"></i><span>{{loadingdatamsg}}</span></div><div class="status" ng-show="isOpen && !_loadingItems && isPaginatedData && isLastPage"><span>{{datacompletemsg}}</span></div>')($is)),typeAheadDropDown.bind("scroll",function(){var $item=WM.element(this);!$is._loadingItems&&!$is.isLastPage&&$item.scrollTop()+$item.innerHeight()>=$item[0].scrollHeight&&triggerSearch($is,typeAheadInput,!0)})})),$is.closeSearch=function(){$is.page=1,$is.datavalue||($is.queryModel=""),element.removeClass("full-screen")},$is.clearSearch=function(){$is.page=1,$is.query&&($is.queryModel=$is.query="",triggerSearch($is,element.find("input[uib-typeahead]")))},$is.reset=function(){$is._model_=void 0,$is.queryModel=$is.query=""},$is.redraw=function(){setDropDownWidth($is,element)}}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/spinner.html",'<div ng-class="[size, spinnerclass]" init-widget title="{{hint}}" apply-styles no-animate class="app-spinner"><div class="spinner-message"><span class="spinner-image animated infinite {{animation}}" ng-class="{\'fa-spin\' : animation === \'spin\'}" ng-style="{backgroundImage:picture, width: imagewidth, height: imageheight}" ng-if="type === \'image\'"></span><i class="spinner-image animated infinite {{animation}}" ng-class="iconclass" ng-style="{\'font-size\' : iconsize}" ng-if="type === \'icon\'"></i><span class="spinner-text" ng-bind-html="messageContent" ng-if="messageContent && !spinnerMessages"></span><div class="spinner-messages" ng-if="spinnerMessages"><p ng-repeat="(key, value) in spinnerMessages">{{value}}</p></div></div></div>')}]).directive("wmSpinner",["PropertiesFactory","$rootScope","$templateCache","WidgetUtilService","Utils","$sce",function(PropertiesFactory,$rootScope,$templateCache,WidgetUtilService,Utils,$sce){"use strict";function propertyChangeHandler(scope,key,newVal){switch(key){case"image":scope.picture=Utils.getBackGroundImageUrl(newVal);break;case"backgroundimage":scope.backgroundimgsource=Utils.getBackGroundImageUrl(newVal);break;case"caption":scope.messageContent=$sce.trustAsHtml(newVal);break;case"iconclass":scope.iconclass=scope.iconclass||"fa fa-spinner fa-spin";break;case"type":if(scope.widgetid){var isImage="image"===newVal,widgetProperties=scope.widgetProps;widgetProperties.image.show=widgetProperties.imagewidth.show=widgetProperties.imageheight.show=isImage,widgetProperties.iconclass.show=widgetProperties.iconsize.show=!isImage}break;case"animation":"spin"===newVal?scope.iconclass=scope.iconclass+" fa-spin":_.includes(scope.iconclass,"fa-spinner")||(scope.iconclass=_.replace(scope.iconclass,"fa-spin",""))}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.spinner",["wm.base"]),notifyFor={image:!0,backgroundimage:!0,caption:!0,iconclass:!0,animation:!0,type:!0};return{restrict:"E",scope:{},replace:!0,template:$templateCache.get("template/widget/spinner.html"),link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs),attrs.servicevariabletotrack&&!scope.widgetid&&(scope.show=!1),scope.iconclass=scope.iconclass||"fa fa-spinner",element.removeClass("animated "+scope.animation),scope.widgetid||scope.$on("$destroy",$rootScope.$on("toggle-variable-state",function(event,variableName,show){variableName===scope.servicevariabletotrack&&(scope.show=show)}))}}}}]),WM.module("wm.widgets.basic").factory("wmSpinner",function($compile,$rootScope){"use strict";function getAppSpinnerScope(){return appSpinner||(appSpinner=WM.element("[name=globalspinner], [name=global-spinner]").eq(0).isolateScope()),appSpinner}function showContextSpinner(spinnerContext,message,id){var compiledEl,$element=WM.element('[name="'+spinnerContext+'"]'),spinnerTemplate='<wm-spinner name="'+spinnerContext+'-spinner" show="true"></wm-spinner>',$spinnerEl=WM.element('[name="'+spinnerContext+'-spinner"]');if($element.length)return spinnerContextMap[spinnerContext]&&$spinnerEl.length?(spinnerContextMap[spinnerContext][id]=_.trim(message),$spinnerEl.isolateScope().spinnerMessages=spinnerContextMap[spinnerContext],id):(spinnerContextMap[spinnerContext]={},spinnerContextMap[spinnerContext][id]=_.trim(message),compiledEl=$compile(spinnerTemplate)($rootScope.$new()),compiledEl.isolateScope().spinnerMessages=spinnerContextMap[spinnerContext],compiledEl.appendTo($element),id)}function hideContextSpinner(spinnerContext,id){var spinnerEle=WM.element('[name="'+spinnerContext+'-spinner"]'),spinnerScope=spinnerEle.isolateScope();if(spinnerEle.length){if(delete spinnerContextMap[spinnerContext][id],!_.isEmpty(spinnerContextMap[spinnerContext]))return void(spinnerScope.spinnerMessages=spinnerContextMap[spinnerContext]);delete spinnerContextMap[spinnerContext],spinnerScope.show=!1,spinnerScope.$destroy(),spinnerEle.remove()}}var appSpinner,spinnerContextMap={page:{}},spinnerId=0;return{show:function(message,id,spinnerClass,spinnerContext){var spinnerScope;return id=id||++spinnerId,spinnerContext&&"page"!==spinnerContext?showContextSpinner(spinnerContext,message,id):(spinnerScope=getAppSpinnerScope(),spinnerContextMap.page[id]=_.trim(message),spinnerScope.spinnerMessages=spinnerContextMap.page,spinnerScope.show=!0,spinnerScope.spinnerclass=spinnerClass,id)},hide:function(id){var spinnerScope,spinnerCount,spinnerContext;return spinnerContext=_.findKey(spinnerContextMap,function(obj){return _.includes(_.keys(obj),id)}),spinnerContext&&"page"!==spinnerContext?void hideContextSpinner(spinnerContext,id):(spinnerScope=getAppSpinnerScope(),void(id?(delete spinnerContextMap.page[id],spinnerScope.spinnerMessages=spinnerContextMap.page,spinnerCount=Object.keys(spinnerContextMap.page).length,0===spinnerCount&&(spinnerScope.show=!1)):spinnerContextMap.page={}))}}}),WM.module("wm.widgets.basic").directive("wmTree",["PropertiesFactory","$rootScope","WidgetUtilService","Utils","CONSTANTS","FormWidgetUtils",function(PropertiesFactory,$rs,WidgetUtilService,Utils,CONSTANTS,FormWidgetUtils){"use strict";function constructNodes($is,nodes,parent,levels,deep,_evalDataValue){var _iconCls,_cls,$ul=WM.element("<ul></ul>"),_iconClses=ICON_CLASSES[$is.treeicons||defaultTreeIconClass],_expr=CONSTANTS.isRunMode?$is.binddatavalue?$is.binddatavalue.replace("bind:",""):$is.datavalue:void 0;_cls=levels>0?" expanded ":" collapsed ",_iconCls=_cls+(levels>0?_iconClses.expanded:_iconClses.collapsed),deep=deep||0,parent.append($ul),nodes.forEach(function(node,idx){var expandCollapseIcon,$li=WM.element("<li></li>"),$iconNode=WM.element("<i></i>"),nodeLabel=WidgetUtilService.getEvaluatedData($is,node,{expressionName:"nodelabel"})||node.label,nodeIcon=WidgetUtilService.getEvaluatedData($is,node,{expressionName:"nodeicon"})||node.icon,nodeChildren=WidgetUtilService.getEvaluatedData($is,node,{expressionName:"nodechildren"})||node.children,nodeIdValue=WidgetUtilService.getEvaluatedData($is,node,{expressionName:"nodeid"}),isNodeMatched=!1;$li.data("nodedata",node).append($iconNode).append('<span class="title">'+nodeLabel+"</span>").appendTo($ul),$is.bindnodeid||$is.nodeid?(isNodeMatched=$is.binddatavalue?nodeIdValue==_evalDataValue:nodeIdValue==_expr,nodeIdValue&&$li.attr("id",nodeIdValue)):$is.binddatavalue&&(isNodeMatched=!!$is.$eval(_expr,node)),!$is._selectNode&&_expr&&("FirstNode"===_expr&&0===idx||!deep&&"LastNode"===_expr&&idx===nodes.length-1||isNodeMatched)&&($is._selectNode=$li,$is.datavalue=nodeIdValue),nodeIcon&&$iconNode.addClass(nodeIcon),nodeChildren&&nodeChildren.length?($li.addClass("parent-node "+_cls),expandCollapseIcon=WM.element('<i class="wi '+_iconCls+' "></i>'),nodeIcon&&$iconNode.addClass(nodeIcon),$li.prepend(expandCollapseIcon),$is.widgetid||constructNodes($is,nodeChildren,$li,levels-1,deep+1,_evalDataValue)):(nodeIcon||$iconNode.addClass("leaf-node"),$li.addClass("leaf-node"))})}function getNodes($is,newVal){var nodes=[];return WM.isString(newVal)?(newVal=newVal.trim(),newVal&&(nodes=newVal.split(",").map(function(item){return{label:item&&item.trim()}}))):WM.isArray(newVal)?(newVal=FormWidgetUtils.getOrderedDataSet(newVal,$is.orderby),nodes=newVal):WM.isObject(newVal)&&(nodes=[newVal]),nodes}function changeTreeIcons($el,nv,ov){nv=nv||defaultTreeIconClass,ov=ov||defaultTreeIconClass,$el.find("i.expanded").removeClass(ICON_CLASSES[ov].expanded).addClass(ICON_CLASSES[nv].expanded),$el.find("i.collapsed").removeClass(ICON_CLASSES[ov].collapsed).addClass(ICON_CLASSES[nv].collapsed)}function toggleExpandCollapseNode($is,$i,$li){var treeIcons=ICON_CLASSES[$is.treeicons||defaultTreeIconClass];$i.hasClass("collapsed")?($i.removeClass("collapsed "+treeIcons.collapsed).addClass("expanded "+treeIcons.expanded),$li.removeClass("collapsed").addClass("expanded")):$i.hasClass("expanded")&&($i.removeClass("expanded "+treeIcons.expanded).addClass("collapsed "+treeIcons.collapsed),$li.removeClass("expanded").addClass("collapsed"))}function getDataValueType($is){return TypeUtils.getTypeForExpression($is.binddataset,$is,"nodeid")}function renderTree($el,$is,attrs){var docFrag,$li,data,fn,levels=+attrs.levels||0,path="";$el.empty(),attrs.widgetid&&(levels=0),$is.nodes&&$is.nodes.length&&(docFrag=document.createDocumentFragment(),constructNodes($is,$is.nodes,WM.element(docFrag),levels,0,$is.datavalue),$el.append(docFrag)),$is._selectNode&&($li=$is._selectNode,$li.addClass("selected"),data=$li.data("nodedata"),$li.parentsUntil($el,"li.parent-node.collapsed").each(function(){var $current=WM.element(this),$i=$current.children("i.collapsed"),$title=$current.children(".title");toggleExpandCollapseNode($is,$i,$current),path="/"+$title.text()+path}),$is.selecteditem=Utils.getClonedObject(data),$is.selecteditem.path=path,fn=$is.onSelect({$event:void 0,$scope:$is,$item:data,$path:path}),Utils.triggerFn(fn),$rs.$safeApply($is))}function propertyChangeHandler($is,$el,attrs,key,newVal,oldVal){switch(key){case"scopedataset":case"dataset":$is.nodes=getNodes($is,newVal.data||newVal),$is._selectNode=void 0,$is.renderTree($el,$is,attrs);break;case"nodeicon":case"nodelabel":case"nodechildren":case"orderby":$is.renderTree($el,$is,attrs);break;case"treeicons":changeTreeIcons($el,newVal,oldVal);break;case"datavalue":$is.selectNodeById(newVal)}}function selectNode($is,$el,evt,value){var data,$liPath,fn,target=evt&&WM.element(evt.target),$li=WM.isObject(value)?value:$el.find('li[id="'+value+'"]:first'),path="";$el.find(".selected").removeClass("selected"),$li.length&&($li.addClass("selected"),data=$li.data("nodedata"),$liPath=target?target.parents(".app-tree li"):$li.find("span.title").parents(".app-tree li"),$liPath.each(function(){var current=WM.element(this).children(".title").text();path="/"+current+path}),$li.parentsUntil($el,"li.parent-node.collapsed").each(function(){var $current=WM.element(this),$i=$current.children("i.collapsed");toggleExpandCollapseNode($is,$i,$current)}),$is.selecteditem=Utils.getClonedObject(data)||{},$is.selecteditem.path=path,target&&($is.nodeid?$is.datavalue=$is.$eval($is.nodeid,data):$is.bindnodeid?$is.datavalue=WidgetUtilService.getEvaluatedData($is,data,{expressionName:"nodeid"}):$is.datavalue=Utils.getClonedObject(data)||{},$is.$watch("datavalue",function(newVal){propertyChangeHandler($is,void 0,void 0,"datavalue",newVal)},!0)),fn=$is.onSelect({$event:evt,$scope:$is,$item:data,$path:path}),Utils.triggerFn(fn),$rs.$safeApply($is))}function bindEvents($is,element){element.on("click",function(evt){var target=WM.element(evt.target),li=target.closest("li");$is.selecteditem={},evt.stopPropagation(),target.is("i")?toggleExpandCollapseNode($is,target,li):target.is("span.title")&&selectNode($is,element,evt,li)})}var TypeUtils,widgetProps=PropertiesFactory.getPropertiesOf("wm.tree",["wm.base","wm.containers","wm.containers.borderstyle"]),notifyFor={scopedataset:!0,dataset:!0,treeicons:!0,nodelabel:!0,nodeicon:!0,nodechildren:!0,orderby:!0},defaultTreeIconClass="plus-minus",ICON_CLASSES={folder:{expanded:"wi-folder-open",collapsed:"wi-folder"},"circle-plus-minus":{expanded:"wi-remove-circle-outline",collapsed:"wi-add-circle-outline"},chevron:{expanded:"wi-keyboard-arrow-down",collapsed:"wi-keyboard-arrow-right"},menu:{expanded:"wi-arrow-down",collapsed:"wi-arrow-right"},triangle:{expanded:"wi-arrow-drop-down-circle",collapsed:"wi-play-circle-filled"},"expand-collapse":{expanded:"wi-expand-less",collapsed:"wi-expand-more"},"plus-minus":{expanded:"wi-minus",collapsed:"wi-plus"}};return{restrict:"E",scope:{scopedataset:"=?",onSelect:"&"},template:'<div class="app-tree" init-widget apply-styles="container" has-model listen-property="dataset"></div>',replace:!0,link:{pre:function($is,$el,attrs){attrs.widgetid?$is.widgetProps=Utils.getClonedObject(widgetProps):$is.widgetProps=widgetProps},post:function($is,$el,attrs){$is.widgetid?(TypeUtils=Utils.getService("TypeUtils"),$is.getDataValueType=getDataValueType.bind(void 0,$is)):bindEvents($is,$el),$is.renderTree=_.debounce(renderTree,20),$is.selectNodeById=selectNode.bind(void 0,$is,$el,WM.noop()),$is.deselectNode=function(){$is.selecteddata={},$is.selectNodeById()};var onPropertyChange=propertyChangeHandler.bind(void 0,$is,$el,attrs);WidgetUtilService.registerPropertyChangeListener(onPropertyChange,$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs),!attrs.widgetid&&attrs.scopedataset&&$is.$watch("scopedataset",function(newVal){onPropertyChange("scopedataset",newVal)},!0),!attrs.widgetid&&attrs.datavalue&&$is.$watch("datavalue",function(newVal){newVal&&onPropertyChange("datavalue",newVal)},!0)}}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/chart.html",'<div init-widget class="app-chart" ng-class="{\'panel\': title}" title="{{hint}}" apply-styles><div class="panel-heading" ng-if="title"><h3 class="panel-title"><div class="pull-left"><i class="app-icon panel-icon {{iconclass}}" ng-show="iconclass"></i></div><div class="heading">{{title}}</div><div class="description">{{subheading}}</div></h3></div><div class="app-chart-inner" ng-class="{\'loading\':isLoadInProgress,\'panel-body\': title}"><svg></svg><div class="wm-content-info readonly-wrapper {{class}}" ng-if="showContentLoadError && showNoDataMsg"><p class="wm-message" title="{{hintMsg}}" ng-class="{\'error\': invalidConfig}">{{errMsg}}</p></div><wm-spinner show="{{isLoadInProgress}}" caption="{{loadingdatamsg}}"></wm-spinner></div></div>')}]).directive("wmChart",function(PropertiesFactory,$templateCache,$rootScope,WidgetUtilService,CONSTANTS,QueryBuilder,Utils,ChartService){"use strict";function togglePropertiesByChartType(scope){ChartService.hideOrShowProperties(allOptions,scope,!1),ChartService.hideOrShowProperties(chartTypes.indexOf(scope.type)===-1?options.Column:options[scope.type],scope,!0)}function setYAxisDataKey(scope,options){ChartService.isPieType(scope.type)?(scope.widgetProps.yaxisdatakey.widget="list",scope.widgetProps.yaxisdatakey.options=options):scope.widgetDataset.yaxisdatakey=options||[]}function isGroupByEnabled(groupby){return!(!groupby||groupby===NONE)}function modifyAxesOptions(scope){var xAxisOptions=[],yAxisOptions=[],isAggregationApplied=isGroupByEnabled(scope.groupby)&&scope.aggregation&&"none"!==scope.aggregation;scope.binddataset&&WM.isObject(scope.dataset)?isAggregationApplied&&(scope.groupby&&(xAxisOptions=scope.groupby.split(","),scope.xaxisdatakey=xAxisOptions[0]),isAggregationApplied&&scope.aggregationcolumn&&(yAxisOptions.push(scope.aggregationcolumn),scope.yaxisdatakey=yAxisOptions[0]),scope.widgetProps.xaxisdatakey.options=xAxisOptions,setYAxisDataKey(scope,yAxisOptions)):scope.binddataset||(scope.xaxisdatakey=scope.yaxisdatakey="",scope.xaxislabel=scope.yaxislabel="",scope.xunits=scope.yunits="",scope.bubblesize="",scope.widgetProps.aggregationcolumn.disabled=!0,scope.widgetProps.aggregation.disabled=!0,scope.widgetid&&scope.active&&($rootScope.$emit("update-widget-property","aggregation",""),$rootScope.$emit("update-widget-property","aggregationcolumn",""),$rootScope.$emit("update-widget-property","groupby",""),$rootScope.$emit("update-widget-property","orderby",""))),scope.$root.$emit("set-markup-attr",scope.widgetid,{xaxisdatakey:scope.xaxisdatakey,yaxisdatakey:scope.yaxisdatakey})}function isValidAxis(scope){return!scope.binddataset||scope.xaxisdatakey&&scope.yaxisdatakey}function isAggregationEnabled(scope){return!(!isGroupByEnabled(scope.groupby)||scope.aggregation===NONE||!scope.aggregationcolumn)}function isDataFilteringEnabled(scope){return isAggregationEnabled(scope)||isGroupByEnabled(scope.groupby)&&scope.isVisuallyGrouped||scope.orderby}function getxAxisVal(scope,dataObj,xKey,index){var value=_.get(dataObj,xKey);return ChartService.isLineTypeChart(scope.type)&&!Utils.isNumberType(scope.xAxisDataType)?(scope.xDataKeyArr.push(value),index):value}function getXMinMaxValues(datum){if(datum){var xValues={};return xValues.min=_.minBy(datum.values,function(dataObject){return dataObject.x||dataObject[0]}),xValues.max=_.maxBy(datum.values,function(dataObject){return dataObject.x||dataObject[0]}),xValues}}function getYMinMaxValues(datum){var yValues={},minValues=[],maxValues=[];if(datum)return _.forEach(datum,function(data){minValues.push(_.minBy(data.values,function(dataObject){return dataObject.y||dataObject[1]})),maxValues.push(_.maxBy(data.values,function(dataObject){return dataObject.y||dataObject[1]}))}),yValues.min=_.minBy(minValues,function(dataObject){return dataObject.y||dataObject[1]}),yValues.max=_.maxBy(maxValues,function(dataObject){return dataObject.y||dataObject[1]}),yValues}function valueFinder(scope,dataObj,xKey,yKey,index,shape){var xVal=getxAxisVal(scope,dataObj,xKey,index),value=_.get(dataObj,yKey),yVal=parseFloat(value)||value,dataPoint={},size=parseFloat(dataObj[scope.bubblesize])||2;return ChartService.isChartDataJSON(scope.type)?(dataPoint.x=xVal,dataPoint.y=yVal,ChartService.isBubbleChart(scope.type)&&(dataPoint.size=size,dataPoint.shape=shape||"circle")):ChartService.isChartDataArray(scope.type)&&(dataPoint=[xVal,yVal]),dataPoint._dataObj=dataObj,dataPoint}function setErrMsg(scope,message){scope.showNoDataMsg&&(scope.showContentLoadError=!0,scope.invalidConfig=!0,$rootScope.$safeApply(scope,function(){scope.errMsg=$rootScope.locale[message]}))}function getChartData(scope){if(scope.sampleData=ChartService.getSampleData(scope),scope.xDataKeyArr=[],!scope.binddataset)return scope.xDataKeyArr=ChartService.getDateList(),CONSTANTS.isStudioMode&&(scope.showContentLoadError=!0,scope.errMsg=$rootScope.locale.MESSAGE_INFO_SAMPLE_DATA),scope.sampleData;if(CONSTANTS.isStudioMode){if(scope.binddataset&&!scope.chartData)return[];if(scope.isServiceVariable)return scope.showContentLoadError=!0,scope.errMsg=$rootScope.locale.MESSAGE_INFO_SAMPLE_DATA,scope.hintMsg=$rootScope.locale.MESSAGE_ERROR_DATA_DISPLAY+scope.name,scope.sampleData;if(!scope.chartData)return scope.sampleData}else{if(!isValidAxis(scope)&&isDataFilteringEnabled(scope))return scope.sampleData;if(!scope.chartData||!scope.chartData.length)return[]}var yAxisKey,datum=[],xAxisKey=scope.xaxisdatakey,yAxisKeys=scope.yaxisdatakey?scope.yaxisdatakey.split(","):[],dataSet=scope.chartData,shapes=[];return WM.isArray(dataSet)&&(ChartService.isPieType(scope.type)?(yAxisKey=yAxisKeys[0],datum=_.map(dataSet,function(dataObj,index){return valueFinder(scope,dataSet[index],xAxisKey,yAxisKey)})):(ChartService.isBubbleChart(scope.type)&&(shapes="random"===scope.shape?allShapes:scope.shape),yAxisKeys.forEach(function(yAxisKey,series){datum.push({values:_.map(dataSet,function(dataObj,index){return valueFinder(scope,dataSet[index],xAxisKey,yAxisKey,index,WM.isArray(shapes)&&shapes[series]||scope.shape)}),key:yAxisKey})}))),datum}function getGroupedData(scope,queryResponse,groupingColumn){var groupKey,i,chartData=[],groupData={},groupValues=[],index=0;for(scope.xDataKeyArr=[];0!==queryResponse.length;){for(groupKey=queryResponse[queryResponse.length-1][groupingColumn],groupValues.push(valueFinder(scope,queryResponse[queryResponse.length-1],scope.xaxisdatakey,scope.yaxisdatakey,0)),queryResponse.splice(queryResponse.length-1,1),i=queryResponse.length-1;i>=0;i-=1)groupKey===queryResponse[i][groupingColumn]&&(index+=1,groupValues.push(valueFinder(scope,queryResponse[i],scope.xaxisdatakey,scope.yaxisdatakey,index)),queryResponse.splice(i,1));groupData={key:groupKey,values:groupValues},chartData.push(groupData),groupValues=[],index=0}return chartData}function getOrderbyExpression(orderby){var orderbyCols=(orderby?orderby.replace(/:/g," "):"").split(","),trimmedCols="";return orderbyCols=orderbyCols.map(function(col){return col.trim()}),trimmedCols=orderbyCols.join()}function getValidAliasName(aliasName){return aliasName?aliasName.replace(/\./g,"_"):null}function getQueryColumns(scope){var expr,columns=[],groupbyColumns=scope.groupby&&scope.groupby!==NONE?scope.groupby.split(","):[],yAxisKeys=scope.yaxisdatakey?scope.yaxisdatakey.split(","):[],xAxisKey=scope.xaxisdatakey,aggColumn=scope.aggregationcolumn||[],requiredColumns=[];return requiredColumns=_.compact(_.uniq(_.concat(xAxisKey,yAxisKeys,groupbyColumns,aggColumn))),isAggregationEnabled(scope)&&columns.push(aggregationFnMap[scope.aggregation]+"("+aggColumn+") AS "+getValidAliasName(aggColumn)),requiredColumns=_.without(requiredColumns,aggColumn),_.forEach(requiredColumns,function(column){expr=column+" AS "+getValidAliasName(column),columns.push(expr)}),columns}function getGroupingDetails(scope){if(isGroupByEnabled(scope.groupby)){var visualGroupingColumn,groupingExpression,groupingColumnIndex,isVisuallyGrouped=!1,groupbyColumns=scope.groupby&&scope.groupby!==NONE?scope.groupby.split(","):[],yAxisKeys=scope.yaxisdatakey?scope.yaxisdatakey.split(","):[],columns=[];return groupbyColumns.length>1&&(groupbyColumns.every(function(column,index){return scope.xaxisdatakey===column||WM.element.inArray(column,yAxisKeys)!==-1||(isVisuallyGrouped=!0,visualGroupingColumn=column,groupingColumnIndex=index,groupbyColumns.splice(groupingColumnIndex,1),!1)}),visualGroupingColumn&&columns.push(visualGroupingColumn),groupbyColumns.length&&(columns=_.concat(columns,groupbyColumns))),scope.xaxisdatakey!==scope.aggregationcolumn&&columns.push(scope.xaxisdatakey),_.forEach(yAxisKeys,function(key){key!==scope.aggregationcolumn&&columns.push(key)}),groupingExpression=columns.join(","),scope.isVisuallyGrouped=isVisuallyGrouped,{expression:groupingExpression,isVisuallyGrouped:isVisuallyGrouped,visualGroupingColumn:visualGroupingColumn}}return{expression:"",isVisuallyGrouped:!1,visualGroupingColumn:""}}function getAggregatedData(scope,element,groupingDetails,callback){var query,variableName,variable,columns,yAxisKeys=scope.yaxisdatakey?scope.yaxisdatakey.split(","):[],orderbyexpression=getOrderbyExpression(scope.orderby),groupbyExpression=groupingDetails.expression,elScope=element.scope();scope.chartData&&(scope.binddataset.indexOf("bind:Variables.")!==-1?(variableName=scope.binddataset.replace("bind:Variables.",""),variableName=variableName.substr(0,variableName.indexOf("."))):variableName=scope.dataset.variableName,variable=elScope.Variables&&elScope.Variables[variableName],variable&&(columns=getQueryColumns(scope),query=QueryBuilder.getQuery({tableName:variable.type,columns:columns,filterFields:scope.filterFields||variable.filterFields,groupby:groupbyExpression,orderby:orderbyexpression}),QueryBuilder.executeQuery({databaseName:variable.liveSource,query:query,page:1,size:variable.maxResults||500,nativeSql:!1},function(response){var chartData=[],aggregationAlias=getValidAliasName(scope.aggregationcolumn),visualGroupingColumnAlias=groupingDetails.visualGroupingColumn?getValidAliasName(groupingDetails.visualGroupingColumn):"",xAxisAliasKey=getValidAliasName(scope.xaxisdatakey),yAxisAliasKeys=[];yAxisKeys.forEach(function(yAxisKey){yAxisAliasKeys.push(getValidAliasName(yAxisKey))}),WM.forEach(response.content,function(data){var obj={};isAggregationEnabled(scope)&&(obj[scope.aggregationcolumn]=data[aggregationAlias]),visualGroupingColumnAlias&&(obj[groupingDetails.visualGroupingColumn]=data[visualGroupingColumnAlias]),obj[scope.xaxisdatakey]=data[xAxisAliasKey],yAxisKeys.forEach(function(yAxisKey){yAxisAliasKeys.push(getValidAliasName(yAxisKey))}),yAxisKeys.forEach(function(yAxisKey,index){obj[yAxisKey]=data[yAxisAliasKeys[index]]}),chartData.push(obj)}),scope.chartData=groupingDetails.isVisuallyGrouped?getGroupedData(scope,chartData,groupingDetails.visualGroupingColumn):chartData,Utils.triggerFn(callback)},function(){scope.chartData=[],setErrMsg(scope,"MESSAGE_ERROR_FETCH_DATA"),Utils.triggerFn(callback)})))}function setTextStyle(properties,id){var charttext=d3.select("#wmChart"+id+" svg").selectAll("text");charttext.style(properties)}function angle(d){var a=90*(d.startAngle+d.endAngle)/Math.PI-90;return a>90?a-180:a}function setLabelsMaxWidth(scope){var xTicks,tickWidth,maxLength,xDist,yDist,totalHeight,maxNoLabels,nthElement,labelsAvailableWidth,barWrapper,yAxisWrapper,svgWrapper,fontsize=parseInt(scope.fontsize,10)||12,isBarchart=ChartService.isBarChart(scope.type);xTicks=WM.element("#wmChart"+scope.$id+" svg").find("g.nv-x").find("g.tick").find("text"),xTicks.each(function(){var xTransform,tickDist,xTick=WM.element(this);if(xTick.text()&&"1"===xTick.css("opacity"))return xTransform=xTick.parent().attr("transform").split(","),xDist=parseFloat(xTransform[0].substr(10)),yDist=parseFloat(xTransform[1]||"0"),!isBarchart&&xDist>0?tickDist=xDist:yDist>0&&(tickDist=yDist),tickWidth?(tickWidth=tickDist-tickWidth,!1):(tickWidth=tickDist,!0)}),isBarchart?(barWrapper=WM.element("#wmChart"+scope.$id+" svg>g.nv-wrap>g>g.nv-barsWrap")[0],yAxisWrapper=WM.element("#wmChart"+scope.$id+" svg>g.nv-wrap>g>g.nv-y")[0],svgWrapper=WM.element("#wmChart"+scope.$id+" svg")[0],totalHeight=barWrapper?barWrapper.getBoundingClientRect().height:0,labelsAvailableWidth=yAxisWrapper?svgWrapper.getBoundingClientRect().width-yAxisWrapper.getBoundingClientRect().width:svgWrapper.getBoundingClientRect().width,maxLength=Math.round(labelsAvailableWidth/fontsize),tickWidth<fontsize&&(maxNoLabels=totalHeight/fontsize,
nthElement=Math.ceil(scope.chartData.length/maxNoLabels),d3.select("#wmChart"+scope.$id+" svg").select("g.nv-x").selectAll("g.tick").select("text").each(function(text,i){i%nthElement!==0&&d3.select(this).attr("opacity",0)}))):maxLength=Math.round(tickWidth/fontsize),maxLength=Math.abs(maxLength),xTicks.each(function(){this.textContent.length>maxLength&&(this.textContent=this.textContent.substr(0,maxLength)+"...")})}function getDefaultColumns(scope){var type,stringColumn,i,temp,defaultColumns=[],columns=scope.isLiveVariable?scope.dataset.propertiesMap.columns:[];for(i=0;i<columns.length&&defaultColumns.length<=2;i+=1)type=columns[i].type,!columns[i].isRelated&&Utils.isNumberType(type)?defaultColumns.push(columns[i].fieldName):"string"!==type||stringColumn||(stringColumn=columns[i].fieldName);return stringColumn&&defaultColumns.length>0&&!ChartService.isBubbleChart(scope.type)&&(temp=defaultColumns[0],defaultColumns[0]=stringColumn,defaultColumns[1]=temp),defaultColumns}function attachClickEvent(scope){var dataObj;d3.select("#wmChart"+scope.$id+" svg").selectAll(chartDataPointXpath[scope.type]).style("pointer-events","all").on("click",function(data,index){switch(scope.type){case"Column":case"Bar":dataObj=data._dataObj;break;case"Pie":case"Donut":dataObj=data.data._dataObj;break;case"Area":case"Cumulative Line":case"Line":dataObj=data[0]._dataObj;break;case"Bubble":dataObj=data.data.point[4]._dataObj}$rootScope.$safeApply(scope,function(){scope.selecteditem=dataObj,scope.onSelect&&scope.onSelect({$event:d3.event,$isolateScope:scope,selectedChartItem:data,selectedItem:scope.selecteditem})})})}function postPlotProcess(scope,element,chart){var chartSvg,pieLabels,pieGroups,angleArray,styleObj={};ChartService.postPlotChartProcess(scope),ChartService.isPieType(scope.type)?scope.showlabelsoutside||(chartSvg=d3.select("#wmChart"+scope.$id+" svg"),pieLabels=chartSvg.select(".nv-pieLabels").selectAll(".nv-label"),pieGroups=chartSvg.select(".nv-pie").selectAll(".nv-slice"),angleArray=[],pieGroups&&pieGroups.length&&(pieGroups.each(function(){d3.select(this).attr("transform",function(d){angleArray.push(angle(d))})}),pieLabels.each(function(d,i){var group=d3.select(this);WM.element(group[0][0]).find("text").attr("transform","rotate("+angleArray[i]+")")}))):setLabelsMaxWidth(scope),WM.forEach(styleProps,function(value,key){"fontsize"===key||"fontunit"===key?styleObj[value]=scope.fontsize+scope.fontunit:styleObj[value]=scope[key]}),setTextStyle(styleObj,scope.$id),CONSTANTS.isRunMode&&(Utils.triggerFn(scope._resizeFn&&scope._resizeFn.clear),scope._resizeFn=nv.utils.windowResize(function(){if(element[0].getBoundingClientRect().height)chart.update(),ChartService.postPlotChartProcess(scope),ChartService.isPieType(scope.type)||setLabelsMaxWidth(scope);else{var parent=element.closest(".app-accordion-panel, .tab-pane").isolateScope();parent&&(parent.initialized=!1)}}))}function configureChart(scope,element,datum){var xDomainValues,yDomainValues,chart,chartData=datum;return datum.length>0&&(ChartService.isAxisDomainValid(scope,"x")&&(xDomainValues=scope.binddataset?getXMinMaxValues(datum[0]):{min:{x:1},max:{x:5}}),ChartService.isAxisDomainValid(scope,"y")&&(yDomainValues=scope.binddataset?getYMinMaxValues(datum):{min:{y:1},max:{y:5}})),!ChartService.isPieType(scope.type)||scope.binddataset&&scope.scopedataset||(chartData=Utils.getClonedObject(scope.scopedataset||datum)),chart=ChartService.initChart(scope,xDomainValues,yDomainValues,null,!scope.binddataset),d3.select("#wmChart"+scope.$id+" svg").datum(chartData).call(chart),postPlotProcess(scope,element,chart),chart}function plotChart(scope,element){var datum=[];scope.chartData=scope.onTransform&&scope.onTransform({$scope:scope})||scope.chartData,datum=scope.isVisuallyGrouped&&!ChartService.isPieType(scope.type)?scope.chartData:getChartData(scope),element[0].getBoundingClientRect().height&&(scope.clearCanvas&&(element.find("svg").replaceWith("<svg></svg>"),scope.clearCanvas=!1),nv.addGraph(function(){configureChart(scope,element,datum)},function(){setTimeout(function(){attachClickEvent(scope)},600)}),$rootScope.$safeApply(scope,function(){scope.isLoadInProgress=!1}))}function plotChartProxy(scope,element){if($rootScope.$safeApply(scope,function(){scope.showContentLoadError=!1,scope.invalidConfig=!1}),!isValidAxis(scope))return setErrMsg(scope,"MESSAGE_INVALID_AXIS"),[];scope.isLoadInProgress=!0;var groupingDetails=getGroupingDetails(scope);scope.binddataset&&scope.isLiveVariable&&(scope.filterFields||isDataFilteringEnabled(scope))?getAggregatedData(scope,element,groupingDetails,function(){plotChart(scope,element)}):(scope.dataset&&scope.dataset.data&&scope.isLiveVariable&&(scope.chartData=scope.dataset.data),plotChart(scope,element))}function setDefaultAxisOptions(scope){var defaultColumns=getDefaultColumns(scope);scope.xaxisdatakey=defaultColumns[0]||null,scope.yaxisdatakey=defaultColumns[1]||null,scope.$root.$emit("set-markup-attr",scope.widgetid,{xaxisdatakey:scope.xaxisdatakey,yaxisdatakey:scope.yaxisdatakey})}function getCutomizedOptions(scope,prop,fields){if(!scope.binddataset)return fields;scope.axisoptions||(scope.axisoptions=fields);var newOptions;switch(prop){case"xaxisdatakey":isGroupByEnabled(scope.groupby)&&(newOptions=_.split(scope.groupby,","));break;case"yaxisdatakey":isAggregationEnabled(scope)?newOptions=_.split(scope.aggregationcolumn,","):scope.isLiveVariable&&(newOptions=scope.numericColumns);break;case"groupby":scope.isLiveVariable&&scope.nonPrimaryColumns&&scope.nonPrimaryColumns.length&&(newOptions=scope.nonPrimaryColumns);break;case"aggregationcolumn":scope.isLiveVariable&&isAggregationEnabled(scope)&&"count"!==scope.aggregation&&(newOptions=scope.numericColumns);break;case"bubblesize":scope.numericColumns&&scope.numericColumns.length&&(newOptions=scope.numericColumns)}return newOptions||fields||scope.axisoptions}function setNumericandNonPrimaryColumns(scope){var columns,type;scope.numericColumns=[],scope.nonPrimaryColumns=[],scope.dataset&&scope.dataset.propertiesMap&&(columns=Utils.fetchPropertiesMapColumns(scope.dataset.propertiesMap)),columns&&(WM.forEach(Object.keys(columns),function(key){type=columns[key].type,Utils.isNumberType(type)&&scope.numericColumns.push(key),"true"!==columns[key].isRelatedPk&&columns[key].isPrimaryKey||scope.nonPrimaryColumns.push(key)}),scope.numericColumns=scope.numericColumns.sort(),scope.nonPrimaryColumns=scope.nonPrimaryColumns.sort())}function setWidgetTypes(scope){ChartService.isPieType(scope.type)?(scope.widgetProps.xaxisdatakey.displayKey="LABEL_PROPERTY_LABEL",scope.widgetProps.yaxisdatakey.displayKey="LABEL_PROPERTY_VALUES",PropertiesFactory.getPropertyGroup("xaxis").displayKey="LABEL_PROPERTY_LABEL_DATA",PropertiesFactory.getPropertyGroup("yaxis").displayKey="LABEL_PROPERTY_VALUE_DATA",scope.widgetProps.yaxisdatakey.widget="list",scope.widgetProps.groupby.widget="list"):(scope.widgetProps.xaxisdatakey.displayKey=void 0,scope.widgetProps.yaxisdatakey.displayKey=void 0,PropertiesFactory.getPropertyGroup("xaxis").displayKey=void 0,PropertiesFactory.getPropertyGroup("yaxis").displayKey=void 0,scope.widgetProps.yaxisdatakey.widget="multi-select",scope.widgetProps.groupby.widget="multi-select")}function toggleAggregationColumnState(scope,aggregation){scope.widgetProps.aggregationcolumn.disabled=!isGroupByChecked||aggregation&&aggregation===NONE}function toggleAggregationState(scope){scope.widgetProps.aggregation.disabled=!isGroupByChecked,isGroupByChecked||(scope.isVisuallyGrouped=!1),toggleAggregationColumnState(scope,scope.aggregation)}function setAggregationColumns(scope,aggregation){scope.widgetProps.aggregationcolumn.options="count"===aggregation?scope.axisoptions:scope.numericColumns}function setGroupByColumns(scope,aggregationcolumn){var index,columns=Utils.getClonedObject(scope.nonPrimaryColumns);scope.nonPrimaryColumns&&aggregationcolumn&&(index=_.indexOf(scope.nonPrimaryColumns,aggregationcolumn),index>=0&&columns.splice(index,1))}function propertyChangeHandler(scope,element,key,newVal,oldVal){var variableName,variableObj,elScope,styleObj={};switch(key){case"dataset":elScope=element.scope(),scope.errMsg="",scope.binddataset&&scope.binddataset.indexOf("bind:Variables.")!==-1&&(variableName=scope.binddataset.replace("bind:Variables.",""),variableName=variableName.substr(0,variableName.indexOf("."))),newVal||scope.binddataset||(scope.isVisuallyGrouped=!1,scope.axisoptions=null),variableObj=elScope.Variables&&elScope.Variables[variableName],scope.isLiveVariable=variableObj&&"wm.LiveVariable"===variableObj.category,scope.isLiveVariable&&CONSTANTS.isStudioMode&&setNumericandNonPrimaryColumns(scope),scope.isServiceVariable=variableObj&&("wm.ServiceVariable"===variableObj.category||"wm.WebSocketVariable"===variableObj.category),scope.chartData=scope.isLiveVariable?newVal&&(newVal.data||""):newVal&&""===newVal.dataValue&&1===_.keys(newVal).length?"":newVal,!WM.isArray(scope.chartData)&&WM.isObject(scope.chartData)&&(scope.chartData=[scope.chartData]),CONSTANTS.isStudioMode&&(WidgetUtilService.updatePropertyPanelOptions(scope),ChartService.hideOrShowProperties(advanceDataProps,scope,scope.isLiveVariable),modifyAxesOptions(scope)),newVal&&newVal.filterFields&&(scope.filterFields=newVal.filterFields),scope.chartData&&!scope.variableInflight&&scope._plotChartProxy();break;case"type":ChartService.isPieType(scope.type)?(scope.offsettop=20,scope.offsetright=0,scope.offsetbottom=0,scope.offsetleft=0):"Pie"!==oldVal&&"Donut"!==oldVal||(scope.offsettop=25,scope.offsetright=25,scope.offsetbottom=55,scope.offsetleft=75),oldVal!==newVal&&(scope.clearCanvas=!0),CONSTANTS.isStudioMode&&togglePropertiesByChartType(scope),scope._plotChartProxy();break;case"fontsize":case"fontunit":case"color":case"fontfamily":case"fontweight":case"fontstyle":case"textdecoration":styleObj[styleProps[key]]="fontsize"===key||"fontunit"===key?scope.fontsize+scope.fontunit:newVal,setTextStyle(styleObj,scope.$id);break;case"aggregation":CONSTANTS.isStudioMode&&(toggleAggregationColumnState(scope,newVal),modifyAxesOptions(scope),newVal!==NONE&&setAggregationColumns(scope,newVal));break;case"groupby":CONSTANTS.isStudioMode&&(isGroupByChecked=isGroupByEnabled(newVal),toggleAggregationState(scope),widgetProps.groupby.selectedvalues=newVal,isGroupByChecked?modifyAxesOptions(scope,key):(scope.widgetProps.xaxisdatakey.options=getCutomizedOptions(scope,"xaxisdatakey"),setYAxisDataKey(scope,getCutomizedOptions(scope,"yaxisdatakey")),$rootScope.$emit("update-widget-property","aggregation",""),$rootScope.$emit("update-widget-property","aggregationcolumn","")));break;case"aggregationcolumn":CONSTANTS.isStudioMode&&(setGroupByColumns(scope,newVal),modifyAxesOptions(scope,key));break;default:scope._plotChartProxy()}_.includes(advanceDataProps,key)&&scope._plotChartProxy()}function getBooleanValue(val){return val===!0||"true"===val||val!==!1&&"false"!==val&&val}var isGroupByChecked,widgetProps=PropertiesFactory.getPropertiesOf("wm.chart",["wm.base"]),options={Bubble:["bubblesize","shape"]},NONE="none",advanceDataProps=["aggregation","aggregationcolumn","groupby","orderby"],chartDataPointXpath={Column:"rect.nv-bar",Bar:"g.nv-bar",Area:".nv-stackedarea .nv-point","Cumulative Line":".nv-cumulativeLine .nv-scatterWrap path.nv-point",Line:".nv-lineChart .nv-scatterWrap path.nv-point",Pie:".nv-pieChart .nv-slice path",Donut:".nv-pieChart .nv-slice path",Bubble:".nv-scatterChart .nv-point-paths path"},allOptions=["bubblesize","shape"],chartTypes=ChartService.chartTypes,styleProps={fontunit:"font-size",fontsize:"font-size",color:"fill",fontfamily:"font-family",fontweight:"font-weight",fontstyle:"font-style",textdecoration:"text-decoration"},allShapes=ChartService.allShapes,notifyFor={dataset:!0,xaxisdatakey:!0,yaxisdatakey:!0,type:!0,height:!0,width:!0,show:!0,fontsize:!0,fontunit:!0,color:!0,fontfamily:!0,fontweight:!0,fontstyle:!0,textdecoration:!0,shape:!0,bubblesize:!0,tooltips:!0,groupby:!0,aggregation:!0,aggregationcolumn:!0,orderby:!0,showlegend:!0,title:!0,subheading:!0},aggregationFnMap={average:"AVG",count:"COUNT",maximum:"MAX",minimum:"MIN",sum:"SUM"};return{restrict:"E",replace:!0,scope:{scopedataset:"=?",onTransform:"&",onSelect:"&"},template:$templateCache.get("template/widget/form/chart.html"),compile:function(){return{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,$el.removeAttr("title")},post:function(scope,element,attrs){function onDestroy(){handlers.forEach(Utils.triggerFn),handlers=[]}var boundVariableName,handlers=[],showLabelsValue=scope.showlabels;scope.getCutomizedOptions=getCutomizedOptions,scope.onPropertyChange=setDefaultAxisOptions,_.includes(["outside","inside","hide"],showLabelsValue)||(scope.showlabels=getBooleanValue(scope.showlabels),scope.showlabelsoutside=getBooleanValue(scope.showlabelsoutside),scope.showlabels=scope.showlabels?scope.showlabelsoutside?"outside":"inside":"hide"),scope.chartReady=!1,scope._plotChartProxy=_.debounce(plotChartProxy.bind(void 0,scope,element),50),scope.theme||(scope.theme=ChartService.isPieType(scope.type)?"Azure":"Terrestrial"),element.attr("id","wmChart"+scope.$id),scope.widgetDataset={},WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs),scope.widgetid&&(handlers.push($rootScope.$on("wms:replot-chart",function(event,activeChartScope){activeChartScope.$id===scope.$id&&scope._plotChartProxy()})),setWidgetTypes(scope)),scope.binddataset||attrs.scopedataset||scope._plotChartProxy(),CONSTANTS.isRunMode?(scope.showNoDataMsg=!1,attrs.scopedataset&&handlers.push(scope.$watch("scopedataset",function(newVal){scope.chartData=newVal||scope.chartData,scope._plotChartProxy()}))):(scope.showNoDataMsg=!0,handlers.push(scope.$root.$on("canvas-resize",function(){scope._plotChartProxy()}))),scope.binddataset&&scope.binddataset.indexOf("bind:Variables.")!==-1&&(boundVariableName=scope.binddataset.replace("bind:Variables.",""),boundVariableName=boundVariableName.split(".")[0],handlers.push($rootScope.$on("toggle-variable-state",function(event,variableName,active){boundVariableName===variableName&&(scope.variableInflight=active,$rootScope.$safeApply(scope,function(){scope.isLoadInProgress=active}))}))),scope.$on("$destroy",onDestroy),element.on("$destroy",onDestroy),scope.redraw=scope._plotChartProxy}}}}}),WM.module("wm.widgets.basic").service("ChartService",["Utils",function(Utils){"use strict";function isPieChart(type){return"Pie"===type}function isLineChart(type){return"Line"===type}function isBarChart(type){return"Bar"===type}function isDonutChart(type){return"Donut"===type}function isBubbleChart(type){return"Bubble"===type}function isColumnChart(type){return"Column"===type}function isAreaChart(type){return"Area"===type}function isPieType(type){return isPieChart(type)||isDonutChart(type)}function isChartDataJSON(type){return _.includes(dataTypeJSON,type)||!_.includes(chartTypes,type)}function isChartDataArray(type){return _.includes(dataTypeArray,type)}function isLineTypeChart(type){return _.includes(lineTypeCharts,type)}function isAxisDomainSupported(type){return isColumnChart(type)||isAreaChart(type)}function getBarSpacingValue(value,prop){return"value"===prop?barSpacingMap[value]:"key"===prop?barSpacingMapInvert[value]:void 0}function getRadiusValue(value,prop){return"value"===prop?donutRatioMap[value]:"key"===prop?donutRatioMapInvert[value]:void 0}function getLabelValues(showlabels,showlabelsoutside,prop){var labelsConfig={};switch(showlabels){case"hide":labelsConfig.showlabels=!1;break;case"inside":labelsConfig.showlabels=!0,labelsConfig.showlabelsoutside=!1;break;case"outside":labelsConfig.showlabels=!0,labelsConfig.showlabelsoutside=!0}return labelsConfig}function constructSampleData(dataType,yaxisLength,shape){var first_series=[],second_series=[],third_series=[],first_series_array=[],second_series_array=[],third_series_array=[],first_series_bubble=[],second_series_bubble=[],third_series_bubble=[],data=[];switch(dataType){case"jsonFormat":first_series=[{x:"01/01/2001",y:4e6},{x:"01/01/2002",y:1e6},{x:"01/01/2003",y:5e6}],second_series=[{x:"01/01/2001",y:3e6},{x:"01/01/2002",y:4e6},{x:"01/01/2003",y:7e6}],third_series=[{x:"01/01/2001",y:2e6},{x:"01/01/2002",y:8e6},{x:"01/01/2003",y:6e6}],data[0]={values:first_series,key:SAMPLE_DATA.group1},yaxisLength>=2&&(data[1]={values:second_series,key:SAMPLE_DATA.group2}),yaxisLength>=3&&(data[2]={values:third_series,key:SAMPLE_DATA.group3});break;case"lineChartFormat":first_series=[{x:1,y:4e6},{x:2,y:1e6},{x:3,y:5e6}],second_series=[{x:1,y:3e6},{x:2,y:4e6},{x:3,y:7e6}],third_series=[{x:1,y:2e6},{x:2,y:8e6},{x:3,y:6e6}],data[0]={values:first_series,key:SAMPLE_DATA.group1},yaxisLength>=2&&(data[1]={values:second_series,key:SAMPLE_DATA.group2}),yaxisLength>=3&&(data[2]={values:third_series,key:SAMPLE_DATA.group3});break;case"arrayFormat":first_series_array=[[1,4e6],[2,1e6],[3,5e6]],second_series_array=[[1,3e6],[2,4e6],[3,7e6]],third_series_array=[[1,2e6],[2,8e6],[3,6e6]],data[0]={values:first_series_array,key:SAMPLE_DATA.group1},yaxisLength>=2&&(data[1]={values:second_series_array,key:SAMPLE_DATA.group2}),yaxisLength>=3&&(data[2]={values:third_series_array,key:SAMPLE_DATA.group3});break;case"bubbleFormat":shape="random"===shape?allShapes[Math.floor(Math.random()*allShapes.length)]:shape,first_series_bubble=[{x:80.66,y:33739900,size:78,shape:shape},{x:79.84,y:81902300,size:90,shape:shape},{x:78.6,y:5523100,size:45,shape:shape}],second_series_bubble=[{x:72.73,y:79716200,size:98,shape:shape},{x:80.05,y:61801600,size:20,shape:shape},{x:72.49,y:73137200,size:34,shape:shape}],third_series_bubble=[{x:68.09,y:33739900,size:45,shape:shape},{x:81.55,y:7485600,size:78,shape:shape},{x:68.6,y:14185e4,size:56,shape:shape}],data[0]={values:first_series_bubble,key:SAMPLE_DATA.group1},yaxisLength>=2&&(data[1]={values:second_series_bubble,key:SAMPLE_DATA.group2}),yaxisLength>=3&&(data[2]={values:third_series_bubble,key:SAMPLE_DATA.group3});break;case"pieChartFormat":data=[{x:SAMPLE_DATA.group1,y:1e6},{x:SAMPLE_DATA.group2,y:2e6},{x:SAMPLE_DATA.group3,y:3e6},{x:SAMPLE_DATA.group4,y:4e6}]}return data}function getDataType(scope){var type=scope.type;return isLineChart(type)?"lineChartFormat":isPieType(type)?"pieChartFormat":isBubbleChart(type)?"bubbleFormat":isChartDataJSON(type)?"jsonFormat":"arrayFormat"}function getSampleData(scope){return constructSampleData(getDataType(scope),_.split(scope.yaxisdatakey,",").length,scope.shape)}function isAxisDomainValid(scope,axis){return!("Min"!==scope[axis+"domain"]||!isAxisDomainSupported(scope.type))}function areMinMaxValuesValid(values){return!(!_.isFinite(values.min)||!_.isFinite(values.max))}function getYScaleMinValue(value){var _min=Math.floor(value);return Math.abs(value)-_min>0?value-.1:_min-1}function highlightPoints(id,highlightpoints){var chartSvg=id?d3.select("#wmChart"+id+" svg"):d3.select(chartId+" svg");highlightpoints?chartSvg.selectAll(".nv-point").style({"stroke-width":"6px","fill-opacity":".95","stroke-opacity":".95"}):chartSvg.selectAll(".nv-point").style({"stroke-width":"0px","fill-opacity":"0"})}function setLineThickness(id,thickness){var chartSvg=id?d3.select("#wmChart"+id+" svg"):d3.select(chartId+" svg");thickness=thickness||1.5,chartSvg.selectAll(".nv-line").style({"stroke-width":thickness})}function initProperties(scope,propertyValueMap){return propertyValueMap&&!Utils.isEmptyObject(propertyValueMap)||(propertyValueMap={}),_.forEach(basicProperties,function(prop){WM.isUndefined(propertyValueMap[prop])&&(propertyValueMap[prop]=scope[prop])}),propertyValueMap}function getNumberValue(value,callback){return isNaN(parseInt(value,10))?callback(value,"value"):value}function hideOrShowProperties(properties,scope,show,key){var showKey=key||"show";show=!!WM.isDefined(show)&&show;var _widgetProps=scope.widgetProps;_.forEach(properties,function(prop){_widgetProps[prop][showKey]=show})}function getDateFormatedData(dateFormat,d){return dateFormat=dateFormat||"%x",d3.time.format(dateFormat)(new Date(d))}function getNumberFormatedData(numberFormat,d){var formattedData,divider,prefix;return formattedData=d3.format(numberFormat)(d),numberFormat?(divider=tickformats[numberFormat]&&tickformats[numberFormat].divider||0,prefix=tickformats[numberFormat]&&tickformats[numberFormat].prefix,prefix&&0!==divider&&(formattedData=d3.format(".2f")(d/divider)+prefix)):formattedData=d>=1e3?d3.format(".1s")(d):d,formattedData}function toggleAxisShow(property,value){var $xAxis=d3.select(chartId+" g.nv-axis.nv-x"),$yAxis=d3.select(chartId+" g.nv-axis.nv-y");"showxaxis"===property?$xAxis.style("visibility",value?"visible":"hidden"):$yAxis.style("visibility",value?"visible":"hidden")}function modifyLegendPosition(scope,position,id){var showLegend=isShowLegend(scope.showlegend),chart_Id=id?"#wmChart"+id:chartId,legendWrap=d3.select(chart_Id+" .nv-legendWrap"),legendPadding=5;if(showLegend&&legendWrap[0][0]&&"bottom"===position){var legendWrapHeight=legendWrap[0][0].getBoundingClientRect().height,wrap=d3.select(chart_Id+" .nv-wrap"),wrapTransform=wrap&&wrap.attr("transform")?wrap.attr("transform").replace(/, /g,","):"",coordinates=/translate\(\s*([^\s,)]+)[ ,]([^\s,)]+)/.exec(wrapTransform),getChartHeight=function(){var chartHeight=WM.element(chart_Id+" svg>.nvd3.nv-wrap")[0].getBoundingClientRect().height;return 0===chartHeight&&(chartHeight=WM.element(chart_Id+" svg")[0].getBoundingClientRect().height-(legendWrapHeight+15)),chartHeight};legendWrap.attr("transform","translate(0 , "+(getChartHeight()-legendWrapHeight-legendPadding)+")"),coordinates&&wrap.attr("transform","translate("+coordinates[1]+","+legendPadding+")")}}function isShowLegend(value){return"false"!==value&&value!==!1&&("true"===value||value===!0||"hide"!==value)}function initChart(scope,xDomainValues,yDomainValues,propertyValueMap,isPreview){propertyValueMap=initProperties(scope,propertyValueMap);var chart,xaxislabel,yaxislabel,labelConfig,radius,barSpacing,showLegend,xAxisValue,xValue={},yValue={},colors=[];switch(scope.type){case"Column":barSpacing=getNumberValue(propertyValueMap.barspacing,getBarSpacingValue)||barSpacingMap.medium,chart=nv.models.multiBarChart().x(function(d){return d.x}).y(function(d){return d.y}).reduceXTicks(propertyValueMap.reducexticks).rotateLabels(0).showControls(!1).stacked("Stacked"===propertyValueMap.viewtype).groupSpacing(barSpacing);break;case"Cumulative Line":chart=nv.models.cumulativeLineChart().x(function(d){return d[0]}).y(function(d){return d[1]}).showControls(!1).useInteractiveGuideline(propertyValueMap.tooltips).interpolate(propertyValueMap.interpolation);break;case"Line":chart=nv.models.lineChart().useInteractiveGuideline(propertyValueMap.tooltips).interpolate(propertyValueMap.interpolation);break;case"Area":chart=nv.models.stackedAreaChart().x(function(d){return d[0]}).y(function(d){return d[1]}).clipEdge(!0).showControls(!1).style(propertyValueMap.areaviewtype).useInteractiveGuideline(propertyValueMap.tooltips).interpolate(propertyValueMap.interpolation);break;case"Bar":barSpacing=getNumberValue(propertyValueMap.barspacing,getBarSpacingValue)||barSpacingMap.medium,chart=nv.models.multiBarHorizontalChart().x(function(d){return d.x}).y(function(d){return d.y}).showControls(!1).stacked("Stacked"===propertyValueMap.viewtype).showValues(propertyValueMap.showvalues).groupSpacing(barSpacing);break;case"Pie":case"Donut":labelConfig=getLabelValues(propertyValueMap.showlabels,propertyValueMap.showlabelsoutside,"value"),radius=getNumberValue(propertyValueMap.donutratio,getRadiusValue)||donutRatioMap.medium,chart=nv.models.pieChart().x(function(d){return d.x}).y(function(d){return d.y}).showLabels(labelConfig.showlabels).labelType(propertyValueMap.labeltype).valueFormat(d3.format("%")).title(propertyValueMap.centerlabel).labelThreshold(.04).labelsOutside(labelConfig.showlabelsoutside),isDonutChart(scope.type)&&chart.donut(!0).donutRatio(radius);break;case"Bubble":chart=nv.models.scatterChart().x(function(d){return d.x}).y(function(d){return d.y}).showDistX(propertyValueMap.showxdistance).showDistY(propertyValueMap.showydistance)}return xDomainValues&&(xValue.min=xDomainValues.min.x||xDomainValues.min[0],xValue.max=xDomainValues.max.x||xDomainValues.max[0],areMinMaxValuesValid(xValue)&&(xValue.min=getYScaleMinValue(xValue.min),chart.xDomain([xValue.min,xValue.max]))),yDomainValues&&(yValue.min=yDomainValues.min.y||yDomainValues.min[1],yValue.max=yDomainValues.max.y||yDomainValues.max[1],areMinMaxValuesValid(yValue)&&(yValue.min=getYScaleMinValue(yValue.min),chart.yDomain([yValue.min,yValue.max]))),chart.legend.vers(propertyValueMap.legendtype&&propertyValueMap.legendtype.toLowerCase()||"furious"),_.includes(chartTypes,scope.type)||(chart=nv.models.multiBarChart().x(function(d){return d.x}).y(function(d){return d.y})),isPieType(scope.type)?("percent"===propertyValueMap.labeltype?chart.valueFormat(d3.format("%")):chart.valueFormat(function(d){return getNumberFormatedData(propertyValueMap.ynumberformat,d)}),chart.tooltip.contentGenerator(function(key){return yValue=getNumberFormatedData(propertyValueMap.ynumberformat,key.data.y),'<table><tbody><tr><td class="legend-color-guide"><div style="background-color:'+key.color+';"></div></td><td class="key">'+key.data.x+'</td><td class="value">'+yValue+"</td></tr></tbody></table>"})):(chart.showXAxis(propertyValueMap.showxaxis).showYAxis(propertyValueMap.showyaxis),xaxislabel=propertyValueMap.xaxislabel||scope.xaxisdatakey||"x caption",yaxislabel=propertyValueMap.yaxislabel||scope.yaxisdatakey||"y caption",xaxislabel+=propertyValueMap.xunits?"("+propertyValueMap.xunits+")":"",yaxislabel+=propertyValueMap.yunits?"("+propertyValueMap.yunits+")":"",chart.xAxis.axisLabel(Utils.prettifyLabels(xaxislabel)).axisLabelDistance(propertyValueMap.xaxislabeldistance).staggerLabels(propertyValueMap.staggerlabels),propertyValueMap.xdateformat||isPreview&&!isBubbleChart(scope.type)?isLineTypeChart(scope.type)?chart.xAxis.tickFormat(function(d){return xAxisValue=isPreview?dateList[d-1]:scope.xDataKeyArr[d-1],getDateFormatedData(propertyValueMap.xdateformat,xAxisValue)}):chart.xAxis.tickFormat(function(d){return getDateFormatedData(propertyValueMap.xdateformat,d)}):propertyValueMap.xnumberformat?chart.xAxis.tickFormat(function(d){return getNumberFormatedData(propertyValueMap.xnumberformat,d)}):isLineTypeChart(scope.type)&&chart.xAxis.tickFormat(function(d){return scope.xDataKeyArr[d]}),chart.yAxis.axisLabel(Utils.prettifyLabels(yaxislabel)).axisLabelDistance(propertyValueMap.yaxislabeldistance).staggerLabels(propertyValueMap.staggerlabels).tickFormat(function(d){return getNumberFormatedData(propertyValueMap.ynumberformat,d)}),isBarChart(scope.type)&&chart.valueFormat(function(d){return getNumberFormatedData(propertyValueMap.ynumberformat,d)})),WM.isString(propertyValueMap.customcolors)&&propertyValueMap.customcolors&&(colors=_.split(propertyValueMap.customcolors,",")),WM.isArray(propertyValueMap.customcolors)&&(colors=propertyValueMap.customcolors),propertyValueMap.offsettop=Number(propertyValueMap.offsettop),propertyValueMap.offsetright=Number(propertyValueMap.offsetright),propertyValueMap.offsetbottom=Number(propertyValueMap.offsetbottom),propertyValueMap.offsetleft=Number(propertyValueMap.offsetleft),showLegend=isShowLegend(propertyValueMap.showlegend),chart.showLegend(showLegend).margin({top:propertyValueMap.offsettop,right:propertyValueMap.offsetright,bottom:propertyValueMap.offsetbottom,left:propertyValueMap.offsetleft}).color(colors.length?colors:themes[propertyValueMap.theme].colors),chart.tooltip.enabled(propertyValueMap.tooltips),scope.message=propertyValueMap.nodatamessage||"No data found",chart.noData(scope.message),chart}function postPlotChartProcess(scope,isPreview){var id=isPreview?null:scope.$id;isLineTypeChart(scope.type)&&(setLineThickness(id,scope.linethickness),highlightPoints(id,scope.highlightpoints)),scope.showlegend&&modifyLegendPosition(scope,scope.showlegend,id)}function getDateList(){return dateList}var chartTypes=["Column","Line","Area","Cumulative Line","Bar","Pie","Donut","Bubble"],allShapes=["circle","square","diamond","cross","triangle-up","triangle-down"],dateList=["01/01/2001","01/01/2002","01/01/2003"],themes={Terrestrial:{colors:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],tooltip:{backgroundColor:"#de7d28",textColor:"#FFFFFF"}},Annabelle:{colors:["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],tooltip:{backgroundColor:"#2e306f",textColor:"#FFFFFF"}},Azure:{colors:["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"],tooltip:{backgroundColor:"#3182bd",textColor:"#FFFFFF"}},Retro:{colors:["#0ca7a1","#ffa615","#334957","#acc5c2","#988f90","#8accc9","#515151","#f27861","#36c9fd","#794668","#0f709d","#0d2738","#44be78","#4a1839","#6a393f","#557d8b","#6c331c","#1c1c1c","#861500","#09562a"],tooltip:{backgroundColor:"#80513a",textColor:"#FFFFFF"}},Mellow:{colors:["#f0dcbf","#88c877","#aeb918","#2e2c23","#ddddd2","#dfe956","#4c963b","#5d3801","#e1eec3","#cd8472","#fcfab3","#9a4635","#9295ad","#2e3f12","#565677","#557d8b","#4f4d02","#0c0c1b","#833324","#24120e"],tooltip:{backgroundColor:"#7c9e73",textColor:"#FFFFFF"}},Orient:{colors:["#a80000","#cc6c3c","#f0e400","#000084","#fccc6c","#009c6c","#cc309c","#78cc00","#fc84e4","#48e4fc","#4878d8","#186c0c","#606060","#a8a8a8","#000000","#d7d7d7","#75a06e","#190d0b","#888888","#694b84"],tooltip:{backgroundColor:"#c14242",textColor:"#FFFFFF"}},GrayScale:{colors:["#141414","#353535","#5b5b5b","#848484","#a8a8a8","#c3c3c3","#e0e0e0","#c8c8c8","#a5a5a5","#878787","#656565","#4e4e4e","#303030","#1c1c1c","#4f4f4f","#3b3b3b","#757575","#606060","#868686","#c1c1c1"],tooltip:{backgroundColor:"#575757",textColor:"#FFFFFF"}},Flyer:{colors:["#3f454c","#5a646e","#848778","#cededf","#74c4dd","#0946ed","#380bb1","#000ff0","#f54a23","#1db262","#bca3aa","#ffa500","#a86b32","#63a18c","#56795e","#934343","#b75f5f","#752d2d","#4e1111","#920606"],tooltip:{backgroundColor:"#47637c",textColor:"#FFFFFF"}},Luminosity:{colors:["#FFFFFF","#e4e4e4","#00bcd4","#f0dd2f","#00aabf","#018376","#e91e63","#39e5d4","#ff6d6d","#00ff76","#ff9800","#969696","#ff4200","#e00000","#95cbe5","#5331ff","#fff4a7","#e7a800","#0061e4","#d5e7ff"],tooltip:{backgroundColor:"#47637c",textColor:"#FFFFFF"}}},basicProperties=["xaxislabel","yaxislabel","xunits","yunits","xnumberformat","xdateformat","ynumberformat","showvalues","showlabels","viewtype","areaviewtype","staggerlabels","reducexticks","offsettop","offsetbottom","offsetright","offsetleft","barspacing","xaxislabeldistance","yaxislabeldistance","theme","labeltype","donutratio","showlabelsoutside","showxdistance","showydistance","shape","nodatamessage","captions","showxaxis","showyaxis","centerlabel","customcolors","showlegend","legendtype","xdomain","ydomain","tooltips","linethickness","highlightpoints","interpolation"],barSpacingMap={small:.3,medium:.5,large:.8},donutRatioMap={small:.3,medium:.6,large:.7},barSpacingMapInvert=_.invert(barSpacingMap),donutRatioMapInvert=_.invert(donutRatioMap),tickformats={Thousand:{prefix:"K",divider:1e3},Million:{prefix:"M",divider:1e6},Billion:{prefix:"B",divider:1e9}},chartId="#preview-chart",dataTypeJSON=["Column","Line","Pie","Bar","Donut","Bubble"],lineTypeCharts=["Line","Area","Cumulative Line"],dataTypeArray=["Cumulative Line","Area"],SAMPLE_DATA={group1:"Europe",group2:"Asia",group3:"America",group4:"Australia"};this.isBarChart=isBarChart,this.isBubbleChart=isBubbleChart,this.isPieType=isPieType,
this.isChartDataJSON=isChartDataJSON,this.isChartDataArray=isChartDataArray,this.isLineTypeChart=isLineTypeChart,this.getSampleData=getSampleData,this.initChart=initChart,this.isAxisDomainValid=isAxisDomainValid,this.highlightPoints=highlightPoints,this.setLineThickness=setLineThickness,this.getBarSpacingValue=getBarSpacingValue,this.getRadiusValue=getRadiusValue,this.getLabelValues=getLabelValues,this.modifyLegendPosition=modifyLegendPosition,this.toggleAxisShow=toggleAxisShow,this.hideOrShowProperties=hideOrShowProperties,this.postPlotChartProcess=postPlotChartProcess,this.initProperties=initProperties,this.allShapes=allShapes,this.chartTypes=chartTypes,this.getDateList=getDateList}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/datanavigator.html",'<nav data-identifier="datanavigator" class="app-datanavigator clearfix" init-widget apply-styles><ul class="pagination advanced {{navigationClass}}" ng-if="navcontrols === \'Classic\'"><li ng-class="{\'disabled\':isDisableFirst}"><a title="{{$root.appLocale.LABEL_FIRST}}" name="first" href="javascript:void(0);" aria-label="First" ng-click="navigatePage(\'first\', $event)"><i class="wi wi-first-page"></i></a></li><li ng-class="{\'disabled\':isDisablePrevious}"><a title="{{$root.appLocale.LABEL_PREVIOUS}}" name="prev" href="javascript:void(0);" aria-label="Previous" ng-click="navigatePage(\'prev\', $event)"><i class="wi wi-chevron-left"></i></a></li><li class="pagecount disabled"><a><input type="number" ng-disabled="isDisableCurrent" ng-model="dn.currentPage" ng-model-options="{updateOn: \'change blur\'}" ng-change="onModelChange($event)" class="form-control" /></a></li><li class="disabled"><a ng-hide="isDisableCount"> / {{pageCount}}</a></li><li ng-class="{\'disabled\':isDisableNext}"><a title="{{$root.appLocale.LABEL_NEXT}}" name="next" href="javascript:void(0);" aria-label="Next" ng-click="navigatePage(\'next\', $event)"><i class="wi wi-chevron-right"></i></a></li><li ng-class="{\'disabled\':isDisableLast}"><a title="{{$root.appLocale.LABEL_LAST}}" name="last" href="javascript:void(0);" aria-label="Last" ng-click="navigatePage(\'last\', $event)"><i class="wi wi-last-page"></i></a></li><li ng-if="showrecordcount" class="totalcount disabled"><a>{{$root.appLocale.LABEL_TOTAL_RECORDS}}: {{dataSize}}</a></li></ul><ul class="pager {{navigationClass}}" ng-if="navcontrols === \'Pager\'"><li class="previous" ng-class="{\'disabled\':isDisablePrevious}"><a href="javascript:void(0);" ng-click="navigatePage(\'prev\', $event)"><span aria-hidden="true"><i class="wi wi-chevron-left"></i></span>{{$root.appLocale.LABEL_PREVIOUS}}</a></li><li class="next" ng-class="{\'disabled\':isDisableNext}"><a href="javascript:void(0);" ng-click="navigatePage(\'next\', $event)">{{$root.appLocale.LABEL_NEXT}}<span aria-hidden="true"><i class="wi wi-chevron-right"></i></span></a></li></ul><ul uib-pagination class="basic pagination {{navigationClass}}" ng-if="navcontrols === \'Basic\'" items-per-page="maxResults" total-items="dataSize" ng-model="dn.currentPage" ng-change="pageChanged()" max-size="maxsize"  boundary-links="boundarylinks" force-ellipses="forceellipses" direction-links="directionlinks" previous-text="." next-text="." first-text="." last-text="."></ul><ul ng-if="navcontrols === \'Basic\' && showrecordcount" class="pagination"><li class="totalcount disabled basiccount"><a>{{$root.appLocale.LABEL_TOTAL_RECORDS}}: {{dataSize}}</a></li></ul></nav>')}]).directive("wmDatanavigator",["PropertiesFactory","$templateCache","WidgetUtilService","Utils","$rootScope","wmToaster","CONSTANTS",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils,$rootScope,wmToaster,CONSTANTS){"use strict";function updateNavSize(scope){var sizeCls=sizeClasses[scope.navigation];sizeCls&&scope.navigationsize?scope.navigationClass=sizeCls[scope.navigationsize]:scope.navigationClass=""}function propertyChangeHandler(scope,element,key,newVal,oldVal){switch(key){case"dataset":var data,parentScope=scope.$parent;if(CONSTANTS.isStudioMode&&!newVal)return;CONSTANTS.isRunMode&&(scope.show=!!newVal&&""!==newVal.dataValue),data="wm-grid"===parentScope._widgettype?parentScope.onDataNavigatorDataSetChange(newVal):newVal,scope.setPagingValues(data);break;case"navigation":if("Advanced"===newVal)return void(scope.navigation="Classic");updateNavSize(scope),scope.widgetid&&(scope.widgetProps.showrecordcount.show="Pager"!==newVal),scope.navcontrols=newVal;break;case"navigationalign":element.removeClass("text-"+oldVal).addClass("text-"+newVal);break;case"navigationsize":updateNavSize(scope)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.datanavigator",["wm.base","wm.base.navigation"]),notifyFor={dataset:!0,navigation:!0,navigationalign:!0,navigationsize:!0},sizeClasses={Pager:{small:"pager-sm",large:"pager-lg"},Basic:{small:"pagination-sm",large:"pagination-lg"},Classic:{small:"pagination-sm",large:"pagination-lg"}};return{restrict:"E",scope:{onSetrecord:"&",onPaginationchange:"&"},replace:!0,controller:function($scope){function setNonPageableData(newVal,variable){var dataSize,maxResults,currentPage,startIndex;dataSize=WM.isArray(newVal)?newVal.length:newVal.data?newVal.data.length:1,maxResults=$scope.pagingOptions&&$scope.pagingOptions.maxResults||dataSize,currentPage=variable&&"wm.Variable"===variable.category?$scope.dn.currentPage||1:1,$scope.setDefaultPagingValues(dataSize,maxResults,currentPage),$scope.disableNavigation(),startIndex=($scope.dn.currentPage-1)*$scope.maxResults,$scope.result=WM.isArray(newVal)?newVal.slice(startIndex,startIndex+$scope.maxResults):newVal}$scope.pageCount=0,$scope.isDisableNext=!0,$scope.isDisablePrevious=!0,$scope.isDisableFirst=!0,$scope.isDisableLast=!0,$scope.resetPageNavigation=function(){$scope.pageCount=0,$scope.dn.currentPage=1,$scope.dataSize=0},$scope.calculatePagingValues=function(pageCount){$scope.pageCount=WM.isDefined(pageCount)?pageCount:$scope.dataSize>$scope.maxResults?Math.ceil($scope.dataSize/$scope.maxResults):$scope.dataSize<0?0:1,$scope.dn.currentPage=$scope.dn.currentPage||1},$scope.isPagingValuesComputed=function(){return WM.isDefined($scope.maxResults)&&WM.isDefined($scope.dataSize)&&WM.isDefined($scope.dn.currentPage)&&WM.isDefined($scope.pageCount)},$scope.setDefaultPagingValues=function(dataSize,maxResults,currentPage,pageCount){dataSize||maxResults?($scope.maxResults=maxResults||$scope.maxResults,$scope.dataSize=WM.isDefined(dataSize)?dataSize:$scope.dataSize,$scope.dn.currentPage=currentPage||$scope.dn.currentPage,$scope.calculatePagingValues(pageCount)):($scope.pageCount=1,$scope.dn.currentPage=1,$scope.maxResults=dataSize,$scope.dataSize=dataSize)},$scope.checkDataSize=function(dataSize,numberOfElements,size){dataSize===-1||dataSize===CONSTANTS.INT_MAX_VALUE?($scope.prevshowrecordcount=$scope.showrecordcount,$scope.isDisableLast=!0,$scope.isDisableCount=!0,$scope.showrecordcount=!1,numberOfElements<size&&($scope.isDisableNext=!0)):($scope.isDisableCount=!1,$scope.showrecordcount=$scope.prevshowrecordcount||$scope.showrecordcount)},$scope.disableNavigation=function(){var isCurrentPageFirst=1===$scope.dn.currentPage,isCurrentPageLast=$scope.dn.currentPage===$scope.pageCount;$scope.isDisableFirst=$scope.isDisablePrevious=isCurrentPageFirst,$scope.isDisableNext=$scope.isDisableLast=isCurrentPageLast,$scope.isDisableCurrent=isCurrentPageFirst&&isCurrentPageLast},$scope.isVariableHasPaging=function(){var dataSet=$scope.dataset;return WM.isObject(dataSet)&&(dataSet.pagingOptions||Utils.isPageable(dataSet))},$scope.setPagingValues=function(newVal){var dataSize,maxResults,currentPage,variable,elScope,variableOptions={};$scope.__fullData=newVal,$scope.result=newVal,$scope.isBoundToFilter=void 0,$scope.binddataset?($scope.binddataset.indexOf("bind:Variables.")!==-1?($scope.variableName=$scope.binddataset.replace("bind:Variables.",""),$scope.variableName=$scope.variableName.substr(0,$scope.variableName.indexOf(".")),elScope=$scope.navigatorElement.scope(),$scope.variableName&&elScope&&(variable=elScope.Variables[$scope.variableName],variableOptions=variable._options||{})):newVal&&(newVal.isBoundToFilter&&newVal.widgetName?($scope.isBoundToFilter=!0,$scope.widgetName=newVal.widgetName):$scope.variableName=newVal.variableName),newVal?($scope.isVariableHasPaging()?($scope.filterFields=variableOptions.filterFields||{},$scope.sortOptions=variableOptions.orderBy||(WM.isArray(newVal.sort)?Utils.getOrderByExpr(newVal.sort):""),WM.isObject(newVal)&&Utils.isPageable(newVal)&&(dataSize=newVal.totalElements,maxResults=newVal.size,newVal.numberOfElements>0?(WM.isDefined(newVal.number)&&($scope.dn.currentPage=newVal.number+1),currentPage=$scope.dn.currentPage||1):currentPage=1,$scope.setDefaultPagingValues(dataSize,maxResults,currentPage),$scope.disableNavigation(),$scope.checkDataSize(dataSize,newVal.numberOfElements,newVal.size)),$scope.isPagingValuesComputed()&&!newVal.pagingOptions||(dataSize=newVal.pagingOptions.dataSize,maxResults=newVal.pagingOptions.maxResults,currentPage=newVal.pagingOptions.currentPage,$scope.setDefaultPagingValues(dataSize,maxResults,currentPage),$scope.disableNavigation(),$scope.checkDataSize(dataSize))):WM.isString(newVal)||setNonPageableData(newVal,variable),$rootScope.$safeApply($scope)):$scope.resetPageNavigation()):newVal&&!WM.isString(newVal)&&(setNonPageableData(newVal),$rootScope.$safeApply($scope))},$scope.isFirstPage=function(){return 1===$scope.dn.currentPage||!$scope.dn.currentPage},$scope.isLastPage=function(){return $scope.dn.currentPage===$scope.pageCount},$scope.goToLastPage=function(isRefresh,event,callback){$scope.isLastPage()?isRefresh&&$scope.goToPage(event,callback):($scope.dn.currentPage=$scope.pageCount,$scope.goToPage(event,callback))},$scope.goToFirstPage=function(isRefresh,event,callback){$scope.isFirstPage()?isRefresh&&$scope.goToPage(event,callback):($scope.dn.currentPage=1,$scope.goToPage(event,callback))},$scope.goToPage=function(event,callback){$scope.firstRow=($scope.dn.currentPage-1)*$scope.maxResults,$scope.getPageData(event,callback)},$scope.onPageDataReady=function(event,data,callback){$scope.disableNavigation(),$scope.invokeSetRecord(event,data),Utils.triggerFn(callback)},$scope.getPageData=function(event,callback){var data,startIndex,widgetScope,widgets,variable=$scope.navigatorElement.scope().Variables[$scope.variableName];return CONSTANTS.isRunMode&&$scope.isBoundToFilter&&$scope.widgetName?(widgets=$scope.navigatorElement.scope().Widgets||{},widgetScope=widgets[$scope.widgetName],void widgetScope.applyFilter({page:$scope.dn.currentPage})):void($scope.isVariableHasPaging()?variable&&"wm.LiveVariable"===variable.category?variable.update({page:$scope.dn.currentPage,filterFields:$scope.filterFields,orderBy:$scope.sortOptions,matchMode:"anywhere",scope:$scope.navigatorElement.scope()},function(data,propertiesMap,pagingOptions){$scope.result={data:data,propertiesMap:propertiesMap,pagingOptions:pagingOptions,filterFields:$scope.filterFields,orderBy:$scope.sortOptions,variableName:$scope.variableName},$scope.dataSize=pagingOptions.dataSize,$scope.maxResults=pagingOptions.maxResults,$scope.calculatePagingValues(),$scope.onPageDataReady(event,data,callback)},function(error){wmToaster.show("error","ERROR","Unable to get data of page -"+$scope.dn.currentPage+":"+error)}):Utils.isPageable($scope.dataset)&&variable.update({page:$scope.dn.currentPage,filterFields:$scope.filterFields,orderBy:$scope.sortOptions,matchMode:"anywhere",scope:$scope.navigatorElement.scope()},function(data){$scope.result=data,$scope.onPageDataReady(event,data,callback)},WM.noop):(startIndex=($scope.dn.currentPage-1)*$scope.maxResults,data=WM.isArray($scope.__fullData)?$scope.__fullData.slice(startIndex,startIndex+$scope.maxResults):$scope.__fullData,$scope.result=data,$rootScope.$safeApply($scope),$scope.onPageDataReady(event,data,callback)))},$scope.invokeSetRecord=function(event,data){$scope.$parent.onSetrecord?$scope.$parent.onSetrecord({$event:event,$scope:this,$data:data,$index:$scope.dn.currentPage}):$scope.onSetrecord&&$scope.onSetrecord({$event:event,$scope:this,$data:data,$index:$scope.dn.currentPage})},$scope.validateCurrentPage=function(event,callback){return isNaN($scope.dn.currentPage)?($scope.goToFirstPage(void 0,event,callback),!1):$scope.dn.currentPage<0?($scope.goToFirstPage(void 0,event,callback),!1):!($scope.pageCount&&$scope.dn.currentPage>$scope.pageCount)||($scope.goToLastPage(void 0,event,callback),!1)},$scope.onModelChange=function(event){$scope.validateCurrentPage(event)&&$scope.goToPage(event)},$scope.pageChanged=function(){var callbackFn=$scope.$parent._onPaginationchange||$scope.$parent.onPaginationchange||$scope.onPaginationchange;$scope.goToPage(),callbackFn({$event:void 0,$scope:this,$index:$scope.dn.currentPage})},$scope.navigatePage=function(index,event,isRefresh,callback){var callbackFn=$scope.$parent._onPaginationchange||$scope.$parent.onPaginationchange||$scope.onPaginationchange;switch(callbackFn({$event:void 0,$scope:this,$index:$scope.dn.currentPage}),$scope.dn.currentPage=parseInt($scope.dn.currentPage,10),index){case"first":return void $scope.goToFirstPage(isRefresh,event,callback);case"prev":if($scope.isFirstPage()||!$scope.validateCurrentPage(event,callback))return;$scope.dn.currentPage-=1;break;case"next":if($scope.isLastPage()||!$scope.validateCurrentPage(event,callback))return;$scope.dn.currentPage+=1;break;case"last":return void $scope.goToLastPage(isRefresh,event,callback)}$scope.goToPage(event,callback)}},template:$templateCache.get("template/widget/datanavigator.html"),compile:function(){return{pre:function(scope){scope.widgetProps=widgetProps,scope.allowPageable=!0,scope.navcontrols="Basic"},post:function(scope,element,attrs){scope.dn={},scope.navigatorElement=element,WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.widgets.basic").service("wmToaster",["toaster","$rootScope","$compile","$timeout",function(toaster,$rs,$compile,$timeout){"use strict";function renderNotification(template,newClass,timeout,position,onclickHandler,onHideCallback,scope){$rs.toasterClasses={},$rs.toasterClasses[newClass]="custom-toaster "+newClass,_.includes(classlist,newClass)||(idMapper[newClass]=++idCount);var trustedHtml=$compile(template)(scope),toastTemplate='<toaster-container name = "'+newClass+"\" toaster-options=\"{'limit': 1,'time-out': 2000, 'position-class': '"+position+"', 'icon-classes': toasterClasses, 'toaster-id': "+idMapper[newClass]+'}"></toaster-container>';_.includes(classlist,newClass)||(WM.element("body").append($compile(toastTemplate)($rs)),classlist.push(newClass)),$rs.$safeApply($rs),$timeout(function(){toaster.pop({type:newClass,body:trustedHtml[0].outerHTML,onHideCallback:onHideCallback,toasterId:idMapper[newClass],timeout:timeout,bodyOutputType:"trustedHtml",clickHandler:onclickHandler})},350)}var _showToaster=function(type,title,desc,timeout,bodyOutputType,onClickHandler,onHideCallback){(title||desc)&&(timeout||(timeout=0!==timeout&&"success"===type?5e3:0),toaster.pop(type,title,desc,timeout,bodyOutputType||"trustedHtml",onClickHandler,void 0,void 0,void 0,onHideCallback))},classlist=[],idCount=0,idMapper={};return{success:function(title,desc){_showToaster("success",title,desc,5e3)},error:function(title,desc){_showToaster("error",title,desc,0)},info:function(title,desc){_showToaster("info",title,desc,0)},warn:function(title,desc){_showToaster("warning",title,desc,0)},show:function(type,title,desc,timeout,bodyOutputType,onClickHandler,onHideCallback){_showToaster(type,title,desc,timeout,bodyOutputType,onClickHandler,onHideCallback)},hide:function(){WM.element(".toast").hide()},createCustomNotification:function(content,className,timeout,position,onClickHandler,onHideCallback,pScope){renderNotification('<wm-container content="'+content+'"></wm-container>',className,timeout,position,onClickHandler,onHideCallback,pScope)}}}]),WM.module("wm.widgets.basic").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/progress.html",'<div class="progress app-progress" title="{{hint}}" init-widget apply-styles><div class="progress-bar" role="progressbar" aria-valuenow={{datavalue}} aria-valuemin={{minvalue}} aria-valuemax={{maxvalue}} ng-hide="isMultipleBar"></div></div>')}]).directive("wmProgress",["PropertiesFactory","WidgetUtilService","$interval","Utils","CONSTANTS",function(PropertiesFactory,WidgetUtilService,$interval,Utils,CONSTANTS){"use strict";function endPolling(scope){$interval.cancel(scope.invokeInterval)}function areValuesValid(max,min){return!(!max||!min&&0!==min||max<=min)}function isPercentageValue(value){if(WM.isString(value))return value=value.trim(),"%"===value.charAt(value.length-1)}function triggerCallbackFns(scope,oldDatavalue,newDatavalue,isValueAPercentage){var onStart=!1,onEnd=!1;isValueAPercentage?oldDatavalue<=0&&newDatavalue>0?onStart=!0:newDatavalue>=100&&(onEnd=!0):oldDatavalue<=scope.minvalue&&newDatavalue>scope.minvalue?onStart=!0:newDatavalue>=scope.maxvalue&&(onEnd=!0),onStart?Utils.triggerFn(scope.onStart,{$scope:scope}):onEnd&&(endPolling(scope),Utils.triggerFn(scope.onComplete,{$scope:scope}))}function getDecimalCount(val){val=val||"9",val=val.replace(/\%$/,"");var n=val.lastIndexOf(".");return n===-1?0:val.length-n-1}function updateCaptionPlacement(element,isMultipleBar,captionPlacement){isMultipleBar?element.find(".multi-bar").each(function(){WM.element(this).find(".app-progress-label").attr("data-caption-placement",captionPlacement)}):element.find(".app-progress-label").attr("data-caption-placement",captionPlacement)}function updateProgressBar(scope,attrs,progressBarEl,oldDatavalue,newDatavalue){var isValueAPercentage,progressBarWidth,displayValue=0,$label=progressBarEl.find(".app-progress-label");if(!scope.isMultipleBar){if(isValueAPercentage=isPercentageValue(scope.datavalue))oldDatavalue=parseInt(oldDatavalue||0,10),newDatavalue=parseInt(newDatavalue||0,10);else if(!areValuesValid(scope.maxvalue,scope.minvalue))return void endPolling(scope);triggerCallbackFns(scope,oldDatavalue,newDatavalue,isValueAPercentage),isValueAPercentage?progressBarWidth=displayValue=scope.datavalue||"0%":WM.isDefined(scope.datavalue)?(displayValue=100*scope.datavalue/(scope.maxvalue-scope.minvalue),progressBarWidth=displayValue+"%"):displayValue=progressBarWidth=0,progressBarEl.css("width",progressBarWidth),$label.length&&newDatavalue===oldDatavalue||(attrs.displayformat===DISPLAY_FORMAT.PERCENTAGE?displayValue=progressBarWidth:attrs.displayformat!==DISPLAY_FORMAT.ABSOLUTE&&(displayValue=displayValue.toFixed(getDecimalCount(scope.displayformat)),_.includes(scope.displayformat,"%")&&(displayValue+="%")),$label.length?$label.text(displayValue).attr("data-caption-placement",scope.captionplacement):WM.element('<span class="app-progress-label"></span>').text(displayValue).attr("data-caption-placement",scope.captionplacement).appendTo(progressBarEl))}}function updateMultipleProgressBar(element,data,captionPlacement){var typeField=_.split(element.attr("type"),"."),valueField=_.split(element.attr("datavalue"),".");_.forEach(data,function(barInfo){var cls=CLASSES[barInfo[_.last(typeField)]]||CLASSES.default,val=barInfo[_.last(valueField)]+"%"||barInfo.value;WM.element('<div class="multi-bar progress-bar"><span class="app-progress-label">'+val+"</span></div>").appendTo(element).addClass(cls).css("width",val)}),updateCaptionPlacement(element,!0,captionPlacement)}function successHandler(scope,response){scope.binddatavalue||Utils.triggerFn(scope.onBeforeupdate,{$response:response,$scope:scope})}function setupPolling(scope){$interval.cancel(scope.invokeInterval),CONSTANTS.isRunMode&&scope.binddataset&&scope.pollinterval&&(scope.invokeInterval=$interval(function(){scope.$root.$emit("invoke-service",scope.boundServiceName,{},successHandler.bind(void 0,scope))},scope.pollinterval))}function defineProperties(scope){Object.defineProperty(scope,"binddataset",{get:function(){return this._binddataset},set:function(value){if(this._binddataset!==value&&(this._binddataset=value,endPolling(scope),WM.isString(value))){var _value=value.replace("bind:Variables.","");scope.boundServiceName=_value.substr(0,_value.indexOf(".")),setupPolling(scope)}}})}function propertyChangeHandler(scope,element,attrs,progressBarEl,key,newVal,oldVal){switch(key){case"minvalue":case"maxvalue":updateProgressBar(scope,attrs,progressBarEl);break;case"datavalue":WM.isArray(scope.dataset)||(scope.isMultipleBar=!1,element.children(".multi-bar").remove(),(WM.isNumber(newVal)||WM.isString(newVal))&&updateProgressBar(scope,attrs,progressBarEl,oldVal,newVal));break;case"type":progressBarEl.removeClass(CLASSES[oldVal]).addClass(CLASSES[newVal]);break;case"pollinterval":endPolling(scope),WM.isNumber(newVal)&&setupPolling(scope);break;case"captionplacement":updateCaptionPlacement(element,scope.isMultipleBar||!1,newVal)}WM.isArray(scope.dataset)&&(element.children(".multi-bar").remove(),scope.isMultipleBar=!0,updateMultipleProgressBar(element,scope.dataset,scope.captionplacement))}var widgetProps=PropertiesFactory.getPropertiesOf("wm.progress",["wm.base","wm.base.events"]),notifyFor={datavalue:!0,minvalue:!0,maxvalue:!0,type:!0,pollinterval:!0,dataset:!0,captionplacement:!0},CLASSES={default:"","default-striped":"progress-bar-striped",success:"progress-bar-success","success-striped":"progress-bar-success progress-bar-striped",info:"progress-bar-info","info-striped":"progress-bar-info progress-bar-striped",warning:"progress-bar-warning","warning-striped":"progress-bar-warning progress-bar-striped",danger:"progress-bar-danger","danger-striped":"progress-bar-danger progress-bar-striped"},DISPLAY_FORMAT={PERCENTAGE:"percentage",ABSOLUTE:"ABSOLUTE"};return{restrict:"E",scope:{},replace:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/widget/progress.html"),link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,Object.defineProperty(scope,"binddataset",{configurable:!0})},post:function(scope,element,attrs){var progressBarEl=element.children().first();defineProperties(scope),attrs.dataset&&Utils.stringStartsWith(attrs.dataset,"bind:")&&(scope.binddataset=attrs.dataset),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element,attrs,progressBarEl),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),$.widget("wm.datagrid",{options:{data:[],statusMsg:"",colDefs:[],rowActions:[],headerConfig:[],sortInfo:{field:"",direction:""},isMobile:!1,enableSort:!0,filtermode:"",height:"100%",showHeader:!0,selectFirstRow:!1,showRowIndex:!1,enableRowSelection:!0,enableColumnSelection:!1,rowNgClass:"",multiselect:!1,filterNullRecords:!0,cssClassNames:{tableRow:"app-datagrid-row",headerCell:"app-datagrid-header-cell",groupHeaderCell:"app-datagrid-group-header-cell",tableCell:"app-datagrid-cell",grid:"",gridDefault:"table",gridBody:"app-datagrid-body",deleteRow:"danger",ascIcon:"wi wi-long-arrow-up",descIcon:"wi wi-long-arrow-down",selectedColumn:"selected-column"},dataStates:{loading:"Loading...",ready:"",error:"An error occurred in loading the data.",nodata:"No data found."},loadingicon:"",startRowIndex:1,editmode:"",searchHandler:WM.noop,sortHandler:function(sortInfo,e){e.stopPropagation();var data=$.extend(!0,[],this.options.data);this._setOption("data",_.orderBy(data,sortInfo.field,sortInfo.direction)),$.isFunction(this.options.afterSort)&&this.options.afterSort(e)}},customColumnDefs:{checkbox:{field:"checkbox",type:"custom",displayName:"",sortable:!1,searchable:!1,resizable:!1,selectable:!1,readonly:!0,style:"width: 50px; text-align: center;",textAlignment:"center",isMultiSelectCol:!0,show:!0},radio:{field:"radio",type:"custom",displayName:"",sortable:!1,searchable:!1,resizable:!1,selectable:!1,readonly:!0,style:"width: 50px; text-align: center;",textAlignment:"center",show:!0},rowIndex:{field:"rowIndex",type:"custom",displayName:"S. No.",sortable:!1,searchable:!1,selectable:!1,readonly:!0,style:"text-align: left;",textAlignment:"left",show:!0}},CONSTANTS:{QUICK_EDIT:"quickedit",INLINE:"inline",FORM:"form",DIALOG:"dialog",SEARCH:"search",MULTI_COLUMN:"multicolumn"},Utils:{random:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},isDefined:function(value){return void 0!==value},isObject:function(value){return null!==value&&"object"==typeof value},getObjectIndex:function(data,obj){var matchIndex=-1;return Array.isArray(data)?(data.some(function(data,index){if(angular.equals(data,obj))return matchIndex=index,!0}),matchIndex):-1},generateGuid:function(){var random=this.random;return random()+random()+"-"+random()+"-"+random()+"-"+random()+"-"+random()+random()+random()},isValidHtml:function(htm){var validHtmlRegex=/<[a-z][\s\S]*>/i;return validHtmlRegex.test(htm)},isMac:function(){return navigator.platform.toUpperCase().indexOf("MAC")>=0},isDeleteKey:function(event){return this.isMac()&&8===event.which||46===event.which}},_getColumnSortDirection:function(field){var sortInfo=this.options.sortInfo;return field===sortInfo.field?sortInfo.direction:""},_toggleSpacingClasses:function(value){switch(value){case"normal":this.gridElement.removeClass("table-condensed"),this.gridHeaderElement.removeClass("table-condensed"),this.gridSearch&&(this.gridSearch.find(".form-group").removeClass("form-group-sm"),this.gridSearch.find("select").removeClass("input-sm"),this.gridSearch.find(".input-group").removeClass("input-group-sm"));break;case"condensed":this.gridElement.addClass("table-condensed"),this.gridHeaderElement.addClass("table-condensed"),this.gridSearch&&(this.gridSearch.find(".form-group").addClass("form-group-sm"),this.gridSearch.find("select").addClass("input-sm"),this.gridSearch.find(".input-group").addClass("input-group-sm"))}},_getColSpan:function(cols){var colSpan=0,self=this;return _.forEach(cols,function(col){var colDef;col.isGroup?colSpan+=self._getColSpan(col.columns):(colDef=_.find(self.preparedHeaderData,{field:col.field}),colSpan=_.isUndefined(colDef.show)||colDef.show?colSpan+1:colSpan)}),colSpan},_setColSpan:function(config){var self=this;_.forEach(config,function(col){col.isGroup&&(col.colspan=self._getColSpan(col.columns),self.gridHeaderElement.find('th[data-col-group="'+col.field+'"]').attr("colspan",col.colspan),self._setColSpan(col.columns))})},_getHeaderTemplate:function(){function generateHeaderCell(value,index){var sortClass,$th,$col,$sortSpan,$sortIcon,id=index,field=value.field,headerLabel=WM.isDefined(value.displayName)?value.displayName:field||"",titleLabel=headerLabel,sortEnabled=self.options.enableSort&&(_.isUndefined(value.show)||value.show)&&(_.isUndefined(value.sortable)||value.sortable)&&!value.widgetType,headerClasses=self.options.cssClassNames.headerCell,tl="";return headerLabel=WM.isDefined(headerLabel)&&""!==headerLabel?headerLabel:"&nbsp;",$col=$("<col/>"),value.style&&$col.attr("style",value.style),$colgroup.append($col),isDefined(value.class)&&(headerClasses+=" "+value.class),value.selected&&(headerClasses+=" "+self.options.cssClassNames.selectedColumn+" "),"checkbox"!==field&&"radio"!==field||(headerClasses+=" grid-col-small"),tl+="<th",(_.isUndefined(value.resizable)||value.resizable)&&(_.isUndefined(value.show)||value.show)&&(tl+=" data-col-resizable"),self.options.enableColumnSelection&&(_.isUndefined(value.selectable)||value.selectable)&&(tl+=" data-col-selectable"),sortEnabled&&(tl+=" data-col-sortable"),tl+="></th>",$th=$(tl),$th.attr({"data-col-id":id,"data-col-field":field,title:titleLabel,style:"text-align: "+value.textAlignment}),$th.addClass(headerClasses),"checkbox"===field&&$th.append('<input type="checkbox" />'),$th.append('<span class="header-data">'+headerLabel+"</span>"),sortEnabled&&($sortSpan=$('<span class="sort-buttons-container"></span>'),$sortIcon=$('<i class="sort-icon"></i>'),sortField&&sortField===value.field&&sortInfo.direction&&(sortClass="asc"===sortInfo.direction?self.options.cssClassNames.ascIcon:self.options.cssClassNames.descIcon,$sortSpan.addClass("active"),$sortIcon.addClass(sortClass+" "+sortInfo.direction)),$th.append($sortSpan.append($sortIcon))),$th.get(0).outerHTML}function generateRow(cols,i){var tl="";_.forEach(cols,function(col){var index,value,classes,styles,$groupTl;col.columns&&col.columns.length?($groupTl=$("<th></th>"),classes=headerGroupClass+" "+(col.class||""),styles="text-align: "+col.textAlignment+";background-color: "+(col.backgroundColor||"")+";",$groupTl.attr({"data-col-group":col.field,class:classes,style:styles,title:col.displayName}),$groupTl.append('<span class="header-data">'+col.displayName+"</span>"),tl+=$groupTl.get(0).outerHTML,generateRow(col.columns,i+1)):(index=_.findIndex(self.preparedHeaderData,{field:col.field}),value=self.preparedHeaderData[index],value&&(tl+=generateHeaderCell(value,index)))}),rowTemplates[i]=rowTemplates[i]||"",rowTemplates[i]+=tl}var $row,$colgroup=$("<colgroup></colgroup>"),$htm=$("<thead></thead>"),isDefined=this.Utils.isDefined,sortInfo=this.options.sortInfo,sortField=sortInfo.field,self=this,rowTemplates=[],headerConfig=this.options.headerConfig,headerGroupClass=self.options.cssClassNames.groupHeaderCell;return _.isEmpty(headerConfig)?($row=$("<tr></tr>"),self.preparedHeaderData.forEach(function(value,index){$row.append(generateHeaderCell(value,index))}),$htm.append($row)):(generateRow(headerConfig,0),$htm.append(_.reduce(rowTemplates,function(template,rowTl,index){var $rowTl=$(rowTl),tl="",rowSpan=rowTemplates.length-index;return rowSpan>1&&$rowTl.closest("th.app-datagrid-header-cell").attr("rowspan",rowSpan),$rowTl.each(function(){tl+=$(this).get(0).outerHTML}),template+"<tr>"+tl+"</tr>"},""))),{colgroup:$colgroup,header:$htm}},_getSearchTemplate:function(){var htm,sel='<select name="wm-datagrid" data-element="dgFilterValue" class="form-control app-select"><option value="" selected>Select Field</option>',searchLabel=this.Utils.isDefined(this.options.searchLabel)&&this.options.searchLabel.length?this.options.searchLabel:"Search:";return this.options.colDefs.forEach(function(colDef,index){"none"!==colDef.field&&"rowOperations"!==colDef.field&&colDef.searchable&&(sel+='<option value="'+colDef.field+'" data-coldef-index="'+index+'">'+(colDef.displayName||colDef.field)+"</option>")}),sel+="</select>",htm='<form class="form-search form-inline" onsubmit="return false;"><div class="form-group"><input type="text" data-element="dgSearchText" class="form-control app-textbox" value="" placeholder="'+searchLabel+'" style="display: inline-block;"/></div><div class="input-append input-group">'+sel+'<span class="input-group-addon"><button type="button" data-element="dgSearchButton" class="app-search-button" title="Search"><i class="wi wi-search"></i></button></span></div></div></form>'},_getGridTemplate:function(){var self=this,$tbody=$('<tbody class="'+this.options.cssClassNames.gridBody+'"></tbody>');return _.forEach(this.preparedData,function(row){$tbody.append(self._getRowTemplate(row))}),$tbody},_getRowTemplate:function(row){var htm,self=this,gridOptions=self.options,rowNgClass=gridOptions.rowNgClass,rowNgClassExpr=rowNgClass?'ng-class="'+rowNgClass+'"':"";return htm=this.preparedHeaderData.reduce(function(prev,current,colIndex){return prev+self._getColumnTemplate(row,colIndex,current)},'<tr tabindex="0" class="'+gridOptions.cssClassNames.tableRow+" "+(gridOptions.rowClass||"")+'" data-row-id="'+row.pk+'" '+rowNgClassExpr+">"),htm+="</tr>",rowNgClass?gridOptions.getCompiledTemplate(htm,row):htm},_getRowActionsColumnDefIndex:function(){var i,len=this.preparedHeaderData.length;for(i=0;i<len;i+=1)if("rowOperations"===this.preparedHeaderData[i].field)return i;return-1},_getRowActionsColumnDef:function(){var index=this._getRowActionsColumnDefIndex();return index!==-1?this.preparedHeaderData[index]:null;
},_getCheckboxTemplate:function(row,isMultiSelectCol){var checked=row.checked?" checked":"",disabled=row.disabed?" disabled":"",chkBoxName=isMultiSelectCol?"gridMultiSelect":"";return'<input name="'+chkBoxName+'" type="checkbox"'+checked+disabled+"/>"},_getRadioTemplate:function(row){var checked=row.checked?" checked":"",disabled=row.disabed?" disabled":"";return'<input type="radio" name="" value=""'+checked+disabled+"/>"},_getColumnTemplate:function(row,colId,colDef){var value,columnValue,classes=this.options.cssClassNames.tableCell+" "+(colDef.class||""),ngClass=colDef.ngclass||"",htm='<td class="'+classes+'" data-col-id="'+colId+'" style="text-align: '+colDef.textAlignment+';"',colExpression=colDef.customExpression,ctId=row.pk+"-"+colId,isCellCompiled=!1;if(colDef.field&&(columnValue=row[colDef.field]),value=_.get(row,colDef.field),value&&(columnValue=value),ngClass&&(isCellCompiled=!0),colDef.formatpattern||("date"===colDef.type&&this.options.dateFormat?(colDef.formatpattern="toDate",colDef.datepattern=this.options.dateFormat):"time"===colDef.type&&this.options.timeFormat?(colDef.formatpattern="toDate",colDef.datepattern=this.options.timeFormat):"datetime"===colDef.type&&this.options.dateTimeFormat&&(colDef.formatpattern="toDate",colDef.datepattern=this.options.dateTimeFormat)),colDef.formatpattern&&"None"!==colDef.formatpattern&&!colExpression){switch(colDef.formatpattern){case"toDate":colDef.datepattern&&("datetime"===colDef.type&&(columnValue=columnValue?moment(columnValue).valueOf():void 0),colExpression="{{'"+columnValue+"' | toDate:'"+colDef.datepattern+"'}}");break;case"toCurrency":colDef.currencypattern&&(colExpression="{{'"+columnValue+"' | toCurrency:'"+colDef.currencypattern,colExpression+=colDef.fractionsize?"':'"+colDef.fractionsize+"'}}":"'}}");break;case"numberToString":colDef.fractionsize&&(colExpression="{{'"+columnValue+"' | numberToString:'"+colDef.fractionsize+"'}}");break;case"stringToNumber":colExpression="{{'"+columnValue+"' | stringToNumber}}";break;case"timeFromNow":colExpression="{{'"+columnValue+"' | timeFromNow}}";break;case"prefix":colDef.prefix&&(colExpression="{{'"+columnValue+"' | prefix:'"+colDef.prefix+"'}}");break;case"suffix":colDef.suffix&&(colExpression="{{'"+columnValue+"' | suffix:'"+colDef.suffix+"'}}")}htm+='title="'+colExpression+'"'}if(colExpression)isCellCompiled?htm+=">":(htm+='data-compiled-template="'+ctId+'">',isCellCompiled=!0),htm+=colExpression;else if("custom"!==colDef.type)columnValue=row[colDef.field],(this.options.filterNullRecords&&null===columnValue||_.isUndefined(columnValue))&&(columnValue=""),htm+='title="'+columnValue+'">',htm+=columnValue;else switch(htm+=">",colDef.field){case"checkbox":htm+=this._getCheckboxTemplate(row,colDef.isMultiSelectCol);break;case"radio":htm+=this._getRadioTemplate(row);break;case"rowOperations":htm+='<span class="actions-column" data-identifier="actionButtons"></span>';break;case"rowIndex":htm+=row.index;break;case"none":htm+="";break;default:htm+=_.isUndefined(columnValue)||null===columnValue?"":columnValue}return htm+="</td>",ngClass&&(htm=$(htm).attr({"data-ng-class":ngClass,"data-compiled-template":ctId})[0].outerHTML),isCellCompiled&&(this.compiledCellTemplates[ctId]=this.options.getCompiledTemplate(htm,row,colDef,!0)||""),htm},_getEventTemplate:function(colDef){var events=_.filter(_.keys(colDef),function(key){return _.startsWith(key,"on")}),template="";return _.forEach(events,function(eventName){template+=" "+_.kebabCase(eventName)+'="'+colDef[eventName]+'" '}),template},_getEditableTemplate:function($el,colDef,cellText,rowId,operation){var template,formName,checkedTmpl,placeholder=_.isUndefined(colDef.placeholder)?"":colDef.placeholder,dataValue=WM.isDefined(cellText)&&null!==cellText?'datavalue="'+cellText+'"':"",eventTemplate=this._getEventTemplate(colDef),dataFieldName=' data-field-name="'+colDef.field+'" ',disabled=!("new"===operation||!colDef.primaryKey||"assigned"!==colDef.generator)||colDef.disabled,disabledTl=disabled?' disabled="'+disabled+'" ':"",required=colDef.required?' required="'+colDef.required+'" ':"",properties=disabledTl+dataFieldName+eventTemplate+dataValue+required,index=colDef.index;switch(colDef.editWidgetType){case"select":cellText=cellText||"",template="<wm-select "+properties+(colDef.isDefinedData?' scopedataset="fullFieldDefs['+index+'].dataset"':'dataset="'+colDef.dataset+'"')+' datafield="'+colDef.datafield+'" displayfield="'+colDef.displayfield+'" placeholder="'+placeholder+'"></wm-select>';break;case"autocomplete":case"typeahead":$el.addClass("datetime-wrapper"),template="<wm-search "+properties+' dataset="'+colDef.dataset+'" datafield="'+colDef.datafield+'" displaylabel="'+colDef.displaylabel+'" searchkey="'+colDef.searchkey+'" '+(colDef.relatedfield?' relatedfield="'+colDef.relatedfield+'"':"")+' type="autocomplete" placeholder="'+placeholder+'"></wm-select>';break;case"date":$el.addClass("datetime-wrapper"),template="<wm-date "+properties+' placeholder="'+placeholder+'"></wm-date>';break;case"time":$el.addClass("datetime-wrapper"),template="<wm-time "+properties+' placeholder="'+placeholder+'"></wm-time>';break;case"datetime":$el.addClass("datetime-wrapper"),template="<wm-datetime "+properties+' outputformat="yyyy-MM-ddTHH:mm:ss" placeholder="'+placeholder+'"></wm-datetime>';break;case"timestamp":$el.addClass("datetime-wrapper"),template="<wm-datetime "+properties+' placeholder="'+placeholder+'"></wm-datetime>';break;case"checkbox":checkedTmpl=colDef.checkedvalue?' checkedvalue="'+colDef.checkedvalue+'" ':"",checkedTmpl+=colDef.uncheckedvalue?' uncheckedvalue="'+colDef.uncheckedvalue+'" ':"",template="<wm-checkbox "+checkedTmpl+properties+"></wm-checkbox>";break;case"number":template='<wm-text type="number" '+properties+' placeholder="'+placeholder+'"></wm-text>';break;case"textarea":cellText=cellText||"",template="<wm-textarea "+properties+' placeholder="'+placeholder+'"></wm-textarea>';break;case"upload":formName=colDef.field+"_"+rowId,$el.attr("form-name",formName),template='<form name="'+formName+'"><input focus-target'+dataFieldName+'class="file-upload" type="file" name="'+colDef.field+'"/></form>';break;default:template="<wm-text "+properties+' placeholder="'+placeholder+'"></wm-text>'}return $el.addClass(colDef.editWidgetType+"-widget"),this.options.getCompiledTemplate(template,this.preparedData[rowId]||{},colDef)},setHeaderConfigForDefaultFields:function(name){if(!_.isEmpty(this.options.headerConfig)){var fieldName=this.customColumnDefs[name].field;_.remove(this.options.headerConfig,{field:fieldName}),this.options.headerConfig.unshift({field:fieldName,isPredefined:!0})}},setDefaultColsData:function(header){_.isEmpty(this.preparedHeaderData)||(this.options.showRowIndex&&(header&&this.preparedHeaderData.unshift(this.customColumnDefs.rowIndex),this.setHeaderConfigForDefaultFields("rowIndex")),this.options.multiselect&&(header&&this.preparedHeaderData.unshift(this.customColumnDefs.checkbox),this.setHeaderConfigForDefaultFields("checkbox")),!this.options.multiselect&&this.options.showRadioColumn&&(header&&this.preparedHeaderData.unshift(this.customColumnDefs.radio),this.setHeaderConfigForDefaultFields("radio")))},_prepareHeaderData:function(){this.preparedHeaderData=[],$.extend(this.preparedHeaderData,this.options.colDefs),this.setDefaultColsData(!0)},_generateCustomColDefs:function(){function generateColumnDef(key){if(!generatedColDefs[key]){var colDef={type:"string",field:key};colDefs.push(colDef),generatedColDefs[key]=!0}}var colDefs=[],generatedColDefs={};this.options.data.forEach(function(item){_.keys(item).forEach(generateColumnDef)}),this.options.colDefs=colDefs,this._prepareHeaderData()},_prepareData:function(){var data=[],colDefs=this.options.colDefs,self=this,isObject=this.Utils.isObject,isDefined=this.Utils.isDefined;!this.options.colDefs.length&&this.options.data.length&&this._generateCustomColDefs(),this.options.data.forEach(function(item,i){var rowData=$.extend(!0,{},item);colDefs.forEach(function(colDef){if(colDef.field){var j,key,isArray,fields=colDef.field.split("."),text=item,len=fields.length;for(j=0;j<len;j++)if(key=fields[j],isArray=void 0,key.indexOf("[0]")!==-1&&(key=key.replace("[0]",""),isArray=!0),isObject(text)&&!isArray)text=_.get(text,key);else{if(!isArray){text=void 0;break}text=_.get(text,key+"[0]")}isDefined(text)?rowData[colDef.field]=text:fields.length>1&&_.has(item,colDef.field)&&(rowData[colDef.field]=item[colDef.field])}}),rowData.index=self.options.startRowIndex+i,rowData.pk=i,data.push(rowData)}),this.preparedData=data},_reselectColumns:function(){var selectedColumns=[],self=this;this.gridHeader&&this.options.enableColumnSelection&&(selectedColumns=this.gridHeader.find("th."+this.options.cssClassNames.selectedColumn),selectedColumns.length&&selectedColumns.each(function(){self.columnSelectionHandler(void 0,$(this))})),this.options.multiselect&&this.updateSelectAllCheckboxState()},_create:function(){$.extend(this,{dataStatus:{message:"",state:""},preparedData:[],preparedHeaderData:[],dataStatusContainer:null,gridContainer:null,gridElement:null,gridHeader:null,gridBody:null,gridSearch:null,tableId:null,searchObj:{field:"",value:"",event:null},compiledCellTemplates:{}}),this._setStatus=_.debounce(function(){this.__setStatus()},100),this._prepareHeaderData(),this._prepareData(),this._render()},_setGridEditMode:function(val){$.isFunction(this.options.setGridEditMode)&&this.options.setGridEditMode(val)},_refreshGrid:function(){this._prepareHeaderData(),this._prepareData(),this._render(),this.addOrRemoveScroll(),this._setGridEditMode(!1)},refreshGrid:function(){window.clearTimeout(this.refreshGridTimeout),this.refreshGridTimeout=window.setTimeout(this._refreshGrid.bind(this),50)},refreshGridData:function(){this._prepareData(),this.gridBody.remove(),this._renderGrid(),this._reselectColumns(),this.addOrRemoveScroll(),this._setGridEditMode(!1)},addNewRow:function(skipFocus){var $row,rowId=this.gridBody.find("tr:visible").length,rowData={};$.isFunction(this.options.beforeRowInsert)&&this.options.beforeRowInsert(),rowData.index=this.options.startRowIndex+rowId,rowData.pk=rowId,this.options.editmode!==this.CONSTANTS.FORM&&this.options.editmode!==this.CONSTANTS.DIALOG&&($row=$(this._getRowTemplate(rowData)),this.preparedData.length||this.setStatus("ready",this.dataStatus.ready),this.gridElement.find("tbody.app-datagrid-body").append($row),this._appendRowActions($row,!0,rowData),this.attachEventHandlers($row),this._findAndReplaceCompiledTemplates(),$row.trigger("click",[void 0,{action:"edit",operation:"new",skipFocus:skipFocus}]),this.updateSelectAllCheckboxState(),this.addOrRemoveScroll(),this.setColGroupWidths())},getSelectedRows:function(){this.getSelectedColumns();var selectedRowsData=[],self=this;return this.preparedData.forEach(function(data,i){data.selected&&selectedRowsData.push(self.options.data[i])}),selectedRowsData},selectRows:function(rows){var self=this;self.gridBody.find("tr").each(function(index){self.preparedData[index].selected&&$(this).trigger("click",[$(this),{skipSingleCheck:!0}])}),_.isArray(rows)?_.forEach(rows,function(row){self.selectRow(row,!0)}):self.selectRow(rows,!0)},setColGroupWidths:function(){var self=this,headerCols=this.options.isMobile?this.gridElement.find("col"):this.gridHeaderElement.find("col"),bodyCols=this.gridElement.find("col"),headerCells=this.options.showHeader?this.gridContainer.find("th.app-datagrid-header-cell"):this.gridElement.find("tr.app-datagrid-row:first td"),colLength=this.preparedHeaderData.length,scrollLeft=this.gridElement.parent().prop("scrollLeft");(headerCols.length||headerCells.length)&&(this._setColSpan(this.options.headerConfig),headerCells.each(function(){var width,id=Number($(this).attr("data-col-id")),colDef=self.preparedHeaderData[id],$headerCell=self.gridContainer.find('th[data-col-id="'+id+'"]'),$tdCell=self.gridElement.find('td.app-datagrid-cell[data-col-id="'+id+'"]'),definedWidth=colDef.width,$headerCol=$(headerCols[id]),$bodyCol=$(bodyCols[id]);_.isUndefined(colDef.show)||colDef.show?($headerCell.show(),$tdCell.show(),$headerCol.show(),$bodyCol.show()):($headerCell.hide(),$tdCell.hide(),$headerCol.hide(),$bodyCol.hide()),$headerCol.length&&"90px"===$headerCol[0].style.width&&(width=_.isUndefined(definedWidth)?"":definedWidth,$headerCol.css("width",width),$bodyCol.css("width",width))}),headerCells.each(function(){var width,tempWidth,$headerCol,$header=$(this),id=Number($header.attr("data-col-id")),colDef=self.preparedHeaderData[id],definedWidth=colDef.width;_.isUndefined(colDef.show)||colDef.show?$header.hasClass("grid-col-small")?width=50:_.isUndefined(definedWidth)||""===definedWidth||_.includes(definedWidth,"%")?($headerCol=$(headerCols[id]),$headerCol.length&&(tempWidth=$headerCol[0].style.width,""===tempWidth||"0px"===tempWidth||"90px"===tempWidth||_.includes(tempWidth,"%")?(width=$header.width(),width=width>90?colLength===id+1?width-17:width:90):width=tempWidth)):width=definedWidth:width=0,$(headerCols[id]).css("width",width),$(bodyCols[id]).css("width",width)}),this.gridElement.parent().prop("scrollLeft",scrollLeft))},getSelectedColumns:function(){var multiSelectColIndex,radioColIndex,colIndex,selectedColsData={},headerData=[],self=this;return $.extend(headerData,this.preparedHeaderData),this.options.multiselect?(headerData.some(function(item,i){if("checkbox"===item.field)return multiSelectColIndex=i,!0}),headerData.splice(multiSelectColIndex,1)):this.options.showRadioColumn&&(headerData.some(function(item,i){if("radio"===item.field)return radioColIndex=i,!0}),headerData.splice(radioColIndex,1)),this.options.showRowIndex&&(headerData.some(function(item,i){if("rowIndex"===item.field)return colIndex=i,!0}),headerData.splice(colIndex,1)),headerData.forEach(function(colDef){var field=colDef.field;colDef.selected&&(selectedColsData[field]={colDef:colDef,colData:self.options.data.map(function(data){return data[field]})})}),selectedColsData},_setOption:function(key,value){switch(this._super(key,value),key){case"showHeader":this._toggleHeader(),this._toggleSearch(),this.setColGroupWidths(),this.addOrRemoveScroll();break;case"filtermode":this._toggleSearch();break;case"searchLabel":this.gridSearch&&this.gridSearch.find('[data-element="dgSearchText"]').attr("placeholder",value);break;case"rowngclass":case"rowclass":this.refreshGrid();break;case"selectFirstRow":this.selectFirstRow(value);break;case"data":this.refreshGridData();break;case"dataStates":"nodata"===this.dataStatus.state?this.setStatus("nodata",this.dataStatus.nodata):"loading"===this.dataStatus.state&&this.setStatus("loading");break;case"loadingicon":this.dataStatusContainer.find("i").removeClass().addClass(this.options.loadingicon);break;case"multiselect":case"showRadioColumn":case"colDefs":case"rowActions":case"filterNullRecords":case"showRowIndex":this.refreshGrid();break;case"cssClassNames":var gridClass=this.options.cssClassNames.gridDefault+" "+this.options.cssClassNames.grid;this.gridElement.attr("class",gridClass),this.gridHeaderElement.attr("class",gridClass),"condensed"===this.options.spacing&&this._toggleSpacingClasses("condensed");break;case"spacing":this._toggleSpacingClasses(value)}},getOptions:function(){return this.options},_toggleHeader:function(){this.gridHeaderElement&&this.gridHeaderElement.empty(),this.gridElement&&(this.gridElement.find("colgroup").remove(),this.gridElement.find("thead").remove()),this.setDefaultColsData(),this.options.showHeader&&this._renderHeader()},_toggleSearch:function(){this.gridSearch&&this.gridSearch.remove(),this.options.filtermode===this.CONSTANTS.SEARCH?this._renderSearch():this.options.filtermode===this.CONSTANTS.MULTI_COLUMN&&(this._renderRowFilter(),this.setColGroupWidths())},_isCustomExpressionNonEditable:function(customTag,$el){var $input;if(!customTag)return!1;if(_.includes(customTag,"{{")&&_.includes(customTag,"}}")){try{if($($el.html()).length)return!0}catch(e){return!1}return!1}return $input=$(customTag),!!$input.length},selectFirstRow:function(value,visible){var $row,id;visible?(this.__setStatus(),$row=this.gridElement.find("tBody tr:visible:first")):$row=this.gridElement.find("tBody tr:first"),id=$row.attr("data-row-id"),$row.length&&this.preparedData.length&&(this.preparedData[id].selected=!value,$row.trigger("click"))},selectRow:function(row,value){var selector,$row,rowIndex=angular.isNumber(row)?row:this.Utils.getObjectIndex(this.options.data,row);rowIndex!==-1&&(selector="tr[data-row-id="+rowIndex+"]",$row=this.gridBody.find(selector),$row.length&&(this.preparedData[rowIndex].selected=!value),$row.trigger("click"))},deselectRow:function(row){this.selectRow(row,!1)},toggleRowSelection:function($row,selected){if($row.length){var $checkbox,$radio,rowId=$row.attr("data-row-id");this.preparedData[rowId]&&(this.preparedData[rowId].selected=selected,selected?$row.addClass("active"):$row.removeClass("active"),this.options.showRadioColumn&&($radio=$row.find("td input:radio:not(:disabled)"),$radio.prop("checked",selected),this.preparedData[rowId].checked=selected),this.options.multiselect?($checkbox=$row.find('td input[name="gridMultiSelect"]:checkbox:not(:disabled)'),$checkbox.prop("checked",selected),this.preparedData[rowId].checked=selected,this.updateSelectAllCheckboxState()):this._deselectPreviousSelection($row))}},updateSelectAllCheckboxState:function(){if(this.options.showHeader){this.__setStatus();var $headerCheckbox=this.gridHeader.find("th.app-datagrid-header-cell input:checkbox"),$tbody=this.gridElement.find("tbody"),checkedItemsLength=$tbody.find('tr:visible input[name="gridMultiSelect"]:checkbox:checked').length,visibleRowsLength=$tbody.find("tr:visible").length;return visibleRowsLength?void(checkedItemsLength===visibleRowsLength?$headerCheckbox.prop("checked",!0):$headerCheckbox.prop("checked",!1)):void $headerCheckbox.prop("checked",!1)}},rowSelectionHandler:function(e,$row,options){function callRowSelectionEvents(){selected&&$.isFunction(self.options.onRowSelect)&&self.options.onRowSelect(data,e),!selected&&$.isFunction(self.options.onRowDeselect)&&self.options.onRowDeselect(data,e)}options=options||{},e.stopPropagation();var rowId,rowData,data,selected,self=this,action=options.action,isQuickEdit=this.options.editmode===this.CONSTANTS.QUICK_EDIT;if(!(action||isQuickEdit&&$(e.target).hasClass("app-datagrid-cell"))||(options.action=options.action||"edit",this.toggleEditRow(e,options),!options.skipSelect)){if($row=$row||$(e.target).closest("tr"),rowId=$row.attr("data-row-id"),rowData=this.preparedData[rowId],data=this.options.data[rowId],selected=rowData&&rowData.selected||!1,!options.skipSingleCheck&&($row.hasClass("active")&&!this.options.multiselect||!rowData))return void(isQuickEdit||callRowSelectionEvents());selected=!selected,this.toggleRowSelection($row,selected),callRowSelectionEvents()}},rowDblClickHandler:function(e,$row){e.stopPropagation(),$row=$row||$(e.target).closest("tr");var rowData,rowId=$row.attr("data-row-id");rowData=this.preparedData[rowId],rowData&&$.isFunction(this.options.onRowDblClick)&&this.options.onRowDblClick(rowData,e)},headerClickHandler:function(e){var $th=$(e.target).closest("th.app-datagrid-header-cell"),id=$th.attr("data-col-id");this.options.onHeaderClick(this.preparedHeaderData[id],e)},columnSelectionHandler:function(e,$headerCell){e&&e.stopImmediatePropagation();var $th=e?$(e.target).closest("th.app-datagrid-header-cell"):$headerCell,id=$th.attr("data-col-id"),colDef=this.preparedHeaderData[id],field=colDef.field,selector='td[data-col-id="'+id+'"]',$column=this.gridElement.find(selector),selected=$column.data("selected")||!1,colInfo={colDef:colDef,data:this.options.data.map(function(data){return data[field]}),sortDirection:this._getColumnSortDirection(colDef.field)},selectedClass=this.options.cssClassNames.selectedColumn;selected=!selected,colDef.selected=selected,$column.data("selected",selected),selected?($column.addClass(selectedClass),$th.addClass(selectedClass),$.isFunction(this.options.onColumnSelect)&&e&&this.options.onColumnSelect(colInfo,e)):($column.removeClass(selectedClass),$th.removeClass(selectedClass),$.isFunction(this.options.onColumnDeselect)&&e&&this.options.onColumnDeselect(colInfo,e))},_getValue:function($el){var text,type=$el.attr("type");return"checkbox"===type?text=$el.prop("checked").toString():(text=$el.val(),$el.text(WM.isDefined(text)?text:"")),text},getTextValue:function($el,colDef,fields){var text,dataValue,$elScope,$ie=$el.find("input");return text=this._getValue($ie,fields),colDef.editWidgetType&&"upload"!==colDef.editWidgetType&&"text"!==colDef.editWidgetType&&($elScope=$el.children().isolateScope(),$elScope&&(dataValue=$elScope.datavalue,text=""===dataValue?void 0:dataValue)),"timestamp"!==colDef.type||colDef.editWidgetType&&"text"!==colDef.editWidgetType||(text=parseInt(text,10)),text},isDataModified:function($editableElements,rowData){function getEpoch(val){return val?moment(val).valueOf():val}var isDataChanged=!1,self=this;return $editableElements.each(function(){var $el=$(this),colId=$el.attr("data-col-id"),colDef=self.preparedHeaderData[colId],fields=_.split(colDef.field,"."),text=self.getTextValue($el,colDef,fields),originalData=_.get(rowData,colDef.field);if(isDataChanged="upload"===colDef.editWidgetType?document.forms[$el.attr("form-name")][colDef.field].files.length>0:!!(WM.isDefined(text)||null!==originalData&&void 0!==originalData)&&("datetime"===colDef.editWidgetType?!(getEpoch(originalData)===getEpoch(text)):!(originalData==text)))return!isDataChanged}),isDataChanged},disableActions:function(val){var $deleteBtns=this.gridBody.find(".delete-row-button"),$editBtns=this.gridBody.find(".edit-row-button");val?($editBtns.addClass("disabled-action"),$deleteBtns.addClass("disabled-action")):($editBtns.removeClass("disabled-action"),$deleteBtns.removeClass("disabled-action"))},setFocusOnElement:function(e,$el){var $firstEl,$target=$(e.target);$target.hasClass("app-datagrid-cell")?$firstEl=$target.find("input"):($el||($el=$target.closest("tr").find("td.cell-editing")),$firstEl=$($el).first().find("input"),$firstEl.length||($firstEl=$($el).first().find("textarea")),$firstEl.length||($firstEl=$($el).first().find("select"))),$firstEl.length&&$firstEl.first().focus()},removeNewRow:function($row){this.disableActions(!1),this._setGridEditMode(!1),$row.attr("data-removed",!0),$row.remove(),this.preparedData.length||this.setStatus("nodata",this.dataStatus.nodata),this.addOrRemoveScroll()},saveRow:function(callBack){this.gridBody.find("tr.row-editing").each(function(){$(this).trigger("click",[void 0,{action:"save",skipSelect:!0,noMsg:!0,success:callBack}])})},toggleEditRow:function(e,options){options=options||{},e&&e.stopPropagation();var action,isNewRow,$editableElements,isValid,$requiredEls,$row=options.$row||$(e.target).closest("tr"),$originalElements=$row.find("td"),$editButton=$row.find(".edit-row-button"),$cancelButton=$row.find(".cancel-edit-row-button"),$saveButton=$row.find(".save-edit-row-button"),$deleteButton=$row.find(".delete-row-button"),rowData=_.cloneDeep(this.options.data[$row.attr("data-row-id")])||{},self=this,rowId=parseInt($row.attr("data-row-id"),10),isDataChanged=!1,advancedEdit=self.options.editmode===self.CONSTANTS.QUICK_EDIT;if("true"!==$row.attr("data-removed")){if(options.selectRow&&this.selectRow(rowData,!0),e=e||{},e.data=e.data||{},action=e.data.action||options.action,"edit"===action){if(advancedEdit&&self.gridBody.find("tr.row-editing").length)return void self.saveRow(function(skipFocus,error){self.editSuccessHandler(skipFocus,error,e,$row,!0)});if($row.addClass("row-editing"),$.isFunction(this.options.beforeRowUpdate)&&this.options.beforeRowUpdate(rowData,e),self.options.editmode===self.CONSTANTS.FORM||self.options.editmode===self.CONSTANTS.DIALOG)return;if("new"===options.operation&&_.forEach(self.preparedHeaderData,function(colDef){rowData[colDef.field]=colDef.defaultvalue}),$.isFunction(this.options.onBeforeFormRender)&&(isValid=this.options.onBeforeFormRender(rowData,e,options.operation||action),isValid===!1))return;this._setGridEditMode(!0),this.disableActions(!0),$deleteButton.removeClass("disabled-action"),$originalElements.each(function(){var value,editableTemplate,$el=$(this),cellText=$el.text(),id=$el.attr("data-col-id"),colDef=self.preparedHeaderData[id];colDef.readonly||(value=_.get(rowData,colDef.field),editableTemplate=self._getEditableTemplate($el,colDef,value,rowId,options.operation),colDef.customExpression||colDef.formatpattern?(self._isCustomExpressionNonEditable(colDef.customExpression,$el)&&$el.addClass("cell-editing editable-expression").data("originalValue",{template:colDef.customExpression,rowData:_.cloneDeep(rowData),colDef:colDef}),$el.addClass("cell-editing editable-expression").html(editableTemplate).data("originalText",cellText)):$el.addClass("cell-editing").html(editableTemplate).data("originalText",cellText),colDef.required&&$el.addClass("required-field form-group"))}),$editButton.addClass("hidden"),$cancelButton.removeClass("hidden"),$saveButton.removeClass("hidden"),$editableElements=$row.find("td.cell-editing"),$editableElements.on("click",function(e){e.stopPropagation()}),!options.skipFocus&&$editableElements&&self.setFocusOnElement(e,$editableElements),$.isFunction(this.options.onFormRender)&&this.options.onFormRender($row,e,options.operation||action)}else if($editableElements=$row.find("td.cell-editing"),isNewRow=rowId>=this.preparedData.length,"save"===action){if($requiredEls=$editableElements.find(".ng-invalid-required"),$requiredEls.length>0)return $requiredEls.addClass("ng-touched"),void($.isFunction(options.success)&&options.success(!1,!0));if(isDataChanged=!!isNewRow||this.isDataModified($editableElements,rowData))if($editableElements.each(function(){var text,$el=$(this),colId=$el.attr("data-col-id"),colDef=self.preparedHeaderData[colId],fields=_.split(colDef.field,".");text=self.getTextValue($el,colDef,fields),1===fields.length&&"upload"===colDef.editWidgetType?_.set(rowData,colDef.field,_.get(document.forms,[$el.attr("form-name"),colDef.field,"files",0])):(text=1!==fields.length&&!isNewRow||""!==text?text:void 0,WM.isDefined(text)?(text="null"===text?null:text,null===text?fields.length>1?_.set(rowData,fields[0],text):_.set(rowData,colDef.field,""):_.set(rowData,colDef.field,text)):1!==fields.length||isNewRow||_.set(rowData,colDef.field,text))}),isNewRow){if(advancedEdit&&_.isEmpty(rowData))return self.removeNewRow($row),void($.isFunction(options.success)&&options.success(!1,void 0,!0));if($.isFunction(this.options.onBeforeRowInsert)&&(isValid=this.options.onBeforeRowInsert(rowData,e),isValid===!1))return;this.options.onRowInsert(rowData,e,options.success)}else{if($.isFunction(this.options.onBeforeRowUpdate)&&(isValid=this.options.onBeforeRowUpdate(rowData,e),isValid===!1))return;this.options.afterRowUpdate(rowData,e,options.success)}else this.cancelEdit($row),options.noMsg||this.options.noChangesDetected(),$.isFunction(options.success)&&options.success(!1)}else{if(isNewRow)return void self.removeNewRow($row);this.cancelEdit($row)}this.addOrRemoveScroll()}},cancelEdit:function($row){var self=this,$editableElements=$row.find("td.cell-editing"),$cancelButton=$row.find(".cancel-edit-row-button"),$saveButton=$row.find(".save-edit-row-button"),$editButton=$row.find(".edit-row-button");this.disableActions(!1),this._setGridEditMode(!1),$row.removeClass("row-editing"),$editableElements.off("click"),$editableElements.each(function(){var originalValue,template,$el=$(this),value=$el.data("originalValue");$el.removeClass("datetime-wrapper cell-editing required-field form-group"),value?(originalValue=value,originalValue.template?(template=self.options.getCompiledTemplate(originalValue.template,originalValue.rowData,originalValue.colDef),$el.html(template)):$el.html(originalValue||"")):$el.text($el.data("originalText")||"")}),$editButton.removeClass("hidden"),$cancelButton.addClass("hidden"),$saveButton.addClass("hidden")},hideRowEditMode:function($row){var $editableElements=$row.find("td.cell-editing"),$editButton=$row.find(".edit-row-button"),$cancelButton=$row.find(".cancel-edit-row-button"),$saveButton=$row.find(".save-edit-row-button"),self=this;$row.removeClass("row-editing"),$editableElements.off("click"),this.disableActions(!1),this._setGridEditMode(!1),$editableElements.each(function(){var originalValue,template,text,colDef,$el=$(this),value=$el.data("originalValue");$el.removeClass("datetime-wrapper cell-editing required-field form-group"),value?(originalValue=value,originalValue.template?(template=self.options.getCompiledTemplate(originalValue.template,originalValue.rowData,originalValue.colDef,!0),$el.html(template)):$el.html(originalValue||"")):(colDef=self.preparedHeaderData[$el.attr("data-col-id")],text=self.getTextValue($el,colDef,colDef.field.split(".")),$el.text(WM.isDefined(text)?text:""))}),$editButton.removeClass("hidden"),$cancelButton.addClass("hidden"),$saveButton.addClass("hidden"),this.addOrRemoveScroll()},deleteRow:function(e){e.stopPropagation();var className,isActiveRow,$row=$(e.target).closest("tr"),rowId=$row.attr("data-row-id"),rowData=this.options.data[rowId],isNewRow=rowId>=this.preparedData.length,self=this;return $.isFunction(this.options.beforeRowDelete)&&this.options.beforeRowDelete(rowData,e),isNewRow?(this.disableActions(!1),this._setGridEditMode(!1),$row.attr("data-removed",!0),$row.remove(),this.preparedData.length||this.setStatus("nodata",this.dataStatus.nodata),void this.addOrRemoveScroll()):void($.isFunction(this.options.onRowDelete)&&(className=this.options.cssClassNames.deleteRow,isActiveRow=$row.attr("class").indexOf("active")!==-1,isActiveRow&&$row.removeClass("active"),$row.addClass(className),this.options.onRowDelete(rowData,function(){isActiveRow&&$row.addClass("active"),$row.removeClass(className),self.addOrRemoveScroll()},e,function(skipFocus,error){if(self.options.editmode===self.CONSTANTS.QUICK_EDIT&&($(e.target).hasClass("delete-row-button")||self.Utils.isDeleteKey(e))){self.__setStatus();var rowID,$nextRow;error||(rowID=+$(e.target).closest("tr").attr("data-row-id"),$nextRow=self.gridBody.find('tr[data-row-id="'+rowID+'"]'),$nextRow.length||($nextRow=self.gridBody.find('tr[data-row-id="'+(rowID-1)+'"]')),$nextRow.trigger("click",[void 0,{action:"edit",skipFocus:skipFocus}]))}})))},deleteRowAndUpdateSelectAll:function(e){this.deleteRow(e),this.updateSelectAllCheckboxState()},_deselectPreviousSelection:function($row){var selectedRows=this.gridBody.find("tr.active"),rowId=$row.attr("data-row-id"),self=this;selectedRows.each(function(){var id=$(this).attr("data-row-id"),preparedData=self.preparedData[id];id!==rowId&&preparedData&&($(this).find("input:radio").prop("checked",!1),preparedData.selected=preparedData.checked=!1,$(this).removeClass("active"))})},resetSortIcons:function($el){var $sortContainer;!$el&&this.gridHeader&&($sortContainer=this.gridHeader.find(".sort-buttons-container.active"),$el=$sortContainer.find("i.sort-icon"),$sortContainer.removeClass("active")),$el.removeClass("desc asc").removeClass(this.options.cssClassNames.descIcon).removeClass(this.options.cssClassNames.ascIcon)},sortHandler:function(e){e.stopImmediatePropagation();var $previousSortedColumn,$previousSortIcon,colId,colDef,$e=$(e.target),$th=$e.closest("th.app-datagrid-header-cell"),id=$th.attr("data-col-id"),$sortContainer=$th.find(".sort-buttons-container"),$sortIcon=$sortContainer.find("i.sort-icon"),direction=$sortIcon.hasClass("asc")?"desc":$sortIcon.hasClass("desc")?"":"asc",sortInfo=this.options.sortInfo,$previousSortMarker=this.gridHeader.find(".sort-buttons-container.active"),field=$th.attr("data-col-field");this.resetSortIcons($sortIcon),$sortIcon.addClass(direction),"asc"===direction?($sortIcon.addClass(this.options.cssClassNames.ascIcon),$sortContainer.addClass("active")):"desc"===direction&&($sortIcon.addClass(this.options.cssClassNames.descIcon),$sortContainer.addClass("active")),$previousSortMarker.length&&($previousSortedColumn=$previousSortMarker.closest("th.app-datagrid-header-cell"),
colId=$previousSortedColumn.attr("data-col-id"),colDef=this.preparedHeaderData[colId],$previousSortIcon=$previousSortMarker.find("i.sort-icon"),colDef.field!==field&&($previousSortMarker.removeClass("active"),this.resetSortIcons($previousSortIcon)),colDef.sortInfo={sorted:!1,direction:""}),sortInfo.direction=direction,sortInfo.field=field,""!==direction&&(this.preparedHeaderData[id].sortInfo={sorted:!0,direction:direction}),this.options.sortHandler.call(this,this.options.sortInfo,e,"sort")},processUpDownKeys:function(event,$row,direction){var self=this;$row.hasClass("row-editing")&&self.options.editmode===self.CONSTANTS.QUICK_EDIT?self.toggleEditRow(event,{action:"save",noMsg:!0,success:function(skipFocus,error){self.editSuccessHandler(skipFocus,error,event,$row,!0,direction)}}):($row="down"===direction?$row.next():$row.prev(),$row.focus())},onKeyDown:function(event){var rowId,isNewRow,$target=$(event.target),$row=$target.closest("tr"),quickEdit=this.options.editmode===this.CONSTANTS.QUICK_EDIT;if(this.Utils.isDeleteKey(event)){if($target.is("input")||$target.hasClass("form-control"))return;return void this.deleteRow(event)}return 27===event.which?(rowId=parseInt($row.attr("data-row-id"),10),isNewRow=rowId>=this.preparedData.length,$row.trigger("click",[void 0,{action:"cancel"}]),void(isNewRow||$row.focus())):13===event.which?(quickEdit&&$target.hasClass("app-datagrid-row")?$row.trigger("click",[void 0,{action:"edit"}]):$row.trigger("click"),void($target.is("button")||(event.stopPropagation(),event.preventDefault()))):38===event.which?void this.processUpDownKeys(event,$row,"up"):void(40===event.which&&this.processUpDownKeys(event,$row,"down"))},editSuccessHandler:function(skipFocus,error,e,$row,isSameRow,direction){var rowID,$nextRow,self=this;return self.__setStatus(),error?void self.setFocusOnElement(e):(rowID=+$row.attr("data-row-id"),direction?(rowID="down"===direction?++rowID:--rowID,$nextRow=self.gridBody.find('tr[data-row-id="'+rowID+'"]'),void($nextRow.length?$nextRow.focus():$row.focus())):(isSameRow||rowID++,$nextRow=self.gridBody.find('tr[data-row-id="'+rowID+'"]'),void($nextRow.length?$nextRow.trigger("click",[void 0,{action:"edit",skipFocus:skipFocus,skipSelect:self.options.multiselect}]):self.addNewRow(skipFocus))))},attachEventHandlers:function($htm){var deleteRowHandler,rowOperationsCol=this._getRowActionsColumnDef(),$header=this.gridHeader,self=this;this.options.enableRowSelection&&($htm.on("click",this.rowSelectionHandler.bind(this)),$htm.on("dblclick",this.rowDblClickHandler.bind(this)),$htm.on("keydown",this.onKeyDown.bind(this))),$header&&(this.options.enableColumnSelection?$header.find("th[data-col-selectable]").on("click",this.columnSelectionHandler.bind(this)):$header.find("th[data-col-selectable]").off("click"),this.options.enableSort?this.options.enableColumnSelection?$header.find("th[data-col-sortable] .header-data").on("click",this.sortHandler.bind(this)):$header.find("th[data-col-sortable]").on("click",this.sortHandler.bind(this)):this.options.enableColumnSelection?$header.find("th[data-col-sortable] .header-data").off("click"):$header.find("th[data-col-sortable]").off("click")),this.options.rowActions.length?($htm.find(".row-action").on("click",{action:"edit"},this._handleCustomEvents.bind(this)),$htm.find(".cancel-edit-row-button").on("click",{action:"cancel"},this.toggleEditRow.bind(this)),$htm.find(".save-edit-row-button").on("click",{action:"save"},this.toggleEditRow.bind(this))):((this.options.editmode!==this.CONSTANTS.FORM&&this.options.editmode!==this.CONSTANTS.DIALOG||rowOperationsCol&&_.includes(rowOperationsCol.operations,"update"))&&($htm.find(".edit-row-button").on("click",{action:"edit"},this.toggleEditRow.bind(this)),$htm.find(".cancel-edit-row-button").on("click",{action:"cancel"},this.toggleEditRow.bind(this)),$htm.find(".save-edit-row-button").on("click",{action:"save"},this.toggleEditRow.bind(this))),rowOperationsCol&&_.includes(rowOperationsCol.operations,"delete")&&(deleteRowHandler=this.deleteRowAndUpdateSelectAll,this.options.multiselect||(deleteRowHandler=this.deleteRow),$htm.find("td .delete-row-button").on("click",deleteRowHandler.bind(this)))),self.options.editmode===self.CONSTANTS.QUICK_EDIT&&$htm.on("focusout","tr",function(e){function isInvalidTarget(){return!$relatedTarget.closest(".app-grid").length||$relatedTarget.is(invalidTargets)}var $target=$(e.target),$row=$target.closest("tr"),$relatedTarget=$(e.relatedTarget),invalidTargets=".row-editing, .row-action-button, .app-datagrid-cell, .caption";$target.closest("td").is(":last-child")&&!$row.hasClass("danger")&&null!==e.relatedTarget&&(""===$relatedTarget.attr("focus-target")||isInvalidTarget()||self.toggleEditRow(e,{action:"save",noMsg:!0,success:function(skipFocus,error,isNewRow){isNewRow||self.editSuccessHandler(skipFocus,error,e,$row)}}))})},_findAndReplaceCompiledTemplates:function(){if(this.gridBody){var $compiledCells=this.gridBody.find("td[data-compiled-template]"),self=this;$compiledCells.each(function(){var $cell=$(this),id=$cell.attr("data-compiled-template");$cell.replaceWith(self.compiledCellTemplates[id])})}},_renderSearch:function(){function search(e){e.stopPropagation();var searchText=$htm.find('[data-element="dgSearchText"]')[0].value,$filterField=$htm.find('[data-element="dgFilterValue"]'),field=$filterField[0].value,colDefIndex=$htm.find("option:selected").attr("data-coldef-index"),colDef=self.options.colDefs[colDefIndex],type=colDef&&colDef.type?colDef.type:"";self.searchObj={field:field,value:searchText,type:type,event:e},self.options.searchHandler.call(self,self.searchObj,e,"search")}var $searchBox,$htm=$(this._getSearchTemplate()),self=this;this.element.find(".form-search").remove(),$htm.insertBefore(this.gridContainer),this.gridSearch=this.element.find(".form-search"),$searchBox=this.gridSearch.find('[data-element="dgSearchText"]'),this.gridSearch.find(".app-search-button").on("click",search),this.gridSearch.find('[data-element="dgFilterValue"]').on("change",function(e){self.dataStatusContainer.find(".status").text()===self.options.dataStates.nodata&&search(e)}),$searchBox.on("keyup",function(e){e.stopPropagation(),$(this).val()||self.searchObj.value&&(self.searchObj.value="",search(e)),13===e.which&&search(e)})},_getFilterWidgetTemplate:function(field){var template,widget=field.filterwidget||"text",placeholder=field.filterplaceholder||"",fieldName=field.field,widgetName=' name="'+this.options.name+"_filter_"+fieldName+'"';switch(widget="number"===widget?"text":widget,widget="autocomplete"===widget?"search":widget,template="<wm-"+widget+widgetName+' placeholder="'+placeholder+'" scopedatavalue="rowFilter[\''+fieldName+"'].value\" on-change=\"onRowFilterChange('"+fieldName+"','"+field.type+"')\" disabled=\"{{emptyMatchModes.indexOf(rowFilter['"+fieldName+"'].matchMode) > -1}}\"",field.filterwidget){case"number":template+=' type="number" ';break;case"select":template+=field.isLiveVariable?' scopedataset="fullFieldDefs['+field.index+'].filterdataset"':' dataset="'+this.options.getBindDataSet()+'" datafield="'+fieldName+'" displayfield="'+fieldName+'"',template+=' orderby="'+fieldName+':asc"';break;case"autocomplete":template+=' type="autocomplete" dataset="'+this.options.getBindDataSet()+'" datafield="'+fieldName+'" searchkey="'+fieldName+'" displaylabel="'+fieldName+'" on-submit="onRowFilterChange()" orderby="'+fieldName+':asc"';break;case"time":template+=' timepattern="hh:mm:ss a" '}return template+="></wm-"+widget+">"},_renderRowFilter:function(){var compiledFilterTl,htm='<tr class="filter-row">',self=this,$headerElement=this.options.isMobile&&!this.options.showHeader?this.gridElement:this.gridHeaderElement;$headerElement.find(".filter-row").remove(),this.preparedHeaderData.forEach(function(field,index){var fieldName=field.field,widget=field.filterwidget||"text";return field.searchable?void(htm+='<th data-col-id="'+index+'"><span class="input-group '+widget+'">'+self._getFilterWidgetTemplate(field)+'<span class="input-group-addon filter-clear-icon" ng-if="showClearIcon(\''+fieldName+'\')"><button class="btn-transparent btn app-button" type="button" ng-click="clearRowFilter(\''+fieldName+'\')"><i class="app-icon wi wi-clear"></i></button></span><span class="input-group-addon" uib-dropdown dropdown-append-to-body><button class="btn-transparent btn app-button" type="button"  uib-dropdown-toggle><i class="app-icon wi wi-filter-list"></i></button><ul class="matchmode-dropdown dropdown-menu" uib-dropdown-menu> <li ng-repeat="matchMode in matchModeTypesMap[\''+field.type+"' || 'string']\" ng-class=\"{active: matchMode === (rowFilter['"+fieldName+"'].matchMode || matchModeTypesMap['"+field.type+"' || 'string'][0])}\"><a href=\"javascript:void(0);\" ng-click=\"onFilterConditionSelect('"+fieldName+"', matchMode)\">{{matchModeMsgs[matchMode]}}</a></li> </ul></span></span></th>"):void(htm+='<th data-col-id="'+index+'"></th>')},this),htm+="</tr>",compiledFilterTl=this.options.compileTemplateInGridScope(htm),this.options.showHeader?this.gridHeader.append(compiledFilterTl):this.options.isMobile?$headerElement.append($("<thead></thead>").append(compiledFilterTl)):$headerElement.append("<thead></thead>").append(compiledFilterTl),this.gridSearch=$headerElement.find(".filter-row")},_renderHeader:function(){function toggleSelectAll(e){var $checkboxes=$('tbody tr:visible td input[name="gridMultiSelect"]:checkbox',self.gridElement),checked=this.checked;$checkboxes.prop("checked",checked),$checkboxes.each(function(){var $row=$(this).closest("tr"),rowId=$row.attr("data-row-id"),rowData=self.options.data[rowId];self.toggleRowSelection($row,checked),checked&&$.isFunction(self.options.onRowSelect)&&self.options.onRowSelect(rowData,e),!checked&&$.isFunction(self.options.onRowDeselect)&&self.options.onRowDeselect(rowData,e)})}var $header,headerTemplate=this._getHeaderTemplate(),$colgroup=headerTemplate.colgroup,self=this;return this.gridElement.parent().scroll(function(){self.gridHeaderElement.parent().prop("scrollLeft",this.scrollLeft)}),this.options.showHeader?($header=headerTemplate.header,this.options.isMobile?(this.gridElement.append($colgroup).append($header),this.gridHeader=this.gridElement.find("thead")):(this.gridHeaderElement.append($colgroup).append($header),this.gridElement.prepend($colgroup.clone()),this.gridHeader=this.gridHeaderElement.find("thead")),$header.on("click",".app-datagrid-header-cell input:checkbox",toggleSelectAll),$.isFunction(this.options.onHeaderClick)&&this.gridHeader.find("th.app-datagrid-header-cell").on("click",this.headerClickHandler.bind(this)),void(!this.options.isMobile&&this.gridHeaderElement.length&&this.gridHeaderElement.find("th[data-col-resizable]").resizable({handles:"e",minWidth:50,resize:function(evt,ui){var $colElement,$colHeaderElement,$cellElements,originalTableWidth,newTableWidth,colIndex=+ui.helper.attr("data-col-id")+1,originalWidth=ui.helper.width(),newWidth=ui.size.width;$colHeaderElement=self.gridHeaderElement.find("colgroup > col:nth-child("+colIndex+")"),$colElement=self.gridElement.find("colgroup > col:nth-child("+colIndex+")"),$cellElements=self.gridElement.find("tr > td:nth-child("+colIndex+") > div"),$colElement.width(newWidth),$colHeaderElement.width(newWidth),$cellElements.width(newWidth),$(this).css("height","auto"),newWidth>ui.originalSize.width&&(originalTableWidth=self.gridHeaderElement.width(),newTableWidth=originalTableWidth+newWidth-originalWidth,self.gridHeaderElement.width(newTableWidth),self.gridElement.width(newTableWidth)),self.addOrRemoveScroll(),self.options.redrawWidgets()}}))):(this.gridHeaderElement.append($colgroup),void this.gridElement.prepend($colgroup.clone()))},addOrRemoveScroll:function(){var gridContent=this.gridContainer.find(".app-grid-content").get(0),gridHeader=this.gridContainer.find(".app-grid-header");gridContent.scrollHeight>gridContent.clientHeight&&!this.Utils.isMac()?gridHeader.addClass("scroll-visible"):gridHeader.removeClass("scroll-visible")},_handleCustomEvents:function(e,options){this.options.handleCustomEvents(e,options)},_getRowActionsTemplate:function(){function generateBindExpr(val){return _.startsWith(val,"bind:")?"{{"+_.replace(val,"bind:","")+"}}":val}var rowOperationsCol,saveCancelTemplateAdded=!1,actionsTemplate="<span> ",saveCancelTemplate='<button type="button" class="save row-action-button btn app-button btn-transparent save-edit-row-button hidden" title="Save"><i class="wi wi-done"></i></button> <button type="button" class="cancel row-action-button btn app-button btn-transparent cancel-edit-row-button hidden" title="Cancel"><i class="wi wi-cancel"></i></button> ';return this.options.rowActions.length?_.forEach(this.options.rowActions,function(def){var clsAttr="row-action row-action-button app-button btn "+def.class,ngShowAttr="",ngDisabled=def.disabled?' ng-disabled="'+_.replace(def.disabled,"bind:","")+'" ':"";"true"===def.show||"false"===def.show?clsAttr+="true"===def.show?"":" ng-hide ":_.includes(def.show,"bind:")&&(ngShowAttr=_.replace(def.show,"bind:","")),_.includes(def.action,"editRow()")?clsAttr+=" edit edit-row-button ":_.includes(def.action,"deleteRow()")&&(clsAttr+=" delete delete-row-button "),actionsTemplate+='<button type="button" data-action-key="'+def.key+'" class="'+clsAttr+'" title="'+generateBindExpr(def.title)+'" '+(ngShowAttr?' ng-show="'+ngShowAttr+'"':"")+(def.tabindex?' tabindex="'+def.tabindex+'"':"")+ngDisabled+'><i class="app-icon '+def.iconclass+'"></i>',def.displayName&&(actionsTemplate+='<span class="btn-caption">'+generateBindExpr(def.displayName)+"</span>"),actionsTemplate+="</button>",_.includes(def.action,"editRow()")&&(actionsTemplate+=saveCancelTemplateAdded?"":saveCancelTemplate,saveCancelTemplateAdded=!0)}):(rowOperationsCol=this._getRowActionsColumnDef()||{},_.includes(rowOperationsCol.operations,"update")&&(actionsTemplate+='<button type="button" class="row-action-button btn app-button btn-transparent edit edit-row-button" title="Edit Row"><i class="wi wi-pencil"></i></button> '+saveCancelTemplate),_.includes(rowOperationsCol.operations,"delete")&&(actionsTemplate+='<button type="button" class="row-action-button btn app-button btn-transparent delete delete-row-button" title="Delete Record"><i class="wi wi-trash"></i></button> ')),actionsTemplate+="</span>"},_appendRowActions:function($htm,isNewRow,rowData){var self,template,rowOperationsCol=this._getRowActionsColumnDef();(this.options.rowActions.length||rowOperationsCol)&&(self=this,template=self._getRowActionsTemplate(),$htm.find("[data-identifier='actionButtons']").each(function(index){isNewRow?$(this).empty().append(self.options.getCompiledTemplate(template,rowData,rowOperationsCol)):$(this).empty().append(self.options.getCompiledTemplate(template,self.preparedData[index],rowOperationsCol))}))},_renderGrid:function(){var $htm=$(this._getGridTemplate());this.gridElement.append($htm),this.options.data.length||"nodata"!==this.dataStatus.state?(this.dataStatus.state=this.dataStatus.state||"loading",this.dataStatus.message=this.dataStatus.message||this.options.dataStates.loading,this.setStatus(this.dataStatus.state,this.dataStatus.message)):this.setStatus("nodata"),this.gridBody=this.gridElement.find("tbody"),this._findAndReplaceCompiledTemplates(),this._appendRowActions($htm),this.attachEventHandlers($htm),this.__setStatus(),this.setColGroupWidths(),$.isFunction(this.options.onDataRender)&&this.options.onDataRender(),this.options.selectFirstRow&&(this.options.multiselect&&(this.options.selectFirstRow=!1),this.selectFirstRow(!0,!0))},_render:function(){this.tableId||(this.tableId=this.Utils.generateGuid());var statusContainer='<div class="overlay" style="display: none;"><div class="status"><i class="'+this.options.loadingicon+'"></i><span class="message"></span></div></div>',table='<div class="table-container table-responsive"><div class="app-grid-header "><div class="app-grid-header-inner"><table class="'+this.options.cssClassNames.gridDefault+" "+this.options.cssClassNames.grid+'" id="table_header_'+this.tableId+'"></table></div></div><div class="app-grid-content" style="height:'+this.options.height+';"><table class="'+this.options.cssClassNames.gridDefault+" "+this.options.cssClassNames.grid+'" id="table_'+this.tableId+'"></table></div></div>';this.gridContainer=$(table),this.gridElement=this.gridContainer.find(".app-grid-content table"),this.gridHeaderElement=this.gridContainer.find(".app-grid-header table"),this.element.find(".table-container").remove(),this.element.append(this.gridContainer),this.dataStatusContainer=$(statusContainer),this.gridContainer.append(this.dataStatusContainer),this._renderHeader(),this.options.filtermode===this.CONSTANTS.SEARCH?this._renderSearch():this.options.filtermode===this.CONSTANTS.MULTI_COLUMN&&this._renderRowFilter(),"condensed"===this.options.spacing&&this._toggleSpacingClasses("condensed"),this._renderGrid()},__setStatus:function(){var loadingIndicator=this.dataStatusContainer.find(".fa"),state=this.dataStatus.state;this.dataStatusContainer.find(".message").text(this.dataStatus.message),"loading"===state?loadingIndicator.show():loadingIndicator.hide(),"ready"===state?this.dataStatusContainer.hide():this.dataStatusContainer.show(),"nodata"===state||"loading"===state||"error"===state?("100%"!==this.options.height&&"auto"!==this.options.height||("nodata"===state?(this.dataStatusContainer.css("height","auto"),this.dataStatus.contentHeight=0):(this.dataStatus.height=this.dataStatus.height||this.dataStatusContainer.outerHeight(),this.dataStatus.contentHeight=this.gridElement.outerHeight()||this.dataStatus.contentHeight,this.dataStatusContainer.css("height",this.dataStatus.height>this.dataStatus.contentHeight?"auto":this.dataStatus.contentHeight))),this.gridContainer.addClass("show-msg")):this.gridContainer.removeClass("show-msg"),this.addOrRemoveScroll()},setStatus:function(state,message){this.dataStatus.state=state,this.dataStatus.message=message||this.options.dataStates[state],this._setStatusCalled?this._setStatus():(this.__setStatus(),this._setStatusCalled=!0)},setGridDimensions:function(key,value){value.indexOf("px")===-1&&value.indexOf("%")===-1&&value.indexOf("em")===-1&&"auto"!=value&&(value+="px"),this.options[key]=value,"height"===key&&(this.gridContainer.find(".app-grid-content").css(key,value),this.dataStatusContainer.css(key,value)),this.addOrRemoveScroll()},setColumnProp:function(fieldName,property,val,isGroup){var $col;switch(property){case"displayName":$col=isGroup?this.gridHeader.find('th[data-col-group="'+fieldName+'"]'):this.gridHeader.find('th[data-col-field="'+fieldName+'"]'),$col.attr("title",val),$col.find(".header-data").html(val)}},_destroy:function(){this.element.text(""),window.clearTimeout(this.refreshGridTimeout)}}),WM.module("wm.widgets.dialog").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/dialog/dialog-template.html",'<div tabindex="-1" role="dialog" class="modal default" ng-style="{display: \'block\'}" ng-click="close($event)" uib-modal-transclude></div>'),$templateCache.put("template/widget/dialog/dialog.html",'<div class="modal-dialog app-dialog" init-widget ng-style="{width: dialogWidth}" ><div class="modal-content"><div class="app-dialog-header modal-header" title="{{hint}}" ng-if="showheader"><button ng-if="closable" aria-label="Close" class="app-dialog-close close" ng-click="hideDialog()" title="Close"><span aria-hidden="true">&times;</span></button><h4 class="app-dialog-title modal-title"><i class="{{iconclass}}" ng-style="{width:iconwidth, height:iconheight, margin:iconmargin}"></i> <span name="wm-{{dialogid}}-title">{{title}}</span><span class="dialog-sub-heading" name="wm-{{dialogid}}-sub-heading" ng-if="subheading">{{subheading}}</span></h4><div class="wm-dialog-header-action" ng-if="actiontitle || actionlink"><i title="{{actiontitle}}" class="wm-icon24 help"></i><a ng-href="{{actionlink}}" target="_blank">Help</a></div></div><div class="app-dialog-body modal-body {{contentclass}}" wmtransclude apply-styles="scrollable-container" name="wm-{{dialogid}}-content"></div><div ng-transclude="footer"></div></div></div>'),$templateCache.put("template/widget/dialog/dialog-header.html",'<div data-identifier="dialog-header" class="app-dialog-header modal-header" init-widget title="{{hint}}"><button ng-if="closable" aria-label="Close" class="app-dialog-close close" ng-click="hideDialog()" title="Close"><span aria-hidden="true">&times;</span></button><h4 class="app-dialog-title modal-title"><i class="{{iconclass}}" ng-style="{width:iconwidth, height:iconheight, margin:iconmargin}"></i> <span name="wm-{{dialogid}}-title">{{caption}}</span></h4><div class="dialog-header-action" wmtransclude></div></div>'),$templateCache.put("template/widget/dialog/dialog-footer.html",'<div class="app-dialog-footer modal-footer" data-identifier="actions" init-widget wmtransclude></div>')}]).directive("wmDialog",["PropertiesFactory","WidgetUtilService","$templateCache","$compile","CONSTANTS","$window","DialogService","Utils",function(PropertiesFactory,WidgetUtilService,$templateCache,$compile,CONSTANTS,$window,DialogService,Utils){"use strict";function propertyChangeHandler(scope,element,key,newVal){switch(key){case"height":scope.content&&(newVal.indexOf("%")>0?scope.content[key]=$window.innerHeight*(window.parseInt(newVal)/100)-132:scope.content[key]=window.parseInt(newVal-122));break;case"width":CONSTANTS.isStudioMode&&(scope.dialogWidth=newVal);break;case"iconwidth":case"iconheight":case"iconmargin":case"iconclass":case"closable":scope.header[key]=newVal;break;case"title":element.removeAttr("title"),scope.header.caption=newVal}}var id,transcludedContent="",widgetProps=PropertiesFactory.getPropertiesOf("wm.designdialog",["wm.basicdialog","wm.base"]),notifyFor={width:!0,height:!0,iconname:!0,iconwidth:!0,iconheight:!0,iconmargin:!0,iconclass:!0,closable:!0,title:!0};return{restrict:"E",transclude:!!CONSTANTS.isStudioMode&&{footer:"?wmDialogactions"},controller:function($scope){this.dialogtype=$scope.dialogtype,this.register=function(name,ele){this[name]=ele.isolateScope()}},scope:{dialogtype:"@",dialogid:"@"},template:function(template,attrs){if(transcludedContent=template.html(),CONSTANTS.isRunMode){var dialog=template[0].outerHTML.replace("<wm-dialog ","<wm-dialog-container ");return dialog=dialog.replace("</wm-dialog>","</wm-dialog-container>"),transcludedContent=dialog,id=attrs.name,'<script type="text/ng-template" id="'+id+'">'+transcludedContent+"</script>"}return $templateCache.get("template/widget/dialog/dialog.html")},replace:!0,compile:function(){return{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,scope.hideDialog=function(){DialogService.hideDialog(scope.dialogid)}},post:function(scope,element,attrs){var modalWindowElScope=element.closest("[uib-modal-window]").isolateScope();CONSTANTS.isStudioMode&&element.append($compile(transcludedContent)(scope)),scope=scope||element.isolateScope(),scope.header=element.find("[data-identifier=dialog-header]").isolateScope()||{},scope.content=element.find("[data-identifier=dialog-content]").isolateScope()||{},modalWindowElScope&&element.closest("[uib-modal-window]").css({"z-index":1050+10*modalWindowElScope.index,display:"block"}),scope.propertyManager&&WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]).directive("wmDialogContainer",["$templateCache","PropertiesFactory","WidgetUtilService","CONSTANTS","$window","Utils","DialogService","DeviceService",function($templateCache,PropertiesFactory,WidgetUtilService,CONSTANTS,$window,Utils,DialogService,DeviceService){"use strict";function propertyChangeHandler(scope,element,key,newVal){switch(key){case"height":scope.content&&(newVal.indexOf("%")>0?scope.content[key]=$window.innerHeight*(window.parseInt(newVal)/100)-112:scope.content[key]=window.parseInt(newVal-112));break;case"width":scope.width&&CONSTANTS.isRunMode&&element.closest(".modal-dialog").css("width",newVal);break;case"iconwidth":case"iconheight":case"iconmargin":case"iconclass":case"closable":scope.header[key]=newVal;break;case"title":scope.header.caption=newVal}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.designdialog",["wm.basicdialog","wm.base"]),notifyFor={width:!0,height:!0,iconwidth:!0,iconheight:!0,iconmargin:!0,iconclass:!0,closable:!0,title:!0};return{restrict:"E",transclude:{footer:"?wmDialogactions"},controller:function($scope,$element){this.dialogtype=$scope.dialogtype,this.register=function(name,ele){this[name]=ele.isolateScope()};var handleEvent=function(eventName,hideDialog,callBack,callbackParams){eventName&&eventName.indexOf("(")!==-1?Utils.triggerFn(callBack,callbackParams):callBack?CONSTANTS.isStudioMode?WM.isFunction(callBack())&&Utils.triggerFn(callBack(),callbackParams):WM.isFunction(callBack)&&Utils.triggerFn(callBack,callbackParams):(_.startsWith(eventName,"Widgets.")||_.startsWith(eventName,"Variables."))&&Utils.evalExp($scope,eventName),hideDialog&&DialogService.hideDialog($scope.dialogid)};this._OkButtonHandler=function(eventName){var eventParams;eventParams=$scope.okParams&&$scope.okParams.indexOf("{")>-1?Utils.getValidJSON($scope.okParams):$scope.okParams,eventName=eventName||"",handleEvent(eventName,!0,$scope.onOk,eventParams)},this._CancelButtonHandler=function(eventName){var eventParams;eventParams=$scope.cancelParams&&$scope.cancelParams.indexOf("{")>-1?Utils.getValidJSON($scope.cancelParams):$scope.cancelParams,eventName=eventName||"",handleEvent(eventName,!0,$scope.onCancel,eventParams)},this._CloseButtonHandler=function(eventName){eventName=eventName||"",handleEvent(eventName,!0,$scope.onClose)},this._OnOpenedHandler=function(eventName){eventName=eventName||"",handleEvent(eventName,!1,$scope.onOpened)},this.onDialogOk=$scope.onOk,this.onDialogCancel=$scope.onCancel,this.onDialogClose=$scope.onClose,$element.scope().onClose=$scope.onClose,$element.scope().onOpened=$scope.onOpened},scope:{dialogid:"@",onOk:"&",onClose:"&",onCancel:"&",onOpened:"&"},template:$templateCache.get("template/widget/dialog/dialog.html"),replace:!0,compile:function(){return{pre:function(scope,element,attrs,ctrl){var backButtonListenerDeregister;scope.__readyQueue=[],scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,scope.whenReady=function(fn){scope.__readyQueue.push(fn)},scope.hideDialog=function(){ctrl._CloseButtonHandler(attrs.onClose)},scope.open=Utils.openDialog.bind(void 0,scope.dialogid),scope.close=DialogService.close.bind(void 0,scope.dialogid),backButtonListenerDeregister=DeviceService.onBackButtonTap(function(){return scope.hideDialog(),!1}),scope.$on("$destroy",function(){backButtonListenerDeregister()})},post:function(scope,element,attrs,ctrl){var modalWindowElScope=element.closest("[uib-modal-window]").isolateScope();for(scope=scope||element.isolateScope(),scope.header=element.find("[data-identifier=dialog-header]").isolateScope()||{},scope.content=element.find("[data-identifier=dialog-content]").isolateScope()||{},attrs.onOpened&&ctrl&&!scope.widgetid&&(CONSTANTS.isRunMode&&scope.whenReady?scope.whenReady(ctrl._OnOpenedHandler.bind(void 0,attrs.onOpened)):ctrl._OnOpenedHandler(attrs.onOpened)),modalWindowElScope&&element.closest("[uib-modal-window]").css({"z-index":1050+10*modalWindowElScope.index,display:"block"}),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs);scope.__readyQueue.length;)Utils.triggerFn(scope.__readyQueue.shift())}}}}}]).directive("wmDialogheader",["PropertiesFactory","WidgetUtilService","$templateCache","CONSTANTS","Utils",function(PropertiesFactory,WidgetUtilService,$templateCache,CONSTANTS,Utils){"use strict";function propertyChangeHandler(scope,key,newVal){var defaultHeight="21px";switch(key){case"iconclass":scope.iconurl&&""!==newVal&&"_none_"!==newVal?(scope.iconurl="",scope.iconwidth=scope.iconheight=defaultHeight):scope.iconurl||""===newVal||"_none_"===newVal?scope.iconwidth=scope.iconheight="":scope.iconwidth=scope.iconheight=defaultHeight}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.dialog.dialogheader",["wm.base"]),notifyFor={iconclass:!0,caption:!0};return{restrict:"E",replace:!0,transclude:!0,controller:"DialogController",scope:{},template:$templateCache.get("template/widget/dialog/dialog-header.html"),compile:function(){return{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs,dialogCtrl){var parentEl,onCloseEventName,onOpenedEventName,parentElScope;parentEl=element.closest(".app-dialog"),parentElScope=parentEl.isolateScope(),scope.onClose=parentElScope.onClose,scope.onOpened=parentElScope.onOpened,scope.dialogid=parentEl.attr("dialogid"),element.scope().dialogid=scope.dialogid,onCloseEventName=parentEl.attr("on-close"),onOpenedEventName=parentEl.attr("on-opened"),scope.hideDialog=function(){dialogCtrl&&dialogCtrl._CloseButtonHandler(onCloseEventName)},onOpenedEventName&&dialogCtrl&&!scope.widgetid&&(CONSTANTS.isRunMode&&parentElScope.whenReady?parentElScope.whenReady(dialogCtrl._OnOpenedHandler.bind(void 0,onOpenedEventName)):dialogCtrl._OnOpenedHandler(onOpenedEventName)),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]).directive("wmDialogactions",["PropertiesFactory","WidgetUtilService","$templateCache","DialogService","Utils",function(PropertiesFactory,WidgetUtilService,$templateCache,DialogService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.dialog.dialogactions",["wm.base"]);return{restrict:"E",replace:!0,transclude:!0,scope:{},template:$templateCache.get("template/widget/dialog/dialog-footer.html"),compile:function(){return{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(iScope,element,attrs){var parentEl,scope;parentEl=element.closest(".app-dialog"),scope=element.scope(),scope.dialogid=parentEl.attr("dialogid"),scope.closeDialog=function(){DialogService.hideDialog(scope.dialogid)},WidgetUtilService.postWidgetCreate(iScope,element,attrs)}}}}}]),WM.module("wm.widgets.dialog").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/dialog/alertdialog.html",'<div class="app-dialog modal-dialog app-alert-dialog" ng-class="{type:type}" dialogclass init-widget apply-styles="container"><div class="modal-content"><wm-dialogheader iconclass="{{iconclass}}" iconwidth="{{iconwidth}}" iconheight="{{iconheight}}" iconmargin="{{iconmargin}}" caption="{{title}}"></wm-dialogheader><div class="app-dialog-body modal-body" apply-styles="scrollable-container"><p class="app-dialog-message text-{{alerttype}}"> {{message}}</p></div><div class="app-dialog-footer modal-footer"><wm-button  class="btn-primary"  caption={{oktext}} on-click="okButtonHandler()"></wm-button></div></div></div>')}]).directive("wmAlertdialog",["$templateCache","PropertiesFactory","WidgetUtilService","CONSTANTS","Utils","$window","DeviceService",function($templateCache,PropertiesFactory,WidgetUtilService,CONSTANTS,Utils,$window,DeviceService){"use strict";function propertyChangeHandler(scope,element,attrs,key,newVal){switch(key){case"height":scope.height&&(newVal.indexOf("%")>0?scope.bodyHeight=$window.innerHeight*(parseInt(newVal,10)/100)-112:scope.bodyHeight=parseInt(newVal-112,10));break;case"message":attrs.notificationdialog&&(scope.message=attrs.message||"Alert Notification Message");break;case"width":newVal&&element.closest(".modal-dialog").css("width",newVal);break;case"title":attrs.notificationdialog&&(scope.title=attrs.title||"Alert")}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.alertdialog",["wm.basicdialog","wm.base","wm.dialog.onOk"]),notifyFor={
message:!0,oktext:!0,height:!0,width:!0,type:!0};return{restrict:"E",controller:"DialogController",scope:{dialogid:"@",onOk:"&",onClose:"&"},replace:!0,template:function(template,attrs){if(void 0===template.attr("inscript")&&template.attr("inscript",!1),CONSTANTS.isRunMode&&"false"===template.attr("inscript")){template.attr("inscript",!0);var transcludedContent=template[0].outerHTML,id=attrs.name;return'<script backdrop="static" type="text/ng-template" id="'+id+'">'+transcludedContent+"</script>"}return $templateCache.get("template/widget/dialog/alertdialog.html")},link:{pre:function(iScope,element,attrs){if(iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,attrs.widgetid&&attrs.notificationdialog){var wp=iScope.widgetProps;_.keys(wp).forEach(function(propName){"class"!==propName&&(wp[propName].disabled=!0)})}},post:function(scope,element,attrs,dialogCtrl){var backButtonListenerDeregister,modalWindowElScope=element.closest("[uib-modal-window]").isolateScope();CONSTANTS.isRunMode&&element.attr("inscript")&&(backButtonListenerDeregister=DeviceService.onBackButtonTap(function(){return dialogCtrl._CancelButtonHandler(),!1}),scope.$on("$destroy",function(){backButtonListenerDeregister()})),scope.okButtonHandler||(scope.okButtonHandler=function(){dialogCtrl._OkButtonHandler(attrs.onOk)}),modalWindowElScope&&element.closest("[uib-modal-window]").css({"z-index":1050+10*modalWindowElScope.index,display:"block"}),scope.propertyManager&&WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element,attrs),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.dialog").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/dialog/confirmdialog.html",'<div class="app-dialog modal-dialog app-confirm-dialog" dialogclass init-widget apply-styles="container"><div class="modal-content"><wm-dialogheader caption="{{title}}" iconclass="{{iconclass}}" iconwidth="{{iconwidth}}" iconheight="{{iconheight}}" iconmargin="{{iconmargin}}"></wm-dialogheader><div class="app-dialog-body modal-body" apply-styles="scrollable-container"><p class="app-dialog-message {{messageclass}}"> {{message}}</p></div><div class="app-dialog-footer modal-footer"><wm-button class="btn-secondary" name="{{dialogid}}-cancel" caption={{canceltext}} on-click="cancelButtonHandler()"></wm-button><wm-button class="btn-primary" name="{{dialogid}}-ok" caption={{oktext}} on-click="okButtonHandler()"></wm-button></div></div></div>')}]).directive("wmConfirmdialog",["$templateCache","PropertiesFactory","WidgetUtilService","CONSTANTS","Utils","$window","DeviceService",function($templateCache,PropertiesFactory,WidgetUtilService,CONSTANTS,Utils,$window,DeviceService){"use strict";function propertyChangeHandler(scope,element,attrs,key,newVal){switch(key){case"height":scope.height&&(newVal.indexOf("%")>0?scope.bodyHeight=$window.innerHeight*(parseInt(newVal,10)/100)-112:scope.bodyHeight=parseInt(newVal-112,10));break;case"message":attrs.notificationdialog&&(scope.message=attrs.message||"Confirm Notification Message");break;case"width":newVal&&element.closest(".modal-dialog").css("width",newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.confirmdialog",["wm.basicdialog","wm.base","wm.dialog.onOk"]),notifyFor={message:!0,oktext:!0,canceltext:!0,height:!0,width:!0};return{restrict:"E",controller:"DialogController",scope:{dialogid:"@",onOk:"&",onClose:"&",onCancel:"&",okParams:"@"},replace:!0,template:function(template,attrs){if(void 0===template.attr("inscript")&&template.attr("inscript",!1),CONSTANTS.isRunMode&&"false"===template.attr("inscript")){template.attr("inscript",!0);var transcludedContent=template[0].outerHTML,id=attrs.name;return'<script backdrop="static" type="text/ng-template" id="'+id+'" modal="true" keyboard="false">'+transcludedContent+"</script>"}return $templateCache.get("template/widget/dialog/confirmdialog.html")},link:{pre:function(iScope,element,attrs){if(iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,attrs.widgetid&&attrs.notificationdialog){var wp=iScope.widgetProps;_.keys(wp).forEach(function(propName){"class"!==propName&&(wp[propName].disabled=!0)})}},post:function(scope,element,attrs,dialogCtrl){var backButtonListenerDeregister,modalWindowElScope=element.closest("[uib-modal-window]").isolateScope();scope.cancelButtonHandler||(scope.cancelButtonHandler=function(){dialogCtrl._CancelButtonHandler(attrs.onCancel)}),scope.okButtonHandler||(scope.okButtonHandler=function(){dialogCtrl._OkButtonHandler(attrs.onOk)}),CONSTANTS.isRunMode&&element.attr("inscript")&&(backButtonListenerDeregister=DeviceService.onBackButtonTap(function(){return scope.cancelButtonHandler(),!1}),scope.$on("$destroy",function(){backButtonListenerDeregister()})),scope.okbuttonclass&&WM.element(element.find("button")[1]).addClass(scope.okbuttonclass),scope.cancelbuttonclass&&WM.element(element.find("button")[0]).addClass(scope.cancelbuttonclass),modalWindowElScope&&element.closest("[uib-modal-window]").css({"z-index":1050+10*modalWindowElScope.index,display:"block"}),scope.propertyManager&&WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element,attrs),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.dialog").controller("DialogController",function($scope,DialogService,Utils,$rootScope,CONSTANTS){"use strict";var handleEvent=function(eventName,hideDialog,callBack,callbackParams){eventName&&eventName.indexOf("(")!==-1?Utils.triggerFn(callBack,callbackParams):callBack?CONSTANTS.isStudioMode?WM.isFunction(callBack())&&Utils.triggerFn(callBack(),callbackParams):WM.isFunction(callBack)&&Utils.triggerFn(callBack,callbackParams):(_.startsWith(eventName,"Widgets.")||_.startsWith(eventName,"Variables."))&&Utils.evalExp($scope,eventName),hideDialog&&DialogService.hideDialog($scope.dialogid)};$scope.open=Utils.openDialog.bind(void 0,$scope.dialogid),$scope.close=DialogService.close.bind(void 0,$scope.dialogid),this._OkButtonHandler=function(eventName){var eventParams;eventParams=$scope.okParams&&$scope.okParams.indexOf("{")>-1?Utils.getValidJSON($scope.okParams):$scope.okParams,eventName=eventName||"",handleEvent(eventName,!0,$scope.onOk,eventParams)},this._CancelButtonHandler=function(eventName){var eventParams;eventParams=$scope.cancelParams&&$scope.cancelParams.indexOf("{")>-1?Utils.getValidJSON($scope.cancelParams):$scope.cancelParams,eventName=eventName||"",handleEvent(eventName,!0,$scope.onCancel,eventParams)},this._CloseButtonHandler=function(eventName){eventName=eventName||"",handleEvent(eventName,!0,$scope.onClose)},this._OnOpenedHandler=function(eventName){eventName=eventName||"",handleEvent(eventName,!1,$scope.onOpened)}}),WM.module("wm.widgets.dialog").controller("NotificationDialogController",["$scope","dialogParams","Utils",function($scope,dialogParams,Utils){"use strict";$scope.notification={},dialogParams.notificationDetails&&($scope.notification.text=dialogParams.notificationDetails.text,$scope.notification.title=dialogParams.notificationDetails.title,$scope.notification.okButtonText=dialogParams.notificationDetails.okButtonText||"OK",$scope.notification.cancelButtonText=dialogParams.notificationDetails.cancelButtonText||"CANCEL",$scope.notification.alerttype=dialogParams.notificationDetails.alerttype||"information"),$scope.variableOnOk=function(){Utils.triggerFn(dialogParams.onOk)},$scope.variableOnClose=function(){Utils.triggerFn(dialogParams.onClose)},$scope.variableOnCancel=function(){Utils.triggerFn(dialogParams.onCancel)}}]),WM.module("wm.widgets.dialog").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/dialog/iframedialog.html",'<div class="app-dialog modal-dialog app-iframe-dialog" dialogclass init-widget><div class="modal-content"><wm-dialogheader iconclass="{{iconclass}}" closable="{{closable}}"  iconwidth="{{iconwidth}}" iconheight="{{iconheight}}" iconmargin="{{iconmargin}}" caption="{{title}}" ng-if="showheader"></wm-dialogheader><div class="app-dialog-body modal-body" apply-styles="scrollable-container"><wm-iframe encodeurl="{{encodeurl}}" iframesrc="{{iframeurl}}" height="100%" width="100%" hint="{{hint}}"></wm-iframe></div><div class="app-dialog-footer modal-footer" ng-if="showactions"><wm-button class="btn-primary" caption={{oktext}} on-click="okButtonHandler()"></wm-button></div></div></div>')}]).directive("wmIframedialog",["$templateCache","PropertiesFactory","WidgetUtilService","CONSTANTS","$sce","$window","Utils",function($templateCache,PropertiesFactory,WidgetUtilService,CONSTANTS,$sce,$window,Utils){"use strict";function propertyChangeHandler(scope,element,key,newVal){switch(key){case"url":scope.iframeurl=$sce.trustAsResourceUrl(newVal);break;case"width":newVal&&element.closest(".modal-dialog").css("width",newVal);break;case"height":scope.height&&(newVal.indexOf("%")>0?scope.bodyHeight=$window.innerHeight*(parseInt(newVal,10)/100)-112:scope.bodyHeight=parseInt(newVal-112,10))}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.iframedialog",["wm.basicdialog","wm.base","wm.dialog.onOk"]),notifyFor={url:!0,height:!0,width:!0};return{restrict:"E",controller:"DialogController",scope:{dialogid:"@",onOk:"&",onClose:"&"},replace:!0,template:function(template,attrs){if(void 0===template.attr("inscript")&&template.attr("inscript",!1),CONSTANTS.isRunMode&&"false"===template.attr("inscript")){template.attr("inscript",!0);var transcludedContent=template[0].outerHTML,id=attrs.name;return'<script backdrop="static" type="text/ng-template" id="'+id+'">'+transcludedContent+"</script>"}return $templateCache.get("template/widget/dialog/iframedialog.html")},link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs,dialogCtrl){scope.okButtonHandler||(scope.okButtonHandler=function(){dialogCtrl._OkButtonHandler(attrs.onOk)}),scope.propertyManager&&WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.dialog").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/dialog/pagedialog.html",'<div class="app-dialog modal-dialog app-page-dialog" dialogclass init-widget page-container><div class="modal-content"><wm-dialogheader iconclass={{iconclass}} closable="{{closable}}" caption={{title}} iconwidth={{iconwidth}} iconheight={{iconheight}} iconmargin={{iconmargin}}></wm-dialogheader><div class="app-dialog-body modal-body" apply-styles="scrollable-container" page-container-target wmtransclude></div><div class="app-dialog-footer modal-footer" ng-if="showactions"><wm-button  class="btn-primary" caption={{oktext}} on-click="okButtonHandler()"></wm-button></div></div></div>')}]).directive("wmPagedialog",["$templateCache","PropertiesFactory","WidgetUtilService","CONSTANTS","Utils","$window",function($templateCache,PropertiesFactory,WidgetUtilService,CONSTANTS,Utils,$window){"use strict";function propertyChangeHandler(scope,element,key,newVal){switch(key){case"height":scope.height&&(newVal.indexOf("%")>0?scope.bodyHeight=$window.innerHeight*(parseInt(newVal,10)/100)-112:scope.bodyHeight=parseInt(newVal-112,10));break;case"width":newVal&&element.closest(".modal-dialog").css("width",newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.pagedialog",["wm.basicdialog","wm.base","wm.dialog.onOk"]),notifyFor={height:!0,width:!0};return{restrict:"E",replace:!0,scope:{dialogid:"@"},transclude:CONSTANTS.isStudioMode,template:function(template,attrs){if(void 0===template.attr("inscript")&&template.attr("inscript",!1),CONSTANTS.isRunMode&&"false"===template.attr("inscript")){template.attr("inscript",!0);var transcludedContent=template[0].outerHTML.replace("<wm-pagedialog ","<wm-pagedialog-container "),id=attrs.name;return transcludedContent=transcludedContent.replace("</<wm-pagedialog>","</<wm-pagedialog-container>"),'<script backdrop="static" type="text/ng-template" id="'+id+'">'+transcludedContent+"</script>"}return $templateCache.get("template/widget/dialog/pagedialog.html")},link:{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.propertyManager&&WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]).directive("wmPagedialogContainer",["$templateCache","PropertiesFactory","WidgetUtilService","CONSTANTS","Utils","$window",function($templateCache,PropertiesFactory,WidgetUtilService,CONSTANTS,Utils,$window){"use strict";function propertyChangeHandler(scope,element,key,newVal){switch(key){case"height":scope.height&&(newVal.indexOf("%")>0?scope.bodyHeight=$window.innerHeight*(parseInt(newVal,10)/100)-112:scope.bodyHeight=parseInt(newVal-112,10));break;case"width":newVal&&element.closest(".modal-dialog").css("width",newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.pagedialog",["wm.basicdialog","wm.base","wm.dialog.onOk"]),notifyFor={height:!0,width:!0};return{restrict:"E",transclude:!0,controller:"DialogController",scope:{dialogid:"@",onOk:"&",onClose:"&"},replace:!0,template:$templateCache.get("template/widget/dialog/pagedialog.html"),link:{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs,dialogCtrl){scope.okButtonHandler||(scope.okButtonHandler=function(){dialogCtrl._OkButtonHandler(attrs.onOk)}),scope.propertyManager&&WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.dialog").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/dialog/logindialog.html",'<div class="app-dialog modal-dialog app-login-dialog" ng-style="{width: width}" init-widget><div class="modal-content"><wm-dialogheader iconclass="{{iconclass}}" caption="{{title}}"></wm-dialogheader><div class="app-dialog-body modal-body" wmtransclude></div></div></div>'),$templateCache.put("template/widget/dialog/logindialogcontainer.html","<div wmtransclude></div>")}]).directive("wmLogindialog",["PropertiesFactory","WidgetUtilService","$templateCache","$compile","CONSTANTS","Utils",function(PropertiesFactory,WidgetUtilService,$templateCache,$compile,CONSTANTS,Utils){"use strict";var id,transcludedContent="",widgetProps=PropertiesFactory.getPropertiesOf("wm.logindialog",["wm.basicdialog","wm.base","wm.base.events.successerror"]);return{restrict:"E",transclude:CONSTANTS.isStudioMode,scope:{dialogid:"@"},template:function(template,attrs){if(transcludedContent=template.html(),CONSTANTS.isRunMode){var dialogEle=WM.element(template[0].outerHTML),onsubmit=dialogEle.attr("on-submit")||"",onsuccess=dialogEle.attr("on-success")||"",onerror=dialogEle.attr("on-error")||"",dialog=template[0].outerHTML.replace("<wm-logindialog ",'<wm-dialog-container class="app-login-dialog" ');return dialog=dialog.replace("</wm-logindialog>","</wm-dialog-container>"),dialog='<wm-logindialog-container on-submit="'+onsubmit+'" on-success="'+onsuccess+'" on-error="'+onerror+'">'+dialog+"</wm-logindialog-container>",transcludedContent=dialog,id=attrs.name,'<script type="text/ng-template" id="'+id+'" login-dialog="true">'+transcludedContent+"</script>"}return $templateCache.get("template/widget/dialog/logindialog.html")},replace:!0,link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs){CONSTANTS.isStudioMode&&$el.append($compile(transcludedContent)($is)),$is=$is||$el.isolateScope(),$is.header=$el.find("[data-identifier=dialog-header]").isolateScope()||{},$is.content=$el.find("[data-identifier=dialog-content]").isolateScope()||{},attrs.title&&!$is.header.caption&&($is.header.caption=attrs.title),attrs.iconclass&&!$is.header.iconclass&&($is.header.iconclass=attrs.iconclass),WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]).directive("wmLogindialogContainer",["$templateCache","PropertiesFactory","WidgetUtilService","SecurityService","Utils","CONSTANTS","$window","$timeout",function($templateCache,PropertiesFactory,WidgetUtilService,SecurityService,Utils,CONSTANTS,$window,$timeout){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.logindialog",["wm.base"]);return{restrict:"E",transclude:!0,scope:{dialogid:"@",onSubmit:"&",onSuccess:"&",onError:"&"},template:$templateCache.get("template/widget/dialog/logindialogcontainer.html"),replace:!0,link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs){function onSuccess(event){$el.trigger("success"),$is.onSuccess({$event:event,$scope:$is})}function onError(event,error){$is.loginMessage=$is.$parent.loginMessage={type:"error",caption:$is.errormessage||error},$el.trigger("error"),$is.onError({$event:event,$scope:$is})}var submitFn,loginBtn,loginBtnClickFn,lastLoggedinUser,$s=$el.scope();CONSTANTS.isRunMode&&(submitFn=attrs.onSubmit||"",loginBtn=$el.find('[role*="loginbutton"]'),loginBtn.length||(loginBtn=$el.find('.app-button[name="loginbutton"]')),loginBtnClickFn=loginBtn.length?loginBtn.isolateScope().onClick||"":"",$is.doLogin=function(event){var rememberMeElement,rememberMe,loginDetails,curUser=$el.find('[name="usernametext"]').val(),password=$el.find('[name="passwordtext"]').val();$is.loginMessage=$is.$parent.loginMessage=null,rememberMeElement=$el.find('.app-checkbox [name="remembermeCheck"]'),rememberMeElement.length||(rememberMeElement=$el.find('.app-checkbox [name="remembermecheck"]')),rememberMeElement.length&&(rememberMe=rememberMeElement.val()),submitFn||loginBtnClickFn?(loginBtnClickFn&&loginBtnClickFn({$event:event,$scope:$is}),_.startsWith(submitFn,"Variables.")?$is.$root.$emit("invoke-service",submitFn,{scope:$s,mode:"dialog"},onSuccess.bind(void 0,event),onError.bind(void 0,event)):submitFn.indexOf("(")!==-1&&$is.onSubmit({$event:event,$scope:$is})):(lastLoggedinUser=SecurityService.getLastLoggedInUser(),loginDetails={username:curUser,password:password,rememberme:rememberMe},$s.Variables.loginVariable.login({loginInfo:loginDetails,mode:"dialog"},function(){lastLoggedinUser&&curUser!==lastLoggedinUser&&($window.location=$window.location.pathname),Utils.triggerFn(onSuccess,event)},onError.bind(void 0,event)))},loginBtn.unbind("click"),loginBtn.click($is.doLogin.bind(void 0)),$el.find(".app-textbox").keypress(function(evt){evt.stopPropagation(),"ENTER"===Utils.getActionFromKey(evt)&&$timeout(function(){$is.doLogin(evt)})})),WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]),WM.module("wm.widgets.dialog").service("DialogService",["$rootScope","$uibModal","CONSTANTS","$uibModalStack",function($rootScope,$uibModal,CONSTANTS,$uibModalStack){"use strict";function closePopover(){WM.element(".app-popover").remove()}function showDialog(dialogId,params){if(!(!dialogId||$uibModalInstances&&$uibModalInstances[dialogId])){closePopover();var backdrop,keyboard,windowClass,modal,template=WM.element("script[id="+dialogId+"]"),controller=template.attr("controller"),content=template.html(),dialogContainer=WM.element("<div></div>").html(content);modal=template.attr("modal"),backdrop="true"!==modal||"static",keyboard=template.attr("keyboard"),keyboard="false"!==keyboard,params||(params={}),windowClass=dialogContainer.find("wm-dialog, wm-alertdialog, wm-confirmdialog, wm-pagedialog, wm-iframedialog, wm-logindialog").attr("dialogclass"),windowClass||(windowClass=(dialogContainer.find("wm-dialog-container").attr("dialogclass")||"")+(template.parent().attr("theme")||"")+" default"),dialogContainer.find("wm-dialog, wm-dialog-container, wm-pagedialog-container, wm-alertdialog, wm-confirmdialog, wm-pagedialog, wm-iframedialog, wm-logindialog").attr({controller:controller,dialogid:dialogId}),content=dialogContainer.html(),dialogContainer=null,$uibModalInstances[dialogId]=$uibModal.open({template:content,controller:controller||dialogId+"Controller",backdrop:backdrop,keyboard:keyboard,windowTemplateUrl:"template/widget/dialog/dialog-template.html",resolve:params.resolve||null,scope:params.scope||(CONSTANTS.isStudioMode?$rootScope:WM.element("[data-ng-controller='AppController']").scope()),windowClass:windowClass||params.windowClass||""}),$uibModalInstances[dialogId].result.then(null,function(){$uibModalInstances[dialogId].scope&&$uibModalInstances[dialogId].scope.$destroy(),$uibModalInstances[dialogId]=null}),$uibModalInstances[dialogId].opened.then(function(){var dialogCtrlScope=$uibModalStack.getTop().value.modalScope,onCloseFn=params.onClose;params._props&&(onCloseFn=params._props.onClose,WM.extend(dialogCtrlScope,params._props)),$uibModalInstances[dialogId].scope=dialogCtrlScope,dialogCtrlScope&&WM.isFunction(onCloseFn)&&dialogCtrlScope.$on("$destroy",onCloseFn),WM.isFunction(params.onOpen)&&params.onOpen($uibModalInstances[dialogId].scope)}),openDialogIds.push(dialogId)}}function _closeDialog(dialogId){closePopover();var dialogRef=openDialogIds.indexOf(dialogId);dialogRef!==-1&&openDialogIds.splice(dialogRef,1)}function hideDialog(dialogId){!dialogId||$uibModalInstances&&!$uibModalInstances[dialogId]||(closePopover(),$uibModalInstances[dialogId].close(),$uibModalInstances[dialogId].scope&&$uibModalInstances[dialogId].scope.$destroy(),$uibModalInstances[dialogId]=null,_closeDialog(dialogId))}function showConfirmDialog(params){var template,controller,content,backdrop,keyboard,windowClass,dialogCaption,dialogContainer,confirmDialog,dialogId=params.dialogId||"global-confirm-dialog";$uibModalInstances&&$uibModalInstances[dialogId]||(closePopover(),template=WM.element("script[id="+dialogId+"]"),controller=params.controller,content=template.html(),dialogContainer=WM.element("<div></div>").html(content),dialogCaption=$rootScope.locale?$rootScope.locale[params.caption]||params.caption:params.caption,backdrop=params.backdrop||template.attr("backdrop"),"static"!==backdrop&&("false"===backdrop?backdrop=!1:"true"!==backdrop&&"undefined"!==backdrop||(backdrop=!0)),keyboard=params.keyboard||template.attr("keyboard"),"false"===keyboard?keyboard=!1:"true"!==keyboard&&"undefined"!==keyboard||(keyboard=!0),params||(params={}),windowClass=dialogContainer.find("wm-confirmdialog").attr("dialogclass"),windowClass||(windowClass=(dialogContainer.find("wm-dialog-container").attr("dialogclass")||"")+(template.parent().attr("theme")||"")+" default"),confirmDialog=dialogContainer.find("wm-confirmdialog"),confirmDialog.attr({controller:controller,dialogid:dialogId,title:dialogCaption,message:$rootScope.locale?$rootScope.locale[params.content]||params.content:params.content,messageclass:params.contentClass||"",iconname:params.iconName||"",iconclass:params.iconClass||"",oktext:params.oktext||$rootScope.locale?$rootScope.locale.LABEL_OK:"OK",canceltext:params.canceltext||$rootScope.locale?$rootScope.locale.LABEL_CANCEL:"CANCEL"}),params.onOk&&confirmDialog.attr("on-ok",params.onOk),params.onCancel&&confirmDialog.attr("on-cancel",params.onCancel),params.onClose&&confirmDialog.attr("on-close",params.onClose),params.okParams&&confirmDialog.attr("ok-params",params.okParams),params.cancelParams&&confirmDialog.attr("cancel-params",params.cancelParams),content=dialogContainer.html(),dialogContainer=null,$uibModalInstances[dialogId]=$uibModal.open({template:content,controller:controller||dialogId+"Controller",backdrop:backdrop,keyboard:keyboard,resolve:params.resolve||null,scope:params.scope||$rootScope,windowClass:windowClass||params.windowClass||"",windowTemplateUrl:"template/widget/dialog/dialog-template.html"}),$uibModalInstances[dialogId].result.then(null,function(){var dialogScope=$uibModalInstances[dialogId].scope;dialogScope.onClose&&dialogScope.onClose(),$uibModalInstances[dialogId]=null}),$uibModalInstances[dialogId].opened.then(function(){$uibModalInstances[dialogId].scope=$uibModalStack.getTop().value.modalScope}),openDialogIds.push(dialogId))}function closeAllDialogs(){var index;for(closePopover(),index=0;index<openDialogIds.length;index+=1)hideDialog(openDialogIds[index])}function open(dialogId,parentScope,properties){var obj={scope:parentScope,_props:properties};closePopover(),showDialog(dialogId,obj)}function _showAppConfirmDialog(params){params=params||{},params.controller="AppConfirmDialogController",params.dialogId="_app-confirm-dialog",params.onOk="confirmDialogActionOk()",params.onCancel="confirmDialogActionCancel()",showConfirmDialog(params)}var $uibModalInstances={},openDialogIds=[];this.open=open,this.close=hideDialog,this.hideDialog=hideDialog,this.showDialog=showDialog,this.showConfirmDialog=showConfirmDialog,this._showAppConfirmDialog=_showAppConfirmDialog,this.closeAllDialogs=closeAllDialogs}]).controller("AppConfirmDialogController",["$scope","confirmActionOk","confirmActionCancel","DialogService","Utils",function($scope,confirmActionOk,confirmActionCancel,DialogService,Utils){"use strict";$scope.confirmDialogActionOk=function(){Utils.triggerFn(confirmActionOk),DialogService.close("_app-confirm-dialog")},$scope.confirmDialogActionCancel=function(){Utils.triggerFn(confirmActionCancel),DialogService.close("_app-confirm-dialog")},$scope.onClose=$scope.confirmDialogActionCancel}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/button.html",'<button class="btn app-button" init-widget apply-styles role="input"><img data-identifier="img" class="button-image-icon" ng-src="{{iconsrc}}" ng-if="iconsrc" ng-style="{width:iconwidth ,height:iconheight, margin:iconmargin}"/><i class="app-icon {{iconclass}}" ng-style="{width:iconwidth, height:iconheight, margin:iconmargin, fontSize:iconwidth}" ng-if="showicon"></i> <span class="btn-caption"></span><span ng-if="badgevalue" class="badge pull-right">{{badgevalue}}</span></button>')}]).directive("wmButton",["PropertiesFactory","WidgetUtilService","Utils",function(PropertiesFactory,WidgetUtilService,Utils){"use strict";function propertyChangeHandler(scope,element,attrs,key,newVal){switch(key){case"iconposition":element.attr("icon-position",newVal);break;case"iconclass":scope.showicon="_none_"!==scope.iconclass&&""!==newVal&&!scope.iconurl;break;case"iconurl":scope.showicon=""===newVal,scope.iconsrc=Utils.getImageUrl(newVal);break;case"caption":Utils.setNodeContent(element.children(".btn-caption"),newVal);break;case"hint":attrs.$set("title",newVal);break;case"disabled":element[0].disabled=newVal;break;case"shortcutkey":attrs.$set("accesskey",newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.button",["wm.base","wm.base.advancedformwidgets","wm.base.events","wm.base.events.focus","wm.base.events.keyboard"]),notifyFor={iconclass:!0,iconurl:!0,caption:!0,iconposition:!0,hint:!0,disabled:!0,shortcutkey:!0};return{restrict:"E",replace:!0,scope:{},template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/widget/form/button.html"),compile:function(tElement){return{pre:function(scope,element,attrs){!attrs.iconclass&&attrs.iconname&&(WM.element(tElement.context).attr("iconclass","glyphicon glyphicon-"+attrs.iconname),attrs.iconclass="glyphicon glyphicon-"+attrs.iconname),scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element,attrs),scope,notifyFor),scope.reset=function(){},WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/button-group.html",'<div class="btn-group app-button-group" wmtransclude init-widget ng-class=\'{"btn-group-vertical": vertical}\' apply-styles="container" title="{{hint}}" role="input"></div>')}]).directive("wmButtongroup",["$templateCache","PropertiesFactory","WidgetUtilService","Utils",function($templateCache,PropertiesFactory,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.buttongroup",["wm.base"]);return{restrict:"E",replace:!0,scope:{},template:$templateCache.get("template/widget/form/button-group.html"),transclude:!0,link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.reset=function(){},WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/switch.html",'<div class="app-switch" init-widget has-model apply-styles role="input" listen-property="dataset"><div class="btn-group btn-group-justified"><a title="{{opt[displayfield || \'label\']}}" focus-target href="javascript:void(0);" role="button" class="btn btn-default" name="wm-switch-{{opt}}" ng-disabled="disabled"  ng-repeat="opt in options track by $index" ng-class="{\'selected\': selected.index === $index}" ng-click="selectOpt($event, $index)">{{opt[displayfield] || opt["label"]}}</a></div><span title="{{options[selected.index][displayfield || \'label\'] || _model_}}" class="btn btn-primary app-switch-overlay switch-handle" >{{options[selected.index][displayfield || "label"] || _model_}}</span><input name={{name}} class="model-holder ng-hide" ng-disabled="disabled" value="{{_model_}}"  ng-required="required"></div>')}]).directive("wmSwitch",["PropertiesFactory","WidgetUtilService","FormWidgetUtils","Utils","LiveWidgetUtils",function(PropertiesFactory,WidgetUtilService,FormWidgetUtils,Utils,LiveWidgetUtils){"use strict";function trim(str){return WM.isString(str)?str.trim():str}function toOptionsObjFromString(str){return{value:str,label:str}}function setSelectedValue(scope){var options=scope.options;WM.isDefined(scope._model_)?options.some(function(opt,index){if(_.isEqual(scope._model_,opt)||scope._model_===opt[scope.datafield]||scope._model_===opt.value)return scope.selected.index=index,!0}):scope.options&&scope.options.length?scope.selectOptAtIndex(0):scope.selected.index=-1}function updateHighlighter(scope,element,skipAnimation){var left,handler=element.find("span.app-switch-overlay"),index=scope.selected.index;void 0!==index&&null!==index||(index=-1),left=index*scope.btnwidth,skipAnimation?handler.css("left",left+"%"):handler.animate({left:left+"%"},300)}function updateSwitchOptions(scope,element,dataset){var options=[];scope.selected.index=-1,scope.datasetType=NONE,dataset=dataset?dataset.data||dataset:[],WM.isString(dataset)?(options=dataset.split(",").map(trim).map(toOptionsObjFromString),scope.datasetType=COMMA_SEP_STRING):WM.isObject(dataset)&&WM.isArray(dataset)&&(dataset=FormWidgetUtils.getOrderedDataSet(dataset,scope.orderby),WM.isString(dataset[0])?(options=dataset.map(trim).map(toOptionsObjFromString),scope.datasetType=ARRAY_STRINGS):WM.isObject(dataset[0])&&!WM.isArray(dataset[0])&&(options=dataset,scope.datasetType=ARRAY_OBJECTS)),options.length&&(scope.btnwidth=100/options.length,element.find(".app-switch-overlay").css("width",scope.btnwidth+"%")),scope.options=options,setSelectedValue(scope),updateHighlighter(scope,element,!0)}function propertyChangeHandler(scope,element,key,newVal){switch(key){case"dataset":updateSwitchOptions(scope,element,newVal);break;case"height":element.css("overflow",newVal?"auto":"")}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.switch",["wm.base","wm.base.editors.abstracteditors"]),notifyFor={dataset:!0,height:!0},COMMA_SEP_STRING=1,ARRAY_STRINGS=2,ARRAY_OBJECTS=3,NONE=0;return{restrict:"E",
replace:!0,scope:{scopedataset:"=?"},template:function(tElement,tAttrs){var template=WM.element(WidgetUtilService.getPreparedTemplate("template/widget/form/switch.html",tElement,tAttrs));return template[0].outerHTML},link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.options=[],scope.selectOptAtIndex=function($index){var opt=scope.options[$index];scope.datasetType===ARRAY_OBJECTS?scope.datafield&&("All Fields"===scope.datafield?scope._model_=opt:scope._model_=opt[scope.datafield]):scope._model_=opt.value},scope.selectOpt=function($event,$index){if($event.preventDefault(),!scope.disabled){if(scope.selected.index===$index){if(2!==scope.options.length)return;$index=1===$index?0:1}scope.selected.index=$index,scope.selectOptAtIndex($index),updateHighlighter(scope,element),scope._onChange($event)}},scope.$watch("_model_",function(){setSelectedValue(scope),updateHighlighter(scope,element,!0)}),scope.selected={},scope.reset=function(){scope.options.length>0&&(scope.datavalue=scope.options[0].value,scope.selected.index=0)},WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),WidgetUtilService.postWidgetCreate(scope,element,attrs),!attrs.widgetid&&attrs.scopedataset&&scope.$watch("scopedataset",function(newVal){updateSwitchOptions(scope,element,newVal)}),!attrs.widgetid&&_.includes(scope.binddataset,"selecteditem.")&&LiveWidgetUtils.fetchDynamicData(scope,element.scope(),function(data){updateSwitchOptions(scope,element,data)})}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/menu.html",'<div class="dropdown app-menu" init-widget uib-dropdown auto-close="{{autoclose}}" role="input" listen-property="dataset" tabindex="-1"><button title="{{hint}}" class="btn app-button dropdown-toggle {{menuclass}}" uib-dropdown-toggle apply-styles focus-target accesskey="{{::shortcutkey}}"><i class="app-icon {{iconclass}}"></i> <span class="caption">{{caption}}</span><span wmtransclude></span><span class="pull-right caret fa" ng-class="menuCaret"></span></button><wm-menu-dropdown menulayout="menulayout" items="menuItems" linktarget="linktarget" menualign="menualign"/></div>'),$templateCache.put("template/widget/form/anchormenu.html",'<div class="dropdown app-menu" init-widget uib-dropdown auto-close="{{autoclose}}" role="input" listen-property="dataset" tabindex="-1"><a title="{{hint}}" href="javascript:void(0);" class="app-anchor dropdown-toggle {{menuclass}}" uib-dropdown-toggle apply-styles accesskey="{{::shortcutkey}}"><i class="app-icon {{iconclass}}"></i> <span class="caption">{{caption}}</span><span wmtransclude></span><span class="pull-right caret fa" ng-class="menuCaret"></span></a><wm-menu-dropdown menulayout="menulayout" items="menuItems" linktarget="linktarget" menualign="menualign"/></div>'),$templateCache.put("template/widget/form/menu/dropdown.html",'<ul class="dropdown-menu {{menulayout}} {{menualign}} {{animateClass}}" uib-dropdown-menu><wm-menu-dropdown-item ng-repeat="item in items" linktarget="linktarget" item="item" menualign="menualign"/></ul>'),$templateCache.put("template/widget/form/menu/dropdownItem.html",'<li ng-class="{\'disabled\': item.disabled, \'dropdown-submenu\' : item.children.length > 0}"><a tabindex="0" href="javascript:void(0);" title="{{item.label}}">'+"<span ng-if=\"item.children.length\" class=\"pull-right fa caret\" ng-class=\"{ 'fa-caret-left': {{menualign === 'pull-right'}}, 'fa-caret-right': {{menualign === 'pull-left' || menualign === undefined}}, 'fa-caret-down': {{menualign === 'dropinline-menu'}} }\"></span><i class=\"app-icon {{item.icon}}\"></i>{{item.label}}</a></li>")}]).directive("wmMenu",["$templateCache","PropertiesFactory","WidgetUtilService","$timeout","Utils","CONSTANTS","FormWidgetUtils",function($templateCache,PropertiesFactory,WidgetUtilService,$timeout,Utils,CONSTANTS,FormWidgetUtils){"use strict";function getMenuItems(newVal,scope){var transformFn,menuItems=[];return WM.isString(newVal)?menuItems=newVal.split(",").map(function(item){var _val=item&&item.trim();return{label:_val,value:_val}}):WM.isArray(newVal)&&(newVal=FormWidgetUtils.getOrderedDataSet(newVal,scope.orderby),WM.isObject(newVal[0])?(transformFn=function(result,item){var children=WidgetUtilService.getEvaluatedData(scope,item,{expressionName:"itemchildren"})||item.children;return Utils.validateAccessRoles(item[scope.userrole||"role"])&&result.push({label:WidgetUtilService.getEvaluatedData(scope,item,{expressionName:"itemlabel"})||item.label,icon:WidgetUtilService.getEvaluatedData(scope,item,{expressionName:"itemicon"})||item.icon,disabled:item.disabled,link:WidgetUtilService.getEvaluatedData(scope,item,{expressionName:"itemlink"})||item.link,value:scope.datafield?"All Fields"===scope.datafield?item:Utils.findValueOf(item,scope.datafield):item,children:(WM.isArray(children)?children:[]).reduce(transformFn,[]),action:WidgetUtilService.getEvaluatedData(scope,item,{expressionName:"itemaction"})||item.action,role:WidgetUtilService.getEvaluatedData(scope,item,{expressionName:"userrole"})||item.role}),result},menuItems=newVal.reduce(transformFn,[])):menuItems=newVal.map(function(item){return{label:item,value:item}})),menuItems}function propertyChangeHandler(scope,element,key,newVal){switch(key){case"scopedataset":case"dataset":scope.itemlabel=scope.itemlabel||scope.displayfield,CONSTANTS.isRunMode&&newVal&&(scope.menuItems=getMenuItems(newVal.data||newVal,scope));break;case"linktarget":scope.linktarget=newVal;break;case"menuposition":switch(newVal){case POSITION.DOWN_RIGHT:element.removeClass("dropup"),scope.menualign="pull-left";break;case POSITION.DOWN_LEFT:element.removeClass("dropup"),scope.menualign="pull-right";break;case POSITION.UP_LEFT:element.addClass("dropup"),scope.menualign="pull-right",scope.menuCaret="fa-caret-up";break;case POSITION.UP_RIGHT:element.addClass("dropup"),scope.menualign="pull-left",scope.menuCaret="fa-caret-up";break;case POSITION.INLINE:scope.menualign="dropinline-menu"}}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.menu",["wm.base","wm.base.advancedformwidgets","wm.menu.dataProps"]),notifyFor={iconname:!0,scopedataset:!0,dataset:!0,menuposition:!0,menualign:!0,linktarget:!0},POSITION={DOWN_RIGHT:"down,right",DOWN_LEFT:"down,left",UP_RIGHT:"up,right",UP_LEFT:"up,left",INLINE:"inline"};return{restrict:"E",scope:{scopedataset:"=?",onSelect:"&"},template:function(tElement,tAttrs){var template="";return template=tAttrs.type&&"anchor"===tAttrs.type?WM.element($templateCache.get("template/widget/form/anchormenu.html")):WM.element($templateCache.get("template/widget/form/menu.html")),template[0].outerHTML},replace:!0,transclude:!0,compile:function(tElement){return{pre:function(iScope,element,attrs){iScope.menuCaret="fa-caret-down",!attrs.iconclass&&attrs.iconname&&(WM.element(tElement.context).attr("iconclass","wi wi-"+attrs.iconname),attrs.iconclass="wi wi-"+attrs.iconname),"up"===attrs.dropposition?attrs.menuposition===POSITION.DOWN_RIGHT?attrs.menuposition=POSITION.UP_RIGHT:attrs.menuposition===POSITION.DOWN_LEFT&&(attrs.menuposition=POSITION.UP_LEFT):"down"===attrs.dropposition&&(attrs.menuposition===POSITION.UP_RIGHT?attrs.menuposition=POSITION.DOWN_RIGHT:attrs.menuposition===POSITION.UP_LEFT&&(attrs.menuposition=POSITION.DOWN_LEFT)),iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){var onPropertyChange=propertyChangeHandler.bind(void 0,scope,element);WidgetUtilService.registerPropertyChangeListener(onPropertyChange,scope,notifyFor),scope.reset=function(){},WidgetUtilService.postWidgetCreate(scope,element,attrs),!scope.widgetid&&attrs.scopedataset&&$timeout(function(){scope.$watch("scopedataset",function(newVal){onPropertyChange("scopedataset",newVal)})},0,!0)}}}}}]).directive("wmMenuDropdown",["$templateCache","CONSTANTS",function($templateCache,CONSTANTS){"use strict";var animation,menuPosition,animated="animated ",animationClasses={scale:{name:"wmScaleInLeft","down,right":"wmScaleInLeft","down,left":"wmScaleInRight","up,right":"wmScaleInTopLeft","up,left":"wmScaleInTopRight"},fade:{name:"fadeIn","down,right":"fadeIn","down,left":"fadeIn","up,right":"fadeIn","up,left":"fadeIn"},slide:{name:"wmSlideInDown","down,right":"wmSlideInDown","down,left":"wmSlideInDown","up,right":"wmSlideInUp","up,left":"wmSlideInUp"}};return{restrict:"E",replace:!0,scope:{items:"=",menualign:"=",menulayout:"=",linktarget:"="},template:$templateCache.get("template/widget/form/menu/dropdown.html"),link:function(scope,element){scope.onSelect=function(args){scope.$parent.onSelect(args)},CONSTANTS.isRunMode&&(animation=element.parent().isolateScope().animateitems,menuPosition=scope.$parent.menuposition,animation?scope.animateClass=animated+(animationClasses[animation][menuPosition]||animationClasses[animation].name):scope.items&&element.parent().scope().animateClass&&(scope.animateClass=element.parent().scope().animateClass))}}}]).directive("wmMenuDropdownItem",["$templateCache","$compile","CONSTANTS","Utils","$window","$routeParams",function($templateCache,$compile,CONSTANTS,Utils,$window,$routeParams){"use strict";return{restrict:"E",replace:!0,scope:{item:"=",menualign:"=",linktarget:"="},template:function(){var template=WM.element($templateCache.get("template/widget/form/menu/dropdownItem.html"));return CONSTANTS.isStudioMode||template.attr("ng-click","onSelect({$event: $event, $scope: this, $item: item.value || item.label })"),template[0].outerHTML},link:function(scope,element){var routeRegex,menuScope=element.closest(".dropdown").isolateScope(),menuLink=scope.item[menuScope.itemlink];scope.item.children&&scope.item.children.length>0&&(element.append('<wm-menu-dropdown items="item.children"  linktarget="linktarget" menualign="menualign"/>'),element.off("click"),$compile(element.contents())(scope)),element.closest(".app-nav-item").length&&menuLink&&(routeRegex=new RegExp("^(#/|#)"+$routeParams.name+"$"),routeRegex.test(menuLink)&&element.addClass("active")),scope.onSelect=function(args){var itemLink=args.$item[menuScope.itemlink||"link"],itemAction=args.$item[menuScope.itemaction||"action"],linkTarget=menuScope.linktarget||"_self";itemLink&&_.startsWith(itemLink,"#")&&!_.startsWith(itemLink,"#/")&&(itemLink=_.replace(itemLink,"#","#/")),scope.$parent.onSelect(args),itemAction?Utils.evalExp(element.closest(".dropdown").scope(),itemAction).then(function(){itemLink&&$window.open(itemLink,linkTarget)}):itemLink&&$window.open(itemLink,linkTarget)}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/slider.html",'<div class="app-slider slider" init-widget has-model title="{{hint}}" apply-styles role="input"><span class="app-slider-value">{{minvalue}}</span><span class="app-slider-value pull-right">{{maxvalue}}</span><input class="range-input" type="range" focus-target title="{{_model_}}" min="{{minvalue}}" max="{{maxvalue}}" step="{{step}}" ng-model="_model_" ng-disabled="disabled" accesskey="{{::shortcutkey}}" ng-change="_onChange({$event: $event, $scope: this})" /><div ng-show="readonly || disabled" class="readonly-wrapper"></div></div>')}]).directive("wmSlider",["PropertiesFactory","$templateCache","WidgetUtilService","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.slider",["wm.base","wm.base.events.change"]);return{restrict:"E",replace:!0,scope:{onChange:"&"},template:function(tElement,tAttrs){var template=WM.element($templateCache.get("template/widget/form/slider.html"));return template.find("input").attr("name",tAttrs.name),template[0].outerHTML},link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.reset=function(){scope._model_=""},WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/checkbox.html",'<div class="app-checkbox checkbox" ng-class="{\'app-toggle\' : (type === \'toggle\')}" init-widget has-model title="{{hint}}" role="input"><label ng-class="{disabled:disabled, unchecked: isUnchecked() }" apply-styles role="button"><input focus-target type="checkbox"  ng-model="_model_" ng-readonly="readonly"  ng-required="required" ng-disabled="disabled"  accesskey="{{::shortcutkey}}" ng-change="_onChange({$event: $event, $scope: this})"><span class="caption" ng-bind-html="_caption"></span><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" class="switch"/></label><input type="hidden" class="ng-hide model-holder" ng-disabled="disabled" value="{{_model_}}"></div>')}]).directive("wmCheckbox",["PropertiesFactory","WidgetUtilService","CONSTANTS","$templateCache","FormWidgetUtils","Utils",function(PropertiesFactory,WidgetUtilService,CONSTANTS,$templateCache,FormWidgetUtils,Utils){"use strict";function propertyChangeHandler(scope,key,newVal){switch(key){case"readonly":scope.disabled=newVal;break;case"caption":WM.isDefined(newVal)&&""!==newVal?scope._caption=newVal:scope._caption="&nbsp;"}}function stringify(value){return"true"!==value&&"false"!==value&&!_.includes(value,"'")&&isNaN(parseInt(value,10))&&(value="'"+value+"'"),value}function getDefaultValue(attrs){var _model_;return attrs.hasOwnProperty("uncheckedvalue")&&(_model_="true"===attrs.uncheckedvalue||"false"!==attrs.uncheckedvalue&&attrs.uncheckedvalue),_model_}var widgetProps=PropertiesFactory.getPropertiesOf("wm.checkbox",["wm.base","wm.base.editors.abstracteditors"]),notifyFor={readonly:!0,caption:!0};return{restrict:"E",scope:{},replace:!0,template:function(tElement,tAttrs){var checkbox,_dataValue,template=WM.element($templateCache.get("template/widget/form/checkbox.html")),isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),setTrueFalseValues=function(attr,property){var value=tAttrs[attr];value&&(value=stringify(value),checkbox.attr(property,value))};return checkbox=template.find("input[type=checkbox]"),setTrueFalseValues("checkedvalue","ng-true-value"),setTrueFalseValues("uncheckedvalue","ng-false-value"),tAttrs.datavalue&&!_.startsWith(tAttrs.datavalue,"bind:")&&(_dataValue=stringify(tAttrs.datavalue),tElement.attr("datavalue",_dataValue),tAttrs.datavalue=_dataValue),isWidgetInsideCanvas||(WidgetUtilService.addEventAttributes(template,tAttrs,FormWidgetUtils.getProxyEventsMap()),WidgetUtilService.addEventAttributes(checkbox,tAttrs,FormWidgetUtils.getFocusBlurEvents())),checkbox.attr("name",tAttrs.name),template[0].outerHTML},link:{pre:function(scope,element,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,attrs.datavalue||attrs.scopedatavalue||(scope._model_=getDefaultValue(attrs)),scope._caption="&nbsp;"},post:function(scope,element,attrs){scope.widgetid&&(widgetProps.caption.show="toggle"!==scope.type),scope.eventProxy=FormWidgetUtils.eventProxy.bind(void 0,scope),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope),scope,notifyFor),scope.reset=function(){scope._model_=getDefaultValue(attrs)||!1},WidgetUtilService.postWidgetCreate(scope,element,attrs);var checkbox=element.children().first().children().first()[0];scope.isUnchecked=function(){return!checkbox.checked}}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/checkboxset.html",'<ul class="app-checkboxset list-group" init-widget has-model apply-styles role="input" listen-property="dataset" title="{{hint}}"  ng-model="_model_" ng-change="_onChange({$event: $event, $scope: this})"></ul>')}]).directive("wmCheckboxset",["PropertiesFactory","WidgetUtilService","$compile","CONSTANTS","Utils","FormWidgetUtils","$templateCache","LiveWidgetUtils",function(PropertiesFactory,WidgetUtilService,$compile,CONSTANTS,Utils,FormWidgetUtils,$templateCache,LiveWidgetUtils){"use strict";function assignModelValue(scope,dataSet,checkboxValue){var selectedValues=[];checkboxValue?selectedValues.push(checkboxValue):""===scope.selectedvalues?scope._model_=[]:WM.isDefined(scope.selectedvalues)?(selectedValues=Utils.convertToArray(scope.selectedvalues),scope._model_=[]):(selectedValues&&0!==selectedValues.length||WM.isDefined(scope._model_))&&WM.isDefined(scope._model_)?scope._model_=Utils.convertToArray(scope._model_):scope._model_=void 0,_.forEach(selectedValues,function(value){scope._model_.push(FormWidgetUtils.getModelValue(scope,dataSet,value,checkboxValue))})}function constructCheckboxSet(scope,element,dataSet){var template,compiledTemplate,$headerEle;scope.dataObject={},scope.dataKeys=[],scope.checkedValues={},dataSet=FormWidgetUtils.getParsedDataSet(dataSet,scope,element),FormWidgetUtils.createDataKeys(scope,dataSet),assignModelValue(scope,dataSet),template=FormWidgetUtils.getRadiosetCheckboxsetTemplate(scope,"checkboxset"),compiledTemplate=$compile(template)(scope),element.empty().append(compiledTemplate),CONSTANTS.isStudioMode&&scope.groupFields&&($headerEle=element.closest(".property-value").find(".fixed-header"),FormWidgetUtils.setFixedHeader(element,$headerEle)),element.find(".app-checkboxset-label").on("click",function(evt){if(!_.includes(evt.target.classList,"caption")){var checkedOption,inputElements=element.find("input:checked");if(scope._model_=[],inputElements.each(function(){checkedOption=WM.element(this).val(),assignModelValue(scope,dataSet,checkedOption)}),CONSTANTS.isStudioMode){if(_.isArray(scope._model_)&&_.isObject(scope._model_[0]))return;scope.selectedvalues=scope._model_.join(",")}Utils.triggerFn(scope._onChange,evt),scope.$root.$safeApply(scope)}})}function propertyChangeHandler(scope,element,key,newVal,oldVal){var dataSet,isBoundToServiceVariable;switch(dataSet=scope.dataset||scope.scopedataset,CONSTANTS.isStudioMode&&scope.binddataset&&(isBoundToServiceVariable=_.startsWith(scope.binddataset,"bind:Variables.")&&"wm.ServiceVariable"===FormWidgetUtils.getBoundVariableCategory(scope)),key){case"dataset":isBoundToServiceVariable&&CONSTANTS.isStudioMode?FormWidgetUtils.appendMessage(element):constructCheckboxSet(scope,element,newVal);break;case"displayfield":case"datafield":case"usekeys":case"orderby":!CONSTANTS.isRunMode&&isBoundToServiceVariable||constructCheckboxSet(scope,element,dataSet);break;case"selectedvalues":dataSet=FormWidgetUtils.getParsedDataSet(dataSet,scope,element),assignModelValue(scope,dataSet);break;case"disabled":element.find('input[type="checkbox"]').attr("disabled",newVal);break;case"layout":element.removeClass(oldVal).addClass(newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.checkboxset",["wm.base","wm.base.editors.dataseteditors"]),notifyFor={dataset:!0,displayfield:!0,datafield:!0,usekeys:!0,selectedvalues:!0,disabled:!0,orderby:!0,layout:!0};return{restrict:"E",scope:{scopedataset:"=?"},replace:!0,template:function(tElement,tAttrs){var template=WM.element($templateCache.get("template/widget/form/checkboxset.html")),isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid");return isWidgetInsideCanvas||WidgetUtilService.addEventAttributes(template,tAttrs,FormWidgetUtils.getProxyEventsMap()),template[0].outerHTML},link:{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.eventProxy=FormWidgetUtils.eventProxy.bind(void 0,scope),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),scope.valueInModel=function(model,value,dataObject){return!!_.includes(model,value)||(model===value||WM.isDefined(dataObject)&&WM.isArray(model)&&model.some(function(el){return _.isObject(el)?WM.equals(dataObject,el):dataObject==el}))},scope.groupFields=attrs.groupFields||!1,scope.$watch("_model_",function(){FormWidgetUtils.updatedCheckedValues(scope)},!1),scope.reset=function(){scope._model_=[]},WidgetUtilService.postWidgetCreate(scope,element,attrs),!attrs.widgetid&&attrs.scopedataset&&scope.$watch("scopedataset",function(){scope.scopedataset&&(scope.dataset=scope.scopedataset)},!0),!attrs.widgetid&&_.includes(scope.binddataset,"selecteditem.")&&LiveWidgetUtils.fetchDynamicData(scope,element.scope(),function(data){constructCheckboxSet(scope,element,data)}),element.removeAttr("tabindex")}}}}]),WM.module("wm.widgets.form").requires=WM.module("wm.widgets.form").requires.concat(["colorpicker.module"]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/colorpicker.html",'<div title="{{hint}}" class="input-group app-colorpicker" init-widget has-model role="input"><input colorpicker colorpicker-parent="true" focus-target class="form-control app-textbox"  ng-disabled="readonly || disabled" ng-required="required" ng-model="_model_" ng-change="_onChange({$event: $event, $scope: this})" accesskey="{{::shortcutkey}}"><span class="input-group-addon" ng-style="{backgroundColor:_model_}">&nbsp;</span></div>')}]).directive("wmColorpicker",["PropertiesFactory","$templateCache","WidgetUtilService","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.colorpicker",["wm.base","wm.base.events","wm.base.events.focus","wm.base.events.change"]);return{restrict:"E",scope:{},replace:!0,template:function(tElement,tAttrs){var isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),template=WM.element($templateCache.get("template/widget/form/colorpicker.html")),target=template.children().first();return template.find("input").attr("name",tAttrs.name),isWidgetInsideCanvas||(tAttrs.hasOwnProperty("onClick")&&target.attr("ng-click","onClick({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onMouseenter")&&target.attr("ng-mouseenter","onMouseenter({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onMouseleave")&&target.attr("ng-mouseleave","onMouseleave({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onFocus")&&target.attr("ng-focus","onFocus({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onBlur")&&target.attr("ng-blur","onBlur({$event: $event, $scope: this})")),template[0].outerHTML},link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.reset=function(){scope._model_=""},WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/composite.html",'<div class="form-group app-composite-widget clearfix" init-widget apply-styles="container" role="input"'+" ng-class=\"{'caption-left': captionposition == 'left','caption-right': captionposition == 'right','caption-top': captionposition == 'top'}\" title=\"{{hint}}\" wmtransclude></div>")}]).directive("wmComposite",["PropertiesFactory","$templateCache","WidgetUtilService","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils){"use strict";function propertyChangeHandler(element,key,newVal){var labelEle,inputElements;switch(key){case"required":labelEle=element.find(".app-label.ng-isolate-scope"),inputElements=[".input-group.ng-isolate-scope",".form-control.ng-isolate-scope","app-radio.ng-isolate-scope",".list-group",".app-checkbox.ng-isolate-scope"],labelEle.length&&(WM.element(labelEle).first().isolateScope().required=newVal),inputElements.forEach(function(ele){var inputEle=element.find(ele);inputEle.length&&inputEle.each(function(){WM.element(this).isolateScope().required=newVal})})}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.composite",["wm.base","wm.containers"]),notifyFor={required:!0};return{restrict:"E",replace:!0,transclude:!0,scope:{},template:$templateCache.get("template/widget/form/composite.html"),link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){if(WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,element),scope,notifyFor),!scope.widgetid){var inputName,labelEl=element.find("label"),inputEl=element.find("input, select, textarea");1===labelEl.length&&1===inputEl.length&&(inputName=inputEl.attr("name"),inputEl.attr("id",inputName),labelEl.attr("for",inputName))}scope.reset=function(){},WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/currency.html",'<div init-widget has-model class="input-group app-currency" role="input"><span class="input-group-addon">{{currencysymbol}}</span><input type="number" focus-target class="form-control app-textbox app-currency-input" title="{{hint}}" apply-styles ng-model="_model_" ng-readonly="readonly"  ng-required="required"  ng-disabled="disabled"  step="{{step}}" accesskey="{{::shortcutkey}}" ng-change="_onChange({$event: $event, $scope: this})"></div>')}]).directive("wmCurrency",["PropertiesFactory","$templateCache","WidgetUtilService","$locale","CURRENCYCONSTANTS","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,$locale,CURRENCYCONSTANTS,Utils){"use strict";function propertyChangeHandler(scope,key,newVal){switch(key){case"currency":CURRENCYCONSTANTS[newVal]&&(scope.currencysymbol=CURRENCYCONSTANTS[newVal].symbol)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.currency",["wm.base","wm.base.editors","wm.base.editors.abstracteditors"]),notifyFor={currency:!0};return{restrict:"E",replace:!0,scope:{},template:function(tElement,tAttrs){var isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),template=WM.element($templateCache.get("template/widget/form/currency.html")),target=template.children().last();return target.attr("name",tAttrs.name),isWidgetInsideCanvas||(tAttrs.hasOwnProperty("minvalue")&&target.attr("min","{{minvalue}}"),tAttrs.hasOwnProperty("maxchars")&&target.attr("maxlength","{{maxchars}}"),tAttrs.hasOwnProperty("maxvalue")&&target.attr("max","{{maxvalue}}"),tAttrs.hasOwnProperty("onClick")&&target.attr("ng-click","onClick({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onMouseenter")&&target.attr("ng-mouseenter","onMouseenter({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onMouseleave")&&target.attr("ng-mouseleave","onMouseleave({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onFocus")&&target.attr("ng-focus","onFocus({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onBlur")&&target.attr("ng-blur","onBlur({$event: $event, $scope: this})")),template[0].outerHTML},link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.$locale=$locale,WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope),scope,notifyFor),scope.reset=function(){scope._model_=""},WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/date.html",'<div class=\'app-date input-group\' init-widget has-model role=\'input\' apply-styles app-defaults=\'{"datepattern": "dateFormat", "outputformat": "dateFormat"}\'><input class="form-control app-textbox app-dateinput" datepicker-append-to-body="true" focus-target  uib-datepicker-popup="{{datepattern}}" show-button-bar="{{showbuttonbar}}" datepicker-options="_dateOptions"  title="{{hint}}"  on-open-focus="true"  is-open=isOpen ng-model="_proxyModel"  ng-readonly="readonly"  ng-required="required"  ng-disabled="disabled"  accesskey="{{::shortcutkey}}" ng-change="_onChange({$event: $event, $scope: this})" ng-keyup="_onKeyUp($event)"><input class="model-holder ng-hide" ng-disabled="disabled" ng-model="_model_"><span class="input-group-btn"><button type="button" class="btn btn-default btn-date" focus-target><i class="app-icon wi wi-calendar"></i></button></span></div>'),$templateCache.put("template/device/widget/form/date.html",'<input type="date" class="form-control app-textbox app-dateinput" init-widget has-model role="input" step="any"  ng-model="_proxyModel"  ng-readonly="readonly"  ng-required="required"  ng-disabled="disabled"  ng-change="updateModel();_onChange({$event: $event, $scope: this});" ng-model-options="{ updateOn: \'change\' }"> ')}]).directive("wmDate",["$rootScope","PropertiesFactory","WidgetUtilService","$templateCache","$filter","FormWidgetUtils","$timeout","CONSTANTS","Utils",function($rs,PropertiesFactory,WidgetUtilService,$templateCache,$filter,FormWidgetUtils,$timeout,CONSTANTS,Utils){"use strict";function propertyChangeHandler(scope,element,key,newVal,oldVal){var currentDate=moment().valueOf();switch(key){case"readonly":case"disabled":element.css("pointer-events",scope.readonly||scope.disabled?"none":"all");break;case"timestamp":newVal!=oldVal&&(scope._model_=newVal);break;case"excludedates":scope.proxyExcludeDates=FormWidgetUtils.getProxyExcludeDates(newVal);break;case"showweeks":scope._dateOptions.showWeeks=scope.showweeks;break;case"maxdate":scope.widgetid||newVal!==CURRENT_DATE||(scope.maxdate=currentDate),scope._dateOptions.maxDate=scope.maxdate;break;case"mindate":scope.widgetid||newVal!==CURRENT_DATE||(scope.mindate=currentDate),scope._dateOptions.minDate=scope.mindate}}function getTimeStamp(val){var epoch;return val&&(WM.isDate(val)?epoch=val.getTime():(isNaN(val)||(val=parseInt(val,10)),epoch=moment(val).valueOf(),epoch=isNaN(epoch)?void 0:epoch)),epoch}function _onClick(scope,evt){scope.isOpen=!scope.isOpen,scope.onClick&&scope.onClick({$event:evt,$scope:scope})}var widgetProps=PropertiesFactory.getPropertiesOf("wm.date",["wm.base","wm.base.editors.abstracteditors","wm.base.datetime"]),notifyFor={readonly:CONSTANTS.isRunMode,disabled:CONSTANTS.isRunMode,timestamp:!0,showweeks:!0,mindate:!0,maxdate:!0,excludedates:!0},CURRENT_DATE="CURRENT_DATE";return{restrict:"E",replace:!0,scope:{},template:function($tEl,tAttrs){var isWidgetInsideCanvas,target,template="";return $rs.isMobileApplicationType&&"uib-picker"!==tAttrs.type?(template=WM.element(WidgetUtilService.getPreparedTemplate("template/device/widget/form/date.html",$tEl,tAttrs)),template[0].outerHTML):(template=WM.element($templateCache.get("template/widget/form/date.html")),isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),target=template.children("input.form-control"),template.find(".app-dateinput").attr("name",tAttrs.name),isWidgetInsideCanvas||(template.find(".btn-date").attr("ng-click","_onClick($event)"),template.find(".app-dateinput").attr("ng-click","_onClick($event)"),tAttrs.hasOwnProperty("onMouseenter")&&template.attr("ng-mouseenter","onMouseenter({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onMouseleave")&&template.attr("ng-mouseleave","onMouseleave({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onFocus")&&target.attr("ng-focus","onFocus({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onBlur")&&target.attr("ng-blur","onBlur({$event: $event, $scope: this})")),template[0].outerHTML)},link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,$is._dateOptions={},$rs.isMobileApplicationType&&($is._nativeMode=!0);var isCurrentDate=!1;Object.defineProperty($is,"_model_",{get:function(){if($is.widgetid&&isCurrentDate)return CURRENT_DATE;var timestamp=this._proxyModel?this._proxyModel.valueOf():"";return this.timestamp=timestamp,"timestamp"===this.outputformat?timestamp:(this.outputformat||(this.outputformat="yyyy-MM-dd"),this._proxyModel?$filter("date")(this._proxyModel,this.outputformat):"");
},set:function(val){var timestamp;isCurrentDate=val===CURRENT_DATE,isCurrentDate?(this._proxyModel=new Date,CONSTANTS.isRunMode&&$is._onChange()):val?(timestamp=getTimeStamp(val),this._proxyModel=new Date(timestamp)):this._proxyModel=void 0}})},post:function($is,$el,attrs){function docClickListener(e){var $target=WM.element(e.target);$target.closest(".uib-datepicker-popup").length||$el[0].contains(e.target)||(document.removeEventListener("click",docClickListener,!0),$rs.$evalAsync(function(){$is.isOpen=!1}))}var onPropertyChange=propertyChangeHandler.bind(void 0,$is,$el);WidgetUtilService.registerPropertyChangeListener(onPropertyChange,$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs),$is._onClick=_onClick.bind(void 0,$is),$is.updateModel=function(){$is._model_=FormWidgetUtils.getUpdatedModel($is.mindate,$is.maxdate,$is._model_,$is._proxyModel,$is._prevDate),$is._prevDate=$is._model_},$is.reset=function(){$is._model_=""},$is._dateOptions.dateDisabled=FormWidgetUtils.disableDates.bind(void 0,$is),attrs.datavalue&&!_.startsWith(attrs.datavalue,"bind:")&&($is._model_=attrs.datavalue),$timeout(function(){WM.element("body").find("> [uib-datepicker-popup-wrap]").addClass("app-date")}),$is.widgetid||($is.$watch("isOpen",function(nv){nv&&document.addEventListener("click",docClickListener,!0)}),$is._onKeyUp=function($event){9===$event.keyCode&&($is.isOpen=!0)})}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/datetime.html",'<div class="app-datetime input-group" init-widget has-model apply-styles role="input" app-defaults=\'{"datepattern": "dateTimeFormat", "outputformat": "dateTimeFormat"}\'  title="{{hint}}" ng-model="_proxyModel"><input class="form-control app-textbox display-input" focus-target ng-model="_displayModel" accesskey="{{::shortcutkey}}" ng-change="updateDateTimeModel($event)" ng-model-options="{updateOn: \'blur\'}" ng-required="required" ng-keyup="_onKeyUp($event)"><input class="form-control app-textbox app-dateinput" datepicker-append-to-body="true" ng-change="selectDate($event)" ng-model="_dateModel"  uib-datepicker-popup datepicker-options="_dateOptions" show-button-bar={{showbuttonbar}} is-open="isDateOpen" focus-target><div uib-dropdown is-open="isTimeOpen" class="dropdown" dropdown-append-to-body="true" auto-close="outsideClick"><div uib-dropdown-menu><div uib-timepicker ng-model="_timeModel" hour-step="hourstep" minute-step="minutestep" show-meridian="ismeridian" show-seconds="showseconds" ng-change="selectTime($event)"></div></div></div><input class="model-holder ng-hide" ng-disabled="disabled" ng-model="_model_"><span class="input-group-btn"><button type="button" class="btn btn-default btn-date" focus-target><i class="app-icon wi wi-calendar"></i></button><button type="button" class="btn btn-default btn-time uib-dropdown-toggle" focus-target><i class="app-icon wi wi-access-time "></i></button></span></div>'),$templateCache.put("template/device/widget/form/datetime.html",'<input type="datetime-local" class="form-control app-textbox app-dateinput" init-widget has-model role="input" step="any"  ng-model="_proxyModel"  ng-readonly="readonly"  ng-required="required"  ng-disabled="disabled"  ng-change="updateModel();_onChange({$event: $event, $scope: this});" ng-model-options="{ updateOn: \'change\' }"> ')}]).directive("wmDatetime",["$rootScope","PropertiesFactory","WidgetUtilService","$timeout","$templateCache","$filter","FormWidgetUtils","$interval","CONSTANTS","Utils",function($rs,PropertiesFactory,WidgetUtilService,$timeout,$templateCache,$filter,FormWidgetUtils,$interval,CONSTANTS,Utils){"use strict";function _formatDateTime($is){var date,time,dateString,timeString,value;$is._timeModel||$is._dateModel?(time=$is._timeModel?new Date($is._timeModel):$is._timeModel=new Date,date=$is._dateModel?new Date($is._dateModel):$is._dateModel=moment($is.mindate||$is.maxdate).valueOf(),dateString=$filter("date")(date,"yyyy-MM-dd"),timeString=$filter("date")(time,"HH:mm:ss"),value=moment(dateString+" "+timeString).valueOf(),$is.timestamp=value,$is.datepattern&&"timestamp"!==$is.datepattern?$is._displayModel=$filter("date")(value,$is.datepattern):$is._displayModel=value,$is.outputformat&&"timestamp"!==$is.outputformat?$is._proxyModel=$filter("date")(value,$is.outputformat):$is._proxyModel=value):($is._displayModel=void 0,$is._proxyModel=void 0)}function propertyChangeHandler($is,$el,key,nv){var inputEl=$el.find("input"),buttonEl=$el.find("button"),currentDateTime=moment().valueOf();switch(key){case"readonly":case"disabled":inputEl.attr(key,nv),buttonEl.attr("disabled",nv),$el.css("pointer-events",$is.readonly||$is.disabled?"none":"all");break;case"autofocus":inputEl.first().attr(key,nv);break;case"excludedates":$is.proxyExcludeDates=FormWidgetUtils.getProxyExcludeDates(nv);break;case"datepattern":$is.showseconds=_.includes(nv,"ss"),$is.ismeridian=_.includes(nv,"hh"),_formatDateTime($is);break;case"showweeks":$is._dateOptions.showWeeks=$is.showweeks;break;case"maxdate":$is.widgetid||nv!==CURRENT_DATETIME||($is.maxdate=currentDateTime),$is._dateOptions.maxDate=$is.maxdate;break;case"mindate":$is.widgetid||nv!==CURRENT_DATETIME||($is.mindate=currentDateTime),$is._dateOptions.minDate=$is.mindate}}function _onClick($is,evt){evt.stopPropagation(),$is.onClick&&$is.onClick({$event:evt,$scope:$is})}function _onDateClick($is,$el,evt){evt.stopPropagation();var dateOpen=$is.isDateOpen;$timeout(function(){$el.parent().trigger("click"),$is.isDateOpen=!dateOpen,$is.isTimeOpen=!1})}function _onTimeClick($is,$el,evt){evt.stopPropagation();var TimeOpen=$is.isTimeOpen;$timeout(function(){$el.parent().trigger("click"),$is.isTimeOpen=!TimeOpen,$is.isDateOpen=!1})}function parseDateTime(val){return WM.isDate(val)?val:(isNaN(val)||(val=parseInt(val,10)),new Date(moment(val).valueOf()))}var widgetProps=PropertiesFactory.getPropertiesOf("wm.datetime",["wm.base","wm.base.editors.abstracteditors","wm.base.datetime"]),notifyFor={readonly:CONSTANTS.isRunMode,disabled:CONSTANTS.isRunMode,autofocus:!0,excludedates:!0,showweeks:!0,mindate:!0,maxdate:!0,datepattern:!0},CURRENT_DATETIME="CURRENT_DATE";return{restrict:"E",replace:!0,scope:{},template:function($tEl,tAttrs){var isWidgetInsideCanvas,target,template="";return $rs.isMobileApplicationType&&"uib-picker"!==tAttrs.type?(template=WM.element(WidgetUtilService.getPreparedTemplate("template/device/widget/form/datetime.html",$tEl,tAttrs)),template[0].outerHTML):(template=WM.element($templateCache.get("template/widget/form/datetime.html",$tEl,tAttrs)),isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),target=template.children("input.form-control"),template.find(".display-input").attr("name",tAttrs.name),isWidgetInsideCanvas||(template.attr("ng-click","_onClick($event)"),template.find(".btn-date").attr("ng-click","_onDateClick($event)"),template.find(".display-input").attr("ng-click","_onDateClick($event)"),template.find(".btn-time").attr("ng-click","_onTimeClick($event)"),tAttrs.hasOwnProperty("onMouseenter")&&template.attr("ng-mouseenter","onMouseenter({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onMouseleave")&&template.attr("ng-mouseleave","onMouseleave({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onFocus")&&target.attr("ng-focus","onFocus({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onBlur")&&target.attr("ng-blur","onBlur({$event: $event, $scope: this})")),template[0].outerHTML)},link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,$is._dateOptions={},$rs.isMobileApplicationType&&"uib-picker"!==attrs.type&&($is._nativeMode=!0)},post:function($is,$el,attrs){function docClickListenerForDate(e){var $target=WM.element(e.target);$target.closest(".uib-datepicker-popup").length||$el[0].contains(e.target)||(document.removeEventListener("click",docClickListenerForDate,!0),$rs.$evalAsync(function(){$is.isDateOpen=!1}))}function docClickListenerForTime(e){var $target=WM.element(e.target);$target.closest("[uib-timepicker]").length||$el[0].contains(e.target)||(document.removeEventListener("click",docClickListenerForTime,!0),$rs.$evalAsync(function(){$is.isTimeOpen=!1}))}var timeInterval,onPropertyChange=propertyChangeHandler.bind(void 0,$is,$el),isCurrentDateTime=!1,setTimeInterval=function(cancel){return cancel?void $interval.cancel(timeInterval):void(CONSTANTS.isRunMode&&($is.disabled=!0,onPropertyChange("disabled",$is.disabled),timeInterval&&"canceled"!==timeInterval.$$state.value||(timeInterval=$interval(function(){$is._model_=CURRENT_DATETIME,$is._onChange()},1e3))))},setModels=function(val){var dateTime;if(val)if(isCurrentDateTime){if(dateTime=new Date,$is._proxyModel=$is._timeModel=dateTime.getTime(),$is._dateModel=new Date($is._proxyModel),$is.widgetid)return void($is._displayModel=$filter("date")($is._proxyModel,$is.datepattern));setTimeInterval()}else dateTime=parseDateTime(val),dateTime.getTime()?($is._proxyModel=$is._timeModel=dateTime.getTime(),$is._dateModel=new Date($is._proxyModel)):$is._proxyModel=$is._dateModel=$is._timeModel=void 0,setTimeInterval(!0);else $is._proxyModel=$is._dateModel=$is._timeModel=void 0;$is.formatDateTime()};WidgetUtilService.registerPropertyChangeListener(onPropertyChange,$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs),$is.formatDateTime=_formatDateTime.bind(void 0,$is),$is._onClick=_onClick.bind(void 0,$is),$is._onDateClick=_onDateClick.bind(void 0,$is,$el),$is._onTimeClick=_onTimeClick.bind(void 0,$is,$el),"false"!==attrs.ismeridian||attrs.datepattern||($is.datepattern=$is.datepattern.replace("hh","HH").replace(" a","")),$is.selectDate=function(event){_.isNull($is._dateModel)?$is._timeModel=void 0:$is.isDateOpen&&$timeout(function(){$is.isTimeOpen=!0}),$is.formatDateTime(),$is._onChange({$event:event,$scope:$is})},$is.selectTime=function(event){$is.formatDateTime(),$is._onChange({$event:event,$scope:$is})},$is.widgetid||$timeout(function(){onPropertyChange("disabled",$is.disabled),onPropertyChange("readonly",$is.readonly)}),$is.updateModel=function(){$is._model_=FormWidgetUtils.getUpdatedModel($is.mindate,$is.maxdate,$is._model_,$is._proxyModel,$is._prevDateTime),$is._prevDateTime=$is._model_},$is.updateDateTimeModel=function(e){isNaN(Date.parse($is._displayModel))?(this._proxyModel="",this.timestamp=""):setModels($is._displayModel),$is._onChange({$event:e,$scope:$is})},$is.reset=function(){$is._model_=""},Object.defineProperty($is,"_model_",{get:function(){if($is.widgetid&&isCurrentDateTime)return CURRENT_DATETIME;if(!$is._nativeMode)return this._proxyModel;var timestamp=this._proxyModel?this._proxyModel.valueOf():"";return this.timestamp=timestamp,"timestamp"===this.outputformat?timestamp:(this.outputformat||(this.outputformat="yyyy-MM-dd"),this._proxyModel?$filter("date")(this._proxyModel,this.outputformat):"")},set:function(val){var dateTime;isCurrentDateTime=val===CURRENT_DATETIME,$is._nativeMode?val?(isCurrentDateTime?(dateTime=new Date,setTimeInterval()):(dateTime=parseDateTime(val),setTimeInterval(!0)),this._proxyModel=new Date(dateTime.getFullYear(),dateTime.getMonth(),dateTime.getDate(),dateTime.getHours(),dateTime.getMinutes(),dateTime.getSeconds())):this._proxyModel=void 0:setModels(val)}}),$is._dateOptions.dateDisabled=FormWidgetUtils.disableDates.bind(void 0,$is),attrs.datavalue&&!_.startsWith(attrs.datavalue,"bind:")&&($is._model_=attrs.datavalue,attrs.datavalue===CURRENT_DATETIME&&setTimeInterval()),$is.$on("$destroy",function(){setTimeInterval(!0)}),$timeout(function(){WM.element("body").find("> [uib-datepicker-popup-wrap]").addClass("app-date")}),$timeout(function(){WM.element("body").find("> [uib-dropdown-menu] > [uib-timepicker]").parent().addClass("app-datetime")}),$el.find(".app-dateinput").attr("tabindex","-1"),$is.widgetid||($is.$watch("isDateOpen",function(nv){nv&&document.addEventListener("click",docClickListenerForDate,!0)}),$is.$watch("isTimeOpen",function(nv){nv&&document.addEventListener("click",docClickListenerForTime,!0)}),$is._onKeyUp=function($event){9===$event.keyCode&&($is.isDateOpen=!0)})}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/fileupload.html",'<div class="app-fileupload" init-widget role="input"><div class="app-multi-file-upload" ng-if="!_isMobileType && multiple"><div class="drop-box" drag-files="onFileSelect($event,$files)" apply-styles><i class="{{iconclass}}"/><div class="message"><label ng-bind="caption" class="caption"></label><form class="form-horizontal" name="{{scope.formName}}"><input class="file-input" focus-target type="file" name="files" on-file-select="onFileSelect($event, $files)" ng-attr-accept="{{chooseFilter}}" multiple ng-disabled="disabled"><a href="javascript:void(0);" class="app-anchor" ng-bind="fileuploadmessage"></a></form></div></div></div><div class="app-single-file-upload" ng-if="!_isCordova && (!multiple || _isMobileType)"><div class="app-button-wrapper"><form class="form-horizontal" name="{{scope.formName}}"><input class="file-input" type="file" name="files" ng-if="multiple" on-file-select="onFileSelect($event, $files)" ng-attr-accept="{{chooseFilter}}" ng-disabled="disabled" multiple><input class="file-input" type="file" name="files" ng-if="!multiple" on-file-select="onFileSelect($event, $files)" ng-attr-accept="{{chooseFilter}}" ng-disabled="disabled"><button focus-target class="app-button btn btn-default" apply-styles><i class="{{iconclass}}"></i> <span class="caption">{{caption}}</span></button></form></div><div class="app-files-upload-status single"></div></div><button ng-if="_isCordova" focus-target class="app-button btn btn-default" ng-click="openFileSelector()" ng-disabled="disabled" apply-styles><i class="{{iconclass}}"></i> <span class="caption">{{caption}}</span></button><ul class="list-group file-upload" ng-style="{height: filelistheight, overflow: overflow}" ng-if="selectedFiles.length > 0 && mode === \'Select\'" ><li class="list-group-item file-upload-status" ng-repeat="ft in selectedFiles" ><div class="media upload-file-list"><div class="media-left media-middle file-icon {{getFileExtension(ft.name) | fileIconClass}}" title="{{getFileExtension(ft.name)}}"></div><div class="media-body media-middle file-details"><label class="upload-title">{{ft.name}}</label><br/><span class="filesize" ng-if="ft.fileLength  !== 0">{{ft.size | filesize:0}}</span></div></div></li></ul><ul class="list-group file-upload" ng-style="{height: filelistheight, overflow: overflow}" ng-if="fileTransfers.length > 0 && mode === \'Upload\'" ><li class="list-group-item file-upload-status {{ft.status}}" ng-hide="ft.status === \'abort\'" ng-repeat="ft in fileTransfers | filter : {status : \'!abort\'}" ><div class="media upload-file-list"><div class="media-left media-middle file-icon {{getFileExtension(ft.name) | fileIconClass}}" title="{{getFileExtension(ft.name)}}"></div><div class="media-body media-middle file-details"><div class="file-detail"><p class="uploaddetails"><label class="upload-title col-xs-8">{{ft.name}}</label><span class="text-muted filesize" ng-if="ft.fileLength  !== 0">{{ft.size | filesize:0}}</span></p><div class="progress" ng-show="ft.status === \'inprogress\'"><div class="progress-bar progress-bar-striped progress-bar-info" ng-style="{width: (ft.progress +\'%\')}"></div></div></div></div><div class="media-right media-middle" ng-if="ft.status === \'inprogress\' || ft.status === \'queued\'"><a class="btn btn-transparent" type="button" ng-click="abortUpload($event, ft)"><i class="wi wi-stop"></i></a></div><div class="media-right media-middle status" ng-if="mode === \'Upload\'" ng-hide="ft.status === \'abort\' || ft.status === \'inprogress\'"><span class="status-icon {{ft.status | stateClass }}"></span></div></div></li></ul></div>')}]).directive("onFileSelect",["$parse","$timeout",function($parse,$timeout){"use strict";return function(scope,elem,attrs){var fn=$parse(attrs.onFileSelect);elem.bind("change",function(evt){var fileList,i,files=[];if(window.FormData){if(fileList=evt.target.files,null!==fileList.length)for(i=0;i<fileList.length;i+=1)files[i]=fileList.item(i)}else files=[this.value];$timeout(function(){fn(scope,{$files:files,$event:evt})})}),elem.bind("click",function(){this.value=null})}}]).directive("dropAvailable",["$parse","$timeout",function($parse,$timeout){"use strict";return function(scope,elem,attrs){if(document.createElement("span").hasOwnProperty("draggable")){var fn=$parse(attrs.dropAvailable);$timeout(function(){fn(scope)})}}}]).directive("dragFiles",["$parse","$timeout",function($parse,$timeout){"use strict";return function(scope,elem,attrs){var fn,div=document.createElement("div"),dragDropSupport="draggable"in div||"ondragstart"in div&&"ondrop"in div;dragDropSupport&&(fn=$parse(attrs.dragFiles),elem.bind("dragenter",function(evt){evt.preventDefault()}),elem.bind("dragover",function(evt){evt.stopPropagation(),evt.preventDefault(),elem.addClass("file-dragover")}),elem.bind("dragleave",function(){elem.removeClass("file-dragover")}),elem.bind("drop",function(evt){evt.stopPropagation(),evt.preventDefault(),elem.removeClass("file-dragover");var i,files=[],fileList=evt.originalEvent.dataTransfer.files;if(null!==fileList)for(i=0;i<fileList.length;i+=1)files.push(fileList.item(i));$timeout(function(){fn(scope,{$files:files,$event:evt})})}))}}]).directive("wmFileupload",["PropertiesFactory","$templateCache","WidgetUtilService","wmToaster","Utils","Variables","ServiceFactory","$rootScope","CONSTANTS","FileUploadService","FileSelectorService","DeviceMediaService","$timeout",function(PropertiesFactory,$templateCache,WidgetUtilService,wmToaster,Utils,Variables,ServiceFactory,$rootScope,CONSTANTS,FileUploadService,FileSelectorService,DeviceMediaService,$timeout){"use strict";function getUrlAndParamName(uploadUriPrefix,service,operation,destination){var variableObject,name,uploadUrl="/file/uploadFile",variableFilterData={service:service,operation:operation,category:"wm.ServiceVariable"};return uploadUriPrefix=uploadUriPrefix||"",destination=destination?"?relativePath="+destination:"",variableObject=Variables.filterByVariableKeys(variableFilterData,!0)[0],variableObject&&(uploadUrl=variableObject._wmServiceOperationInfo.relativePath),name=_.find(variableObject._wmServiceOperationInfo.parameters,{type:"file"}).name||"files",{uploadUrl:uploadUriPrefix+uploadUrl+destination,fileParamName:name}}function getAllServices(onSuccess){ServiceFactory.getServicesWithType(function(response){Utils.triggerFn(onSuccess,_.map(response,"name"))})}function createVariable(widgetId,service,operation){var serviceType=ServiceFactory.getServiceObjectByName(service).type;$rootScope.$emit("create-service-variable",service,serviceType,operation),$rootScope.$emit("set-markup-attr",widgetId,{service:service,operation:operation})}function onUploadError(scope,event){Utils.triggerFn(scope.onError,{$event:event,$scope:scope}),scope.multiple||wmToaster.show("error","File upload failed")}function onUploadProgress(scope,event){Utils.triggerFn(scope.onProgress,{$event:event,$scope:scope})}function onUploadAbort(scope,event){Utils.triggerFn(scope.onAbort,{$event:event,$scope:scope})}function getSuccessResponse(event){var response;return 200===event.target.status&&(response=Utils.getValidJSON(event.target.response),response&&response.result&&response.result.error&&(event.target.status=500,response=void 0)),response}function onUploadSuccess(scope,event){if(403===event.target.status)return scope.uploadedFiles=[],void onUploadError(scope,event);if(window.FormData){var response=getSuccessResponse(event);if(!response)return void onUploadError(scope,event);scope.uploadedFiles.push(response[0])}Utils.triggerFn(scope.onSuccess,{$event:event,$scope:scope}),scope.multiple||wmToaster.show("success","File Uploaded")}function isValidFile(filename,contenttype,extensionName,isMobileType){var isValid,contentTypes;return!contenttype||(contentTypes=_.toLower(contenttype).split(","),(_.includes(contentTypes,"image/*")||_.includes(contentTypes,"image")&&isMobileType)&&(isValid=Utils.isImageFile(filename))?isValid:(_.includes(contentTypes,"audio/*")||_.includes(contentTypes,"audio")&&isMobileType)&&(isValid=Utils.isAudioFile(filename))?isValid:(_.includes(contentTypes,"video/*")||_.includes(contentTypes,"video")&&isMobileType)&&(isValid=Utils.isVideoFile(filename))?isValid:(_.includes(contentTypes,"."+_.toLower(extensionName))&&(isValid=!0),isValid))}function getValidFiles($files,scope){var validFiles=[],MAXFILEUPLOAD_SIZE=parseInt(scope.maxfilesize,10)*FILESIZE_MB||FILESIZE_MB,MAX_FILE_UPLOAD_FORMATTED_SIZE=(scope.maxfilesize||"1")+"MB";return scope.chooseFilter===DEVICE_CONTENTTYPES.FILES&&(scope.chooseFilter=""),_.forEach($files,function(file){return isValidFile(file.name,scope.chooseFilter,scope.getFileExtension(file.name),scope._isMobileType)?file.size>MAXFILEUPLOAD_SIZE?(Utils.triggerFn(scope.onError),void wmToaster.show("error","File size exceeded limit. Max upload size is "+MAX_FILE_UPLOAD_FORMATTED_SIZE)):void validFiles.push(file):(Utils.triggerFn(scope.onError),void wmToaster.show("error","Expected a "+scope.contenttype+" file"))}),validFiles}function uploadFiles($files,scope,uploadOptions){var config=getUrlAndParamName(scope.uploadUrl,scope.service,scope.operation,scope.destination);scope.fileTransfers=FileUploadService.upload($files,config,uploadOptions),scope.uploadedFiles=[],_.map(scope.fileTransfers,function(ft){ft.then(onUploadSuccess.bind(void 0,scope),onUploadError.bind(void 0,scope),onUploadProgress.bind(void 0,scope))})}function getCaption(caption,mode,isMultiple,isMobileType){if(_.includes(DEFAULT_CAPTIONS,caption)){if(mode===MODE.UPLOAD)return isMultiple&&!isMobileType?DEFAULT_CAPTIONS.MULTIPLE_UPLOAD:DEFAULT_CAPTIONS.UPLOAD;if(mode===MODE.SELECT)return isMultiple&&!isMobileType?DEFAULT_CAPTIONS.MULTIPLE_SELECT:DEFAULT_CAPTIONS.SELECT}return caption}function getPropertyType($is,prop){var variable,type,types=$rootScope.dataTypes;switch(prop){case"uploadedFiles":variable=Variables.filterByVariableKeys({service:$is.service,operation:$is.operation,category:"wm.ServiceVariable"},!0)[0],type=variable&&variable.type;break;case"selectedFiles":type=$is.widgettype+"_"+prop,types[type]={fields:{name:{type:"string"},size:{type:"number"},type:{type:"string"}}}}return type}var selectedUploadTypePath,widgetProps=PropertiesFactory.getPropertiesOf("wm.fileupload",["wm.base","wm.base.advancedformwidgets","wm.base.events.successerror"]),notifyFor={uploadpath:!0,contenttype:!0,service:!0,operation:!0,mode:!0,multiple:!0},MODE={SELECT:"Select",UPLOAD:"Upload"},DEFAULT_CAPTIONS={MULTIPLE_UPLOAD:"Drop your files here to start uploading.",MULTIPLE_SELECT:"Drop your files here.",UPLOAD:"Upload",SELECT:"Select"},DEVICE_CONTENTTYPES={IMAGE:"image",VIDEO:"video",AUDIO:"audio",FILES:"files"},FILESIZE_MB=1048576;return{restrict:"E",priority:10,replace:!0,scope:{onSelect:"&",onSuccess:"&",onError:"&",onProgress:"&",onAbort:"&"},template:$templateCache.get("template/widget/form/fileupload.html"),compile:function(){return{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,scope._isMobileType=$rootScope.isMobileApplicationType,scope._isCordova=CONSTANTS.hasCordova},post:function(scope,element,attrs){function propertyChangeHandler(key,newVal){switch(key){case"uploadpath":scope.changeServerUploadPath(newVal);break;case"contenttype":scope.chooseFilter=newVal.split(" ").join(",");break;case"service":isStudioMode&&!$rootScope.isTemplateBundleType&&(scope.service!==CONSTANT_FILE_SERVICE||scope.operation||(scope.operation="uploadFile"),ServiceFactory.getServiceOperations(scope.service,function(response){scope.widgetProps.operation.options=_.map(response,"name")}));break;case"operation":isStudioMode&&scope.service&&scope.operation&&createVariable(scope.widgetid,scope.service,scope.operation);break;case"mode":case"multiple":scope.formName=scope.name+(scope.multiple?"-multiple-fileupload":"-single-fileupload"),scope.caption=getCaption(scope.caption,scope.mode,scope.multiple,scope._isMobileType)}}var isStudioMode=CONSTANTS.isStudioMode&&scope.widgetid,parentPrefabScope=element.closest(".app-prefab").isolateScope(),CONSTANT_FILE_SERVICE="FileService";scope.uploadData={file:void 0,uploadPath:void 0},scope.formName=scope.name+(scope.multiple?"-multiple-fileupload":"-single-fileupload"),scope.chooseFilter="",scope.uploadedFiles={fileName:"",path:"",length:"",status:""},scope.reset=function(){scope.fileTransfers&&(scope.fileTransfers.length=0),scope.selectedFiles&&(scope.selectedFiles.length=0)},scope.uploadUrl=parentPrefabScope&&parentPrefabScope.prefabname?"prefabs/"+parentPrefabScope.prefabname:"services",isStudioMode&&(getAllServices(function(services){scope.widgetProps.service.options=services}),$rootScope.$on("update-fileupload",function(event,widgetId,serviceId){scope.widgetid===widgetId&&(scope.service=serviceId,getAllServices(function(services){scope.widgetProps.service.options=services}))})),scope.changeServerUploadPath=function(path){selectedUploadTypePath=path},scope.abortUpload=function(event,ft){ft.abort(),onUploadAbort(scope,event)},CONSTANTS.hasCordova&&(scope.openFileSelector=function(){({formName:scope.formName});return scope.contenttype===DEVICE_CONTENTTYPES.IMAGE?void DeviceMediaService.imagePicker(scope.multiple).then(function(files){scope.onFileSelect({},files)}):scope.contenttype===DEVICE_CONTENTTYPES.AUDIO?void DeviceMediaService.audioPicker(scope.multiple).then(function(files){scope.onFileSelect({},files)}):scope.contenttype===DEVICE_CONTENTTYPES.VIDEO&&Utils.isIphone()?void DeviceMediaService.videoPicker().then(function(files){scope.onFileSelect({},files)}):void FileSelectorService.open({multiple:scope.multiple},function(files){scope.onFileSelect({},files)})}),scope.getFileExtension=function(fileName){return fileName&&_.includes(fileName,".")?fileName.substring(fileName.lastIndexOf(".")+1):"file"},scope.onFileSelect=function($event,$files){var uploadOptions={formName:scope.formName};scope.onSelect({$event:WM.extend($event.$files||{},$files),$scope:scope}),$files=getValidFiles($files,scope),scope.mode===MODE.UPLOAD?uploadFiles($files,scope,uploadOptions):scope.selectedFiles=$files},scope.getPropertyType=getPropertyType.bind(void 0,scope),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler,scope,notifyFor),$timeout(function(){WidgetUtilService.postWidgetCreate(scope,element,attrs)})}}}}}]).filter("filesize",["Utils",function(Utils){"use strict";var units=["bytes","KB","MB","GB","TB","PB"];return function(bytes,precision){if(isNaN(parseFloat(bytes))||!isFinite(bytes))return Utils.isMobile()?"":"?";for(var unit=0;bytes>=1024;)bytes/=1024,unit++;return bytes.toFixed(+precision)+" "+units[unit]}}]).filter("stateClass",function(){"use strict";var stateClassMap={success:"wi wi-done text-success",error:"wi wi-cancel text-danger"};return function(state){return stateClassMap[state.toLowerCase()]}}).filter("fileIconClass",function(){"use strict";var fileClassMapping={zip:"fa-file-zip-o",pdf:"fa-file-pdf-o",rar:"fa-file-archive-o",txt:"fa-file-text-o",ppt:"fa-file-powerpoint-o",pot:"fa-file-powerpoint-o",pps:"fa-file-powerpoint-o",pptx:"fa-file-powerpoint-o",potx:"fa-file-powerpoint-o",ppsx:"fa-file-powerpoint-o",mpg:"fa-file-movie-o",mp4:"fa-file-movie-o",mov:"fa-file-movie-o",avi:"fa-file-movie-o",mp3:"fa-file-audio-o",docx:"fa-file-word-o",js:"fa-file-code-o",md:"fa-file-code-o",html:"fa-file-code-o",css:"fa-file-code-o",xlsx:"fa-file-excel-o",png:"fa-file-image-o",jpg:"fa-file-image-o",jpeg:"fa-file-image-o",file:"fa-file-o",default:"fa-file-o"};return function(fileExtension){return"fa "+(fileClassMapping[fileExtension]||"fa-file-o")}}),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/radio.html",'<div class="radio app-radio" init-widget has-model title="{{hint}}" role="input"><label apply-styles><input type="radio" class="app-radiobutton" focus-target value="{{checkedvalue}}" ng-model="_model_" ng-readonly="readonly"  ng-required="required"  ng-disabled="disabled"  accesskey="{{::shortcutkey}}" ng-change="_onChange({$event: $event, $scope: this})" /><span class="caption">{{caption || "&nbsp;"}}</span></label></div>')}]).directive("wmRadio",["PropertiesFactory","WidgetUtilService","$templateCache","FormWidgetUtils",function(PropertiesFactory,WidgetUtilService,$templateCache,FormWidgetUtils){"use strict";function propertyChangeHandler(radtioBtn,key,newVal){switch(key){case"radiogroup":radtioBtn.attr("name",newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.radio",["wm.base","wm.base.editors.abstracteditors"]),notifyFor={radiogroup:!0};return{restrict:"E",scope:{},replace:!0,template:function(tElement,tAttrs){var radioBtn,template=WM.element($templateCache.get("template/widget/form/radio.html")),isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid");return radioBtn=template.find("input[type=radio]"),isWidgetInsideCanvas||(WidgetUtilService.addEventAttributes(template,tAttrs,FormWidgetUtils.getProxyEventsMap()),WidgetUtilService.addEventAttributes(radioBtn,tAttrs,FormWidgetUtils.getFocusBlurEvents())),radioBtn.attr("name",tAttrs.name),template[0].outerHTML},link:{pre:function(scope){scope.widgetProps=widgetProps},post:function(scope,element,attrs){scope.eventProxy=FormWidgetUtils.eventProxy.bind(void 0,scope);var radtioBtn=element.find("input[type=radio]");WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,radtioBtn),scope,notifyFor),scope.reset=function(){scope._model_=void 0},WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/radioset.html",'<ul class="app-radioset list-group" init-widget has-model apply-styles role="input" listen-property="dataset" title="{{hint}}" ng-model="_model_" ng-change="_onChange({$event: $event, $scope: this})"></ul>')}]).directive("wmRadioset",["PropertiesFactory","WidgetUtilService","$compile","CONSTANTS","Utils","FormWidgetUtils","$templateCache","LiveWidgetUtils",function(PropertiesFactory,WidgetUtilService,$compile,CONSTANTS,Utils,FormWidgetUtils,$templateCache,LiveWidgetUtils){"use strict";function assignModelValue(scope,dataSet,radioValue){var selectedValue;""===scope.selectedvalue&&(scope._model_=selectedValue=void 0),selectedValue=radioValue||radioValue===!1?radioValue:WM.isDefined(scope.selectedvalue)?scope.selectedvalue:WM.isDefined(scope._model_)?scope._model_:void 0,scope._model_=FormWidgetUtils.getModelValue(scope,dataSet,selectedValue,radioValue)}function constructRadioSet(scope,element,dataSet){var template,compiledTemplate;scope.dataObject={},scope.dataKeys=[],scope.checkedValues={},dataSet=FormWidgetUtils.getParsedDataSet(dataSet,scope,element),FormWidgetUtils.createDataKeys(scope,dataSet),assignModelValue(scope,dataSet),template=FormWidgetUtils.getRadiosetCheckboxsetTemplate(scope,"radioset"),compiledTemplate=$compile(template)(scope),element.empty().append(compiledTemplate),element.find(".app-radioset-label").on("click",function(evt){if(!(scope.disabled||scope.readonly||_.includes(evt.target.classList,"caption"))){var radioOption;radioOption=WM.element(this).find("input").attr("data-attr-index"),radioOption=scope.dataKeys[radioOption],assignModelValue(scope,dataSet,radioOption),Utils.triggerFn(scope._onChange,evt),scope.$root.$safeApply(scope)}})}function propertyChangeHandler(scope,element,key,newVal,oldVal){var isBoundToServiceVariable,dataSet=scope.dataset||scope.scopedataset;switch(CONSTANTS.isStudioMode&&scope.binddataset&&(isBoundToServiceVariable=_.startsWith(scope.binddataset,"bind:Variables.")&&"wm.ServiceVariable"===FormWidgetUtils.getBoundVariableCategory(scope)),key){case"dataset":isBoundToServiceVariable&&CONSTANTS.isStudioMode?FormWidgetUtils.appendMessage(element):constructRadioSet(scope,element,newVal);
break;case"displayfield":case"datafield":case"usekeys":case"orderby":!CONSTANTS.isRunMode&&isBoundToServiceVariable||constructRadioSet(scope,element,dataSet);break;case"selectedvalue":dataSet=FormWidgetUtils.getParsedDataSet(dataSet,scope,element),assignModelValue(scope,dataSet);break;case"disabled":element.find('input[type="radio"]').attr("disabled",newVal);break;case"layout":element.removeClass(oldVal).addClass(newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.radioset",["wm.base","wm.base.editors.dataseteditors"]),notifyFor={dataset:!0,displayfield:!0,datafield:!0,usekeys:!0,selectedvalue:!0,disabled:!0,orderby:!0,layout:!0};return{restrict:"E",scope:{scopedataset:"=?"},replace:!0,template:function(tElement,tAttrs){var template=WM.element($templateCache.get("template/widget/form/radioset.html")),isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid");return isWidgetInsideCanvas||WidgetUtilService.addEventAttributes(template,tAttrs,FormWidgetUtils.getProxyEventsMap()),template[0].outerHTML},link:{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.eventProxy=FormWidgetUtils.eventProxy.bind(void 0,scope),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),scope.valueInModel=function(model,value,dataObject){return!!WM.isDefined(model)&&(model===value||WM.equals(model,dataObject))},scope.widgetid||scope.$watch("_model_",function(){FormWidgetUtils.updatedCheckedValues(scope)}),scope.reset=function(){scope._model_=""},WidgetUtilService.postWidgetCreate(scope,element,attrs),!attrs.widgetid&&attrs.scopedataset&&scope.$watch("scopedataset",function(){constructRadioSet(scope,element,scope.scopedataset)}),!attrs.widgetid&&_.includes(scope.binddataset,"selecteditem.")&&LiveWidgetUtils.fetchDynamicData(scope,element.scope(),function(data){constructRadioSet(scope,element,data)}),element.removeAttr("tabindex")}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/select.html",'<select init-widget has-model listen-property="dataset" class="form-control app-select" apply-styles role="input" focus-target ng-model="modelProxy" title="{{hint}}" ng-readonly="readonly"  ng-disabled="disabled" ng-required="required" accesskey="{{::shortcutkey}}" ng-change="onChangeProxy({$event: $event, $scope: this})" ng-options="option.key as $root.locale[option.value] || option.value for option in selectOptions"><option selected value="" ng-if="placeholder">{{placeholder}}</option></select>')}]).directive("wmSelect",["PropertiesFactory","WidgetUtilService","FormWidgetUtils","Utils","LiveWidgetUtils",function(PropertiesFactory,WidgetUtilService,FormWidgetUtils,Utils,LiveWidgetUtils){"use strict";function getKey(optionObject){var keys=Object.keys(optionObject);return 1===keys.length?keys[0]:"dataValue"}function setModelProxyAndDisplayVal(scope,_model_,isList){var selectedIndex=_dataSetModelMap[scope.$id][WM.toJson(_model_)],val=_.get(scope.selectOptions,[selectedIndex,"value"]);isList?(scope.modelProxy.push(selectedIndex),scope.displayValue.push(val)):(scope.modelProxy=selectedIndex,scope.displayValue=val)}function setDisplayValFromModelProxy(scope,_modelProxy){var selectedModelObj;scope.multiple?(scope.displayValue=[],_.forEach(_modelProxy,function(model){selectedModelObj=_.find(scope.selectOptions,["key",model]),selectedModelObj&&scope.displayValue.push(selectedModelObj.value)})):(selectedModelObj=_.find(scope.selectOptions,["key",_modelProxy]),scope.displayValue=WM.isDefined(selectedModelObj)?selectedModelObj.value:"")}function updateModelProxy(scope,_model_){var _modelProxy;_modelChangedManually[scope.$id]||(scope.datafield!==ALLFIELDS?(_modelProxy=WM.isObject(_model_)?_model_:WM.isDefined(_model_)&&_.toString(_model_),scope.modelProxy=_modelProxy,WM.isDefined(_modelProxy)&&setDisplayValFromModelProxy(scope,_modelProxy)):_dataSetModelMap[scope.$id]&&(scope.multiple&&WM.isArray(_model_)?(WM.isDefined(scope.modelProxy)?WM.isArray(scope.modelProxy)&&(scope.modelProxy.length=0):scope.modelProxy=[],WM.isDefined(scope.displayValue)?WM.isArray(scope.displayValue)&&(scope.displayValue.length=0):scope.displayValue=[],_.forEach(_model_,function(modelObj){setModelProxyAndDisplayVal(scope,modelObj,!0)})):setModelProxyAndDisplayVal(scope,_model_))),_modelChangedManually[scope.$id]=!1}function parseDataSet(dataSet,scope){var key,data=dataSet,dataField=scope.datafield,displayField=FormWidgetUtils.getDisplayField(dataSet,scope.displayfield||scope.datafield),orderedKeys=[];return _dataSetModelProxyMap[scope.$id]={},_dataSetModelMap[scope.$id]={},dataField&&dataField!==ALLFIELDS?(data={},WM.isObject(dataSet)&&!WM.isArray(dataSet)?data[WidgetUtilService.getObjValueByKey(dataSet,dataField)]=WidgetUtilService.getEvaluatedData(scope,dataSet,{fieldName:"displayfield",expressionName:"displayexpression"},displayField):_.forEach(dataSet,function(option){key=WidgetUtilService.getObjValueByKey(option,dataField),_.includes(orderedKeys,key)||orderedKeys.push(key),data[key]=WidgetUtilService.getEvaluatedData(scope,option,{fieldName:"displayfield",expressionName:"displayexpression"},displayField)})):(data={},!WM.isArray(dataSet)&&scope.binddataset&&scope.binddataset.indexOf("selecteditem")>-1?(data[0]=WidgetUtilService.getEvaluatedData(scope,dataSet,{fieldName:"displayfield",expressionName:"displayexpression"},displayField),_dataSetModelProxyMap[scope.$id][0]=dataSet,_dataSetModelMap[scope.$id][JSON.stringify(dataSet)]="0"):_.forEach(dataSet,function(option,index){WM.isObject(option)?scope.datafield===ALLFIELDS?(data[index]=WidgetUtilService.getEvaluatedData(scope,option,{fieldName:"displayfield",expressionName:"displayexpression"},displayField),_dataSetModelProxyMap[scope.$id][index]=option,_dataSetModelMap[scope.$id][JSON.stringify(option)]=index.toString()):data[WidgetUtilService.getObjValueByKey(option,dataField)]=WidgetUtilService.getEvaluatedData(scope,option,{fieldName:"displayfield",expressionName:"displayexpression"},displayField):WM.isArray(dataSet)?data[option]=option:data[index]=option})),scope.orderedKeys=orderedKeys,data}function createSelectOptions(dataset,scope){if(dataset){dataset=dataset.hasOwnProperty("data")?dataset.data:dataset;var key;dataset&&""!==dataset.dataValue&&(scope.selectOptions=[],WM.isArray(dataset)?(dataset=FormWidgetUtils.getOrderedDataSet(dataset,scope.orderby),dataset=parseDataSet(dataset,scope),WM.isObject(dataset[0])?(key=getKey(dataset[0]),_.forEach(dataset,function(option){scope.selectOptions.push({key:key,value:option.name||option[key]})})):WM.isArray(dataset)?_.forEach(dataset,function(option){scope.selectOptions.push({key:option,value:option})}):WM.isObject(dataset)&&(scope.orderedKeys.length?_.forEach(scope.orderedKeys,function(val){scope.selectOptions.push({key:_.toString(val),value:dataset[val]})}):_.forEach(dataset,function(val,key){scope.selectOptions.push({key:key,value:val})}))):WM.isObject(dataset)?(dataset=parseDataSet(dataset,scope),scope.orderedKeys.length?_.forEach(scope.orderedKeys,function(val){scope.selectOptions.push({key:_.toString(val),value:dataset[val]})}):_.forEach(dataset,function(val,key){scope.selectOptions.push({key:key,value:val})})):WM.isString(dataset)?_.forEach(dataset.split(","),function(opt){opt=opt.trim(),scope.selectOptions.push({key:opt,value:opt})}):scope.selectOptions.push({key:dataset,value:dataset}),updateModelProxy(scope,scope._model_))}}function propertyChangeHandler(scope,element,attrs,key,newVal){switch(key){case"dataset":createSelectOptions(scope.dataset,scope,element);break;case"multiple":attrs.$set("multiple",newVal),scope.widgetid&&(scope.widgetProps.datavalue.isList=newVal);break;case"active":scope.widgetid&&scope.dataset&&newVal&&WidgetUtilService.updatePropertyPanelOptions(scope);break;case"displayfield":scope.widgetid&&createSelectOptions(scope.dataset,scope,element)}}function onChangeProxy(scope,args){if(scope.readonly)return void(scope.modelProxy=scope._model_);if(scope.datafield!==ALLFIELDS||scope.dataset&&WM.isString(scope.dataset))scope._model_=scope.modelProxy,setDisplayValFromModelProxy(scope,scope.modelProxy);else if(_dataSetModelProxyMap[scope.$id])if(scope.multiple){var modelHolder=[];_.each(scope.modelProxy,function(proxy){modelHolder.push(_dataSetModelProxyMap[scope.$id][proxy])}),scope._model_=modelHolder}else scope._model_=_dataSetModelProxyMap[scope.$id][scope.modelProxy];_modelChangedManually[scope.$id]=!0,WM.isFunction(scope._onChange)&&scope._onChange({$event:args.$event,$scope:args.$scope})}function scopeDatasetWatcher(scope,element){scope.widgetid&&WidgetUtilService.updatePropertyPanelOptions(scope),createSelectOptions(scope.scopedataset,scope,element)}var widgetProps=PropertiesFactory.getPropertiesOf("wm.select",["wm.base","wm.base.editors","wm.base.editors.abstracteditors","wm.base.editors.dataseteditors","wm.base.events.keyboard"]),notifyFor={dataset:!0,multiple:!0,active:!0,displayfield:!0},_dataSetModelProxyMap={},_dataSetModelMap={},_modelChangedManually={},ALLFIELDS="All Fields";return{restrict:"E",replace:!0,scope:{scopedataset:"=?"},template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/widget/form/select.html"),link:{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,attrs.widgetid||Object.defineProperty(iScope,"_model_",{get:function(){return this._proxyModel},set:function(newVal){this._proxyModel=newVal,_modelChangedManually[iScope.$id]=!1,updateModelProxy(iScope,newVal)}})},post:function(iScope,element,attrs){var scope=element.scope();scope.changeAppLocale=scope.$root.changeLocale,WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,iScope,element,attrs),iScope,notifyFor),iScope.onChangeProxy=onChangeProxy.bind(void 0,iScope),iScope.reset=function(){iScope._model_=""},WidgetUtilService.postWidgetCreate(iScope,element,attrs),attrs.widgetid||attrs.scopedataset&&iScope.$watch("scopedataset",scopeDatasetWatcher.bind(void 0,iScope,element)),!attrs.widgetid&&_.includes(iScope.binddataset,"selecteditem.")&&LiveWidgetUtils.fetchDynamicData(iScope,scope,function(data){createSelectOptions(data,iScope,element)})}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/chips.html",'<ul class="app-chips nav nav-pills list-inline" init-widget has-model apply-styles role="input" ng-keydown="handleDeleteKeyPressEvent($event)" tabindex="0" listen-property="dataset" title="{{hint}}"  ng-model="_model_"><li ng-repeat="chip in selectedChips track by $index" ng-click="setActiveStates(chip)" ng-dblclick="makeEditable(chip)" ng-class="{\'active\': chip.active, \'disabled\': disabled}"><a class="app-chip" href="javascript:void(0);" ng-if="!chip.edit" ng-class="{\'chip-duplicate bg-danger\': chip.isDuplicate, \'chip-picture\': chip.wmImgSrc}"><img data-identifier="img" class="button-image-icon" ng-src="{{chip.wmImgSrc}}"  ng-if="chip.wmImgSrc"/>{{chip.key}}<button type="button" class="btn btn-transparent" ng-click="removeItem($event, $index)" ng-if="!readonly"><i class="app-icon wi wi-close"></i></button></a><input class="app-chip-input" type="text" ng-if="chip.edit" ng-keydown="handleEnterKeyPressEvent($event, chip)" ng-model="chip.fullValue"/></li><li ng-if="!(readonly || saturate)"><input ng-if="!isWidgetInsideCanvas" name="app-chip-search" class="app-chip-input form-control" type="text" ng-attr-placeholder="{{placeholder}}" ng-model="newItem.name" ng-keydown="handleKeyPressEvent($event)" ng-click="resetActiveState()" uib-typeahead="option as option.key for option in chips | filter:$viewValue" spellcheck="false" autocomplete="off" typeahead-on-select="addItem($event, $item)" ng-disabled="disabled" typeahead-editable="!allowonlyselect" typeahead-min-length="1" ng-model-options="{debounce: 200}" typeahead-is-open="dropdown.open" typeahead-template-url="template/widget/form/chipsSearch.html"><input type="text" class="form-control" ng-if="isWidgetInsideCanvas" ng-attr-placeholder="{{placeholder}}"></li></ul>'),$templateCache.put("template/widget/form/chipsSearch.html",'<a><img ng-src="{{match.model.wmImgSrc}}" ng-if="match.model.wmImgSrc"><span ng-bind-html="match.label | uibTypeaheadHighlight:query" title="{{chip.label}}" class="match-label"></span></a>')}]).directive("wmChips",["PropertiesFactory","WidgetUtilService","Utils","FormWidgetUtils","LiveWidgetUtils",function(PropertiesFactory,WidgetUtilService,Utils,FormWidgetUtils,LiveWidgetUtils){"use strict";function isDuplicate($s,newItemObject){return _.findIndex($s.selectedChips,newItemObject)>-1}function constructChip($s,displayValue,dataValue,imgSrcValue){dataValue||(dataValue=displayValue);var chipObj={key:displayValue,value:dataValue,wmImgSrc:imgSrcValue,fullValue:displayValue+" <"+dataValue+">"};return chipObj.isDuplicate=isDuplicate($s,chipObj),chipObj}function updateSelectedChips(chips,$s){if(ignoreUpdate)return void(ignoreUpdate=!1);var values,chip;chips=chips||[],WM.isArray(chips)?$s.selectedChips=chips:(values=_.split(chips,","),$s.selectedChips=[],_.forEach(values,function(ele){chip=_.find($s.chips,{key:ele}),$s.selectedChips.push($s.constructChip(ele,_.get(chip,"value"),_.get(chip,"wmImgSrc")))}))}function createSelectOptions(dataset,$s){var displayFieldValue,dataFieldValue,imageFieldValue,chips=[],dataField=$s.datafield,displayField=$s.displayfield||$s.displayexpression||$s.binddisplayexpression,imageField=$s.displayimagesrc,value=$s.value||$s.datavalue;(!$s.binddataset&&!$s.scopedataset||displayField||$s.datavalue)&&($s.chips.length=0,WM.isArray(dataset)&&dataset.length&&(chips=_.map(dataset,function(dataObj){return displayFieldValue=WidgetUtilService.getEvaluatedData($s,dataObj,{fieldName:"displayfield",expressionName:"displayexpression"}),dataFieldValue=Utils.getEvaluatedExprValue(dataObj,dataField),imageFieldValue=$s.binddisplayimagesrc?WidgetUtilService.getEvaluatedData($s,dataObj,{expressionName:"displayimagesrc"}):dataObj[imageField],displayField?$s.constructChip(displayFieldValue,dataFieldValue,imageFieldValue):$s.constructChip(dataObj)})),$s.chips=chips,$s.binddataset||$s.scopedataset?value&&updateSelectedChips(value,$s):updateSelectedChips(Utils.getClonedObject(chips),$s))}function getBooleanValue(val){return val===!0||"true"===val||val!==!1&&"false"!==val&&val}function makeEditable($s,chip){$s.editable=getBooleanValue($s.editable),$s.readonly||$s.editable===!1||(_.forEach($s.selectedChips,function(chip){chip.edit=!1}),chip.edit=!0)}function onModelUpdate($s,$event){var values=[];ignoreUpdate=!0,"All Fields"===$s.datafield?$s._model_=Utils.getClonedObject($s.selectedChips):(values=_.map($s.selectedChips,function(ele){return ele.value}),$s._model_=values),$s._onChange($event)}function validateDuplicates($s){var chipsCopy=_.map($s.selectedChips,function(ele){return _.pick(ele,["key","value","wmImgSrc","fullValue"])});_.forEach(chipsCopy,function(chip,index){_.findIndex(chipsCopy,chip)===_.findLastIndex(chipsCopy,chip)||_.findIndex(chipsCopy,chip)===index?$s.selectedChips[index].isDuplicate=!1:$s.selectedChips[index].isDuplicate=!0})}function stopEvent($event){$event.stopPropagation(),$event.preventDefault()}function handleEnterKeyPressEvent($s,$event,chip){var values,key=Utils.getActionFromKey($event);key===KEYS.ENTER&&(chip.edit=!1,values=_.split(chip.fullValue,"<"),chip.key=_.trim(values[0]),chip.value=_.trim(_.split(values[1],">")[0]),onModelUpdate($s,$event),validateDuplicates($s),stopEvent($event))}function checkMaxSize($s){var maxSize=parseInt($s.maxsize,10),size=$s.selectedChips.length;return $s.saturate=!1,maxSize>0&&size===maxSize&&($s.saturate=!0,!0)}function removeItem($s,$event,index){var indexes=WM.isArray(index)?index:[index];_.pullAt($s.selectedChips,indexes),onModelUpdate($s,$event),checkMaxSize($s),validateDuplicates($s)}function handleDeleteKeyPressEvent($s,$event){var key=Utils.getActionFromKey($event),activeElementIndices=[];if(key===KEYS.DELETE){if(!$s.selectedChips.length)return;if($s.newItem.name)return;_.forEach($s.selectedChips,function(chip,index){chip.active&&activeElementIndices.push(index)}),$s.removeItem($event,activeElementIndices)}}function handleKeyPressEvent($s,$el,$event){var lastTag,newItem,key=Utils.getActionFromKey($event),length=$s.selectedChips.length;if(key===KEYS.ENTER)$s.addItem($event),stopEvent($event);else if(key===KEYS.BACKSPACE||Utils.isAppleProduct&&key===KEYS.DELETE){if(!length||$s.dropdown.open)return;if(newItem=$el.find(".app-chip-input").val())return;lastTag=_.last($s.selectedChips),lastTag.active?$s.removeItem($event,length-1):$s.setActiveStates(lastTag),stopEvent($event)}}function resetActiveState($s,currChip){$s.multiple||_.forEach($s.selectedChips,function(chip){chip.active=!1,currChip||(chip.edit=!1)})}function setActiveStates($s,currChip){var value,index=_.findLastIndex($s.selectedChips,currChip);$s.multiple&&index>-1?value=!$s.selectedChips[index].active:(value=!0,$s.resetActiveState(currChip)),index>-1&&($s.selectedChips[index].active=value)}function addItem($s,$event,newItem){var newItemKey,newItemObject=Utils.getClonedObject(newItem),allowAdd=!0;checkMaxSize($s)||(!newItem&&$s.newItem&&(newItemKey=Utils.getClonedObject($s.newItem.name),newItemObject=$s.constructChip(newItemKey)),(newItemKey||newItem)&&(isDuplicate($s,newItemObject)&&(newItemObject.isDuplicate=!0),$s.onBeforeadd&&(allowAdd=$s.onBeforeadd({$event:"event",$isolateScope:$s,newItem:newItemObject})),(WM.isUndefined(allowAdd)||allowAdd)&&($s.selectedChips.push(newItemObject),checkMaxSize($s),onModelUpdate($s,$event),$s.newItem.name="")))}function reset($s){$s.selectedChips.length=0}function init($s,widgetId){$s.newItem={},$s.dropdown={},$s.selectedChips=[],$s.chips=[],$s.isWidgetInsideCanvas=!!widgetId}function propertyChangeHandler($s,$el,key){switch(key){case"dataset":case"displayfield":case"datafield":var data=$s.dataset;data&&($s.binddataset?data=data.data||(WM.isArray(data)?data:[data]):WM.isArray(data)||(data=_.split(data,",")),$s.orderby&&(data=FormWidgetUtils.getOrderedDataSet(data,$s.orderby)),createSelectOptions(data,$s))}}var ignoreUpdate,widgetProps=PropertiesFactory.getPropertiesOf("wm.chips",["wm.base","wm.base.editors.dataseteditors"]),notifyFor={dataset:!0,displayfield:!0,datafield:!0},KEYS={BACKSPACE:"BACKSPACE",ENTER:"ENTER",DELETE:"DELETE"};return{restrict:"E",scope:{scopedataset:"=?"},replace:!0,template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/widget/form/chips.html"),link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,$is.constructChip=constructChip.bind(void 0,$is),attrs.widgetid||Object.defineProperty($is,"_model_",{get:function(){return this._proxyModel},set:function(newVal){this._proxyModel=newVal,WM.isDefined(newVal)?updateSelectedChips(newVal,$is):$is.selectedChips.length=0}})},post:function($s,$el,attrs){init($s,attrs.widgetid),$s.isWidgetInsideCanvas||($s.handleEnterKeyPressEvent=handleEnterKeyPressEvent.bind(void 0,$s),$s.setActiveStates=setActiveStates.bind(void 0,$s),$s.makeEditable=makeEditable.bind(void 0,$s),$s.removeItem=removeItem.bind(void 0,$s),$s.handleKeyPressEvent=handleKeyPressEvent.bind(void 0,$s,$el),$s.handleDeleteKeyPressEvent=handleDeleteKeyPressEvent.bind(void 0,$s),$s.addItem=addItem.bind(void 0,$s),$s.reset=reset.bind(void 0,$s),$s.resetActiveState=resetActiveState.bind(void 0,$s)),!attrs.widgetid&&attrs.scopedataset&&$s.$watch("scopedataset",function(){$s.scopedataset&&($s.dataset=$s.scopedataset)},!0),!attrs.widgetid&&_.includes($s.binddataset,"selecteditem.")&&LiveWidgetUtils.fetchDynamicData($s,$el.scope(),function(data){createSelectOptions(data,$s)}),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$s,$el),$s,notifyFor),WidgetUtilService.postWidgetCreate($s,$el,attrs)}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/text.html",'<input class="form-control app-textbox" init-widget has-model apply-styles role="input" focus-target title="{{hint}}"  ng-model="_model_" ng-readonly="readonly"  ng-required="required"  ng-disabled="disabled"  pattern="{{regexp}}" accesskey="{{::shortcutkey}}" ng-change="_onChange({$event: $event, $scope: this})">')}]).directive("wmText",["PropertiesFactory","WidgetUtilService","FormWidgetUtils","CONSTANTS","Utils",function(PropertiesFactory,WidgetUtilService,FormWidgetUtils,CONSTANTS,Utils){"use strict";function propertyChangeHandler(scope,element,key,newVal){var wdgtProperties=scope.widgetProps;switch(key){case"type":FormWidgetUtils.setPropertiesTextWidget(wdgtProperties,newVal);break;case"autocomplete":newVal===!0||"true"===newVal?element.removeAttr(key):element.attr(key,"off");break;case"displayformat":scope.placeholder=newVal?"":scope.placeholder}}function getPropertyType($is,prop){var type;switch(prop){case"datavalue":switch($is.type){case"number":case"time":type=$is.type;break;case"datetime-local":type="datetime, timestamp";break;case"date":case"month":case"week":type="date";break;default:type="string"}}return type}var widgetProps=PropertiesFactory.getPropertiesOf("wm.text",["wm.base","wm.base.editors","wm.base.editors.abstracteditors","wm.base.events.keyboard"]),notifyFor={type:!0,autocomplete:!0,displayformat:!0};return{restrict:"E",replace:!0,scope:{},template:function(tElement,tAttrs){var updateon,debounce,allowInvalid,isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),template=WM.element(WidgetUtilService.getPreparedTemplate("template/widget/form/text.html",tElement,tAttrs));return isWidgetInsideCanvas||(updateon=(tAttrs.updateon||"blur")+" change ",debounce=tAttrs.updatedelay||0,allowInvalid="true"===tAttrs.allowinvalid,template.attr("ng-model-options",'{ updateOn:"'+updateon+'", debounce: '+debounce+" ,allowInvalid: "+allowInvalid+"}"),tAttrs.hasOwnProperty("maxchars")&&template.attr("maxlength","{{maxchars}}"),tAttrs.hasOwnProperty("minvalue")&&template.attr("min","{{minvalue}}"),tAttrs.hasOwnProperty("maxvalue")&&template.attr("max","{{maxvalue}}"),tAttrs.hasOwnProperty("displayformat")&&template.attr("ui-mask","{{displayformat}}")),template[0].outerHTML},link:{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,scope,element),scope,notifyFor),scope.reset=function(){scope._model_=""},WidgetUtilService.postWidgetCreate(scope,element,attrs),scope.getPropertyType=getPropertyType.bind(void 0,scope)}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/textarea.html",'<textarea init-widget has-model class="form-control app-textarea" apply-styles role="input" focus-target ng-model="_model_" title="{{hint}}" ng-disabled="disabled"  ng-readonly="readonly" ng-required="required"  accesskey="{{::shortcutkey}}" ng-change="_onChange({$event: $event, $scope: this})"></textarea>')}]).directive("wmTextarea",["PropertiesFactory","WidgetUtilService","CONSTANTS","Utils",function(PropertiesFactory,WidgetUtilService,CONSTANTS,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.textarea",["wm.base","wm.base.editors","wm.base.editors.abstracteditors","wm.base.events.keyboard"]);return{restrict:"E",replace:!0,scope:{},template:function(tElement,tAttrs){var updateon,debounce,isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),template=WM.element(WidgetUtilService.getPreparedTemplate("template/widget/form/textarea.html",tElement,tAttrs));return isWidgetInsideCanvas||(updateon=(tAttrs.updateon||"blur")+" change ",debounce=tAttrs.updatedelay||0,template.attr("ng-model-options",'{ updateOn:"'+updateon+'", debounce: '+debounce+"}"),tAttrs.hasOwnProperty("maxchars")&&template.attr("maxlength","{{maxchars}}")),template[0].outerHTML},link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){scope.reset=function(){scope._model_=""},CONSTANTS.isStudioMode&&element.css("resize","none"),WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/form/time.html",'<div class="app-timeinput input-group dropdown" uib-dropdown init-widget has-model apply-styles role="input" title="{{hint}}" app-defaults=\'{"timepattern": "timeFormat", "outputformat": "timeFormat"}\'><input class="form-control app-textbox display-input" ng-model="_timeModel" accesskey="{{::shortcutkey}}" ng-change="updateTimeModel();_onChange({$event: $event, $scope: this})" ng-model-options="{updateOn: \'blur\'}" ng-required="required" focus-target ng-keyup="_onKeyUp($event)"><div uib-dropdown is-open="isOpen" class="dropdown" dropdown-append-to-body="true" auto-close="outsideClick"><div uib-dropdown-menu><div uib-timepicker ng-model="_proxyModel" hour-step="hourstep" minute-step="minutestep" show-meridian="ismeridian" show-seconds="showseconds" ng-change="selectTime($event)"></div></div></div><input class="model-holder ng-hide" ng-disabled="disabled" ng-model="_model_"><span class="input-group-btn dropdown-toggle"><button type="button" class="btn btn-default btn-time" focus-target><i class="app-icon wi wi-access-time"></i></button></span></div>'),$templateCache.put("template/device/widget/form/time.html",'<input type="time" class="form-control app-textbox" init-widget has-model role="input" ng-model="_proxyModel"  ng-readonly="readonly"  ng-required="required"  ng-disabled="disabled"  ng-change="updateModel();_onChange({$event: $event, $scope: this})"> ')}]).directive("wmTime",["$rootScope","PropertiesFactory","WidgetUtilService","$timeout","$templateCache","$filter","Utils","$interval","CONSTANTS",function($rs,PropertiesFactory,WidgetUtilService,$timeout,$templateCache,$filter,Utils,$interval,CONSTANTS){"use strict";function setTimeModel($is){"timestamp"===$is.timepattern?$is._timeModel=$is._proxyModel&&$is._proxyModel.getTime():$is._timeModel=$filter("date")($is._proxyModel,$is.timepattern)}function propertyChangeHandler($is,$el,key,nv){var inputEl=$el.find("input"),buttonEl=$el.find("button");switch(key){case"readonly":case"disabled":inputEl.attr(key,nv),buttonEl.attr("disabled",nv),$el.css("pointer-events",$is.readonly||$is.disabled?"none":"all");break;case"autofocus":inputEl.first().attr(key,nv);break;case"timepattern":$is.showseconds=_.includes(nv,"ss"),$is.ismeridian=_.includes(nv,"hh"),setTimeModel($is)}}function _onClick($is,evt){evt.stopPropagation(),$is.onClick&&$is.onClick({$event:evt,$scope:$is})}function _onTimeClick($is,$el,evt){evt.stopPropagation();var timeOpen=$is.isOpen;$timeout(function(){$el.parent().trigger("click"),$is.isOpen=!timeOpen})}var widgetProps=PropertiesFactory.getPropertiesOf("wm.time",["wm.base","wm.base.editors.abstracteditors","wm.base.datetime"]),notifyFor={readonly:CONSTANTS.isRunMode,disabled:CONSTANTS.isRunMode,autofocus:!0,timepattern:!0};return{restrict:"E",replace:!0,scope:{},template:function($tEl,tAttrs){var isWidgetInsideCanvas,target,template="";return $rs.isMobileApplicationType&&"uib-picker"!==tAttrs.type?(template=WM.element(WidgetUtilService.getPreparedTemplate("template/device/widget/form/time.html",$tEl,tAttrs)),template[0].outerHTML):(template=WM.element($templateCache.get("template/widget/form/time.html",$tEl,tAttrs)),isWidgetInsideCanvas=tAttrs.hasOwnProperty("widgetid"),target=template.children("input.form-control"),template.find(".display-input").attr("name",tAttrs.name),isWidgetInsideCanvas||(template.attr("ng-click","_onClick($event)"),template.find(".btn-time").attr("ng-click","_onTimeClick($event)"),template.find(".display-input").attr("ng-click","_onTimeClick($event)"),tAttrs.hasOwnProperty("onMouseenter")&&template.attr("ng-mouseenter","onMouseenter({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onMouseleave")&&template.attr("ng-mouseleave","onMouseleave({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onFocus")&&target.attr("ng-focus","onFocus({$event: $event, $scope: this})"),tAttrs.hasOwnProperty("onBlur")&&target.attr("ng-blur","onBlur({$event: $event, $scope: this})")),template[0].outerHTML)},link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,$rs.isMobileApplicationType&&"uib-picker"!==attrs.type&&($is._nativeMode=!0)},post:function($is,$el,attrs){function setTimeInterval(cancel){return cancel?void $interval.cancel(timeInterval):void(CONSTANTS.isRunMode&&($is.disabled=!0,onPropertyChange("disabled",$is.disabled),timeInterval&&"canceled"!==timeInterval.$$state.value||(timeInterval=$interval(function(){$is._model_=CURRENT_TIME,$is._onChange()},1e3))))}function setProxyModel(val){var dateTime;val?isCurrentTime?($is._proxyModel=new Date,setTimeInterval()):(dateTime=Utils.getValidDateObject(val),$is._proxyModel=WM.isDate(dateTime)?dateTime:void 0,setTimeInterval(!0)):$is._proxyModel=void 0}function docClickListener(e){var $target=WM.element(e.target);$target.closest("[uib-timepicker]").length||$el[0].contains(e.target)||(document.removeEventListener("click",docClickListener,!0),$rs.$evalAsync(function(){$is.isOpen=!1}))}var timeInterval,onPropertyChange=propertyChangeHandler.bind(void 0,$is,$el),isCurrentTime=!1,CURRENT_TIME="CURRENT_TIME";WidgetUtilService.registerPropertyChangeListener(onPropertyChange,$is,notifyFor),$is.reset=function(){$is._model_=""},"false"!==attrs.ismeridian||attrs.timepattern||($is.timepattern=$is.timepattern.replace("hh","HH").replace(" a","")),WidgetUtilService.postWidgetCreate($is,$el,attrs),$is._onClick=_onClick.bind(void 0,$is),$is._onTimeClick=_onTimeClick.bind(void 0,$is,$el),$is.updateModel=function(){$is._model_=$is._proxyModel},$is.updateTimeModel=function(){isNaN(Date.parse(moment().format("YYYY-MM-DD")+" "+$is._timeModel))?this._proxyModel="":(setProxyModel($is._timeModel),setTimeModel($is))},$is.selectTime=function(event){$is._model_=$is._proxyModel,$is._onChange({$event:event,$scope:$is})},$is.widgetid||$timeout(function(){onPropertyChange("disabled",$is.disabled),onPropertyChange("readonly",$is.readonly)}),Object.defineProperty($is,"_model_",{get:function(){if($is.widgetid&&isCurrentTime)return CURRENT_TIME;var timestamp=this._proxyModel?this._proxyModel.valueOf():"";return this.timestamp=timestamp,"timestamp"===this.outputformat?timestamp:(this.outputformat||(this.outputformat="HH:mm:ss"),this._proxyModel?$filter("date")(this._proxyModel,this.outputformat):"")},set:function(val){var dateTime;return isCurrentTime=val===CURRENT_TIME,$is._nativeMode?void(val?(isCurrentTime?(dateTime=new Date,setTimeInterval()):(dateTime=Utils.getValidDateObject(val),setTimeInterval(!0)),this._proxyModel=new Date(dateTime.getFullYear(),dateTime.getMonth(),dateTime.getDate(),dateTime.getHours(),dateTime.getMinutes(),dateTime.getSeconds())):this._proxyModel=void 0):(setProxyModel(val),void setTimeModel($is))}}),attrs.datavalue&&!_.startsWith(attrs.datavalue,"bind:")&&($is._model_=attrs.datavalue,attrs.datavalue===CURRENT_TIME&&setTimeInterval()),$is.$on("$destroy",function(){setTimeInterval(!0)}),$timeout(function(){WM.element("body").find("> [uib-dropdown-menu] > [uib-timepicker]").parent().addClass("app-datetime")}),$is.widgetid||($is.$watch("isOpen",function(nv){nv&&document.addEventListener("click",docClickListener,!0)}),$is._onKeyUp=function($event){9===$event.keyCode&&($is.isOpen=!0)})}}}}]),WM.module("wm.widgets.form").run(["$templateCache",function($tc){"use strict";$tc.put("template/widget/richtexteditor.html",'<div class="app-richtexteditor clearfix" init-widget has-model apply-styles role="input"><div text-angular ng-model="_model_" ta-disabled="readonly" placeholder="Enter text"></div><div ng-bind-html="_model_" class="ta-preview" ng-if="showpreview"></div><input class="model-holder ng-hide" ng-disabled="disabled"></div>');
}]).directive("wmRichtexteditor",["PropertiesFactory","$templateCache","WidgetUtilService","$injector","Utils",function(PropertiesFactory,$tc,WidgetUtilService,$injector,Utils){"use strict";function getRule(el){var rule,id=el.find("[contenteditable]").attr("id");return id&&WM.element(document.head).find("style:not([id]):empty").each(function(){var _rules=this.sheet.cssRules||this.sheet.rules;if(_.forEach(_rules,function(_rule){if(_.includes(_rule.cssText,"#"+id))return rule=_rule.style,!1}),rule)return!1}),rule||{}}function propertyChangeHandler($is,$taEl,key,nv){switch(key){case"placeholder":$is._rule||($is._rule=getRule($taEl)),$is._rule.content='"'+nv+'"';break;case"showpreview":$is.showpreview=nv}}function getCursorPosition(){var selection,retObj,taSelection;taSelection=$injector.get("taSelection");try{selection=taSelection.getSelection(),retObj={start:selection.start.offset,end:selection.end.offset}}catch(e){retObj={}}return retObj}var widgetProps=PropertiesFactory.getPropertiesOf("wm.richtexteditor",["wm.base"]),notifyFor={placeholder:!0,showpreview:!0};return{restrict:"E",scope:{},replace:!0,template:function(tElement,tAttrs){var template=WM.element($tc.get("template/widget/richtexteditor.html"));return template.find(".model-holder").attr("name",tAttrs.name),template[0].outerHTML},link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs){WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is,$el.children().first()),$is,notifyFor);var ngModelCtrl,hiddenInputEl=$el.children("input");!attrs.widgetid&&attrs.scopedatavalue&&$is.$on("$destroy",$is.$watch("_model_",function(newVal){hiddenInputEl.val(newVal)})),ngModelCtrl=$el.children("[text-angular]").controller("ngModel"),ngModelCtrl.$viewChangeListeners.push(function(){$is._onChange(new Event("change"))}),$is.reset=function(){$is._model_=""},$is.getCursorPosition=getCursorPosition,WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]),WM.module("wm.widgets.grid").directive("wmGrid",["PropertiesFactory","WidgetUtilService","$compile","$controller","CONSTANTS","$rootScope","$timeout","Utils","LiveWidgetUtils","$document","AppDefaults",function(PropertiesFactory,WidgetUtilService,$compile,$controller,CONSTANTS,$rs,$timeout,Utils,LiveWidgetUtils,$document,AppDefaults){"use strict";function setFlags($is,eleScope){var variableType,boundToInnerDataSet,widgetName,binddataset=$is.binddataset;$is.isBoundToVariable=_.startsWith(binddataset,"bind:Variables."),$is.isBoundToWidget=_.startsWith(binddataset,"bind:Widgets."),$is.variableName=Utils.getVariableName($is),$is.variable=_.get(eleScope.Variables,$is.variableName),$is.isBoundToVariable&&$is.variable?($is.variableType=variableType=$is.variable.category,$is.isBoundToStaticVariable="wm.Variable"===variableType,$is.isBoundToLiveVariable="wm.LiveVariable"===variableType,boundToInnerDataSet=_.includes(binddataset,"dataSet."),$is.isBoundToLiveVariable?$is.isBoundToLiveVariableRoot=!boundToInnerDataSet:($is.isBoundToServiceVariable="wm.ServiceVariable"===variableType,$is.isBoundToServiceVariable&&"DataService"===$is.variable.serviceType&&($is.isBoundToProcedureServiceVariable="ProcedureExecution"===$is.variable.controller,$is.isBoundToQueryServiceVariable="QueryExecution"===$is.variable.controller))):$is.isBoundToWidget&&(widgetName=_.split(binddataset,".")[1],$is.widgetName=widgetName,$is.isBoundToSelectedItem=binddataset.indexOf("selecteditem")!==-1,$is.isBoundToSelectedItemSubset=binddataset.indexOf("selecteditem.")!==-1,$is.isBoundToFilter=$is.Widgets[widgetName]&&("wm-livefilter"===$is.Widgets[widgetName]._widgettype||"wm-livefilter"===$is.Widgets[widgetName].widgettype))}var gridColumnCount,widgetProps=PropertiesFactory.getPropertiesOf("wm.grid",["wm.base","wm.base.navigation","wm.layouts.panel.defaults"]),gridColumnMarkup="",notifyFor={width:!0,height:!0,gridfirstrowselect:!0,deleterow:!0,updaterow:!0,dataset:!0,showheader:!0,navigation:!0,insertrow:!0,show:!0,gridsearch:!0,filtermode:!0,searchlabel:!0,multiselect:!0,radioselect:!0,showrowindex:!0,enablesort:!0,gridcaption:!0,gridclass:!0,rowngclass:CONSTANTS.isStudioMode,rowclass:CONSTANTS.isStudioMode,nodatamessage:!0,loadingdatamsg:!0,loadingicon:!0,filternullrecords:!0,spacing:!0,exportformat:!0,editmode:CONSTANTS.isStudioMode},getObjectIndexInArray=function(key,value,arr){var i,index=-1;for(i=0;i<arr.length;i++)if(arr[i][key]===value){index=i;break}return index},EDIT_MODE={QUICK_EDIT:"quickedit",INLINE:"inline",FORM:"form",DIALOG:"dialog"};return{restrict:"E",scope:{scopedataset:"=?",onSelect:"&",onDeselect:"&",onSort:"&",onClick:"&",onHeaderclick:"&",onShow:"&",onHide:"&",onBeforerowinsert:"&",onRowinsert:"&",onBeforerowupdate:"&",onRowupdate:"&",onRowdeleted:"&",onRowdelete:"&",onBeforeformrender:"&",onFormrender:"&",onRowclick:"&",onRowdblclick:"&",onColumnselect:"&",onColumndeselect:"&",onEnterkeypress:"&",onSetrecord:"&",onDatarender:"&",onBeforedatarender:"&",onTap:"&"},replace:!0,transclude:!1,controller:"gridController",template:function(element){return gridColumnMarkup=element.html(),'<div data-identifier="grid" init-widget class="app-grid app-panel panel" apply-styles="shell"><div class="panel-heading" ng-if="title || subheading || iconclass || exportOptions.length || _actions.header.length"><h3 class="panel-title"><div class="pull-left"><i class="app-icon panel-icon {{iconclass}}" data-ng-show="iconclass"></i></div><div class="pull-left"><div class="heading">{{title}}</div><div class="description">{{subheading}}</div></div><div class="panel-actions app-datagrid-actions" ng-if="exportOptions.length || _actions.header.length"><wm-button ng-repeat="btn in _actions.header track by $index" caption="{{btn.displayName}}" show="bind:btn.show" class="{{btn.class}}" ng-class="{\'btn-sm\': spacing === \'condensed\', \'disabled-new\': btn.key === \'addNewRow\' && isGridEditMode}" iconclass="{{btn.iconclass}}" on-click="{{btn.action}}" type="button" shortcutkey="{{btn.shortcutkey}}" tabindex="{{btn.tabindex}}" hint="{{btn.title}}" disabled="bind:btn.disabled"></wm-button><wm-menu autoclose="always" caption="{{$root.appLocale.LABEL_EXPORT}}" ng-if="exportOptions.length" name="{{::name}}-export" scopedataset="exportOptions" on-select="export($item)" menuposition="down,left"></wm-menu></div></h3></div><div class="app-datagrid"></div><div class="panel-footer clearfix" ng-show="shownavigation || _actions.footer.length"><div class="app-datagrid-paginator" ng-show="(isStudioMode || dataNavigator.dataSize) && show && shownavigation"><wm-datanavigator show="{{show && shownavigation}}" navigationalign="{{navigationalign}}" navigationsize="{{navigationSize}}" navigation="{{navControls}}" showrecordcount="{{show && showrecordcount}}" maxsize="{{maxsize}}" boundarylinks="{{boundarylinks}}" forceellipses="{{forceellipses}}" directionlinks="{{directionlinks}}"></wm-datanavigator></div><div class="app-datagrid-actions" ng-if="_actions.footer.length"><wm-button ng-repeat="btn in _actions.footer track by $index" caption="{{btn.displayName}}" show="bind:btn.show" class="{{btn.class}}" ng-class="{\'btn-sm\': spacing === \'condensed\', \'disabled-new\': btn.key === \'addNewRow\' && isGridEditMode}" iconclass="{{btn.iconclass}}" on-click="{{btn.action}}" type="button" shortcutkey="{{btn.shortcutkey}}" tabindex="{{btn.tabindex}}"  hint="{{btn.title}}" disabled="bind:btn.disabled"></wm-button></div></div></div>'},compile:function(tElement,tAttr){function defineSelectedItemProp(scope){Object.defineProperty(scope,"selecteditem",{get:function(){return scope.multiselect?scope.items:_.isEmpty(scope.items)?{}:scope.items[0]},set:function(val){scope.items.length=0,scope.callDataGridMethod("selectRows",val)}})}var showHeader,showNavigation,contextEl=tElement.context,exportIconMapping={EXCEL:"fa fa-file-excel-o",CSV:"fa fa-file-text-o"};return tAttr.gridnoheader&&(contextEl.removeAttribute("gridnoheader"),tAttr.showheader||(showHeader=!("true"===tAttr.gridnoheader||tAttr.gridnoheader===!0),delete tAttr.gridnoheader,tAttr.showheader=showHeader,contextEl.setAttribute("showheader",showHeader))),tAttr.shownavigation&&(contextEl.removeAttribute("shownavigation"),showNavigation="true"===tAttr.shownavigation||tAttr.shownavigation===!0,delete tAttr.shownavigation,tAttr.navigation||(tAttr.navigation=showNavigation?"Basic":"None",contextEl.setAttribute("navigation",tAttr.navigation))),tAttr.gridColumnMarkup=gridColumnMarkup,gridColumnCount=(gridColumnMarkup.match(/<wm-grid-column/g)||[]).length,CONSTANTS.isStudioMode&&(window[tAttr.name+"Controller"]=WM.noop),{pre:function($is,element,attrs){$is.$on("security:before-child-remove",function(evt,childScope,childEl,childAttrs){evt.stopPropagation(),"addNewRow"===childAttrs.key&&($is._doNotAddNew=!0)}),$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,$is.allowPageable=!0;var elScope=element.scope();$is.Variables=elScope.Variables,$is.Widgets=elScope.Widgets,$is.pageParams=elScope.pageParams,$is.appLocale=$rs.appLocale,$is.columns={},$is.formfields={},Object.defineProperty($is,"selecteditem",{configurable:!0}),element.removeAttr("title"),WM.isDefined(attrs.enablecolumnselection)||!attrs.onColumnselect&&!attrs.onColumndeselect||($is.enablecolumnselection=attrs.enablecolumnselection=!0,WM.element(tElement.context).attr("enablecolumnselection",!0)),$is.isStudioMode=CONSTANTS.isStudioMode},post:function($is,element,attrs){function isInputBodyWrapper(target){var classes=[".dropdown-menu",".uib-typeahead-match",".modal-dialog",".toast"],isInput=!1;return _.forEach(classes,function(cls){if(target.closest(cls).length)return isInput=!0,!1}),isInput}function documentClickBind(event){var $target=event.target;element[0].contains($target)||event.target.doctype||isInputBodyWrapper($($target))||$is.callDataGridMethod("saveRow")}function getMatchModeMsgs(){return{start:$is.appLocale.LABEL_STARTS_WITH,end:$is.appLocale.LABEL_ENDS_WITH,anywhere:$is.appLocale.LABEL_CONTAINS,exact:$is.appLocale.LABEL_IS_EQUAL_TO,notequals:$is.appLocale.LABEL_IS_NOT_EQUAL_TO,lessthan:$is.appLocale.LABEL_LESS_THAN,lessthanequal:$is.appLocale.LABEL_LESS_THAN_OR_EQUALS_TO,greaterthan:$is.appLocale.LABEL_GREATER_THAN,greaterthanequal:$is.appLocale.LABEL_GREATER_THAN_OR_EQUALS_TO,null:$is.appLocale.LABEL_IS_NULL,isnotnull:$is.appLocale.LABEL_IS_NOT_NULL,empty:$is.appLocale.LABEL_IS_EMPTY,isnotempty:$is.appLocale.LABEL_IS_NOT_EMPTY,nullorempty:$is.appLocale.LABEL_IS_NULL_OR_EMPTY}}function onDestroy(){handlers.forEach(Utils.triggerFn),Utils.triggerFn($is.navigatorResultWatch),Utils.triggerFn($is.navigatorMaxResultWatch),Utils.triggerFn($is.gridDataWatch),$document.off("click",documentClickBind),Object.defineProperty($is,"selecteditem",{get:_.noop,set:_.noop})}function _redraw(forceRender){forceRender?$is.datagridElement.datagrid($is.gridOptions):$timeout(function(){$is.callDataGridMethod("setColGroupWidths"),$is.callDataGridMethod("addOrRemoveScroll")})}function propertyChangeHandler(key,newVal){var addNewRowButtonIndex,isFormMode;switch(key){case"width":$is.callDataGridMethod("setGridDimensions","width",newVal);break;case"height":$is.callDataGridMethod("setGridDimensions","height",newVal);break;case"gridfirstrowselect":$is.setDataGridOption("selectFirstRow",newVal);break;case"deleterow":$is.widgetid&&($is.renderOperationColumns(),$is.setDataGridOption("colDefs",Utils.getClonedObject($is.fieldDefs)));break;case"updaterow":$is.widgetid&&($is.renderOperationColumns(),$is.setDataGridOption("colDefs",Utils.getClonedObject($is.fieldDefs)));break;case"dataset":$is.watchVariableDataSet(newVal);break;case"showheader":CONSTANTS.isStudioMode&&$is.setDataGridOption("showHeader",newVal);break;case"gridsearch":newVal&&($is.filtermode="search");break;case"filtermode":$is.setDataGridOption("filtermode",newVal);break;case"searchlabel":$is.setDataGridOption("searchLabel",newVal);break;case"rowngclass":$is.setDataGridOption("rowNgClass",newVal);break;case"rowclass":$is.setDataGridOption("rowClass",newVal);break;case"multiselect":$is.widgetid&&(newVal&&($is.radioselect=!1,wp.radioselect.show=!1,wp.radioselect.showindesigner=!1,$is.$root.$emit("set-markup-attr",$is.widgetid,{radioselect:!1})),$is.setDataGridOption("multiselect",newVal));break;case"radioselect":$is.widgetid&&(newVal&&($is.multiselect=!1,wp.multiselect.show=!1,wp.multiselect.showindesigner=!1,$is.$root.$emit("set-markup-attr",$is.widgetid,{multiselect:!1})),$is.setDataGridOption("showRadioColumn",newVal));break;case"showrowindex":$is.widgetid&&$is.setDataGridOption("showRowIndex",newVal);break;case"navigation":if("Advanced"===newVal)return void($is.navigation="Classic");"None"!==newVal&&($is.shownavigation=!0,$is.enablePageNavigation()),$is.navControls=newVal,$is.widgetid&&(wp.showrecordcount.show=wp.showrecordcount.showindesigner=!_.includes(["None","Pager"],newVal));break;case"insertrow":if($is._doNotAddNew)return;$is.insertrow=newVal===!0||"true"===newVal,addNewRowButtonIndex=getObjectIndexInArray("key","addNewRow",$is.actions),$is.insertrow?addNewRowButtonIndex===-1&&$is.actions.unshift(_.find(LiveWidgetUtils.getLiveWidgetButtons("GRID"),function(button){return"addNewRow"===button.key})):$is.actions.length&&addNewRowButtonIndex!==-1&&$is.actions.splice(addNewRowButtonIndex,1),$is.populateActions();break;case"show":newVal?$is.onShow():$is.onHide();break;case"gridclass":$is.callDataGridMethod("option","cssClassNames.grid",newVal);break;case"nodatamessage":$is.callDataGridMethod("option","dataStates.nodata",newVal);break;case"loadingdatamsg":$is.callDataGridMethod("option","dataStates.loading",newVal);break;case"loadingicon":$is.callDataGridMethod("option","loadingicon",newVal);break;case"filternullrecords":CONSTANTS.isStudioMode&&$is.callDataGridMethod("option","filterNullRecords",newVal);break;case"spacing":$is.callDataGridMethod("option","spacing",newVal),"condensed"===newVal?$is.navigationSize="small":$is.navigationSize="";break;case"exportformat":$is.exportOptions=[],newVal&&_.forEach(_.split(newVal,","),function(type){$is.exportOptions.push({label:type,icon:exportIconMapping[type]})});break;case"editmode":$is.widgetid&&(isFormMode=$is.editmode===EDIT_MODE.DIALOG||$is.editmode===EDIT_MODE.FORM,wp.onRowdelete.show=!isFormMode,wp.onBeforerowinsert.show=!isFormMode,wp.onRowinsert.show=!isFormMode,wp.onBeforerowupdate.show=!isFormMode,wp.onRowupdate.show=!isFormMode,wp.onFormrender.show=!isFormMode,wp.onBeforeformrender.show=!isFormMode)}}var gridController,runModeInitialProperties={showrowindex:"showRowIndex",multiselect:"multiselect",radioselect:"showRadioColumn",filternullrecords:"filterNullRecords",enablesort:"enableSort",showheader:"showHeader",enablecolumnselection:"enableColumnSelection"},handlers=[],liveGrid=element.closest(".app-livegrid"),wp=$is.widgetProps;if(CONSTANTS.isRunMode)try{gridController=$is.name+"Controller",$controller(gridController,{$scope:$is})}catch(ignore){}attrs.gridcaption&&!attrs.title&&($is.title=$is.gridcaption),$is.matchModeTypesMap=LiveWidgetUtils.getMatchModeTypesMap(),$is.emptyMatchModes=["null","empty","nullorempty","isnotnull","isnotempty"],$is.matchModeMsgs=getMatchModeMsgs(),$is.gridElement=element,$is.gridColumnCount=gridColumnCount,$is.displayAllFields=""===attrs.displayall,$is.datagridElement=element.find(".app-datagrid"),$is.isPartOfLiveGrid=liveGrid.length>0,$is.actions=[],$is.rowActions=[],$is._actions={},$is.headerConfig=[],$is.items=[],$is.shownavigation="None"!==$is.navigation,$is.redraw=_.debounce(_redraw,150),$is.setFlags=setFlags.bind(void 0,$is,element.scope()),!attrs.readonlygrid&&WM.isDefined(attrs.editmode)||("true"===attrs.readonlygrid?$is.editmode="":$is.isPartOfLiveGrid?$is.editmode="inline"===liveGrid.isolateScope().formlayout?EDIT_MODE.FORM:EDIT_MODE.DIALOG:$is.editmode=attrs.readonlygrid?EDIT_MODE.INLINE:""),WM.element(element).css({position:"relative"}),void 0===$is.dataset&&"grid"!==attrs.identifier&&$is.watchVariableDataSet(""),handlers.push($rs.$on("wms:compile-grid-columns",function(event,scopeId,markup){$is.$id===scopeId&&($is.fullFieldDefs=[],$is.fieldDefs=[],$is.headerConfig=[],$compile(markup)($is),""===markup&&$is.setGridData([],!0),$is.renderOperationColumns(),$is.setDataGridOption("colDefs",Utils.getClonedObject($is.fieldDefs),!0))})),handlers.push($rs.$on("wms:compile-grid-actions",function(event,scopeId,markup){$is.$id===scopeId&&($is.actions=[],$compile(markup)($is))})),handlers.push($rs.$on("wms:compile-grid-row-actions",function(event,scopeId,markup,fromDesigner){var prevLength,forceSet;$is.$id===scopeId&&($is.rowActions=[],$compile(markup)($is)),prevLength=$is.fieldDefs.length,$is.renderOperationColumns(fromDesigner),forceSet=prevLength!==$is.fieldDefs.length,$is.setDataGridOption("colDefs",Utils.getClonedObject($is.fieldDefs),forceSet),$is.setDataGridOption("rowActions",Utils.getClonedObject($is.rowActions)),$is.setDataGridOption("showHeader",$is.showheader)})),handlers.push($rs.$on("locale-change",function(){$is.appLocale=$rs.appLocale,$is.matchModeMsgs=getMatchModeMsgs()})),handlers.push($is.$watch("binddataset",function(newVal,oldVal){var innerDataSetRegEx=/dataSet(\[\$i\])?\./;newVal!==oldVal&&($is.dataNavigatorWatched=!1,$is.dataNavigator&&($is.dataNavigator.result=void 0)),$is.setFlags(),($is.isBoundToVariable&&innerDataSetRegEx.test(newVal)||$is.isBoundToSelectedItem||$is.isBoundToSelectedItemSubset)&&$is.callDataGridMethod("setStatus","nodata",$is.nodatamessage),_.includes(newVal,"selecteditem.")&&(CONSTANTS.isRunMode?LiveWidgetUtils.fetchDynamicData($is,element.scope(),function(data){WM.isDefined(data)?($is.dataNavigatorWatched=!0,$is.dataset=data,$is.dataNavigator&&($is.dataNavigator.dataset=data)):$is.callDataGridMethod("setStatus","nodata",$is.nodatamessage)}):$is.callDataGridMethod("setStatus","error",$rs.locale.MESSAGE_GRID_CANNOT_LOAD_DATA_IN_STUDIO)),$is.widgetid&&(wp.pagesize.show=!($is.isBoundToLiveVariable||$is.isBoundToQueryServiceVariable)||!!$is.isBoundToWidget&&!$is.isBoundToFilter,wp.exportformat.show=wp.exportformat.showindesigner=wp.exportdatasize.show=wp.exportdatasize.showindesigner=$is.isBoundToLiveVariable||$is.isBoundToFilter||$is.isBoundToQueryServiceVariable,wp.multiselect.show=wp.multiselect.showindesigner=!$is.isPartOfLiveGrid&&wp.multiselect.show,wp.filtermode.disabled=$is.isBoundToFilter)})),handlers.push($rs.$on("toggle-variable-state",function(event,boundVariableName,active){($is.isBoundToLiveVariable||$is.isBoundToServiceVariable||$is.isBoundToFilter)&&boundVariableName===$is.variableName&&($is.variableInflight=active,active?$is.callDataGridMethod("setStatus","loading",$is.loadingdatamsg):!$is.isGridEditMode&&$is.gridData&&0===$is.gridData.length?$is.callDataGridMethod("setStatus","nodata",$is.nodatamessage):$is.callDataGridMethod("setStatus","ready"))})),$compile(attrs.gridColumnMarkup)($is),$is.gridOptions.rowActions=$is.rowActions,$is.gridOptions.headerConfig=$is.headerConfig,$is.rowActions.length&&$is.widgetid&&$is.renderOperationColumns(),$is.gridOptions.colDefs.map(function(column){$is.columns[column.field]=column}),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler,$is,notifyFor),defineSelectedItemProp($is),$timeout(function(){$is.dataNavigator=element.find("[data-identifier=datanavigator]").isolateScope(),WidgetUtilService.postWidgetCreate($is,element,attrs),!$is.widgetid&&attrs.scopedataset&&handlers.push($is.$watch("scopedataset",function(newVal){$is.dataNavigatorWatched?$is.dataNavigator.dataset=newVal:$is.dataset=newVal}))},0,!1),$is.widgetid||$is.editmode!==EDIT_MODE.QUICK_EDIT||(element.on("keyup",function(e){if(9===e.which&&WM.element(e.target).hasClass("app-grid")){var $row;$row=$is.datagridElement.find(".app-grid-content tr:first"),$row.length?$row.trigger("click",[void 0,{action:"edit"}]):$is.addNewRow()}}),$document.on("click",documentClickBind)),CONSTANTS.isRunMode&&(_.forEach(runModeInitialProperties,function(value,key){var attrValue=attrs[key];WM.isDefined(attrValue)&&($is.gridOptions[value]="true"===attrValue||attrValue===!0)}),$is.gridOptions.rowNgClass=$is.rowngclass,$is.gridOptions.rowClass=$is.rowclass,$is.gridOptions.editmode=$is.editmode,$is.gridOptions.isMobile=Utils.isMobile(),$is.renderOperationColumns()),$is.gridOptions.dateFormat=AppDefaults.get("dateFormat"),$is.gridOptions.timeFormat=AppDefaults.get("timeFormat"),$is.gridOptions.dateTimeFormat=AppDefaults.get("dateTimeFormat"),$is.gridOptions.name=$is.name||$is.$id,$is.datagridElement.datagrid($is.gridOptions),$is.callDataGridMethod("setStatus","loading",$is.loadingdatamsg),$is.$on("$destroy",onDestroy),element.on("$destroy",onDestroy)}}}}}]).controller("gridController",["$rootScope","$scope","$timeout","$compile","CONSTANTS","Utils","wmToaster","$servicevariable","LiveWidgetUtils","DialogService",function($rs,$is,$timeout,$compile,CONSTANTS,Utils,wmToaster,$servicevariable,LiveWidgetUtils,DialogService){"use strict";function isEmptyRecord(record){var data,isDisplayed,properties=Object.keys(record);return properties.every(function(prop,index){return data=record[prop],isDisplayed=$is.fieldDefs.length&&WM.isDefined($is.fieldDefs[index])&&(CONSTANTS.isMobile?$is.fieldDefs[index].mobileDisplay:$is.fieldDefs[index].pcDisplay)||!0,!isDisplayed||(null===data||void 0===data||""===data)})}function removeEmptyRecords(serviceData){var allRecords=serviceData.data||serviceData,filteredData=[];return allRecords&&allRecords.length&&(filteredData=allRecords.filter(function(record){return record&&!isEmptyRecord(record)})),filteredData}function setGridData(serverData,forceSet){var data=serverData;if(!forceSet&&($is.isBoundToLiveVariableRoot||WM.isDefined(serverData.propertiesMap))){if(!serverData.data||Utils.isEmptyObject(serverData.data))return;data=serverData.data}$is.filternullrecords?$is.gridData=removeEmptyRecords(data):$is.gridData=data,$is.variableInflight||($is.gridData&&0===$is.gridData.length?$is.callDataGridMethod("setStatus","nodata",$is.nodatamessage):$is.callDataGridMethod("setStatus","ready")),$is.$root.$safeApply($is)}function transformData(dataObject){var newObj,tempArr,keys,oldKeys,numKeys,newObject,tempObj,variableName;return dataObject=dataObject||[],variableName=$is.variableName,WM.isArray(dataObject)?WM.isString(dataObject[0])&&(tempArr=[],WM.forEach(dataObject,function(str){newObj={},newObj[variableName.split(".").join("-")]=str,tempArr.push(newObj)}),dataObject=tempArr):(WM.isString(dataObject)&&(keys=variableName.substring(variableName.indexOf(".")+1,variableName.length).split("."),oldKeys=[],numKeys=keys.length,newObject={},tempObj=newObject,WM.forEach(keys,function(key,index){WM.forEach(oldKeys,function(oldKey){tempObj=newObject[oldKey]}),tempObj[key]=index===numKeys-1?dataObject:{},oldKeys.push(key)}),dataObject=newObject),dataObject=[dataObject]),dataObject}function getSearchValue(value,type){return Utils.isNumberType(type)?_.toNumber(value):"datetime"===type?moment(value).valueOf():_.toString(value).toLowerCase()}function getFilteredData(data,searchObj){var currentVal,searchVal=getSearchValue(searchObj.value,searchObj.type);return data=_.filter(data,function(obj){var isExists;switch(currentVal=searchObj.field?getSearchValue(_.get(obj,searchObj.field),searchObj.type):_.values(obj).join(" ").toLowerCase(),searchObj.matchMode){case"start":isExists=_.startsWith(currentVal,searchVal);break;case"end":isExists=_.endsWith(currentVal,searchVal);break;case"exact":isExists=_.isEqual(currentVal,searchVal);break;case"notequals":isExists=!_.isEqual(currentVal,searchVal);break;case"null":isExists=_.isNull(currentVal,searchVal);break;case"isnotnull":isExists=!_.isNull(currentVal,searchVal);break;case"empty":isExists=_.isEmpty(currentVal,searchVal);break;case"isnotempty":isExists=!_.isEmpty(currentVal,searchVal);break;case"nullorempty":isExists=_.isNull(currentVal,searchVal)||_.isEmpty(currentVal,searchVal);break;case"lessthan":isExists=currentVal<searchVal;break;case"lessthanequal":isExists=currentVal<=searchVal;break;case"greaterthan":isExists=currentVal>searchVal;break;case"greaterthanequal":isExists=currentVal>=searchVal;break;default:isExists=Utils.isNumberType(searchObj.type)?_.isEqual(currentVal,searchVal):_.includes(currentVal,searchVal)}return isExists})}function getSearchResult(data,searchObj){return searchObj?(_.isArray(searchObj)?_.forEach(searchObj,function(obj){data=getFilteredData(data,obj)}):data=getFilteredData(data,searchObj),data):data}function getSortResult(data,sortObj){return sortObj&&sortObj.direction&&(data=_.orderBy(data,sortObj.field,sortObj.direction)),data}function populateGridData(serviceData){var data;$is.binddataset?($is.gridVariable=serviceData,$is.isBoundToLiveVariable||$is.isBoundToFilter||(serviceData=transformData(serviceData)),!$is.shownavigation&&$is.isClientSearch?(data=Utils.getClonedObject(serviceData),data=getSearchResult(data,$is.filterInfo),data=getSortResult(data,$is.sortInfo),$is.serverData=data):$is.serverData=serviceData):$is.serverData=serviceData,$is.columnDefsExists()&&!$is.newDefsRequired?setGridData($is.serverData):$is.widgetid||($is.newcolumns=!0,$is.newDefsRequired=!0,$is.createGridColumns($is.serverData))}function setFilterFields(filterFields,searchObj){var field=searchObj&&searchObj.field;field&&(filterFields[field]={value:searchObj.value,logicalOp:"AND"},searchObj.matchMode&&(filterFields[field].matchMode=searchObj.matchMode))}function getFilterFields(searchObj){var filterFields={};return _.isArray(searchObj)?_.forEach(searchObj,function(obj){setFilterFields(filterFields,obj)}):setFilterFields(filterFields,searchObj),filterFields}function refreshLiveVariable(page,success,error){var sortInfo=$is.sortInfo,sortOptions=sortInfo&&sortInfo.direction?sortInfo.field+" "+sortInfo.direction:"",filterFields=getFilterFields($is.filterInfo);$is.variable.listRecords({filterFields:filterFields,orderBy:sortOptions,page:page||1},success,error)}function refreshQueryServiceVariable(page,success,error){var sortInfo=$is.sortInfo,sortOptions=sortInfo&&sortInfo.direction?sortInfo.field+" "+sortInfo.direction:"";$is.variable.invoke({orderBy:sortOptions,page:page||1},success,error)}function refreshServiceVariable(success,error){$is.variable.invoke({},success,error)}function refreshLiveFilter(){var sortInfo=$is.sortInfo,sortOptions=sortInfo&&sortInfo.direction?sortInfo.field+" "+sortInfo.direction:"";$is.Widgets[$is.widgetName].applyFilter({orderBy:sortOptions})}function searchGrid(searchObj){$is.filterInfo=searchObj,refreshLiveVariable(1,WM.noop,function(){$is.toggleMessage(!0,"error",$is.nodatamessage)})}function sortHandler(sortObj,e){$is.gridOptions.sortInfo.field=sortObj.field,$is.gridOptions.sortInfo.direction=sortObj.direction,$is.sortInfo=Utils.getClonedObject(sortObj),$is.isBoundToFilter&&$is.widgetName?refreshLiveFilter():$is.isBoundToLiveVariable?refreshLiveVariable(1,function(){$is.onSort({$event:e,$data:$is.serverData})},function(error){$is.toggleMessage(!0,"error",error)}):$is.isBoundToQueryServiceVariable&&refreshQueryServiceVariable(1,function(){$is.onSort({$event:e,$data:$is.serverData})},function(error){$is.toggleMessage(!0,"error",error)})}function handleOperation(searchSortObj,e,type){var data;data=$is.shownavigation?Utils.getClonedObject($is.__fullData):Utils.getClonedObject($is.dataset),$is.isClientSearch=!0,"search"===type?$is.filterInfo=searchSortObj:$is.sortInfo=searchSortObj,WM.isObject(data)&&!WM.isArray(data)&&(data=[data]),data=getSearchResult(data,$is.filterInfo),data=getSortResult(data,$is.sortInfo),$is.serverData=data,$is.shownavigation?($is.dataNavigator.dn.currentPage=1,$is.dataNavigator.setPagingValues(data)):setGridData($is.serverData),"sort"===type&&$is.onSort({$event:e,$data:$is.serverData})}function defaultSearchHandler(searchObj){var data=Utils.getClonedObject($is.gridData),$rows=$is.datagridElement.find("tbody tr.app-datagrid-row");$is.filterInfo=searchObj,data=getSearchResult(data,searchObj),_.forEach($is.gridData,function(value,index){var $row=WM.element($rows[index]);_.find(data,function(obj){return _.isEqual(obj,value)})?$row.show():$row.hide()}),data&&data.length?($is.callDataGridMethod("setStatus","ready"),$is.gridfirstrowselect&&!$is.multiselect&&$is.callDataGridMethod("selectFirstRow",!0,!0)):($is.callDataGridMethod("setStatus","nodata",$is.nodatamessage),$is.selecteditem=void 0)}function getCompiledTemplate(htm,row,colDef,refreshImg){var ngSrc,imageEl,rowScope=$is.$new(),el=WM.element(htm);return rowScope.selectedItemData=rowScope.rowData=Utils.getClonedObject(row),rowScope.row=row,rowScope.row.getProperty=function(field){return row[field]},colDef?(rowScope.colDef=colDef,rowScope.columnValue=row[colDef.field],refreshImg&&"image"===colDef.widgetType&&(ngSrc=el.attr("data-ng-src"),ngSrc?imageEl=el:(imageEl=el.find("img"),ngSrc=imageEl.attr("data-ng-src")),ngSrc&&imageEl.attr("data-ng-src",ngSrc.concat((_.includes(ngSrc,"?")?"&_ts=":"?_ts=")+(new Date).getTime()))),$compile(el)(rowScope)):$compile(el)(rowScope)}function compileTemplateInGridScope(htm){var el=WM.element(htm);return $compile(el)($is)}function deleteRecord(row,cancelRowDeleteCallback,evt,callBack){var variable,variableType,successHandler=function(success){return success&&success.error?void $is.toggleMessage(!0,"error",$is.errormessage||success.error):($is.onRecordDelete(callBack),"wm.LiveVariable"===variableType&&$is.updateVariable(row,callBack),$is.toggleMessage(!0,"success",$is.deletemessage),$is.onRowdelete({$event:evt,$data:row,$rowData:row,$isolateScope:$is}),void $is.onRowdeleted({$event:evt,$data:row,$rowData:row,$isolateScope:$is}))},deleteFn=function(){if("wm.LiveVariable"===variableType||"wm.Variable"===variableType){if("wm.Variable"===variableType)return variable.removeItem(row),void successHandler(row);variable.deleteRecord({row:row,transform:!0,scope:$is.gridElement.scope(),skipNotification:!0},successHandler,function(error){Utils.triggerFn(callBack,void 0,!0),$is.toggleMessage(!0,"error",$is.errormessage||error)})}else $is.onRowdelete({$event:evt,$rowData:row,$isolateScope:$is});Utils.triggerFn(cancelRowDeleteCallback)};return variable=$is.variable,variableType=$is.variable&&$is.variable.category,$is.confirmdelete?void DialogService._showAppConfirmDialog({caption:"Delete Record",iconClass:"wi wi-delete fa-lg",content:$is.confirmdelete,resolve:{confirmActionOk:function(){return deleteFn},confirmActionCancel:function(){return function(){Utils.triggerFn(cancelRowDeleteCallback)}}}}):(deleteFn(),void Utils.triggerFn(cancelRowDeleteCallback))}function insertRecord(options){var variable=$is.variable,variableType=$is.variable&&$is.variable.category,dataObject={row:options.row,transform:!0,scope:$is.gridElement.scope(),skipNotification:!0},successHandler=function(response){if(response.error)$is.toggleMessage(!0,"error",$is.errormessage||response.error),Utils.triggerFn(options.error,response);else{if(options.event){var row=WM.element(options.event.target).closest("tr");$is.callDataGridMethod("hideRowEditMode",row)}$is.toggleMessage(!0,"success",$is.insertmessage),"wm.LiveVariable"===variableType&&($is.initiateSelectItem("last",response,void 0,$is.isBoundToStaticVariable,options.callBack),$is.updateVariable(response,options.callBack)),Utils.triggerFn(options.success,response),$is.onRowinsert({$event:options.event,$data:response,$rowData:response,$isolateScope:$is})}};if("wm.LiveVariable"===variableType||"wm.Variable"===variableType){if("wm.Variable"===variableType)return variable.addItem(options.row),void successHandler(options.row);variable.insertRecord(dataObject,successHandler,function(error){$is.toggleMessage(!0,"error",$is.errormessage||error),Utils.triggerFn(options.error,error),Utils.triggerFn(options.callBack,void 0,!0)})}else $is.onRowinsert({$event:options.event,$rowData:options.row,$isolateScope:$is})}function updateRecord(options){var variable=$is.variable,variableType=$is.variable&&$is.variable.category,dataObject={row:options.row,prevData:options.prevData,transform:!0,scope:$is.gridElement.scope(),skipNotification:!0
},successHandler=function(response){if(response.error)$is.toggleMessage(!0,"error",$is.errormessage||response.error),Utils.triggerFn(options.error,response);else{if(options.event){var row=WM.element(options.event.target).closest("tr");$is.callDataGridMethod("hideRowEditMode",row)}$is.toggleMessage(!0,"success",$is.updatemessage),"wm.LiveVariable"===variableType&&($is.initiateSelectItem("current",response,void 0,$is.isBoundToStaticVariable,options.callBack),$is.updateVariable(response,options.callBack)),Utils.triggerFn(options.success,response),$is.onRowupdate({$event:options.event,$data:response,$rowData:response,$isolateScope:$is})}};if("wm.LiveVariable"===variableType||"wm.Variable"===variableType){if("wm.Variable"===variableType)return variable.setItem(options.prevData,options.row),void successHandler(options.row);variable.updateRecord(dataObject,successHandler,function(error){$is.toggleMessage(!0,"error",$is.errormessage||error),Utils.triggerFn(options.error,error),Utils.triggerFn(options.callBack,void 0,!0)})}else $is.onRowupdate({$event:options.event,$rowData:options.row,$isolateScope:$is})}function setImageProperties(variableObj){variableObj&&($is.primaryKey=variableObj.getPrimaryKey(),$is.contentBaseUrl=(""!==variableObj._prefabName&&void 0!==variableObj._prefabName?"prefabs/"+variableObj._prefabName:"services")+"/"+variableObj.liveSource+"/"+variableObj.type+"/")}function selectItemOnSuccess(row,skipSelectItem,callBack){$timeout(function(){skipSelectItem||$is.selectItem(row,$is.dataset&&$is.dataset.data),Utils.triggerFn(callBack)},void 0,!1)}function resetSortStatus(variableSort){var gridSortString;_.isEmpty($is.sortInfo)||(gridSortString=$is.sortInfo.field+" "+$is.sortInfo.direction,variableSort=_.get($is.variable,["_options","orderBy"])||variableSort,gridSortString!==variableSort&&($is.callDataGridMethod("resetSortIcons"),$is.sortInfo={},$is.setDataGridOption("sortInfo",{})))}function checkFiltersApplied(variableSort){var variable=$is.variable;return $is.isBoundToLiveVariable?(_.isEmpty(_.get(variable,["_options","filterFields"]))&&$is.clearFilter(!0),void resetSortStatus(variableSort)):void($is.isBoundToQueryServiceVariable&&resetSortStatus(variableSort))}function updateMarkupForGrid(config){$is.widgetid&&Utils.getService("LiveWidgetsMarkupManager").updateMarkupForGrid(config)}function updateVariable(row,callBack){var variable=$is.variable;return $is.isBoundToFilter?($is.shownavigation||refreshLiveFilter(),void $is.Widgets[$is.widgetName].updateAllowedValues()):void(variable&&!$is.shownavigation&&refreshLiveVariable(1,function(){selectItemOnSuccess(row,!0,callBack)}))}function resetColumnDefinitions(){$is.fieldDefs=[],$is.setDataGridOption("colDefs",Utils.getClonedObject($is.fieldDefs))}function renderOperationColumns(fromDesigner){var rowActionCol,insertPosition,opConfig={},operations=[],rowOperationsColumn=LiveWidgetUtils.getRowOperationsColumn(),config={name:rowOperationsColumn.field,field:rowOperationsColumn.field,isPredefined:!0};$is.fieldDefs.length&&(rowActionCol=_.find($is.fullFieldDefs,{field:"rowOperations",type:"custom"}),_.remove($is.fieldDefs,{type:"custom",field:"rowOperations"}),_.remove($is.headerConfig,{field:rowOperationsColumn.field}),_.forEach(rowOperations,function(field,fieldName){(_.some($is.rowActions,{key:field.property})||!fromDesigner&&$is[field.property])&&(opConfig[fieldName]=rowOperations[fieldName].config,operations.push(fieldName))}),$is.rowActions.length?rowActionCol?(insertPosition=rowActionCol.rowactionsposition?_.toNumber(rowActionCol.rowactionsposition):$is.fieldDefs.length,$is.fieldDefs.splice(insertPosition,0,rowActionCol),0===insertPosition?$is.headerConfig.unshift(config):$is.headerConfig.push(config)):($is.fieldDefs.push(rowOperationsColumn),$is.headerConfig.push(config)):!fromDesigner&&operations.length&&(rowOperationsColumn.operations=operations,rowOperationsColumn.opConfig=opConfig,$is.fieldDefs.push(rowOperationsColumn),$is.headerConfig.push(config)),$is.setDataGridOption("headerConfig",$is.headerConfig))}function addNewRow(){$is.isGridEditMode||($is.callDataGridMethod("addNewRow"),$is.$emit("add-new-row"),$rs.$emit("wm-event",$is.widgetid,"create"))}function resetPageNavigation(){$is.dataNavigator&&$is.dataNavigator.resetPageNavigation()}function enablePageNavigation(){$is.dataset&&""!==_.get($is.dataset,"dataValue")&&!_.isEmpty($is.dataset)&&$is.dataNavigator&&($is.dataNavigator.pagingOptions={maxResults:$is.pagesize||5},Utils.triggerFn($is.navigatorResultWatch),$is.dataNavigator.dataset=$is.binddataset||$is.dataset,$is.navigatorResultWatch=$is.dataNavigator.$watch("result",function(newVal){WM.isDefined(newVal)?_.isEqual($is.dataset,newVal)?$is.watchVariableDataSet(newVal):WM.isArray(newVal)?$is.dataset=[].concat(newVal):WM.isObject(newVal)?$is.dataset=WM.extend({},newVal):$is.dataset=newVal:$is.dataset=void 0},!0),Utils.triggerFn($is.navigatorMaxResultWatch),$is.navigatorMaxResultWatch=$is.dataNavigator.$watch("maxResults",function(newVal){$is.pagesize=newVal}),$is.dataNavigatorWatched=!0,WM.isObject($is.dataset)&&Utils.isPageable($is.dataset)?$is.__fullData=$is.dataset.content:$is.__fullData=$is.dataset,$is.dataset=void 0)}function fetchDynamicColumnDefs(){var fields,result,f,dataKeys;result=LiveWidgetUtils.fetchReferenceDetails($is),result.fields?(f=result.fields,dataKeys=Object.keys(f),fields={},dataKeys.forEach(function(key){fields[key]=""})):result.relatedFieldType&&(fields=$servicevariable.getServiceModel({typeRef:result.relatedFieldType,variable:result.referenceVariable})),fields&&$is.watchVariableDataSet(fields)}function isDataValid(){var error,dataset=$is.dataset||{};return dataset.error&&(error=dataset.error),dataset.data&&dataset.data.error&&dataset.data.errorMessage&&(error=dataset.data.errorMessage),!error||(setGridData([]),$is.callDataGridMethod("setStatus","error",error),!1)}function setSortSearchHandlers(isPageable){$is.isBoundToVariable&&$is.variable?$is.isBoundToLiveVariable?($is.setDataGridOption("searchHandler",searchGrid),$is.setDataGridOption("sortHandler",sortHandler),setImageProperties($is.variable)):$is.isBoundToQueryServiceVariable?($is.setDataGridOption("searchHandler",defaultSearchHandler),$is.setDataGridOption("sortHandler",sortHandler)):$is.isBoundToProcedureServiceVariable?($is.setDataGridOption("searchHandler",handleOperation),$is.setDataGridOption("sortHandler",handleOperation)):($is.setDataGridOption("searchHandler",handleOperation),isPageable?$is.setDataGridOption("sortHandler",sortHandler):$is.setDataGridOption("sortHandler",handleOperation)):$is.isBoundToFilter?($is.setDataGridOption("sortHandler",sortHandler),setImageProperties($is.variable)):$is.isBoundToSelectedItem?($is.setDataGridOption("searchHandler",handleOperation),$is.setDataGridOption("sortHandler",handleOperation)):$is.binddataset.indexOf("bind:Widgets")===-1&&$is.callDataGridMethod("setStatus","error",$is.nodatamessage)}function watchVariableDataSet(newVal){var variableName,result,variableSortString,columns,widgetBindingDetails,relatedTables,isPageable=!1;if(!($is.dataNavigatorWatched&&_.isUndefined(newVal)&&$is.__fullData)&&($is.variableInflight&&$is.callDataGridMethod("setStatus","loading",$is.loadingdatamsg),$is.setFlags(),result=Utils.getValidJSON(newVal),$is.gridVariable="",$is.widgetid&&WM.isDefined($is.$parent)&&$is.$parent.redrawColumns&&($is.newcolumns=$is.$parent.redrawColumns),result&&(newVal=result),$is.isDataValid())){if(WM.isObject(newVal)&&Utils.isPageable(newVal)&&(variableSortString=Utils.getOrderByExpr(newVal.sort),newVal=newVal.content,isPageable=!0),CONSTANTS.isRunMode&&newVal&&""!==_.get(newVal,"dataValue")&&!_.isEmpty(newVal)){if($is.shownavigation&&!$is.dataNavigatorWatched)return void $is.enablePageNavigation()}else $is.resetPageNavigation(),CONSTANTS.isRunMode&&($is.callDataGridMethod("setStatus","nodata",$is.nodatamessage),$is.setDataGridOption("selectFirstRow",$is.gridfirstrowselect));if(CONSTANTS.isRunMode&&!$is.shownavigation&&checkFiltersApplied(variableSortString),$is.binddataset){if($is.isBoundToWidget&&($is.isBoundToSelectedItemSubset||$is.isBoundToSelectedItem)&&(null===$is.variableName&&(widgetBindingDetails=LiveWidgetUtils.fetchReferenceDetails($is),widgetBindingDetails.fields||(relatedTables=widgetBindingDetails.referenceVariable&&widgetBindingDetails.referenceVariable.relatedTables||[],variableName=widgetBindingDetails.referenceVariableName,relatedTables.forEach(function(val){val.columnName===widgetBindingDetails.relatedFieldName&&(variableName=val.watchOn)}),$is.variableName=variableName,$is.variable=_.get($is.gridElement.scope().Variables,$is.variableName))),$is.widgetid&&""!==newVal&&($is.binddataset==="bind:"+newVal||WM.isArray(newVal)&&!newVal.length)))return void $is.fetchDynamicColumnDefs();setSortSearchHandlers(isPageable)}return!WM.isObject(newVal)||newVal&&""===newVal.dataValue?void((""===newVal||newVal&&""===newVal.dataValue)&&($is.widgetid&&$is.newcolumns&&($is.prepareFieldDefs(),$is.newcolumns=!1),$is.variableInflight||setGridData([]))):void(newVal?($is.widgetid&&($is.createGridColumns($is.isBoundToLiveVariableRoot?newVal.data:newVal,newVal.propertiesMap||void 0),$is.newcolumns=!1),$is.fieldDefs&&$is.columnDefsExists()&&newVal.propertiesMap&&(columns=Utils.fetchPropertiesMapColumns(newVal.propertiesMap),$is.fieldDefs.forEach(function(fieldDef){Object.keys(columns).forEach(function(key){key===fieldDef.field&&(fieldDef.type=columns[key].type)})})),populateGridData(newVal),$is.isBoundToServiceVariable&&CONSTANTS.isStudioMode&&($is.gridData=[],$is.callDataGridMethod("setStatus","error",$rs.locale.MESSAGE_GRID_CANNOT_LOAD_DATA_IN_STUDIO))):$is.widgetid&&($is.callDataGridMethod("setStatus","nodata",$is.nodatamessage),$is.setDataGridOption("selectFirstRow",$is.gridfirstrowselect),$is.newcolumns&&($is.prepareFieldDefs(),$is.newcolumns=!1)))}}function createGridColumns(data,propertiesMap){var dataValid=data&&!data.error;dataValid&&!WM.isArray(data)&&(data=[data]),$is.newcolumns&&(propertiesMap?$is.prepareFieldDefs(data,propertiesMap):$is.prepareFieldDefs(data)),dataValid&&($is.serverData=data,setGridData($is.serverData))}function prepareFieldDefs(data,propertiesMap){var defaultFieldDefs,properties,columns,gridObj,options={};$is.fieldDefs=[],$is.headerConfig=[],propertiesMap?(columns=Utils.fetchPropertiesMapColumns(propertiesMap),properties=[Utils.resetObjectWithEmptyValues(columns)]):properties=data,options.columnUpperBound=$is.displayAllFields?-1:10,defaultFieldDefs=Utils.prepareFieldDefs(properties,options),WM.forEach(defaultFieldDefs,function(columnDef){var newColumn;columnDef.pcDisplay=!0,columnDef.mobileDisplay=!0,columnDef.searchable=!0,columnDef.type="string",WM.forEach($is.fullFieldDefs,function(column){column.field&&column.field===columnDef.field&&(columnDef.pcDisplay=column.pcDisplay,columnDef.mobileDisplay=column.mobileDisplay,columnDef.customExpression=column.customExpression,columnDef.width=column.width,columnDef.textAlignment=column.textAlignment,columnDef.backgroundColor=column.backgroundColor,columnDef.textColor=column.textColor,columnDef.widgetType=column.widgetType,columnDef.displayName=column.displayName,columnDef.class=column.class,columnDef.ngclass=column.ngclass,columnDef.formatpattern=column.formatpattern,columnDef.datepattern=column.datepattern,columnDef.currencypattern=column.currencypattern,columnDef.fractionsize=column.fractionsize,columnDef.suffix=column.suffix,columnDef.prefix=column.prefix,columnDef.accessroles=column.accessroles)}),propertiesMap&&(newColumn=columns[columnDef.field],columnDef.type=newColumn.type,columnDef.primaryKey=newColumn.isPrimaryKey,columnDef.generator=newColumn.generator,columnDef.readonly=WM.isDefined(newColumn.readonly)?"true"===newColumn.readonly:newColumn.relatedEntityName?!newColumn.isPrimaryKey:_.includes(["identity","uniqueid","sequence"],newColumn.generator),"timestamp"!==columnDef.type&&"datetime"!==columnDef.type&&"date"!==columnDef.type||(columnDef.formatpattern||(columnDef.formatpattern="toDate"),columnDef.datepattern||(columnDef.datepattern="date"===columnDef.type?"yyyy-MM-dd":"dd-MMM-yyyy HH:mm:ss")),"blob"!==columnDef.type||columnDef.customExpression||("image"===columnDef.widgetType?columnDef.customExpression='<img ng-if="columnValue != null" width="48px" class="wm-icon wm-icon24 wi wi-file" data-ng-src="{{contentBaseUrl + row[primaryKey] + \'/content/\'+ colDef.field}}"/>':columnDef.customExpression='<a ng-if="columnValue != null" class="col-md-9" target="_blank" data-ng-href="{{contentBaseUrl + row[primaryKey] + \'/content/\'+ colDef.field}}"><i class="wm-icon wm-icon24 wi wi-file"></i></a>')),$is.headerConfig.push({name:columnDef.field,field:columnDef.field})}),$is.fieldDefs=Utils.getClonedObject(defaultFieldDefs),renderOperationColumns(),gridObj={widgetName:$is.name,fieldDefs:defaultFieldDefs,scopeId:$is.$id},$is.updateMarkupForGrid(gridObj),$is.setDataGridOption("colDefs",Utils.getClonedObject($is.fieldDefs))}function setDataGridOption(optionName,newVal,forceSet){if($is.datagridElement.datagrid("instance")){var option={};!WM.isDefined(newVal)||WM.equals(newVal,$is.gridOptions[optionName])&&!forceSet||(option[optionName]=newVal,$is.datagridElement.datagrid("option",option),$is.gridOptions[optionName]=newVal)}}function initiateSelectItem(index,row,skipSelectItem,isStaticVariable,callBack){"last"===index&&(isStaticVariable||($is.dataNavigator.dataSize+=1),$is.shownavigation||(index="current")),$is.dataNavigator.calculatePagingValues(),$is.dataNavigator.navigatePage(index,null,!0,function(){($is.shownavigation||isStaticVariable)&&selectItemOnSuccess(row,skipSelectItem,callBack)})}function selectItem(item,data){data&&($is.serverData=data),$is.variable&&"wm.LiveVariable"===$is.variable.category&&(item=_.omitBy(item,function(value){return _.isArray(value)&&_.isEmpty(value)})),$is.callDataGridMethod("selectRow",item,!0)}function deselectItem(item){$is.callDataGridMethod("deselectRow",item)}function columnDefsExists(){var i,n;for(i=0,n=$is.fieldDefs.length;i<n;i+=1)if($is.fieldDefs[i].field)return!0;return!1}function deleteRow(evt){var row;evt&&evt.target?$is.callDataGridMethod("deleteRowAndUpdateSelectAll",evt):$timeout(function(){row=evt||$is.selectedItems[0],deleteRecord(row)})}function editRow(evt){var row;evt&&evt.target?$is.callDataGridMethod("toggleEditRow",evt,{selectRow:!0}):"form"===$is.editmode||"dialog"===$is.editmode?(row=evt||$is.selectedItems[0],$is.gridOptions.beforeRowUpdate(row)):$timeout(function(){row=$is.datagridElement.find("tr.active"),row.length&&$is.callDataGridMethod("toggleEditRow",void 0,{$row:row,action:"edit"})})}function addRow(){$is.addNewRow()}function onRecordDelete(callBack){var index;$is.dataNavigator&&($is.dataNavigator.dataSize-=1,$is.dataNavigator.calculatePagingValues(),index=$is.dataNavigator.pageCount<$is.dataNavigator.dn.currentPage?"prev":void 0,$is.dataNavigator.navigatePage(index,null,!0,function(){$timeout(function(){Utils.triggerFn(callBack)},void 0,!1)}))}function call(operation,data,success,error){switch(data.success=success,data.error=error,operation){case"create":insertRecord(data);break;case"update":updateRecord(data);break;case"delete":deleteRecord(data)}}function exportData($item){var filterFields,variable=$is.variable,sortOptions=_.isEmpty($is.sortInfo)?"":$is.sortInfo.field+" "+$is.sortInfo.direction;$is.isBoundToFilter?$is.Widgets[$is.widgetName].applyFilter({orderBy:sortOptions,exportFormat:$item.label,exportdatasize:$is.exportdatasize}):($is.isBoundToLiveVariable||$is.isBoundToQueryServiceVariable)&&(filterFields=getFilterFields($is.filterInfo),variable.download({matchMode:"anywhere",filterFields:filterFields,orderBy:sortOptions,exportFormat:$item.label,logicalOp:"AND",size:$is.exportdatasize},function(errMsg){wmToaster.error("Error",errMsg)}))}function populateActions(){$is._actions.header=[],$is._actions.footer=[],_.forEach($is.actions,function(action){_.includes(action.position,"header")&&$is._actions.header.push(action),_.includes(action.position,"footer")&&$is._actions.footer.push(action)})}function onRowFilterChange(fieldName,type){var searchObj=[];_.forEach($is.rowFilter,function(value,key){(WM.isDefined(value.value)&&""!==value.value||_.includes($is.emptyMatchModes,value.matchMode))&&(key===fieldName&&(value.type=value.type||type,value.matchMode=value.matchMode||_.get($is.matchModeTypesMap[type],0)),searchObj.push({field:key,value:value.value,matchMode:value.matchMode,type:value.type}))}),$is.gridOptions.searchHandler(searchObj,void 0,"search")}function onFilterConditionSelect(field,condition){$is.rowFilter[field]=$is.rowFilter[field]||{},$is.rowFilter[field].matchMode=condition,_.includes($is.emptyMatchModes,condition)?($is.rowFilter[field].value=void 0,$is.onRowFilterChange()):$is.rowFilter[field].value?$is.onRowFilterChange():$timeout(function(){$is.Widgets[($is.name||$is.$id)+"_filter_"+field].focus()})}function clearRowFilter(field){$is.rowFilter&&$is.rowFilter[field]&&($is.rowFilter[field].value=void 0,$is.onRowFilterChange())}function showClearIcon(field){var value=$is.rowFilter[field]&&$is.rowFilter[field].value;return WM.isDefined(value)&&""!==value&&null!==value}function toggleMessage(show,type,msg,header){show&&msg?wmToaster.show(type,WM.isDefined(header)?header:type.toUpperCase(),msg):wmToaster.hide()}function onPaginationchange(){$is.datagridElement.find(".app-grid-content").scrollTop(0)}function clearFilter(skipFilter){var $gridElement;$is.filterInfo={},"multicolumn"===$is.filtermode?($is.rowFilter={},skipFilter||$is.onRowFilterChange()):"search"===$is.filtermode&&($gridElement=$is.datagridElement,$gridElement.find('[data-element="dgSearchText"]').val(""),$gridElement.find('[data-element="dgFilterValue"]').val(""),skipFilter||$gridElement.find(".app-search-button").trigger("click"))}function refreshData(isSamePage){var page=isSamePage?$is.dataNavigator.dn.currentPage:1;return $is.isBoundToLiveVariable?void refreshLiveVariable(page):$is.isBoundToQueryServiceVariable?void refreshQueryServiceVariable(page):$is.isBoundToServiceVariable?void refreshServiceVariable():void($is.isBoundToFilter&&refreshLiveFilter())}function onDataNavigatorDataSetChange(newVal){var data,variableSort;return WM.isObject(newVal)&&Utils.isPageable(newVal)?(variableSort=Utils.getOrderByExpr(newVal.sort),$is.__fullData=newVal.content):$is.__fullData=newVal,checkFiltersApplied(variableSort),$is.isClientSearch?(data=Utils.getClonedObject(newVal),data=getSearchResult(data,$is.filterInfo),data=getSortResult(data,$is.sortInfo)):newVal}function callDataGridMethod(){if($is.datagridElement.datagrid("instance"))return $is.datagridElement.datagrid.apply($is.datagridElement,arguments)}function hideEditRow(){var $row=$is.datagridElement.find("tr.row-editing");$row.length&&$is.callDataGridMethod("hideRowEditMode",$row)}function saveRow(){$is.callDataGridMethod("saveRow")}function cancelRow(){var $row=$is.datagridElement.find("tr.row-editing");$row.length&&$is.callDataGridMethod("cancelEdit",$row)}var rowOperations={update:{config:{label:"Update",value:"update"},property:"updaterow"},delete:{config:{label:"Delete",value:"delete"},property:"deleterow"}};$is.setGridData=setGridData.bind(void 0),$is.rowFilter={},$is.filterInfo={},$is.fieldDefs=[],$is.fullFieldDefs=[],$is.selectedItems=[],$is.isGridEditMode=!1,$is.formWidgets={},$is.gridData=[],$is.updateMarkupForGrid=updateMarkupForGrid,$is.updateVariable=updateVariable,$is.resetColumnDefinitions=resetColumnDefinitions,$is.renderOperationColumns=renderOperationColumns,$is.addNewRow=addNewRow,$is.resetPageNavigation=resetPageNavigation,$is.enablePageNavigation=enablePageNavigation,$is.fetchDynamicColumnDefs=fetchDynamicColumnDefs,$is.isDataValid=isDataValid,$is.watchVariableDataSet=watchVariableDataSet,$is.createGridColumns=createGridColumns,$is.prepareFieldDefs=prepareFieldDefs,$is.setDataGridOption=setDataGridOption,$is.initiateSelectItem=initiateSelectItem,$is.selectItem=selectItem,$is.highlightRow=$is.selectItem,$is.deselectItem=deselectItem,$is.columnDefsExists=columnDefsExists,$is.deleteRow=deleteRow,$is.editRow=editRow,$is.addRow=addRow,$is.hideEditRow=hideEditRow,$is.saveRow=saveRow,$is.cancelRow=cancelRow,$is.onRecordDelete=onRecordDelete,$is.call=call,$is.export=exportData,$is.populateActions=populateActions,$is.onRowFilterChange=onRowFilterChange,$is.onFilterConditionSelect=onFilterConditionSelect,$is.clearRowFilter=clearRowFilter,$is.showClearIcon=showClearIcon,$is.toggleMessage=toggleMessage,$is.onPaginationchange=onPaginationchange,$is.clearFilter=clearFilter,$is.refreshData=refreshData,$is.onDataNavigatorDataSetChange=onDataNavigatorDataSetChange,$is.callDataGridMethod=callDataGridMethod,$is.gridDataWatch=$is.$watch("gridData",function(newValue){var startRowIndex,gridOptions;WM.isDefined(newValue)&&($is.shownavigation&&$is.dataNavigator&&$is.dataNavigator.dn.currentPage&&(startRowIndex=($is.dataNavigator.dn.currentPage-1)*($is.dataNavigator.maxResults||1)+1,$is.setDataGridOption("startRowIndex",startRowIndex)),gridOptions=$is.callDataGridMethod("getOptions"),!gridOptions.colDefs.length&&$is.fieldDefs.length&&$is.setDataGridOption("colDefs",Utils.getClonedObject($is.fieldDefs)),_.map(gridOptions.colDefs,function(column){$is.columns[column.field]=column}),!_.isEmpty(newValue)&&gridOptions.colDefs.length&&$is.onBeforedatarender({$isolateScope:$is,$data:newValue,$columns:$is.columns}),$is.setDataGridOption("data",Utils.getClonedObject(newValue)))}),$is.gridOptions={data:Utils.getClonedObject($is.gridData),colDefs:$is.fieldDefs,startRowIndex:1,onDataRender:function(){$is.multiselect||($is.items.length=0),$is.callDataGridMethod("selectRows",$is.items),$is.selectedItems=$is.callDataGridMethod("getSelectedRows"),$is.gridData.length&&$is.onDatarender({$isolateScope:$is,$data:$is.gridData}),CONSTANTS.isRunMode&&$is.isBoundToQueryServiceVariable&&$is.filterInfo&&defaultSearchHandler($is.filterInfo)},onRowSelect:function(rowData,e){$is.selectedItems=$is.callDataGridMethod("getSelectedRows"),$is.multiselect?_.findIndex($is.items,rowData)===-1&&$is.items.push(rowData):($is.items.length=0,$is.items.push(rowData)),$is.onSelect({$data:rowData,$event:e,$rowData:rowData,$isolateScope:$is}),$is.onRowclick({$data:rowData,$event:e,$rowData:rowData,$isolateScope:$is}),WM.isDefined($is.onClick)&&$is.onClick({$data:rowData,$event:e,$rowData:rowData,$isolateScope:$is}),WM.isDefined($is.onTap)&&$is.onTap({$data:rowData,$event:e,$rowData:rowData,$isolateScope:$is}),$rs.$safeApply($is)},onRowDblClick:function(rowData,e){$is.onRowdblclick({$data:rowData,$event:e,$rowData:rowData,$isolateScope:$is}),$rs.$safeApply($is)},onRowDeselect:function(rowData,e){$is.multiselect&&($is.items=_.pullAllWith($is.items,[rowData],_.isEqual),$is.selectedItems=$is.callDataGridMethod("getSelectedRows"),$is.onDeselect({$data:rowData,$event:e,$rowData:rowData,$isolateScope:$is}),$rs.$safeApply($is))},onColumnSelect:function(col,e){$is.selectedColumns=$is.callDataGridMethod("getSelectedColumns"),$is.onColumnselect({$data:col,$event:e}),$rs.$safeApply($is)},onColumnDeselect:function(col,e){$is.selectedColumns=$is.callDataGridMethod("getSelectedColumns"),$is.onColumndeselect({$data:col,$event:e}),$rs.$safeApply($is)},onHeaderClick:function(col,e){$is.onHeaderclick({$event:e,$data:col})},onRowDelete:function(rowData,cancelRowDeleteCallback,e,callBack){deleteRecord(rowData,cancelRowDeleteCallback,e,callBack)},onRowInsert:function(rowData,e,callBack){insertRecord({row:rowData,event:e,callBack:callBack})},beforeRowUpdate:function(rowData,e,eventName){$is.$emit("update-row",$is.widgetid,rowData,eventName),$is.prevData=Utils.getClonedObject(rowData),$rs.$safeApply($is),$rs.$emit("wm-event",$is.widgetid,"update")},afterRowUpdate:function(rowData,e,callBack){updateRecord({row:rowData,prevData:$is.prevData,event:e,callBack:callBack})},onBeforeRowUpdate:function(rowData,e){return $is.onBeforerowupdate({$event:e,$data:rowData,$rowData:rowData,$isolateScope:$is})},onBeforeRowInsert:function(rowData,e){return $is.onBeforerowinsert({$event:e,$data:rowData,$rowData:rowData,$isolateScope:$is})},onFormRender:function($row,e,operation){$is.formWidgets=LiveWidgetUtils.getFormFilterWidgets($row,"data-field-name"),$is.onFormrender({$event:e,formWidgets:$is.formWidgets,$operation:operation}),$rs.$safeApply($is)},onBeforeFormRender:function(rowData,e,operation){return $is.onBeforeformrender({$event:e,$rowData:rowData,$operation:operation})},sortInfo:{field:"",direction:""},getCompiledTemplate:function(htm,row,colDef,refreshImg){return getCompiledTemplate(htm,row,colDef,refreshImg)},compileTemplateInGridScope:function(htm){return compileTemplateInGridScope(htm)},getBindDataSet:function(){return $is.binddataset},setGridEditMode:function(val){$is.isGridEditMode=val,val||($is.formWidgets={}),$rs.$safeApply($is)},noChangesDetected:function(){$is.toggleMessage(!0,"info",$is.appLocale.MESSAGE_NO_CHANGES,""),$rs.$safeApply($is)},afterSort:function(e){$rs.$safeApply($is),$is.onSort({$event:e,$data:$is.serverData})},handleCustomEvents:function(e,options){if(options)$is.callDataGridMethod("toggleEditRow",e,options);else{var $ele=WM.element(e.target),$button=$ele.closest("button"),key=$button.attr("data-action-key"),events=_.find($is.rowActions,{key:key}).action||"",callBackScope=$button.scope(),$row=$ele.closest("tr"),rowId=$row.attr("data-row-id"),data=$is.gridOptions.data[rowId];events&&Utils.triggerCustomEvents(e,events,callBackScope,data)}},redrawWidgets:function(){$is.datagridElement.find("tr.filter-row .ng-isolate-scope, tr.row-editing .ng-isolate-scope").each(function(){Utils.triggerFn(WM.element(this).isolateScope().redraw)})},searchHandler:handleOperation,sortHandler:handleOperation}}]).directive("wmGridColumnGroup",["LiveWidgetUtils","CONSTANTS","BindingManager","Utils",function(LiveWidgetUtils,CONSTANTS,BindingManager,Utils){"use strict";return{restrict:"E",scope:!0,template:"<div ng-transclude></div>",replace:!0,transclude:!0,link:{pre:function(scope,element,attrs){function watchProperty(property,expression){exprWatchHandlers[property]=BindingManager.register(parentScope,expression,function(newVal){newVal=WM.isDefined(newVal)?newVal:"","displayName"===property&&scope.callDataGridMethod("setColumnProp",config.field,property,newVal,!0)},{deepWatch:!0,allowPageable:!0,acceptsArray:!1})}var exprWatchHandlers=[],$parentEl=element.parent(),parentScope=scope.$parent,config={field:attrs.name,displayName:attrs.caption,columns:[],isGroup:!0,accessroles:attrs.accessroles,backgroundColor:attrs.backgroundcolor,textAlignment:attrs.textalignment||"center",class:attrs.colClass||""};LiveWidgetUtils.setHeaderConfigForTable(parentScope.headerConfig,config,$parentEl),CONSTANTS.isRunMode&&(_.each(config,function(value,property){Utils.stringStartsWith(value,"bind:")&&watchProperty(property,value.replace("bind:",""))}),scope.$on("$destroy",function(){_.forEach(exprWatchHandlers,Utils.triggerFn)}))}}}}]).directive("wmGridColumn",["$parse","Utils","CONSTANTS","BindingManager","LiveWidgetUtils",function($parse,Utils,CONSTANTS,BindingManager,LiveWidgetUtils){"use strict";var isDataSetWidgets=Utils.getDataSetWidgets();return{restrict:"E",scope:!0,template:"<div></div>",replace:!0,compile:function(tElement){return{pre:function(scope,element,attrs){function getFormWidgetScope(fieldName){var $el=scope.datagridElement.find('[data-field-name="'+fieldName+'"]');return $el.isolateScope()}function watchProperty(property,expression){exprWatchHandlers[property]=BindingManager.register(parentScope,expression,function(newVal){newVal=WM.isDefined(newVal)?newVal:"",columnDef.setProperty(property,newVal)},{deepWatch:!0,allowPageable:!0,acceptsArray:!1})}function getFilterWidget(type){var widget=fieldTypeWidgetTypeMap[type]&&fieldTypeWidgetTypeMap[type][0];return"boolean"===type&&(widget="select"),_.includes(["text","number","select","autocomplete","date","time","datetime"],widget)?widget:"text"}scope.ColumnDef=function(){},scope.ColumnDef.prototype=new wm.baseClasses.FieldDef,scope.ColumnDef.prototype.setProperty=function(property,newval){this.$is.setProperty.call(this,property,newval),"displayName"===property?scope.callDataGridMethod("setColumnProp",this.field,property,newval):this.$is.redraw&&this.$is.redraw(!0)},scope.fieldDef=function(){},scope.fieldDef.prototype=new wm.baseClasses.FieldDef,scope.fieldDef.prototype.setProperty=function(property,newval){var elScope=getFormWidgetScope(this.field);property="value"===property?"datavalue":property,elScope[property]=newval},scope.fieldDef.prototype.getProperty=function(property){var elScope=getFormWidgetScope(this.field);return property="value"===property?"datavalue":property,elScope[property]},scope.fieldDef.prototype.focus=function(){var elScope=getFormWidgetScope(this.field);elScope.focus()};var index,config,columnDefProps,variable,events,bindings,fieldTypeWidgetTypeMap=LiveWidgetUtils.getFieldTypeWidgetTypesMap(),exprWatchHandlers=[],textAlignment=attrs.textalignment||"left",backgroundColor=attrs.backgroundcolor||"",textColor=attrs.textcolor||"",width="px"===attrs.width?"":attrs.width||"",styleDef="width: "+width+"; background-color: "+backgroundColor+"; color: "+textColor+";",columnDef=new scope.ColumnDef,fieldDef=new scope.fieldDef,updateCustomExpression=function(column){LiveWidgetUtils.setColumnConfig(column)},parentScope=scope.$parent,$parentEl=element.parent(),fieldDefProps={field:attrs.binding},skipWatchProps=["dataset","defaultvalue","disabled","readonly"];if(scope.ColumnDef.prototype.$is=parentScope,scope.fieldDef.prototype.$is=parentScope,columnDefProps={field:attrs.binding,displayName:attrs.caption,pcDisplay:!WM.isDefined(attrs.pcdisplay)||"true"===attrs.pcdisplay,mobileDisplay:!WM.isDefined(attrs.mobiledisplay)||"true"===attrs.mobiledisplay,width:width,textAlignment:textAlignment,backgroundColor:backgroundColor,textColor:textColor,type:attrs.type||"string",primaryKey:attrs.primaryKey?$parse(attrs.primaryKey)():"",generator:attrs.generator,widgetType:attrs.widgetType,style:styleDef,class:attrs.colClass||"",ngclass:attrs.colNgClass||"",datepattern:attrs.datepattern,formatpattern:"toNumber"===attrs.formatpattern?"numberToString":attrs.formatpattern,currencypattern:attrs.currencypattern,fractionsize:attrs.fractionsize,suffix:attrs.suffix,prefix:attrs.prefix,accessroles:attrs.accessroles||"",dataset:attrs.dataset,datafield:attrs.datafield,placeholder:attrs.placeholder,disabled:!!attrs.disabled&&("true"===attrs.disabled||attrs.disabled),required:!!attrs.required&&("true"===attrs.required||attrs.required),displaylabel:attrs.displaylabel,searchkey:attrs.searchkey,displayfield:attrs.displayfield,sortable:"false"!==attrs.sortable,searchable:"blob"!==attrs.type&&"clob"!==attrs.type&&"false"!==attrs.searchable,show:"false"!==attrs.show&&("true"===attrs.show||!attrs.show||attrs.show),rowactionsposition:attrs.rowactionsposition,filterwidget:attrs.filterwidget||getFilterWidget(attrs.type||"string"),filterplaceholder:attrs.filterplaceholder,relatedEntityName:attrs.relatedEntityName,checkedvalue:attrs.checkedvalue,uncheckedvalue:attrs.uncheckedvalue},columnDefProps.defaultvalue=LiveWidgetUtils.getDefaultValue(attrs.defaultvalue,columnDefProps.type,columnDefProps.editWidgetType),columnDefProps.editWidgetType=attrs.editWidgetType||LiveWidgetUtils.getEditModeWidget(columnDefProps),events=_.filter(_.keys(attrs),function(key){return _.startsWith(key,"on")}),_.forEach(events,function(eventName){columnDefProps[eventName]=attrs[eventName]}),WM.extend(columnDef,columnDefProps),WM.extend(fieldDef,fieldDefProps),parentScope.formfields[fieldDef.field]=fieldDef,tElement.context.innerHTML&&(columnDef.customExpression=tElement.context.innerHTML),columnDef.readonly=WM.isDefined(attrs.readonly)?"true"===attrs.readonly:columnDef.relatedEntityName?!columnDef.primaryKey:_.includes(["identity","uniqueid","sequence"],columnDef.generator),"blob"!==columnDef.type||columnDef.customExpression||"image"!==columnDef.widgetType&&(columnDef.customExpression='<a ng-if="columnValue != null" class="col-md-9" target="_blank" data-ng-href="{{contentBaseUrl + row[primaryKey] + \'/content/\'+ colDef.field}}"><i class="wm-icon wm-icon24 wi wi-file"></i></a>'),
index=parentScope.fullFieldDefs.push(columnDef)-1,columnDef.index=index,columnDef.widgetType&&!columnDef.customExpression&&(updateCustomExpression(columnDef),parentScope.widgetid&&parentScope.fullFieldDefs.length===parentScope.gridColumnCount&&(config={widgetName:scope.name,scopeId:parentScope.$id,fieldDefs:parentScope.fullFieldDefs},scope.updateMarkupForGrid(config),scope.$root.$emit("save-workspace",!0))),CONSTANTS.isRunMode){if(_.each(columnDef,function(value,property){Utils.stringStartsWith(value,"bind:")&&!_.includes(skipWatchProps,property)&&watchProperty(property,value.replace("bind:",""))}),Utils.isMobile()){if(!columnDef.mobileDisplay)return}else if(!columnDef.pcDisplay)return;!attrs.dataset&&columnDef.relatedEntityName&&columnDef.primaryKey&&isDataSetWidgets[columnDef.editWidgetType]&&(bindings=_.split(columnDef.field,"."),LiveWidgetUtils.fetchRelatedFieldData(columnDef,_.head(bindings),_.last(bindings),columnDef.editWidgetType,element.scope(),parentScope))}LiveWidgetUtils.setHeaderConfigForTable(parentScope.headerConfig,{field:columnDefProps.field,displayName:columnDefProps.displayName},$parentEl),parentScope.fieldDefs.push(columnDef),element.remove(),scope.$on("$destroy",function(){_.forEach(exprWatchHandlers,Utils.triggerFn)}),CONSTANTS.isRunMode&&"multicolumn"===parentScope.filtermode&&"select"===columnDef.filterwidget&&(variable=parentScope.gridElement.scope().Variables[Utils.getVariableName(parentScope)],variable&&"wm.LiveVariable"===variable.category&&(columnDef.isLiveVariable=!0,columnDef.relatedEntityName&&(columnDef.isRelated=!0,columnDef.lookupType=columnDef.relatedEntityName,columnDef.lookupField=_.split(columnDef.field,".")[1]),LiveWidgetUtils.getDistinctValues(columnDef,variable,function(field,data,aliascolumn){field.filterdataset=_.pull(_.map(data.content,aliascolumn),null)})))}}}}}]).directive("wmGridAction",["CONSTANTS","LiveWidgetUtils",function(CONSTANTS,LiveWidgetUtils){"use strict";return{restrict:"E",scope:!0,replace:!0,compile:function(){return{post:function(scope,element,attrs){var parentIsolateScope,$parentElement=element.parent(),buttonDef=WM.extend(LiveWidgetUtils.getButtonDef(attrs),{icon:attrs.icon});buttonDef.position=attrs.position||"footer",parentIsolateScope=CONSTANTS.isRunMode?scope:scope.parentIsolateScope=$parentElement&&$parentElement.length>0?$parentElement.closest('[data-identifier="grid"]').isolateScope()||scope.$parent:scope.$parent,parentIsolateScope.actions=parentIsolateScope.actions||[],parentIsolateScope.actions.push(buttonDef),parentIsolateScope.populateActions()}}}}}]).directive("wmGridRowAction",["CONSTANTS","LiveWidgetUtils",function(CONSTANTS,LiveWidgetUtils){"use strict";return{restrict:"E",scope:!0,replace:!0,compile:function(){return{post:function(scope,element,attrs){var parentIsolateScope,buttonDef=LiveWidgetUtils.getButtonDef(attrs),$parentElement=element.parent();delete buttonDef.shortcutkey,parentIsolateScope=CONSTANTS.isRunMode?scope:scope.parentIsolateScope=$parentElement&&$parentElement.length>0?$parentElement.closest('[data-identifier="grid"]').isolateScope()||scope.$parent:scope.$parent,parentIsolateScope.rowActions=parentIsolateScope.rowActions||[],parentIsolateScope.rowActions.push(buttonDef)}}}}}]),WM.module("wm.widgets.live").controller("liveFormDialogController",WM.noop).directive("wmLiveform",["PropertiesFactory","WidgetUtilService","$compile","$rootScope","CONSTANTS","$controller","Utils","wmToaster","$filter","LiveWidgetUtils","DialogService",function(PropertiesFactory,WidgetUtilService,$compile,$rootScope,CONSTANTS,$controller,Utils,wmToaster,$filter,LiveWidgetUtils,DialogService){"use strict";var pageTemplate,defaultTemplate,widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.liveform",["wm.base","wm.base.events.successerror","wm.layouts.panel.defaults"]),notifyFor={dataset:!0,captionsize:!0,novalidate:!0,autocomplete:!0,rowdata:!0,formdata:!0,updatemode:!0,formlayout:!0,formtype:!0,defaultmode:!0,captionalign:!0},isTimeType=function(field){return"time"===field.widget||"time"===field.type&&!field.widget},getValidTime=function(val){if(val){var date=(new Date).toDateString();return new Date(date+" "+val).getTime()}};return{restrict:"E",replace:!0,scope:{onBeforeservicecall:"&",onResult:"&"},require:"?^wmLivegrid",template:function(template,attrs){var expr=attrs.onBackbtnclick?'on-backbtnclick="'+attrs.onBackbtnclick+'"':"";return pageTemplate='<form data-identifier="liveform" init-widget role="form" class="app-device-liveform panel liveform-inline" ng-class="[captionAlignClass]" ng-submit="formSave($event);" apply-styles="shell"><wm-mobile-navbar title="{{title}}" '+expr+'><wm-button type="{{btn.type}}" class="navbar-btn btn-primary btn-transparent" ng-repeat="btn in buttonArray" caption="" title="{{btn.displayName}}" iconclass="{{btn.iconclass}}" show="{{isUpdateMode && btn.show}}" on-click="{{btn.action}}"></wm-button></wm-mobile-navbar><div ng-show="isLayoutDialog" class="text-left"><i class="wi wi-gear app-dialogmode-icon"></i><span class="app-dialogmode-text">Live form in dialog mode</span></div><div class="form-elements panel-body" ng-class="{\'update-mode\': isUpdateMode }" ng-show="!isLayoutDialog" apply-styles="inner-shell">'+template.context.innerHTML+'</div><div class="hidden-form-elements"></div></form>',defaultTemplate='<form data-identifier="liveform" init-widget role="form" class="app-liveform panel app-panel liveform-inline" ng-class="[captionAlignClass]" ng-submit="formSave($event);" apply-styles="shell"><div ng-show="isLayoutDialog" class="text-left"><i class="wi wi-gear app-dialogmode-icon"></i><span class="app-dialogmode-text">Live form in dialog mode</span></div><div class="panel-heading" ng-if="title || subheading || iconclass" ng-show="!isLayoutDialog"><h3 class="panel-title"><div class="pull-left"><i class="app-icon panel-icon {{iconclass}}" ng-show="iconclass"></i></div><div class="pull-left"><div class="heading">{{title}}</div><div class="description">{{subheading}}</div></div></h3></div><div class="form-elements panel-body" ng-class="{\'update-mode\': isUpdateMode }" ng-show="!isLayoutDialog" apply-styles="inner-shell"><wm-message ng-if=(messagelayout==="Inline") scopedataset="statusMessage" hideclose="false"></wm-message>'+template.context.innerHTML+'</div><div class="hidden-form-elements"></div><div class="basic-btn-grp form-action panel-footer clearfix" ng-hide="isLayoutDialog || !buttonArray"></div></form>',!CONSTANTS.isRunMode||"dialog"!==attrs.formtype&&"dialog"!==attrs.layout&&"dialog"!==attrs.formlayout?"page"===attrs.formlayout?pageTemplate:defaultTemplate:(attrs.dialogid="liveformdialog-"+attrs.name+"-"+Utils.generateGUId(),'<div data-identifier="liveform" init-widget class="app-liveform liveform-dialog" ><wm-dialog class="app-liveform-dialog" width="{{dialogWidth}}" contentclass="noscroll" iconclass="{{iconclass}}" name="'+attrs.dialogid+'" title="{{title}}" modal="true" controller="liveFormDialogController"><form data-identifier="liveform" role="form" name="'+attrs.name+'" class="app-liveform" autocomplete="'+("true"===attrs.autocomplete||attrs.autocomplete===!0?"on":"off")+'" ng-submit="formSave($event);" apply-styles="shell" ng-class="[captionAlignClass]"><div class="form-elements panel-body" ng-class="{\'update-mode\': isUpdateMode }" ng-style="{height: height, overflow: height ? \'auto\': overflow, padding: padding}"><wm-message ng-if=(messagelayout==="Inline") scopedataset="statusMessage" hideclose="false"></wm-message><div class="form-content">'+template.context.innerHTML+'</div></div><div class="hidden-form-elements"></div><div class="basic-btn-grp form-action modal-footer clearfix"><div class="action-content"></div></div></form></wm-dialog></div>')},controller:function($scope,$attrs,DialogService){function getFormElement(){return $scope.isLayoutDialog?WM.element("body").find('.app-liveform-dialog[dialogid="'+$scope._dialogid+'"]'):$scope.element}function resetFormState(){var $formEle=getFormElement(),formScope=$scope.isLayoutDialog&&$formEle.length?$formEle.scope():$scope;formScope.ngform&&(formScope.ngform.$setUntouched(),formScope.ngform.$setPristine())}function resetFormFields(formEle){formEle.find('[role="input"]').each(function(){var $inputEl=WM.element(this);_.isEmpty($inputEl.closest('[data-role="form-field"]'))&&WM.element(this).isolateScope().reset()})}function resetFileUploadWidget(dataValue,skipValueSet){WM.element($scope.formElement).find("[name="+dataValue.key+"]").val(""),skipValueSet||(dataValue.href="",dataValue.value=null)}function emptyDataModel(){$scope.formFields.forEach(function(dataValue){WM.isDefined(dataValue)&&("blob"===dataValue.type?resetFileUploadWidget(dataValue):dataValue.value="")})}function getDataObject(){return"insert"===$scope.operationType?{}:WM.isDefined(prevDataObject)&&!Utils.isEmptyObject(prevDataObject)?Utils.getClonedObject(prevDataObject):Utils.getClonedObject($scope.formdata||{})}var prevformFields,formController,onResult,onVariableUpdate,prevDataObject={};if(CONSTANTS.isRunMode)try{formController=$attrs.name+"Controller",$controller(formController,{$scope:$scope})}catch(ignore){}$scope.__compileWithIScope=!0,onResult=function(data,status,event){$scope.onResult({$event:event,$operation:$scope.operationType,$data:data}),status?Utils.triggerFn($scope.onSuccess,{$event:event,$operation:$scope.operationType,$data:data}):Utils.triggerFn($scope.onError,{$event:event,$operation:$scope.operationType,$data:data})},onVariableUpdate=function(response,newForm,updateMode){newForm?$scope.new():$scope.changeDataObject(response),$scope.isUpdateMode=!WM.isDefined(updateMode)||updateMode},$scope.prevDataValues=[],$scope.findOperationType=function(variable){var operation,isPrimary=!1;return variable&&variable.operation&&"read"!==variable.operation?variable.operation:($scope.primaryKey&&$scope.formdata&&(1===$scope.primaryKey.length?$scope.formdata[$scope.primaryKey[0]]&&(operation="update"):0===$scope.primaryKey.length?(_.forEach($scope.formdata,function(value){value&&(isPrimary=!0)}),isPrimary&&(operation="update")):(isPrimary=_.some($scope.primaryKey,function(primarykey){if($scope.formdata[primarykey])return!0}),isPrimary&&(operation="update"))),operation||"insert")},$scope.save=function(){$scope.formSave(void 0,!0)},$scope.saveAndNew=function(){$scope.formSave(void 0,!0,!0)},$scope.saveAndView=function(){$scope.formSave(void 0,!1)},$scope.toggleMessage=function(show,msg,type,header){var template;show&&msg?"Inline"===$scope.messagelayout?(template="error"===type&&$scope.errormessage?$scope.errormessage:msg,$scope.statusMessage={caption:template||"",type:type}):(template="error"===type&&$scope.errormessage?$scope.errormessage:msg,wmToaster.show(type,WM.isDefined(header)?header:type.toUpperCase(),template,void 0,"trustedHtml")):$scope.statusMessage=null},$scope.formSave=function(event,updateMode,newForm,callBackFn){var data,prevData,isValid,deleteFn,$invalidEle,requestData={},elScope=$scope.element.scope(),variableName=$scope.variableName||Utils.getVariableName($scope),variable=elScope.Variables[variableName],$formEle=getFormElement(),formScope=$scope.isLayoutDialog&&$formEle.length?$formEle.scope():$scope;if($scope.operationType=$scope.operationType||$scope.findOperationType(variable),"delete"!==$scope.operationType&&!$scope.novalidate&&formScope.ngform&&formScope.ngform.$invalid&&(WM.element($formEle.find('input[type="file"].app-blob-upload')).each(function(){var $blobEL=WM.element(this);$blobEL.val()&&formScope.ngform[$blobEL.attr("name")].$setValidity("required",!0)}),formScope.ngform.$invalid))return $invalidEle=$formEle.find(".ng-untouched.ng-invalid:first"),void($invalidEle.length&&formScope.ngform[$invalidEle.attr("name")].$setTouched());$scope.formElement=$scope.isLayoutDialog?document.forms[$scope.name]:$scope.formElement||document.forms[$scope.name],data=$scope.constructDataObject(),prevData=prevformFields?$scope.constructDataObject(!0):data;try{if(isValid=$scope.onBeforeservicecall({$event:event,$operation:$scope.operationType,$data:data}),isValid===!1)return;if(isValid&&isValid.error)return void wmToaster.show("error","ERROR",isValid.error)}catch(err){if("Abort"===err.message)return}if("update"===$scope.operationType&&formScope.ngform&&formScope.ngform.$pristine&&_.isEqual(data,prevData))return void $scope.toggleMessage(!0,$scope.appLocale.MESSAGE_NO_CHANGES,"info","");switch(resetFormState(),requestData={row:data,transform:!0,multipartData:$scope.multipartData,skipNotification:!0},elScope.prefabname&&(requestData.scope=elScope),$scope.operationType){case"update":requestData.rowData=$scope.rowdata||$scope.formdata,requestData.prevData=prevData,$scope.subscribedWidget?$scope.subscribedWidget.call("update",requestData,function(){$scope.isLayoutDialog&&DialogService.hideDialog($scope._dialogid),$scope.isUpdateMode=!1,$scope.toggleMessage(!0,$scope.updatemessage,"success")},function(error){$scope.toggleMessage(!0,$scope.errormessage||error,"error")}):variable.updateRecord(requestData,function(response){response.error?($scope.toggleMessage(!0,response.error,"error"),onResult(response,!1,event)):($scope.toggleMessage(!0,$scope.updatemessage,"success"),onResult(response,!0,event),$scope.ctrl?$scope.$emit("on-result","update",response,newForm,updateMode):(variable.update({skipToggleState:!0}),onVariableUpdate(response,newForm,updateMode)),LiveWidgetUtils.closeDialog($formEle))},function(error){$scope.toggleMessage(!0,error,"error"),onResult(error,!1,event)});break;case"insert":$scope.subscribedWidget?$scope.subscribedWidget.call("create",requestData,function(){$scope.isLayoutDialog&&DialogService.hideDialog($scope._dialogid),$scope.isUpdateMode=!1,$scope.toggleMessage(!0,$scope.insertmessage,"success")},function(error){$scope.toggleMessage(!0,$scope.errormessage||error,"error")}):variable.insertRecord(requestData,function(response){response.error?($scope.toggleMessage(!0,response.error,"error"),onResult(response,!1,event)):($scope.toggleMessage(!0,$scope.insertmessage,"success"),onResult(response,!0,event),$scope.ctrl?$scope.$emit("on-result","insert",response,newForm,updateMode):(variable.update({skipToggleState:!0}),onVariableUpdate(response,newForm,updateMode)),LiveWidgetUtils.closeDialog($formEle))},function(error){$scope.toggleMessage(!0,error,"error"),onResult(error,!1,event)});break;case"delete":deleteFn=function(){variable.deleteRecord(requestData,function(success){return success&&success.error?($scope.toggleMessage(!0,success.error,"error"),void onResult(success,!1)):(onResult(requestData.row,!0),$scope.clearData(),$scope.prevDataValues=[],$scope.toggleMessage(!0,$scope.deletemessage,"success"),$scope.isSelected=!1,void($scope.ctrl?$scope.$emit("on-result","delete",success):variable.update({skipToggleState:!0})))},function(error){$scope.toggleMessage(!0,error,"error"),onResult(error,!1),Utils.triggerFn(callBackFn)})},$scope.toggleMessage(!1),$scope.ctrl?$scope.ctrl.confirmMessage(deleteFn,callBackFn):deleteFn()}},$scope.setPrevformFields=function(formFields){prevformFields=Utils.getClonedObject(formFields),prevDataObject=Utils.getClonedObject($scope.rowdata||{})},$scope.formCancel=function(){$scope.reset(),$scope.toggleMessage(!1),$scope.isSelected&&($scope.formFields=Utils.getClonedObject(prevformFields)||$scope.formFields),$scope.$emit("on-cancel"),$scope.isUpdateMode=!1,$scope.isLayoutDialog&&DialogService.hideDialog($scope._dialogid)},$scope.setPrevDataValues=function(){$scope.formFields&&!$scope.widgetid&&($scope.prevDataValues=$scope.formFields.map(function(obj){return{key:obj.key,value:obj.value}}))},$scope.clearMessage=function(){$scope.toggleMessage(!1)},$scope.reset=function(){var prevDataValues,formEle=getFormElement();resetFormState(),resetFormFields(formEle),WM.isArray($scope.formFields)&&(prevDataValues=_.fromPairs(_.map($scope.prevDataValues,function(item){return[item.key,item.value]})),$scope.formFields.forEach(function(formField){formField.value=prevDataValues[formField.key],"blob"===formField.type&&(resetFileUploadWidget(formField,!0),formField.href=$scope.getBlobURL(prevDataValues,formField.key,formField.value)),formField.value||"autocomplete"!==formField.widget||formEle.find("div[name="+formField.name+"] input").val("")}),$scope.constructDataObject())},$scope.edit=function(){resetFormState(),$scope.toggleMessage(!1),$scope.isLayoutDialog||($scope.isSelected&&(prevformFields=Utils.getClonedObject($scope.formFields)),prevDataObject=Utils.getClonedObject($scope.rowdata||{})),$scope.setReadonlyFields(),$scope.isUpdateMode=!0,$scope.operationType="update"},$scope.new=function(){resetFormState(),$scope.toggleMessage(!1),$scope.isSelected&&!$scope.isLayoutDialog&&(prevformFields=Utils.getClonedObject($scope.formFields)),$scope.formFields&&$scope.formFields.length>0&&emptyDataModel(),$scope.setDefaults(),$scope.setPrevDataValues(),$scope.constructDataObject(),$scope.isUpdateMode=!0,$scope.operationType="insert"},$scope.filetypes={image:"image/*",video:"video/*",audio:"audio/*"},$scope.setDefaults=function(){$scope.formFields.forEach(function(fieldObj){$scope.setDefaultValueToValue(fieldObj)})},$scope.setDefaultValueToValue=function(fieldObj){var fileType,defaultValue=fieldObj.defaultvalue;defaultValue&&"null"!==defaultValue?fieldObj.value=LiveWidgetUtils.getDefaultValue(defaultValue,fieldObj.type):fieldObj.value=void 0,"blob"===fieldObj.type&&(fileType=fieldObj.filetype?$scope.filetypes[fieldObj.filetype]:"",fieldObj.permitted=fileType+(fieldObj.extensions?(fileType?",":"")+fieldObj.extensions:"")),fieldObj.readonly&&fieldObj.primaryKey&&"assigned"===fieldObj.generator&&(fieldObj.readonly=!1),$scope.setPrevDataValues()},$scope.setReadonlyFields=function(){$scope.formFields&&!$scope.widgetid&&$scope.formFields.forEach(function(column){column.primaryKey&&!column.isRelated&&(column.readonly=!0)})},$scope.delete=function(callBackFn){resetFormState(),$scope.operationType="delete",prevDataObject=Utils.getClonedObject($scope.rowdata||{}),$scope.formSave(void 0,void 0,void 0,callBackFn)},$scope.isInReqdFormat=function(data){return WM.isArray(data)&&data[0].key&&data[0].type},$scope.constructDataObject=function(isPreviousData){var formFields,element,dataObject=getDataObject(),formName=$scope.name;return formFields=isPreviousData?prevformFields:$scope.formFields,_.forEach(formFields,function(field){var dateTime;field.widget&&Utils.isDateTimeType(field.widget)||Utils.isDateTimeType(field.type)?field.value?(dateTime=Utils.getValidDateObject(field.value),"timestamp"===field.outputformat||"timestamp"===field.type?dataObject[field.key]=field.value?dateTime.getTime():null:field.outputformat?dataObject[field.key]=$filter("date")(dateTime,field.outputformat):dataObject[field.key]=field.value):dataObject[field.key]=void 0:"blob"===field.type?dataObject[field.key]=_.get(document.forms,[formName,field.key,"files",0]):"list"===field.type?dataObject[field.key]=field.value||void 0:dataObject[field.key]=field.value}),isPreviousData||(element=getFormElement(),LiveWidgetUtils.setFormWidgetsValues(element,dataObject),$scope.dataoutput=dataObject),dataObject},$scope.clearData=function(){$scope.toggleMessage(!1),$scope.formFields&&$scope.formFields.length>0&&emptyDataModel()},$scope.setReadonly=function(element){WM.element(element).find("input, textarea").attr("disabled",!0)},$scope.removeReadonly=function(element){WM.element(element).find("input, textarea").attr("disabled",!1)},$scope.isUpdateMode=!1,$scope.setPrimaryKey=function(columnName){$scope.primaryKey=$scope.primaryKey||[],WM.element.inArray(columnName,$scope.primaryKey)===-1&&$scope.primaryKey.push(columnName)},$scope.translateVariableObject=function(rawObject){return LiveWidgetUtils.translateVariableObject(rawObject,$scope)},$scope.getBlobURL=function(dataObj,key,value){var primaryKeys,primaryKey,href="";return null!==value&&void 0!==value&&$scope.variableObj?(primaryKeys=$scope.variableObj.getPrimaryKey()||[],primaryKey=dataObj[primaryKeys[0]],CONSTANTS.hasCordova&&CONSTANTS.isRunMode&&(href+=$rootScope.project.deployedUrl),href+=(""!==$scope.variableObj._prefabName&&void 0!==$scope.variableObj._prefabName?"prefabs/"+$scope.variableObj._prefabName:"services")+"/",href+=$scope.variableObj.liveSource+"/"+$scope.variableObj.type+"/"+primaryKey+"/content/"+key+"?"+Math.random()):href},$scope.changeDataObject=function(dataObj){$scope.formFields&&!$scope.widgetid&&dataObj&&($scope.formFields.forEach(function(formField){var value=_.get(dataObj,formField.key);isTimeType(formField)?formField.value=getValidTime(value):"blob"===formField.type?(resetFileUploadWidget(formField,!0),formField.href=$scope.getBlobURL(dataObj,formField.key,value),formField.value=value):formField.value=value}),$scope.setPrevDataValues(),$scope.constructDataObject())},$scope.setFieldVal=function(fieldDef){var dataObj=$scope.rowdata||$scope.formdata,value=_.get(dataObj,fieldDef.key);dataObj&&(isTimeType(fieldDef)?fieldDef.value=getValidTime(value):"blob"===fieldDef.type?(fieldDef.href=$scope.getBlobURL(dataObj,fieldDef.key,value),fieldDef.value=value):fieldDef.value=value,$scope.dataoutput=$scope.dataoutput||{},$scope.dataoutput[fieldDef.key]=fieldDef.value)},$scope.getDisplayExpr=function(object,displayExpr){if(WM.isObject(object)){if(!displayExpr&&(displayExpr=Object.keys(object)[0],!displayExpr))return;return WidgetUtilService.updateAndEvalExp(object,displayExpr,$scope)}return object},$scope.getOutputPatterns=function(type,outputFormat){return Utils.isDateTimeType(type)?Utils.getDateTimeFormatForType(type):outputFormat},$scope.cancel=function(){$scope.formCancel()},$scope.update=function(){$scope.edit()}},compile:function(){return{pre:function(scope,element,attrs){var elScope=element.scope();scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,(attrs.formtype||attrs.layout)&&(attrs.formlayout=attrs.formtype||attrs.layout),$rootScope.isMobileApplicationType&&CONSTANTS.isStudioMode&&"dialog"!==attrs.formlayout&&(scope.widgetProps.formlayout.show=!0,scope.widgetProps.formlayout.showindesigner=!0),"dialog"===attrs.formlayout&&(scope.isLayoutDialog=!0,scope._dialogid=attrs.dialogid),scope.Variables=elScope.Variables,scope.Widgets=elScope.Widgets,scope.appLocale=$rootScope.appLocale,scope.pageParams=elScope.pageParams,element.removeAttr("title")},post:function(scope,element,attrs,controller){function getEmptyDataSetGridObj(){return{widgetName:scope.name,fieldDefs:[],buttonDefs:[],scopeId:scope.$id,numColumns:scope.getActiveLayout()}}function getNonEmptyDatSetGridObj(){return{widgetName:scope.name,fieldDefs:scope.formFields,buttonDefs:scope.buttonArray,scopeId:scope.$id,numColumns:scope.getActiveLayout()}}function propertyChangeHandler(key,newVal,oldVal){var value,translatedObj,tempVarName,gridObj,variableObj,elScope=element.scope();switch(key){case"dataset":newVal&&newVal.propertiesMap&&WM.isArray(newVal.propertiesMap.columns)?oldVal&&oldVal.propertiesMap&&WM.equals(newVal.propertiesMap.columns,oldVal.propertiesMap.columns)||(tempVarName=Utils.getVariableName(scope),scope.variableName&&tempVarName!==scope.variableName&&(scope.formCreated=!1,scope.formConstructed=!1),scope.variableName=tempVarName,(scope.formCreated||scope.formConstructed)&&scope.formFields?(translatedObj=scope.translateVariableObject(newVal),scope.translatedObj=translatedObj,scope.formFields.forEach(function(fieldObject){translatedObj.forEach(function(transObj){transObj.key===fieldObject.key&&(fieldObject.isRelated=transObj.isRelated,fieldObject.type=transObj.type)})}),variableObj=elScope.Variables&&elScope.Variables[scope.variableName],scope.variableObj=variableObj,variableObj&&(scope.widgetProps.formdata.type=variableObj.type,scope.widgetProps.dataoutput.type="object, "+variableObj.type)):(scope.buttonArray=LiveWidgetUtils.getLiveWidgetButtons("LIVEFORM").filter(function(button){return"page"===scope.formlayout?"save"===button.key:"cancel"===button.key||"save"===button.key}),variableObj=elScope.Variables&&elScope.Variables[scope.variableName],scope.variableObj=variableObj,variableObj&&(scope.widgetProps.formdata.type=variableObj.type),translatedObj=scope.isInReqdFormat(newVal)?newVal:scope.translateVariableObject(newVal),scope.translatedObj=translatedObj,scope.formFields=translatedObj),gridObj=getNonEmptyDatSetGridObj()):newVal?(scope.variableName=Utils.getVariableName(scope),scope.variableObj=elScope.Variables&&elScope.Variables[scope.variableName]):(scope.variableName="",scope.variableObj=void 0,gridObj=getEmptyDataSetGridObj()),CONSTANTS.isStudioMode&&gridObj&&(!scope.formFieldCompiled||scope.newcolumns)&&(scope.newcolumns=!1,gridObj.bindDataSetChanged=!0,gridObj.widgettype=scope.widgettype,Utils.getService("LiveWidgetsMarkupManager").updateMarkupForLiveForm(gridObj)),_.forEach(scope.formFields,function(field){field&&(field.primaryKey&&scope.setPrimaryKey(field.key),field.outputformat=scope.getOutputPatterns(field.type,field.outputformat))});break;case"captionsize":LiveWidgetUtils.setCaptionSize(element,newVal);break;case"novalidate":newVal===!0||"true"===newVal?element.attr("novalidate",""):element.removeAttr("novalidate");break;case"autocomplete":"dialog"!==scope.formlayout&&(value=newVal===!0||"true"===newVal?"on":"off",element.attr(key,value));break;case"rowdata":newVal&&WM.isObject(newVal)&&scope.changeDataObject(newVal);break;case"formdata":newVal&&WM.isObject(newVal)&&(_.isArray(newVal)?scope.changeDataObject(_.last(newVal)):scope.changeDataObject(newVal));break;case"updatemode":scope.isUpdateMode=newVal===!0||"true"===newVal;break;case"defaultmode":newVal&&"Edit"===newVal?scope.updateMode=!0:scope.updateMode=!1,scope.isUpdateMode=scope.updateMode;break;case"formlayout":scope.isLayoutDialog="dialog"===newVal,element.toggleClass("liveform-dialog",scope.isLayoutDialog),CONSTANTS.isStudioMode&&(scope.widgetProps.onBackbtnclick.show="page"===newVal);break;case"captionalign":scope.captionAlignClass="align-"+newVal}}function initDependency(widgetname){var eventChangeHandler,dependsonWidget=scope.Widgets[widgetname];dependsonWidget&&(scope.subscribedWidget=dependsonWidget,eventChangeHandler=function(event,widgetid,eventName){if(widgetid===scope.subscribedWidget.name)switch(eventName){case"create":scope.operationType="insert",scope.isSelected=!0,scope.rowdata="",scope.isLayoutDialog&&(scope.setPrevformFields(scope.formFields),scope.formFields=[]),scope.new(),scope.isLayoutDialog&&DialogService.showDialog(scope._dialogid,{resolve:{},scope:scope});break;case"update":scope.operationType="update",scope.isSelected=!0,scope.isLayoutDialog&&(scope.setPrevformFields(scope.formFields),scope.formFields=[]),scope.edit(),scope.$root.$safeApply(scope),scope.isLayoutDialog&&(scope.isUpdateMode=!0,DialogService.showDialog(scope._dialogid,{resolve:{},scope:scope}));break;case"read":scope.isUpdateMode=!1;break;case"delete":scope.operationType="delete",scope.subscribedWidget.call("delete",{row:scope.constructDataObject()},function(){scope.toggleMessage(!0,scope.deletemessage,"success")},function(error){scope.toggleMessage(!0,scope.errormessage||error,"error")})}},handlers.push(dependsonWidget.$watch("selectedItems",function(newVal){newVal&&newVal.length&&(scope.rowdata=newVal[newVal.length-1],scope.isUpdateMode&&eventChangeHandler(null,dependsonWidget.widgetid,"update"))})),handlers.push($rootScope.$on("wm-event",eventChangeHandler)))}scope.ctrl=controller,scope.ngform=scope[scope.name],"dialog"!==attrs.formlayout?scope.formElement=element:CONSTANTS.isRunMode&&(scope.dialogWidth=scope.width,scope.width="100%"),scope.element=element;var handlers=[];scope.getActiveLayout=function(){return LiveWidgetUtils.getColumnCountByLayoutType(scope.layout,+scope.element.find(".app-grid-layout:first").attr("columns"))},WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler,scope,notifyFor),Object.defineProperty(scope,"mode",{get:function(){return scope.operationType||scope.findOperationType()}}),scope.widgetid&&handlers.push($rootScope.$on("compile-live-form-fields",function(event,scopeId,markup,fromDesigner){if($rootScope.isMobileApplicationType&&CONSTANTS.isStudioMode&&("page"===scope.formlayout?(element.html(pageTemplate),scope.buttonArray=void 0,$compile(element.contents())(scope),element.addClass("app-device-liveform")):(element.html(defaultTemplate),element.find(".basic-btn-grp").empty(),$compile(element.contents())(scope),element.removeClass("app-device-liveform"))),scope.$id===scopeId&&(scope.formFields=void 0,scope.buttonArray=void 0,element.find(".form-elements").empty(),element.find(".hidden-form-elements").empty(),element.find(".basic-btn-grp").empty(),scope.formConstructed=fromDesigner,markup)){scope.formConstructed=!0;var markupObj=WM.element("<div>"+markup+"</div>"),fieldsObj=markupObj.find("> :not(wm-form-action)"),actionsObj=markupObj.find("wm-form-action");fieldsObj?$rootScope.$emit("prepare-element",fieldsObj,function(){element.find(".form-elements").append(fieldsObj),element.find(".basic-btn-grp").append(actionsObj),$compile(fieldsObj)(scope),$compile(actionsObj)(scope)}):(fieldsObj=markupObj.find("wm-form-field"),element.find(".form-elements").append(fieldsObj),element.find(".basic-btn-grp").append(actionsObj),$compile(fieldsObj)(scope),$compile(actionsObj)(scope)),scope.formWidgets=LiveWidgetUtils.getFormFilterWidgets(element)}})),scope.$on("$destroy",function(){handlers.forEach(Utils.triggerFn)}),WidgetUtilService.postWidgetCreate(scope,element,attrs),scope.formWidgets=LiveWidgetUtils.getFormFilterWidgets(element),attrs.dependson&&CONSTANTS.isRunMode&&initDependency(attrs.dependson)}}}}}]).directive("wmFormField",["Utils","$compile","CONSTANTS","BindingManager","LiveWidgetUtils","WidgetUtilService",function(Utils,$compile,CONSTANTS,BindingManager,LiveWidgetUtils,WidgetUtilService){"use strict";var isDataSetWidgets=Utils.getDataSetWidgets();return{restrict:"E",template:"<div init-widget data-role='form-field'></div>",scope:{},replace:!0,compile:function(tElement){return{pre:function(scope,element,attrs){LiveWidgetUtils.preProcessFields("wm-form-field",scope,attrs,tElement)},post:function(scope,element,attrs){function setDefaultValue(){"wm-liveform"===parentScope._widgettype?parentScope.setDefaultValueToValue(columnDef):columnDef.value=LiveWidgetUtils.getDefaultValue(columnDef.defaultvalue,void 0,columnDef.widget),parentScope.constructDataObject()}function setValidity(name,val){var formWidget=parentScope.ngform[name+"_formWidget"];formWidget&&formWidget.$setValidity("custom",val)}scope.FieldDef=function(){},scope.FieldDef.prototype=new wm.baseClasses.FieldDef;var parentScope,template,index,expr,exprWatchHandler,defaultObj,isLayoutDialog,columnDefProps,columnDef=new scope.FieldDef,elScope=element.scope(),externalForm=element.closest("form.app-form"),parentEle=element.parent();if(parentScope=parentEle.length?externalForm.length?parentEle.closest("form.app-form").isolateScope().elScope:parentEle.closest('[data-identifier="liveform"]').isolateScope()||scope.$parent:scope.$parent,scope.parentScope=parentScope,isLayoutDialog=parentScope.isLayoutDialog,columnDefProps=WM.extend(LiveWidgetUtils.getColumnDef(attrs),{key:attrs.key||attrs.target||attrs.binding||attrs.name,regexp:attrs.regexp||".*"}),scope.FieldDef.prototype.$is=parentScope,WM.extend(columnDef,columnDefProps),attrs.isRelated="true"===attrs.isRelated||attrs.primaryKey===!0,columnDef.isRelated=attrs.isRelated,CONSTANTS.isRunMode&&columnDef.show===!1&&(columnDef.required=!1),scope.required=columnDef.required,scope.readonly=columnDef.readonly,scope.disabled=columnDef.disabled,scope.multiple=columnDef.multiple,scope._validationmessage=columnDef.validationmessage,"true"===scope.isupdatemode&&(parentScope.isUpdateMode=!0),scope.fieldDefConfig=columnDef,parentScope.formFields=_.isArray(parentScope.formFields)?parentScope.formFields:[],index=_.indexOf(parentScope.formFields,void 0),index=index>-1?index:parentScope.formFields.length,parentScope.formFields[index]=columnDef,attrs.defaultvalue&&(Utils.stringStartsWith(attrs.defaultvalue,"bind:")&&CONSTANTS.isRunMode?(expr=attrs.defaultvalue.replace("bind:",""),
exprWatchHandler=BindingManager.register(parentScope,expr,function(newVal){parentScope.formFields[index].defaultvalue=newVal,"update"!==parentScope.operationType&&setDefaultValue()},{deepWatch:!0,allowPageable:!0,acceptsArray:!1},"datavalue")):(columnDef.defaultvalue=attrs.defaultvalue,CONSTANTS.isRunMode&&setDefaultValue())),CONSTANTS.isRunMode&&!attrs.dataset&&attrs.isRelated&&isDataSetWidgets[columnDef.widget]&&LiveWidgetUtils.fetchRelatedFieldData(columnDef,columnDef.key,"All Fields",columnDef.widget,elScope,parentScope),isLayoutDialog&&(parentScope.ngform=parentScope[parentScope.name],defaultObj=_.find(parentScope.translatedObj,function(obj){return obj.key===columnDef.key}),defaultObj&&(columnDef.isRelated=defaultObj.isRelated,columnDef.type=defaultObj.type,columnDef.outputformat=parentScope.getOutputPatterns(columnDef.type,columnDef.outputformat)),parentScope.setDefaultValueToValue(columnDef),parentScope.setFieldVal(columnDef),"update"===parentScope.operationType&&parentScope.setReadonlyFields()),isLayoutDialog&&parentScope.setPrevDataValues(),parentScope.formCreated=!0,parentScope.formFieldCompiled=!0,CONSTANTS.isRunMode)if(Utils.isMobile()){if(!columnDef.mobileDisplay)return}else if(!columnDef.pcDisplay)return;!CONSTANTS.isRunMode||columnDef.show?(template=LiveWidgetUtils.getTemplate(columnDef,index,parentScope.captionposition||parentEle.closest(".app-form").isolateScope().captionposition,element),element.find(".live-field").remove(),element.append(template),$compile(element.contents())(parentScope)):(template=LiveWidgetUtils.getHiddenTemplate(columnDef,index),externalForm.length?element.closest("form.app-form").find(".hidden-form-elements").append($compile(template)(parentScope)):element.closest('[data-identifier="liveform"]').find("> .hidden-form-elements").append($compile(template)(parentScope))),parentScope._onFocusField=parentScope._onFocusField||function($event){WM.element($event.target).closest(".live-field").addClass("active")},parentScope._onBlurField=parentScope._onBlurField||function($event){var $field=WM.element($event.target).closest(".live-field"),fieldScope=$field.parent('[data-role="form-field"]').isolateScope();$field.removeClass("active"),fieldScope.validationmessage=fieldScope._validationmessage,setValidity(fieldScope.name,!0)},parentScope._onChangeField=parentScope._onChangeField||function(){parentScope.constructDataObject()},parentScope._onSubmitField=parentScope._onSubmitField||function(){parentScope.constructDataObject()},parentScope.$on("$destroy",function(){exprWatchHandler&&exprWatchHandler()}),element.on("$destroy",function(){CONSTANTS.isRunMode?_.pullAt(parentScope.formFields,_.indexOf(parentScope.formFields,columnDef)):_.set(parentScope.formFields,index,void 0)}),WidgetUtilService.registerPropertyChangeListener(LiveWidgetUtils.fieldPropertyChangeHandler.bind(void 0,scope,element,attrs,parentScope,index),scope),scope.hasOwnProperty("datavalue")||Object.defineProperty(scope,"datavalue",{get:function(){return _.get(parentScope,["formFields",[index],"value"])},set:function(val){_.set(parentScope,["formFields",[index],"value"],val)}}),"select"!==scope.widget||scope.hasOwnProperty("displayvalue")||Object.defineProperty(scope,"displayvalue",{get:function(){return _.get(parentScope,["Widgets",scope.name+"_formWidget","displayvalue"])}}),scope.setValidationMessage=function(val){scope.validationmessage=val,setValidity(scope.name,!1)},parentScope.formfields=parentScope.formfields||{},parentScope.formfields[columnDef.key]=columnDef,element.removeAttr("tabindex")}}}}}]).directive("wmFormAction",["$compile","CONSTANTS","LiveWidgetUtils",function($compile,CONSTANTS,LiveWidgetUtils){"use strict";var getTemplate=function(btnField,index){var template='<wm-button name="'+btnField.key+'" caption="'+btnField.displayName+'" class="'+btnField.class+'" iconclass="'+btnField.iconclass+'"" on-click="'+btnField.action+'" type="'+btnField.type+'" hint="'+btnField.title+'"  shortcutkey="'+btnField.shortcutkey+'" disabled="'+btnField.disabled+'"  tabindex="'+btnField.tabindex+'"';return template=btnField.updateMode?template+' show="{{isUpdateMode && buttonArray['+index+'].show}}"':template+' show="{{!isUpdateMode && buttonArray['+index+'].show}}"',template+="></wm-button>"};return{restrict:"E",scope:!0,replace:!0,template:"<div></div>",compile:function(){return{post:function(scope,element,attrs){var parentScope,template,index,parentEle=element.parent(),buttonDef=WM.extend(LiveWidgetUtils.getButtonDef(attrs),{iconname:attrs.iconname,type:attrs.type||"button",updateMode:attrs.updateMode===!0||"true"===attrs.updateMode});parentScope=CONSTANTS.isRunMode&&scope.isLayoutDialog?scope:scope.parentScope=parentEle&&parentEle.length>0?parentEle.closest('[data-identifier="liveform"]').isolateScope()||scope.$parent:scope.$parent,parentScope.buttonArray=parentScope.buttonArray||[],index=parentScope.buttonArray.push(buttonDef)-1,parentScope.formCreated=!0,parentScope.formFieldCompiled=!0,template=getTemplate(buttonDef,index),"page"===scope.formlayout?scope.buttonArray[index].action=buttonDef.action:element.closest('[data-identifier="liveform"]').find("> .basic-btn-grp").append($compile(template)(parentScope)),element.remove()}}}}}]).directive("wmValidFile",function(){"use strict";return{require:"ngModel",link:function(scope,el,attrs,ngModel){el.bind("change",function(){scope.$apply(function(){ngModel.$setViewValue(el.val()),ngModel.$render()})})}}}),WM.module("wm.widgets.live").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/livefilter/livefilter.html",'<form data-identifier="livefilter" class="app-livefilter panel app-panel clearfix liveform-inline" init-widget apply-styles="shell"><div class="panel-heading" ng-if="title || subheading || iconclass"><h3 class="panel-title"><div class="pull-left"><i class="app-icon panel-icon {{iconclass}}" ng-show="iconclass"></i></div><div class="pull-left"><div class="heading">{{title}}</div><div class="description">{{subheading}}</div></div><div class="panel-actions"><button type="button" class="app-icon wi panel-action" ng-if="collapsible" title="{{::$root.appLocale.LABEL_COLLAPSE}}/{{::$root.appLocale.LABEL_EXPAND}}" ng-class="expanded ? \'wi-minus\': \'wi-plus\'" ng-click="expandCollapsePanel($event);"></button></div></h3></div><div ng-show="expanded" class="panel-body" apply-styles="inner-shell"><div data-identifier="filter-elements" ng-transclude></div><div class="hidden-filter-elements"></div></div><div ng-show="expanded && buttonArray" class="basic-btn-grp form-action panel-footer clearfix"></div></form>')}]).directive("wmLivefilter",["PropertiesFactory","$rootScope","$templateCache","WidgetUtilService","$compile","CONSTANTS","QueryBuilder","Utils","wmToaster","$controller","LiveWidgetUtils","$timeout",function(PropertiesFactory,$rootScope,$templateCache,WidgetUtilService,$compile,CONSTANTS,QueryBuilder,Utils,wmToaster,$controller,LiveWidgetUtils,$timeout){"use strict";function getEmptyMatchMode(enableemptyfilter){var matchMode,emptyFilterOptions=_.split(enableemptyfilter,",");return 2===_.intersection(emptyFilterOptions,FILTER_CONSTANTS.NULLEMPTY).length?matchMode=MATCH_MODES.NULLOREMPTY:_.includes(emptyFilterOptions,FILTER_CONSTANTS.NULL)?matchMode=MATCH_MODES.NULL:_.includes(emptyFilterOptions,FILTER_CONSTANTS.EMPTY)&&(matchMode=MATCH_MODES.EMPTY),matchMode}function getRangeMatchMode(minValue,maxValue){var matchMode;return minValue&&maxValue?matchMode=MATCH_MODES.BETWEEN:minValue?matchMode=MATCH_MODES.GREATER:maxValue&&(matchMode=MATCH_MODES.LESSER),matchMode}function getRangeFieldValue(minValue,maxValue){var fieldValue;return minValue&&maxValue?fieldValue=[minValue,maxValue]:minValue?fieldValue=minValue:maxValue&&(fieldValue=maxValue),fieldValue}function setFieldDataSet(filterField,data,aliasColumn,enableemptyfilter){var emptySupportWidgets=["select","radioset"],isEnableEmptyFilter=getEnableEmptyFilter(enableemptyfilter),emptyOption={};filterField.dataset=[],isEnableEmptyFilter&&_.includes(emptySupportWidgets,filterField.widget)&&!filterField.isRange&&!filterField.multiple&&(emptyOption[FILTER_CONSTANTS.LABEL_KEY]=FILTER_CONSTANTS.EMPTY_KEY,emptyOption[FILTER_CONSTANTS.LABEL_VALUE]=FILTER_CONSTANTS.EMPTY_VALUE,filterField.dataset.push(emptyOption)),_.each(data.content,function(key){var value=key[aliasColumn],option={};null!==value&&""!==value&&(option[FILTER_CONSTANTS.LABEL_KEY]=value,option[FILTER_CONSTANTS.LABEL_VALUE]=value,filterField.dataset.push(option))}),filterField.datafield=FILTER_CONSTANTS.LABEL_KEY,"typeahead"===filterField.widget||"autocomplete"===filterField.widget?(filterField.searchkey=FILTER_CONSTANTS.LABEL_VALUE,filterField.displaylabel=FILTER_CONSTANTS.LABEL_VALUE):filterField.displayfield=FILTER_CONSTANTS.LABEL_VALUE}var widgetProps=PropertiesFactory.getPropertiesOf("wm.livefilter",["wm.base","wm.layouts.panel.defaults"]),filterMarkup="",FILTER_CONSTANTS={EMPTY_KEY:"EMPTY_NULL_FILTER",EMPTY_VALUE:$rootScope.appLocale.LABEL_NO_VALUE,NULLEMPTY:["null","empty"],NULL:"null",EMPTY:"empty",LABEL_KEY:"key",LABEL_VALUE:"value"},MATCH_MODES={BETWEEN:"between",GREATER:"greaterthanequal",LESSER:"lessthanequal",NULL:"null",EMPTY:"empty",NULLOREMPTY:"nullorempty"},dataSetWidgetTypes=Utils.getDataSetWidgets(),getEnableEmptyFilter=function(enableemptyfilter){return enableemptyfilter&&_.intersection(enableemptyfilter.split(","),FILTER_CONSTANTS.NULLEMPTY).length>0},notifyFor={dataset:!0,pagesize:CONSTANTS.isStudioMode,captionalign:!0,captionsize:!0};return{restrict:"E",replace:!0,transclude:!0,scope:{onBeforeservicecall:"&",onSuccess:"&",onError:"&"},controller:function($scope,$attrs){function applyFilterOnField(filterDef,isFirst){var variable=$scope.Variables[$scope.variableName],newVal=filterDef.isRange?getRangeFieldValue(filterDef.minValue,filterDef.maxValue):filterDef.value,filterOnFields=_.filter($scope.formFields,{filterOn:filterDef.field});!variable||isFirst&&(_.isUndefined(newVal)||""===newVal)||_.forEach(filterOnFields,function(filterField){var query,fieldColumn,type,filterOn=filterField.filterOn,filterFields={};dataSetWidgetTypes[filterField.widget]&&!filterField.tempDataset&&filterOn!==filterField.field&&(filterDef&&filterDef.isRelated&&(filterOn+="."+filterDef.lookupField),type=_.toLower(variable.getSqlType(filterOn)),WM.isDefined(newVal)&&""!==newVal&&null!==newVal?(filterFields=[{column:[filterOn],value:newVal,type:type}],filterDef.isRange?filterFields[0].matchMode=getRangeMatchMode(filterDef.minValue,filterDef.maxValue):getEnableEmptyFilter($scope.enableemptyfilter)&&newVal===FILTER_CONSTANTS.EMPTY_KEY&&(filterFields[0].matchMode=getEmptyMatchMode($scope.enableemptyfilter))):filterFields=[],fieldColumn=filterField.field,query=QueryBuilder.getQuery({tableName:$scope.result.propertiesMap.entityName,columns:[" DISTINCT "+fieldColumn+" AS "+filterField.field],filterFields:filterFields}),QueryBuilder.executeQuery({databaseName:variable.liveSource,query:query,page:1,size:500,nativeSql:!1,prefabName:variable._prefabName},function(data){setFieldDataSet(filterField,data,fieldColumn,$scope.enableemptyfilter)}))})}var onResult,filterController;if(CONSTANTS.isRunMode)try{filterController=$attrs.name+"Controller",$controller(filterController,{$scope:$scope})}catch(ignore){}onResult=function(data,status){status?Utils.triggerFn($scope.onSuccess,{$data:data}):Utils.triggerFn($scope.onError,{$data:data})},$scope.isUpdateMode=!0,$scope.__compileWithIScope=!0,$scope.clearFilter=function(){WM.forEach($scope.formFields,function(filterField){!filterField.readonly&&filterField.show&&("typeahead"!==filterField.widget&&"autocomplete"!==filterField.widget||$scope.$element.find("div[name="+filterField.name+"] input").val(""),filterField.isRange?(filterField.minValue="",filterField.maxValue=""):filterField.value=""),applyFilterOnField(filterField)}),$timeout(function(){$scope.filter()})},$scope.applyFilter=function(options){options=options||{},options.page=options.page||1,options.orderBy=WM.isDefined(options.orderBy)?options.orderBy:$scope.orderBy,$scope.filter(options)},$scope.filter=function(options){var orderBy,isValid,formFields={},variable=$scope.Variables[$scope.variableName],page=1,dataModel={};options=options||{},page=options.page||page,orderBy=WM.isDefined(options.orderBy)?options.orderBy:$scope.orderBy||"",$scope.orderBy=orderBy,_.forEach($scope.formFields,function(field){var fieldEle,fieldSelector="div[name="+field.name+"] input",$el=$scope.$element;return"typeahead"!==field.widget&&"autocomplete"!==field.widget||!$el?void(field.isRange?dataModel[field.field]={minValue:field.minValue,maxValue:field.maxValue}:dataModel[field.field]={value:field.value}):(fieldEle=$el.find(fieldSelector),void(field.isRange?dataModel[field.field]={minValue:WM.isDefined(field.minValue)?field.minValue:fieldEle.first().val(),maxValue:WM.isDefined(field.maxValue)?field.maxValue:fieldEle.last().val()}:dataModel[field.field]={value:WM.isDefined(field.value)?field.value:fieldEle.val()}))});try{if(isValid=$scope.onBeforeservicecall({$data:dataModel}),isValid===!1)return;if(isValid&&isValid.error)return void wmToaster.show("error","ERROR",isValid.error);_.each($scope.formFields,function(filterField){filterField.isRange?(filterField._minValue=dataModel[filterField.field].minValue,filterField._maxValue=dataModel[filterField.field].maxValue):filterField._value=dataModel[filterField.field].value})}catch(err){if("Abort"===err.message)return}return WM.forEach($scope.formFields,function(filterField){var fieldValue,matchMode,minValue=filterField._minValue,maxvalue=filterField._maxValue,colName=filterField.field;if(filterField.isRelated&&(colName+="."+filterField.lookupField),filterField.isRange)fieldValue=getRangeFieldValue(minValue,maxvalue),matchMode=getRangeMatchMode(minValue,maxvalue),WM.isDefined(fieldValue)&&(formFields[colName]={value:fieldValue,matchMode:matchMode,logicalOp:"AND"});else{switch(filterField.widget){case"select":case"radioset":getEnableEmptyFilter($scope.enableemptyfilter)&&filterField._value===FILTER_CONSTANTS.EMPTY_KEY?(matchMode=getEmptyMatchMode($scope.enableemptyfilter),fieldValue=filterField._value):"boolean"===filterField.type?WM.isDefined(filterField._value)&&""!==filterField._value&&(fieldValue=JSON.parse(filterField._value)):fieldValue=filterField._value;break;case"checkboxset":case"chips":filterField._value&&filterField._value.length&&(fieldValue=filterField._value);break;case"checkbox":case"toggle":WM.isDefined(filterField._value)&&""!==filterField._value&&(fieldValue="boolean"===filterField.type?JSON.parse(filterField._value):filterField._value);break;default:fieldValue=filterField._value}WM.isDefined(fieldValue)&&""!==fieldValue&&null!==fieldValue&&(formFields[colName]={},matchMode?(formFields[colName].matchMode=matchMode,fieldValue=void 0):("string"===filterField.type||filterField.isRelated)&&(formFields[colName].matchMode=matchMode||filterField.matchmode||variable.matchMode),formFields[colName].value=fieldValue,formFields[colName].logicalOp="AND")}}),options.exportFormat?void variable.download({matchMode:"anywhere",filterFields:formFields,orderBy:orderBy,exportFormat:options.exportFormat,logicalOp:"AND",size:options.exportdatasize}):void variable.update({filterFields:formFields,orderBy:orderBy,page:page,pagesize:$scope.pagesize||20,skipDataSetUpdate:!0},function(data,propertiesMap,pageOptions){data.error?(wmToaster.show("error","ERROR",data.error),onResult(data,!1)):($scope.result.data=data,$scope.result.formFields=Utils.getClonedObject(formFields),$scope.result.pagingOptions={dataSize:pageOptions.dataSize,maxResults:$scope.pagesize||20,currentPage:page},$scope.result.options={page:page,orderBy:orderBy},onResult(data,!0))},function(error){wmToaster.show("error","ERROR",error),onResult(error,!1)})},$scope.constructDefaultData=function(dataset){var columnObj=dataset.propertiesMap.columns,colDefArray=[],numColumns=Math.min(columnObj.length,5),fieldTypeWidgetTypeMap=LiveWidgetUtils.getFieldTypeWidgetTypesMap();return _.each(columnObj,function(column,index){var colDef={field:column.fieldName,displayname:Utils.prettifyLabel(column.fieldName),widget:fieldTypeWidgetTypeMap[column.type][0],isRange:!1,filterOn:"",lookupType:"",lookupField:"",minPlaceholder:"",maxPlaceholder:"",placeholder:"",datepattern:"",class:"",width:"",height:"",textAlignment:"",backgroundColor:"",required:"",minValue:"",maxValue:"",multiple:"",value:"",type:column.type,step:LiveWidgetUtils.getStepValue(column.type),ismeridian:"",isPrimaryKey:column.isPrimaryKey,generator:column.generator,show:!0,pcDisplay:!0,mobileDisplay:!0};return column.isRelated?(colDef.field=column.fieldName.charAt(0).toLowerCase()+column.fieldName.slice(1),colDef.displayname=Utils.prettifyLabel(colDef.field),colDef.isRelated=!0,colDef.lookupType=column.relatedEntityName,colDef.lookupField="",_.each(column.columns,function(subcolumn){subcolumn.isPrimaryKey&&(colDef.lookupField=subcolumn.fieldName)}),colDef.relatedEntityName=column.relatedEntityName):colDef.isRelated=!1,colDefArray.push(colDef),index+1<numColumns}),colDefArray},$scope.filterOnDefault=function(){var defaultObj=_.find($scope.formFields,function(obj){return obj.value});defaultObj&&$scope.result&&$scope.filter()},$scope.expandCollapsePanel=function($event){$scope.collapsible&&($scope.expanded?$scope.onCollapse&&$scope.onCollapse({$event:$event,$scope:this}):$scope.onExpand&&$scope.onExpand({$event:$event,$scope:this}),$scope.expanded=!$scope.expanded)},$scope._onFocusField=function($event){WM.element($event.target).closest(".live-field").addClass("active")},$scope._onBlurField=function($event){WM.element($event.target).closest(".live-field").removeClass("active")},$scope._onChangeField=function($event,$is,newVal,oldVal){var index=$is.$element.closest('[data-role="filter-field"]').isolateScope().index;applyFilterOnField($scope.formFields[index]),$scope.autoupdate&&(newVal||oldVal)&&$scope.filter()},$scope._onSubmitField=function($event,$is){var index=$is.$element.closest('[data-role="filter-field"]').isolateScope().index;applyFilterOnField($scope.formFields[index]),$scope.autoupdate&&$scope.filter()},$scope.applyFilterOnField=applyFilterOnField},template:function(element){return filterMarkup=element.html(),$templateCache.get("template/widget/livefilter/livefilter.html")},compile:function(tElement,tAttr){return tAttr.gridColumnMarkup=filterMarkup,{pre:function(iScope,element,attrs){var elScope=element.scope();iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,iScope.filterElement=element,iScope.Variables=elScope.Variables,iScope.Widgets=elScope.Widgets,iScope.pageParams=elScope.pageParams,iScope.appLocale=$rootScope.appLocale,iScope.filterFields={},element.removeAttr("title")},post:function(scope,element,attrs){function updateAllowedValues(){var variable=scope.Variables[scope.variableName];variable&&_.forEach(scope.formFields,function(filterField){LiveWidgetUtils.getDistinctValues(filterField,variable,function(filterField,data,aliasColumn){setFieldDataSet(filterField,data,aliasColumn,scope.enableemptyfilter)})})}function propertyChangeHandler(key,newVal,oldVal){switch(key){case"dataset":var fieldsObj,buttonsObj,designerObj,fieldTypeWidgetTypeMap=LiveWidgetUtils.getFieldTypeWidgetTypesMap(),elScope=element.scope();newVal&&newVal.propertiesMap&&WM.isArray(newVal.propertiesMap.columns)?(oldVal&&oldVal.propertiesMap&&WM.equals(newVal.propertiesMap.columns,oldVal.propertiesMap.columns)&&WM.equals(newVal.data,oldVal.data)||(scope.result=scope.result||{data:[],pagingOptions:newVal.pagingOptions,options:{page:1}},scope.variableName=scope.binddataset.match(variableRegex)[1],scope.variableObj=elScope.Variables&&elScope.Variables[scope.variableName],scope.variableType=scope.variableObj.category,scope.result.variableName=scope.variableName,scope.result.propertiesMap=newVal.propertiesMap,scope.result.widgetName=scope.name,scope.result.isBoundToFilter=!0,fieldsObj=scope.constructDefaultData(newVal),scope.formFields&&newVal&&newVal.propertiesMap&&(scope.formFields.forEach(function(filterField){var filterObj=_.find(newVal.propertiesMap.columns,function(obj){return obj.fieldName===filterField.field});filterObj&&(filterField.type=filterObj.type,!CONSTANTS.isStudioMode||"datetime"!==filterField.type||filterField.widget&&"text"!==filterField.widget||(filterField.widget=fieldTypeWidgetTypeMap[filterField.type][0],scope.$root.$emit("set-markup-attr",scope.widgetid,{type:filterField.type,widget:filterField.widget},"wm-filter-field[field="+filterField.field+"]")))}),scope.formFields.map(function(field){scope.filterFields[field.key]=field})),buttonsObj=defaultButtonsArray,scope.filter(scope.result.options)),updateAllowedValues(),_.forEach(scope.formFields,function(filterField){scope.applyFilterOnField(filterField,!0)})):!newVal&&CONSTANTS.isStudioMode&&(scope.variableName="",scope.result="",scope.formFields="",scope.filterConstructed=!1,scope.fieldObjectCreated=!1,fieldsObj=[],buttonsObj=[]),CONSTANTS.isStudioMode&&scope.newcolumns&&fieldsObj&&(scope.newcolumns=!1,designerObj={widgetName:scope.name,fieldDefs:fieldsObj,buttonDefs:buttonsObj,variableName:scope.variableName,scopeId:scope.$id,numColumns:scope.getActiveLayout(),bindDataSetChanged:!0,widgettype:scope.widgettype},Utils.getService("LiveWidgetsMarkupManager").updateMarkupForLiveFilter(designerObj));break;case"pagesize":WM.isDefined(scope.variableName)&&WM.isDefined(newVal)&&!WM.equals(newVal,oldVal)&&scope.filter();break;case"captionalign":element.removeClass("align-"+oldVal).addClass("align-"+newVal);break;case"captionsize":LiveWidgetUtils.setCaptionSize(element,newVal)}}void 0===scope.expanded&&(scope.expanded=!0);var variableRegex=/^bind:Variables\.(.*)\.dataSet$/,handlers=[],defaultButtonsArray=LiveWidgetUtils.getLiveWidgetButtons("LIVEFILTER");scope.filterContainer=element,scope.primaryKey=null,scope.getActiveLayout=function(){return LiveWidgetUtils.getColumnCountByLayoutType(scope.layout,+element.find(".app-grid-layout:first").attr("columns"))},WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler,scope,notifyFor),handlers.push($rootScope.$on("compile-filters",function(event,scopeId,markup,variableName,fromDesigner){if(scope.$id===scopeId){var markupObj=WM.element("<div>"+markup+"</div>"),fieldsObj=markupObj.find("> :not(wm-filter-action)"),actionsObj=markupObj.find("wm-filter-action");scope.filterConstructed=fromDesigner,scope.variableName=variableName,scope.formFields=void 0,scope.buttonArray=void 0,element.find('[data-identifier="filter-elements"]').empty(),element.find(".hidden-filter-elements").empty(),element.find(".basic-btn-grp").empty(),fieldsObj&&fieldsObj.length?$rootScope.$emit("prepare-element",fieldsObj,function(){element.find('[data-identifier="filter-elements"]').append(fieldsObj),element.find(".basic-btn-grp").append(actionsObj),$compile(fieldsObj)(scope),$compile(actionsObj)(scope)}):(fieldsObj=markupObj.find("wm-filter-field"),element.find('[data-identifier="filter-elements"]').append(fieldsObj),element.find(".basic-btn-grp").append(actionsObj),$compile(fieldsObj)(scope),$compile(actionsObj)(scope)),updateAllowedValues(),scope.filterConstructed=!0}scope.filterWidgets=LiveWidgetUtils.getFormFilterWidgets(element)})),scope.$on("$destroy",function(){handlers.forEach(Utils.triggerFn)}),scope.filterWidgets=LiveWidgetUtils.getFormFilterWidgets(element),scope.updateAllowedValues=updateAllowedValues,scope.redraw=function(forceRender){forceRender&&scope.filter(scope.result.options)},WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]).directive("wmFilterField",["$compile","Utils","CONSTANTS","BindingManager","LiveWidgetUtils","WidgetUtilService",function($compile,Utils,CONSTANTS,BindingManager,LiveWidgetUtils,WidgetUtilService){"use strict";return{restrict:"E",scope:{},template:"<div init-widget data-role='filter-field'></div>",replace:!0,compile:function(tElement){return{pre:function(scope,element,attrs){LiveWidgetUtils.preProcessFields("wm-filter-field",scope,attrs,tElement)},post:function(scope,element,attrs){var parent=element.parent();scope.parentIsolateScope=parent&&parent.length>0?parent.closest('[data-identifier="livefilter"]').isolateScope():scope.$parent,scope.FilterField=function(){},scope.FilterField.prototype=new wm.baseClasses.FieldDef;var expr,exprWatchHandler,template,index,defaultVal,parentIsolateScope=scope.parentIsolateScope,columnsDef=new scope.FilterField,columnsDefProps=WM.extend(LiveWidgetUtils.getColumnDef(attrs),{field:attrs.field||attrs.binding||attrs.name,filterOn:attrs.filterOn,isRange:"true"===attrs.isRange||attrs.isRange===!0,isRelated:"true"===attrs.isRelated||attrs.isRelated===!0,lookupType:attrs.lookupType,lookupField:attrs.lookupField,relatedEntityName:attrs.relatedEntityName});if(WM.extend(columnsDef,columnsDefProps),columnsDef.key=columnsDef.field,scope.required=columnsDef.required,scope.readonly=columnsDef.readonly,scope.disabled=columnsDef.disabled,scope.FilterField.prototype.$is=parentIsolateScope,columnsDefProps.defaultvalue=attrs.defaultvalue||attrs.value,columnsDef.defaultvalue&&(Utils.stringStartsWith(columnsDef.defaultvalue,"bind:")&&CONSTANTS.isRunMode?(expr=columnsDef.defaultvalue.replace("bind:",""),exprWatchHandler=BindingManager.register(parentIsolateScope,expr,function(newVal){parentIsolateScope.formFields[index].value=newVal,columnsDef.isRange&&(parentIsolateScope.formFields[index].minValue=newVal,parentIsolateScope.formFields[index].maxValue=newVal),parentIsolateScope.filterOnDefault(),parentIsolateScope.applyFilterOnField(columnsDef)},{deepWatch:!0,allowPageable:!0,acceptsArray:!1},"datavalue")):(defaultVal=columnsDef.defaultvalue,CONSTANTS.isRunMode&&(defaultVal=LiveWidgetUtils.getDefaultValue(defaultVal,columnsDef.type)),columnsDef.value=defaultVal,columnsDef.isRange&&(columnsDef.minValue=defaultVal,columnsDef.maxValue=defaultVal))),attrs.dataset&&(columnsDef.tempDataset=attrs.dataset),scope.fieldDefConfig=columnsDef,parentIsolateScope.formFields=parentIsolateScope.formFields||[],parentIsolateScope.columnsDefCreated=!0,index=_.indexOf(parentIsolateScope.formFields,void 0),index=index>-1?index:parentIsolateScope.formFields.length,scope.index=index,parentIsolateScope.formFields[index]=columnsDef,CONSTANTS.isRunMode)if(Utils.isMobile()){if(!columnsDef.mobileDisplay)return}else if(!columnsDef.pcDisplay)return;!CONSTANTS.isRunMode||columnsDef.show?(template=LiveWidgetUtils.getTemplate(columnsDef,index,parentIsolateScope.captionposition,element),element.html(template),$compile(element.contents())(parentIsolateScope)):(template=LiveWidgetUtils.getHiddenTemplate(columnsDef,index),element.closest('[data-identifier="livefilter"]').find("> .hidden-filter-elements").append($compile(template)(parentIsolateScope))),parentIsolateScope.$on("$destroy",function(){exprWatchHandler&&exprWatchHandler()}),element.on("$destroy",function(){CONSTANTS.isRunMode?_.pullAt(parentIsolateScope.formFields,_.indexOf(parentIsolateScope.formFields,columnsDef)):_.set(parentIsolateScope.formFields,index,void 0)}),WidgetUtilService.registerPropertyChangeListener(LiveWidgetUtils.fieldPropertyChangeHandler.bind(void 0,scope,element,attrs,parentIsolateScope,index),scope),scope.hasOwnProperty("datavalue")||Object.defineProperty(scope,"datavalue",{get:function(){return _.get(parentIsolateScope,["formFields",[index],"value"])},set:function(val){_.set(parentIsolateScope,["formFields",[index],"value"],val)}}),"select"!==scope.widget||scope.hasOwnProperty("displayvalue")||Object.defineProperty(scope,"displayvalue",{get:function(){return _.get(parentIsolateScope,["Widgets",scope.name+"_formWidget","displayvalue"])}}),element.removeAttr("tabindex")}}}}}]).directive("wmFilterAction",["$compile","LiveWidgetUtils",function($compile,LiveWidgetUtils){"use strict";return{restrict:"E",scope:!0,template:"",replace:!0,compile:function(){return{post:function(scope,element,attrs){var parent=element.parent();scope.parentIsolateScope=parent&&parent.length>0?parent.closest('[data-identifier="livefilter"]').isolateScope():scope.$parent;var buttonTemplate,index,buttonDef=WM.extend(LiveWidgetUtils.getButtonDef(attrs),{iconname:attrs.iconname,type:"button"});scope.parentIsolateScope.buttonArray=scope.parentIsolateScope.buttonArray||[],index=scope.parentIsolateScope.buttonArray.push(buttonDef)-1,scope.parentIsolateScope.columnsDefCreated=!0,buttonTemplate='<wm-button caption="'+buttonDef.displayName+'" show="{{buttonArray['+index+'].show}}" hint="'+buttonDef.title+'"class="'+buttonDef.class+'" iconclass="'+buttonDef.iconclass+'"on-click="'+buttonDef.action+'" type="'+buttonDef.type+'" shortcutkey="'+buttonDef.shortcutkey+'" disabled="'+buttonDef.disabled+'" tabindex="'+buttonDef.tabindex+'"></wm-button>',element.closest('[data-identifier="livefilter"]').find(".basic-btn-grp").append($compile(buttonTemplate)(scope.parentIsolateScope)),$compile(element.contents())(scope.parentIsolateScope),element.remove()}}}}}]),WM.module("wm.widgets.live").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/livegrid/livegrid.html",'<div class="app-livegrid" init-widget title="{{hint}}" apply-styles="container"><div wmtransclude></div></div>')}]).directive("wmLivegrid",["PropertiesFactory","$templateCache","WidgetUtilService","DialogService","$compile","$timeout","Utils","wmToaster","$rootScope","LiveWidgetUtils",function(PropertiesFactory,$templateCache,WidgetUtilService,DialogService,$compile,$timeout,Utils,wmToaster,$rs,LiveWidgetUtils){"use strict";function setFormWidgets($is){$timeout(function(){$is.formWidgets=LiveWidgetUtils.getFormFilterWidgets(WM.element("body").find(".app-liveform-dialog[dialogid="+$is._dialogid+"]"))})}var widgetProps=PropertiesFactory.getPropertiesOf("wm.livegrid",["wm.base"]),gridMarkup="",notifyFor={formlayout:!0},showErrorMessage=function(){wmToaster.show("error","ERROR",$rs.appLocale.LABEL_ACCESS_DENIED)};return{restrict:"E",replace:!0,transclude:!0,scope:{},controller:function($scope){this.confirmMessage=function(okCallBack,cancelCallBack){return $scope.grid&&$scope.grid.confirmdelete?void DialogService._showAppConfirmDialog({caption:"Delete Record",iconClass:"wi wi-delete fa-lg",content:$scope.grid.confirmdelete,resolve:{confirmActionOk:function(){return okCallBack},confirmActionCancel:function(){return cancelCallBack}}}):void okCallBack()}},template:function(element){return gridMarkup=element.html(),$templateCache.get("template/widget/livegrid/livegrid.html")},compile:function(tElement,tAttr){return tAttr.gridColumnMarkup=gridMarkup,{pre:function(iScope,$el,attrs){iScope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){function propertyChangeHandler(key,newVal){switch(key){case"formlayout":scope.gridform&&(scope.isLayoutDialog="dialog"===newVal,scope.gridform.formlayout=newVal,scope.$root.$emit("set-markup-attr",scope.gridform.widgetid,{formlayout:newVal}))}}var handlers=[],liveGridOptions={multiselect:!1,setGridEditMode:""};liveGridOptions.onRowDelete=function(row,callBackFn){scope.gridform.rowdata=row,scope.gridform.delete(callBackFn)},scope.getRegExp=function(){return new RegExp(scope.regexp)},scope.primaryKey=null,scope.fullFieldDefs=[],scope.fieldDefs=[],scope.grid=element.find("[data-identifier=grid]").isolateScope(),scope.gridform=element.find("[data-identifier=liveform]").isolateScope(),scope.isLayoutDialog=!1,scope.grid&&scope.gridform?(scope.grid.datagridElement.datagrid("option",liveGridOptions),scope.grid.parentgrid=!0,scope.grid.isGridPartOfLiveGrid=!0,scope.grid.newcolumns=scope.newcolumns,scope.grid.$watch("selectedItems",function(newValue){scope.grid&&scope.gridform&&scope.grid.variableName===scope.gridform.variableName&&(newValue&&newValue.length>0&&!scope.gridform.isSelected&&(scope.gridform.isSelected=!0),newValue&&newValue.length>0?(scope.grid.multiselect?scope.gridform.rowdata=newValue[0]:scope.gridform.rowdata=newValue[newValue.length-1],scope.gridform.isUpdateMode&&scope.gridform.edit()):(scope.gridform.isSelected=!1,
scope.gridform.rowdata="",scope.gridform.clearData()))},!0),scope.grid.$watch("fullFieldDefs",function(newVal){scope.fullFieldDefs=newVal},!0),scope.grid.$watch("fieldDefs",function(newVal){scope.fieldDefs=newVal},!0),scope.grid.$watch("serverData",function(newVal){scope.serverData=newVal},!0),handlers.push(scope.grid.$on("add-new-row",function(){scope.gridform.isSelected=!0,scope.gridform.rowdata="",scope.gridform.isLayoutDialog&&(scope.gridform.setPrevformFields(scope.gridform.formFields),scope.gridform.formFields=[]),scope.gridform.new(),scope.isLayoutDialog&&(DialogService.showDialog(scope.gridform._dialogid,{resolve:{},scope:scope.gridform}),setFormWidgets(scope.gridform))})),handlers.push(scope.grid.$on("update-row",function(event,widgetid,row,eventName){scope.gridform.rowdata=row,scope.gridform.isLayoutDialog&&(scope.gridform.setPrevformFields(scope.gridform.formFields),scope.gridform.formFields=[]),scope.gridform.isSelected=!0,scope.gridform.edit(),scope.$root.$safeApply(scope),scope.isLayoutDialog&&(scope.gridform.isUpdateMode="dblclick"!==eventName||scope.gridform.updateMode,DialogService.showDialog(scope.gridform._dialogid,{resolve:{},scope:scope.gridform}),setFormWidgets(scope.gridform))})),scope.gridform.$watch("primaryKey",function(newVal){scope.primaryKey=newVal}),handlers.push(scope.gridform.$on("on-cancel",function(){scope.gridform.isUpdateMode=!1,scope.isLayoutDialog&&DialogService.hideDialog(scope.gridform._dialogid)})),handlers.push(scope.gridform.$on("on-result",function(event,operation,response,newForm,updateMode){switch(scope.gridform.isUpdateMode=WM.isDefined(updateMode)?updateMode:!!newForm,operation){case"insert":newForm?(scope.grid.gridfirstrowselect=!1,scope.grid.initiateSelectItem("last",response,!0)):scope.grid.initiateSelectItem("last",response);break;case"update":newForm?(scope.grid.gridfirstrowselect=!1,scope.grid.initiateSelectItem("current",response,!0)):scope.grid.initiateSelectItem("current",response);break;case"delete":scope.grid.onRecordDelete()}scope.grid.updateVariable(),scope.isLayoutDialog&&(newForm?"insert"===operation?scope.gridform.new():"update"===operation&&scope.gridform.edit():DialogService.hideDialog(scope.gridform._dialogid))}))):scope.grid&&scope.grid.datagridElement.datagrid("option",{beforeRowUpdate:function(){showErrorMessage()},beforeRowDelete:function(){showErrorMessage()},beforeRowInsert:function(){showErrorMessage()}}),$compile(attrs.gridColumnMarkup)(scope),scope.$on("$destroy",function(){handlers.forEach(Utils.triggerFn)}),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler,scope,notifyFor),$timeout(function(){WidgetUtilService.postWidgetCreate(scope,element,attrs)},0,!1)}}}}}]),WM.module("wm.layouts.containers").directive("wmListtemplate",["PropertiesFactory","WidgetUtilService","$rootScope","CONSTANTS","$timeout","Utils",function(PropertiesFactory,WidgetUtilService,$rootScope,CONSTANTS,$timeout,Utils){"use strict";function updateLiveListTemplate($is){$timeout(function(){$rootScope.$emit("livelist-template-modified",{widgetName:$is.name,bindDataset:null,fields:null,forceUpdate:!0,isTemplateUpdate:!0})},void 0)}function propertyChangeHandler($is,key,newVal){switch(key){case"layout":newVal&&$is.newcolumns&&(updateLiveListTemplate($is),$is.newcolumns=!1)}}function templateFn(){return'<li init-widget class="app-listtemplate list-group-item app-list-item"  wmtransclude></li>'}function preLinkFn($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps}function studioMode_postLinkFn($is,$el,attrs){var onPropertyChange=propertyChangeHandler.bind(void 0,$is);onPropertyChange.notifyFor=notifyFor,$is.propertyManager.add($is.propertyManager.ACTIONS.CHANGE,onPropertyChange),WidgetUtilService.postWidgetCreate($is,$el,attrs)}function runMode_preLinkFn($is,$el,attrs,listCtrl){listCtrl.$set("listTemplate",$el.children()),$el.remove()}var widgetProps,notifyFor,directiveDefn={restrict:"E",replace:!0};return CONSTANTS.isStudioMode&&(widgetProps=PropertiesFactory.getPropertiesOf("wm.layouts.listtemplate"),notifyFor={layout:!0}),CONSTANTS.isStudioMode?WM.extend(directiveDefn,{transclude:!0,scope:{},template:templateFn,link:{pre:preLinkFn,post:studioMode_postLinkFn}}):WM.extend(directiveDefn,{terminal:!0,require:"^wmLivelist",link:{pre:runMode_preLinkFn}}),directiveDefn}]),WM.module("wm.widgets.live").run(["$templateCache",function($tc){"use strict";$tc.put("template/widget/list.html",'<div class="app-livelist app-panel" ng-class="navigation" init-widget live-actions apply-styles="shell" listen-property="dataset"><div class="panel-heading" ng-if="title || subheading || iconclass"><h3 class="panel-title"><div class="pull-left"><i class="app-icon panel-icon {{iconclass}}" ng-show="iconclass"></i></div><div class="pull-left"><div class="heading">{{title}}</div><div class="description">{{subheading}}</div></div></h3></div><nav class="app-datanavigator" ng-if="navigation === \'Inline\' && !noDataFound"><ul class="pager"><li class="previous" ng-class="{\'disabled\': dataNavigator.isDisablePrevious}"><a href="javascript:void(0);" ng-click="dataNavigator.navigatePage(\'prev\', $event)"><i class="wi wi-chevron-left"></i></a></li></ul></nav><ul data-identifier="list" tabindex="0" class="app-livelist-container clearfix" ng-show="!noDataFound" ng-class="listclass" wmtransclude apply-styles="scrollable-container"></ul><div class="no-data-msg" ng-if="noDataFound && !variableInflight">{{nodatamessage}}</div><div class="loading-data-msg" ng-if="variableInflight"><span><i class="app-icon panel-icon {{loadingicon}} fa-spin"></i><span class="loading-text">{{loadingdatamsg}}</span></span></div><nav class="app-datanavigator" ng-if="navigation === \'Inline\' && !noDataFound"><ul class="pager"><li class="next" ng-class="{\'disabled\': dataNavigator.isDisableNext}"><a href="javascript:void(0);" ng-click="dataNavigator.navigatePage(\'next\', $event)"><i class="wi wi-chevron-right"></i></a></li></ul></nav><div class="panel-footer" ng-if="navigation !== \'None\'" ng-show="(isStudioMode || dataNavigator.dataSize) && (showNavigation || (onDemandLoad && !variableInflight && !dataNavigator.isLastPage()))"><wm-datanavigator showrecordcount="{{show && showrecordcount}}" navigationalign="{{navigationalign}}" navigation="{{navControls}}" maxsize="{{maxsize}}" boundarylinks="{{boundarylinks}}" forceellipses="{{forceellipses}}" directionlinks="{{directionlinks}}"></wm-datanavigator><a ng-show="onDemandLoad" href="javascript:void(0);" ng-click="dataNavigator.navigatePage(\'next\', $event)" class="app-button btn btn-justified {{paginationclass}}">{{ondemandmessage}}</a></div></div>')}]).controller("listController",[function(){"use strict";var _map={};this.$set=function(key,value){_map[key]=value},this.$get=function(key){return _map[key].clone(!0)}}]).directive("wmLivelist",["WidgetUtilService","PropertiesFactory","$templateCache","CONSTANTS","$compile","Utils","$rootScope","$servicevariable","$timeout","DeviceVariableService","LiveWidgetUtils","FormWidgetUtils","$filter","$interpolate","$parse",function(WidgetUtilService,PropertiesFactory,$tc,CONSTANTS,$compile,Utils,$rs,$servicevariable,$timeout,DeviceVariableService,LiveWidgetUtils,FormWidgetUtils,$filter,$interpolate,$parse){"use strict";function getItemIndex(listItems,item){var matchIndex;return listItems.each(function(index){var $li=WM.element(this),liScope=$li.scope();if(_.isEqual(liScope.item,item))return matchIndex=index,!1}),matchIndex}function getVariable($is,variableName){if(variableName){var variables=$is.Variables||{};return variables[variableName]}}function getColumnsFromDataSet(dataset){return WM.isObject(dataset)?WM.isArray(dataset)&&WM.isObject(dataset[0])?_.keys(dataset[0]):_.keys(dataset):[]}function getColumnsFromPropertiesMap(propertiesMap){return propertiesMap&&propertiesMap.columns?propertiesMap.columns.map(function(column){return column.fieldName}):[]}function getBoundWidgetDatasetDetails($is){var dataSetParts,refVariable,refVariableName,relFieldName,relFieldType,fields,details,isBoundToSelectedItemSubset=_.includes($is.binddataset,"selecteditem.");return dataSetParts=$is.binddataset.split("."),refVariableName=Utils.getVariableName($is),refVariable=getVariable($is,refVariableName),relFieldName=isBoundToSelectedItemSubset&&dataSetParts[3],fields=$rs.dataTypes[refVariable.package].fields,details={refVariableName:refVariableName,refVariable:refVariable},relFieldName?(relFieldType=fields[relFieldName].type,details.relFieldType=relFieldType):details.fields=fields,details}function fetchDynamicColumns($is){var result,fields=[];return result=getBoundWidgetDatasetDetails($is),result.fields?fields=result.fields:result.relFieldType&&(fields=$servicevariable.getServiceModel({typeRef:result.relFieldType,variable:result.refVariable})),WM.isObject(fields)?_.keys(fields):fields}function updateLiveListBindings($is,forceUpdate){var columns;columns=$is.dataset&&$is.dataset.propertiesMap?getColumnsFromPropertiesMap($is.dataset.propertiesMap):getColumnsFromDataSet($is.dataset),columns&&columns.length||_.includes($is.binddataset,"bind:Widgets.")&&(columns=fetchDynamicColumns($is)),$rs.$emit("livelist-template-modified",{widgetName:$is.name,bindDataset:$is.binddataset,fields:columns,forceUpdate:forceUpdate})}function handlePageSizeDisplay($is,variableObj){if(variableObj){var widgetName=_.split($is.binddataset,".")[1],isBoundToLiveVariable="wm.LiveVariable"===variableObj.category,isBoundToWidget=_.startsWith($is.binddataset,"bind:Widgets."),isBoundToFilter=$is.Widgets[widgetName]&&("wm-livefilter"===$is.Widgets[widgetName]._widgettype||"wm-livefilter"===$is.Widgets[widgetName].widgettype),isBoundToQueryServiceVariable="wm.ServiceVariable"===variableObj.category&&"DataService"===variableObj.serviceType&&"QueryExecution"===variableObj.controller;$is.widgetProps.pagesize.show=!(isBoundToLiveVariable||isBoundToQueryServiceVariable)||!!isBoundToWidget&&!isBoundToFilter}}function setFetchInProgress($is,inProgress){$is.$liScope.fetchInProgress=inProgress}function _fetchNextOnScroll($is,$el){var $dataNavigator=$el.find("> .panel-footer > [data-identifier=datanavigator]"),navigator=$dataNavigator.isolateScope();$rs.$evalAsync(function(){setFetchInProgress($is,!0),navigator.navigatePage("next"),navigator.isLastPage()&&setFetchInProgress($is,!1)})}function bindScrollEvt($is,$el){var $scrollParent,scrollNode,lastScrollTop=0,$ul=$el.find("> ul");$scrollParent=$ul.children().first().scrollParent(!1),scrollNode=$scrollParent[0]===document?document.body:$scrollParent[0],scrollNode.scrollHeight>scrollNode.clientHeight?$scrollParent.each(function(){lastScrollTop=this===document?this.body.scrollTop||WM.element(window).scrollTop():this.scrollTop}).off("scroll.scroll_evt").on("scroll.scroll_evt",function(evt){var clientHeight,totalHeight,scrollTop,target=evt.target;target=target===document?target.scrollingElement||document.body:target,clientHeight=target.clientHeight,totalHeight=target.scrollHeight,scrollTop=target===document.body?WM.element(window).scrollTop():target.scrollTop,lastScrollTop<scrollTop&&.9*totalHeight<scrollTop+clientHeight&&(WM.element(this).off("scroll.scroll_evt"),_fetchNextOnScroll($is,$el)),lastScrollTop=scrollTop}):($scrollParent=$ul,$ul.on("wheel.scroll_evt",function(e){e.originalEvent.deltaY>0&&($ul.off("wheel.scroll_evt"),_fetchNextOnScroll($is,$el))})),$el.data("$scrollParent",$scrollParent)}function applyWrapper($tmplContent,attrs,flag){var tmpl=liTemplateWrapper_start;return attrs.hasOwnProperty("onMouseenter")&&(tmpl+=' ng-mouseenter="onMouseenter({$event: $event, $scope: this})" '),attrs.hasOwnProperty("onMouseleave")&&(tmpl+=' ng-mouseleave="onMouseleave({$event: $event, $scope: this})" '),tmpl+=liTemplateWrapper_end,tmpl=WM.element(tmpl),flag?tmpl.find(".app-list-item").append($tmplContent):tmpl.first().append($tmplContent),tmpl}function prepareLITemplate(tmpl,attrs,flag,name){var $tmpl=WM.element(tmpl),$div=WM.element("<div></div>").append($tmpl),parentDataSet=attrs.dataset||attrs.scopedataset;return parentDataSet&&Utils.updateTmplAttrs($div,parentDataSet,name),$tmpl=applyWrapper($tmpl,attrs,flag)}function setNavigationClass($is,$el,nv){$timeout(function(){var dataNavigatorScope,$dataNavigatorEl=$el.find("> .panel-footer > [data-identifier=datanavigator]");$is.navigation&&$dataNavigatorEl.length&&(dataNavigatorScope=$dataNavigatorEl.isolateScope(),dataNavigatorScope.navigationClass=nv)})}function filterDate(value,format,defaultFormat){return"timestamp"===format?value:$filter("date")(value,format||defaultFormat)}function addListElements(_s,$el,$is,attrs,listCtrl){function getTimeRolledUpString(str,rollUp){var groupByKey,currMoment=moment(),strMoment=moment(str),getSameElseFormat=function(){return"["+filterDate(this.valueOf(),$is.dateformat,ROLLUP_PATTERNS.DAY)+"]"};switch(rollUp){case TIME_ROLLUP_OPTIONS.HOUR:strMoment.isValid()||(strMoment=moment((new Date).toDateString()+" "+str),strMoment.isValid()&&(momentLocale._calendar.sameDay=function(){return"["+filterDate(this.valueOf(),$is.dateformat,ROLLUP_PATTERNS.HOUR)+"]"})),strMoment=strMoment.startOf("hour"),momentLocale._calendar.sameElse=getSameElseFormat,groupByKey=strMoment.calendar(currMoment);break;case TIME_ROLLUP_OPTIONS.WEEK:groupByKey=filterDate(strMoment.valueOf(),$is.dateformat,ROLLUP_PATTERNS.WEEK);break;case TIME_ROLLUP_OPTIONS.MONTH:groupByKey=filterDate(strMoment.valueOf(),$is.dateformat,ROLLUP_PATTERNS.MONTH);break;case TIME_ROLLUP_OPTIONS.YEAR:groupByKey=strMoment.format(ROLLUP_PATTERNS.YEAR);break;case TIME_ROLLUP_OPTIONS.DAY:strMoment=strMoment.startOf("day"),momentLocale._calendar.sameElse=getSameElseFormat,groupByKey=strMoment.calendar(currMoment)}return"Invalid date"===groupByKey?GROUP_BY_OPTIONS.OTHERS:groupByKey}function groupDataByField(liData){var concatStr=_.get(liData,$is.groupby);return WM.isUndefined(concatStr)||_.isNull(concatStr)?GROUP_BY_OPTIONS.OTHERS:($is.match===GROUP_BY_OPTIONS.ALPHABET&&(concatStr=concatStr.substr(0,1)),_.includes(_.values(TIME_ROLLUP_OPTIONS),$is.match)&&(concatStr=getTimeRolledUpString(concatStr,$is.match)),_.toLower(concatStr))}var $liTemplate,groupedLiData,groupDataByUserDefinedFn,regex=/\W/g,momentLocale=moment.localeData(),momentCalendarOptions=Utils.getClonedObject(momentLocale._calendar),momentCalendarDayOptions=momentLocale._calendarDay||{lastDay:"[Yesterday]",lastWeek:"[Last] dddd",nextDay:"[Tomorrow]",nextWeek:"dddd",sameDay:"[Today]",sameElse:"L"},GROUP_BY_OPTIONS={ALPHABET:"alphabet",WORD:"word",OTHERS:"Others"},TIME_ROLLUP_OPTIONS={HOUR:"hour",DAY:"day",WEEK:"week",MONTH:"month",YEAR:"year"},ROLLUP_PATTERNS={DAY:"yyyy-MM-dd",WEEK:"w 'Week',  yyyy",MONTH:"MMM, yyyy",YEAR:"YYYY",HOUR:"hh:mm a"},groupedDataFieldName="",count=0;$el.find("> [data-identifier=list]").empty(),_.includes($is.groupby,"(")?(groupDataByUserDefinedFn=_s[$is.groupby.split("(")[0]],groupedLiData=_.groupBy(_s.fieldDefs,groupDataByUserDefinedFn)):($is.orderby||(_s.fieldDefs=FormWidgetUtils.getOrderedDataSet(_s.fieldDefs,$is.groupby)),$is.match===TIME_ROLLUP_OPTIONS.DAY&&(momentLocale._calendar=momentCalendarDayOptions),_s.fieldDefs=_.orderBy(_s.fieldDefs,function(fieldDef){var groupKey=_.get(fieldDef,$is.groupby);if(groupKey)return _.toLower(groupKey)}),groupedLiData=_.groupBy(_s.fieldDefs,groupDataByField),momentLocale._calendar=momentCalendarOptions),_.forEach(_.keys(groupedLiData),function(groupkey,index){var groupedData=groupedLiData[groupkey];groupedDataFieldName="_groupData"+groupkey,liTemplateWrapper_start="",liTemplateWrapper_end="></li></ul></li>",regex.test(groupedDataFieldName)&&(count+=1,groupedDataFieldName=groupedDataFieldName.replace(regex,"_")+count),_s[groupedDataFieldName]=_.sortBy(groupedData,function(data){return data._groupIndex=index+1,data[$is.groupby]}),liTemplateWrapper_start+='<li class="app-list-item-group clearfix"><ul class="list-group" ng-class="listclass"><li class="app-list-item-header list-item" ng-class="{\'collapsible-content\' : collapsible}"><h4>'+groupkey+'<div class="header-action"><i class="app-icon wi action wi-chevron-up" ng-if="collapsible" title="{{::$root.appLocale.LABEL_COLLAPSE}}/{{::$root.appLocale.LABEL_EXPAND}}"></i><span ng-if="showcount" class="label label-default">'+_s[groupedDataFieldName].length+"</span></div></h4></li>",liTemplateWrapper_start+='<li ng-repeat="item in '+groupedDataFieldName+' track by $index" tabindex="0" ng-init="addCurrentItemWidgets(this);" ng-focus="onFocus($event)" class="app-list-item" ng-class="[itemsPerRowClass, _itemClass(this), {\'disable-item\': _disableItem(this)}]" ',$liTemplate=prepareLITemplate(listCtrl.$get("listTemplate"),attrs,!0,$is.name),$el.find("> [data-identifier=list]").append($liTemplate),$compile($liTemplate)($is.$liScope)})}function updateFieldDefs($is,$el,data,attrs,listCtrl){var unbindWatcher,_s,fieldDefs;_s=$is.$liScope,fieldDefs=_s.fieldDefs,$is.infScroll||$is.onDemandLoad?(WM.isUndefined(fieldDefs)&&(_s.fieldDefs=fieldDefs=[]),$is.dataNavigator.isFirstPage()&&(_s.fieldDefs.length=0),_.forEach(data,function(item){fieldDefs.push(item)}),$rs.$evalAsync(function(){setFetchInProgress($is,!1),fieldDefs.length&&!$is.onDemandLoad&&$timeout(function(){bindScrollEvt($is,$el)},100)})):_s.fieldDefs=data,$is.orderby&&(_s.fieldDefs=FormWidgetUtils.getOrderedDataSet(_s.fieldDefs,$is.orderby)),$is.groupby&&(addListElements(_s,$el,$is,attrs,listCtrl),$is.collapsible&&$el.find("li.app-list-item-header").on("click",function(e){var selectedGroup=WM.element(e.target).closest(".list-group"),selectedAppIcon=selectedGroup.find("li.app-list-item-header").find(".app-icon");selectedAppIcon.hasClass("wi-chevron-down")?selectedAppIcon.removeClass("wi-chevron-down").addClass("wi-chevron-up"):selectedAppIcon.removeClass("wi-chevron-up").addClass("wi-chevron-down"),selectedGroup.find(".app-list-item").toggle()})),_s.fieldDefs.length||($is.noDataFound=!0,$is.selecteditem=void 0),$el.find("li.app-list-item.active").removeClass("active"),!$is.selectfirstitem||1!==_.get($is.dataNavigator,"dn.currentPage")&&$is.multiselect||(unbindWatcher=$is.$watch(function(){var items=$el.find(".list-group li.app-list-item:first");items.length&&$rs.$safeApply($is,function(){$timeout(function(){var item=items.first();item.hasClass("active")||item.click()},0,!1),unbindWatcher()})})),$timeout(function(){_.forEach($is._items,function(item){var listItems=$el.find(".list-group li.app-list-item"),itemIndex=getItemIndex(listItems,item),$li=WM.element(listItems[itemIndex]);_.isEqual(itemIndex,-1)||$li.addClass("active")})})}function onDataChange($is,$el,nv,attrs,listCtrl){if(nv){var boundVariableName=Utils.getVariableName($is),variable=getVariable($is,boundVariableName),category=variable&&variable.category;if(nv="wm.Variable"===category?nv:Utils.getClonedObject(nv),$is.noDataFound=!1,nv.data)nv=nv.data;else if(!_.includes($is.binddataset,"bind:Widgets.")&&"wm.LiveVariable"===category)return;WM.isObject(nv)&&Utils.isPageable(nv)&&(nv=nv.content),WM.isObject(nv)&&!WM.isArray(nv)&&(nv=[nv]),$is.binddataset||WM.isString(nv)&&(nv=nv.split(",")),WM.isArray(nv)&&(nv.length&&$is.onBeforedatarender({$isolateScope:$is,$data:nv}),updateFieldDefs($is,$el,nv,attrs,listCtrl))}else CONSTANTS.isRunMode&&updateFieldDefs($is,$el,[],attrs,listCtrl)}function setupDataSource($is,$el,nv,attrs,listCtrl){var $dataNavigator,dataNavigator,binddataset;"None"!==$is.navigation?($is.clear(),binddataset=$is.binddataset,Utils.triggerFn($is._watchers.dataset),$is.dataNavigator=void 0,$timeout(function(){$dataNavigator=$el.find("> .panel-footer > [data-identifier=datanavigator]"),dataNavigator=$dataNavigator.isolateScope(),$is.dataNavigator=dataNavigator,dataNavigator.pagingOptions={maxResults:$is.pagesize||20},Utils.triggerFn($is._watchers.dataNavigatorResult),Utils.triggerFn($is._watchers.dataNavigatorMaxResults),$is._watchers.dataNavigatorResult=dataNavigator.$watch("result",function(_nv){onDataChange($is,$el,_nv,attrs,listCtrl)},!0),$is._watchers.dataNavigatorMaxResults=dataNavigator.$watch("maxResults",function(_nv){$is.pagesize=_nv},!0),dataNavigator.dataset=binddataset})):onDataChange($is,$el,nv,attrs,listCtrl)}function studioMode_onDataSetChange($is,doNotRemoveTemplate){var boundVariableName=Utils.getVariableName($is),variable=getVariable($is,boundVariableName);variable&&($is.variableName=variable.name,$is.variableType=variable.category),$is.oldbinddataset!==$is.binddataset&&$is._isInitialized&&(doNotRemoveTemplate||updateLiveListBindings($is,!0)),handlePageSizeDisplay($is,variable)}function runMode_onDataSetChange($is,$el,nv,attrs,listCtrl){$is.oldbinddataset!==$is.binddataset?setupDataSource($is,$el,nv,attrs,listCtrl):onDataChange($is,$el,nv,attrs,listCtrl)}function onDataSetChange($is,$el,doNotRemoveTemplate,nv,attrs,listCtrl){CONSTANTS.isStudioMode?studioMode_onDataSetChange($is,doNotRemoveTemplate):runMode_onDataSetChange($is,$el,nv,attrs,listCtrl),$is.oldbinddataset=$is.binddataset}function resetNavigation($is){$is.showNavigation=!1,$is.navControls=void 0,$is.infScroll=!1,$is.onDemandLoad=!1}function enableBasicNavigation($is){$is.navControls=NAVIGATION.BASIC,$is.showNavigation=!0}function enableInlineNavigation($is){$is.navControls=NAVIGATION.INLINE}function enableClassicNavigation($is){$is.navControls=NAVIGATION.CLASSIC,$is.showNavigation=!0}function enablePagerNavigation($is){$is.navControls=NAVIGATION.PAGER,$is.showNavigation=!0}function enableInfiniteScroll($is){$is.infScroll=!0}function enableOnDemandLoad($is){$is.onDemandLoad=!0}function onNavigationTypeChange($is,type){switch(resetNavigation($is),type){case NAVIGATION.BASIC:enableBasicNavigation($is);break;case NAVIGATION.INLINE:enableInlineNavigation($is);break;case NAVIGATION.ADVANCED:case NAVIGATION.CLASSIC:enableClassicNavigation($is);break;case NAVIGATION.SCROLL:enableInfiniteScroll($is);break;case NAVIGATION.PAGER:enablePagerNavigation($is);break;case NAVIGATION.ONDEMAND:enableOnDemandLoad($is)}}function setListClass($is){var itemClass="",$liScope=$is.$liScope;$is.itemsperrow?isNaN(parseInt($is.itemsperrow,10))?(_.forEach(_.split($is.itemsperrow," "),function(cls){var keys=_.split(cls,"-");cls=keys[0]+"-"+12/parseInt(keys[1],10),itemClass+=" col-"+cls}),$liScope.itemsPerRowClass=itemClass.trim()):$liScope.itemsPerRowClass="col-xs-"+12/parseInt($is.itemsperrow,10):$liScope.itemsPerRowClass="col-xs-12"}function propertyChangeHandler($is,$el,attrs,listCtrl,key,nv){var doNotRemoveTemplate,selectedVariable,eleScope=$el.scope(),variable=Utils.getVariableName($is,eleScope),wp=$is.widgetProps,matchDataTypes=["string","date","time","datetime","timestamp"],matchServiceDataTypes=["java.lang.String","java.sql.Date","java.sql.Time","java.sql.Datetime","java.sql.Timestamp"],typeUtils=Utils.getService("TypeUtils"),showOrHideMatchProperty=function(){$is.binddataset&&"Javascript"!==$is.groupby&&(selectedVariable=selectedVariable||eleScope.Variables[variable],!$is.groupby||_.includes($is.groupby,"(")?wp.match.show=!1:selectedVariable&&("wm.LiveVariable"===selectedVariable.category?wp.match.show=_.includes(matchDataTypes,_.toLower(Utils.extractType(typeUtils.getTypeForExpression($is.binddataset+"."+$is.groupby)))):"wm.DeviceVariable"===selectedVariable.category?wp.match.show=_.includes(matchDataTypes,DeviceVariableService.getFieldType(variable,$is.groupby)):"wm.ServiceVariable"!==selectedVariable.category&&"wm.Variable"!==selectedVariable.category||(wp.match.show=_.includes(matchServiceDataTypes,typeUtils.getTypeForExpression($is.binddataset+"."+$is.groupby)))),wp.match.show||($is.$root.$emit("set-markup-attr",$is.widgetid,{match:""}),$is.match=""),wp.showcount.show=wp.collapsible.show=!!$is.groupby,wp.collapsible.show||($is.$root.$emit("set-markup-attr",$is.widgetid,{collapsible:""}),$is.collapsible=!1))};switch(key){case"dataset":doNotRemoveTemplate="true"===attrs.template,onDataSetChange($is,$el,doNotRemoveTemplate,nv,attrs,listCtrl),$is.widgetid&&showOrHideMatchProperty();break;case"navigation":if("Advanced"===nv)return void($is.navigation="Classic");wp.navigationalign.show=!_.includes(["None","Scroll","Inline","On-Demand"],nv),wp.showrecordcount.show=!_.includes(["Pager","Inline","Scroll","None","On-Demand"],nv),wp.ondemandmessage.show="On-Demand"===nv,wp.paginationclass.show=!_.includes(["None","Scroll","Inline"],nv),onNavigationTypeChange($is,nv),setNavigationClass($is,$el,$is.paginationclass);break;case"groupby":selectedVariable=eleScope.Variables[variable],$is.widgetid&&(showOrHideMatchProperty(),nv&&""!==nv?($is.enablereorder=!1,wp.enablereorder.show=!1,"Javascript"===nv?wp.groupby.isGroupBy=!0:wp.groupby.isGroupBy=!1):wp.enablereorder.show=!0);break;case"match":wp.dateformat.show=_.includes(["day","hour","month","week"],$is.match);break;case"padding":$rs.$emit("apply-box-model-property",$el.find("> .app-livelist-container"),"padding",nv);break;case"itemsperrow":setListClass($is);break;case"paginationclass":setNavigationClass($is,$el,nv)}}function defineProps($is,$el){var _scope=$el.scope();Object.defineProperties($is,{Variables:{get:function(){return _scope.Variables}},Widgets:{get:function(){return _scope.Widgets}},item:{get:function(){return _scope.item}}})}function getEvalFn($is,attrs,property,val,itemAttr){var watchFn,bindExpr,evalFn,interpolateFn,$dummy,$target;return itemAttr="false"!==itemAttr&&itemAttr,_.startsWith(itemAttr,"bind:")?($dummy=WM.element("<div>"),$target=WM.element("<div>").attr(property,val),$dummy.append($target),Utils.updateTmplAttrs($dummy,attrs.dataset||attrs.scopedataset,$is.name),bindExpr=_.replace($target.attr(property),"bind:",""),watchFn=$parse(bindExpr),evalFn=function($s){return watchFn($s)}):_.includes(itemAttr,"{{")&&_.includes(itemAttr,"}}")?(interpolateFn=$interpolate(itemAttr),evalFn=function($s){return interpolateFn($s)}):evalFn=_.identity.bind(void 0,itemAttr),evalFn}function createChildScope($is,$el,attrs){var itemClsAttr,evalItemClassFn,evalDisableItemFn,disableItemAttr,_scope=$el.scope(),$liScope=_scope.$new(),$contextEl=attrs.$$element.context;return $liScope.fieldDefs=[],itemClsAttr=$contextEl.getAttribute("itemclass"),disableItemAttr=$contextEl.getAttribute("disableitem"),evalItemClassFn=getEvalFn($is,attrs,"itemclass",attrs.itemclass,itemClsAttr),evalDisableItemFn=getEvalFn($is,attrs,"disableitem",attrs.disableitem,disableItemAttr),WM.extend($liScope,{onClick:$is.onClick,onDblclick:$is.onDblclick,onTap:$is.onTap,onDoubletap:$is.onDoubletap,onMouseenter:$is.onMouseenter,onMouseleave:$is.onMouseleave,onEnterkeypress:$is.onEnterkeypress,onSetrecord:$is.onSetrecord,onBeforedatarender:$is.onBeforedatarender,onPaginationchange:$is.onPaginationchange,_itemClass:evalItemClassFn,itemsPerRowClass:"",addRow:$is.addRow,updateRow:$is.updateRow,deleteRow:$is.deleteRow,showcount:$is.showcount,collapsible:$is.collapsible,_disableItem:evalDisableItemFn}),$liScope}function triggerWMEvent($is,evt,name){var $li=WM.element(evt.target).parents("li.app-list-item");_.isEmpty($li)||($is.selecteditem=$li.scope().item),$rs.$safeApply($is),$rs.$emit("wm-event",$is.name,name)}function checkSelectionLimit($is,count){return!$is.selectionlimit||count<$is.selectionlimit}function getWidgets($el,name,index){var $target,prefix="li.app-list-item",retVal=[];if(WM.isDefined(name))return WM.isDefined(index)?(index=+index||0,index++,$target=$el.find(prefix+":nth-child("+index+")").find('[init-widget][name="'+name+'"]'),$target.length&&$target.isolateScope?[$target.isolateScope()]:void 0):($el.find(prefix+' [init-widget][name="'+name+'"]').each(function(){$target=WM.element(this),$target.isolateScope&&retVal.push($target.isolateScope())}),retVal)}function updateSelectedItemsWidgets($is,$el){$is.multiselect&&($is.selectedItemWidgets.length=0),$el.find("li.app-list-item.active").each(function(){var wid={};WM.element(this).find("[init-widget]").each(function(){var _is,$target=WM.element(this);$target.isolateScope&&(_is=$target.isolateScope(),_is.name&&(wid[_is.name]=_is))}),$is.multiselect?$is.selectedItemWidgets.push(wid):$is.selectedItemWidgets=wid})}function setItems($li,$is){var _item=$li.scope().item;$li.hasClass("active")?$is._items.push(_item):$is._items=_.pullAllWith($is._items,[_item],_.isEqual)}function clearItems($is,$el){$el.find("li.app-list-item.active").removeClass("active"),$is._items.length=0}function setupEvtHandlers($is,$el,attrs){var pressStartTimeStamp=0,$hammerEl=new Hammer($el[0],{}),selectCount=0;$el[0].addEventListener("click",function(evt){if(!(pressStartTimeStamp+50>Date.now())){var $li=WM.element(evt.target).closest("li.app-list-item"),$liScope=$li&&$li.scope();$liScope&&!$liScope._disableItem($liScope)&&(attrs.onClick&&Utils.triggerFn($liScope.onClick,{$event:evt,$scope:$liScope}),attrs.onTap&&Utils.triggerFn($liScope.onTap,{$event:evt,$scope:$liScope}),$rs.$safeApply($is))}}),$el[0].addEventListener("click",function(evt){if(!(pressStartTimeStamp+50>Date.now())){var first,last,$liItems,$li=WM.element(evt.target).closest("li.app-list-item"),$liScope=$li&&$li.scope(),isActive=$li.hasClass("active");$liScope&&!$liScope._disableItem($liScope)&&($is.firstSelectedItem=$is.firstSelectedItem||$li,selectCount=WM.isArray($is.selecteditem)?$is.selecteditem.length:WM.isObject($is.selecteditem)?1:0,$is.multiselect&&$rs.isMobileApplicationType?checkSelectionLimit($is,selectCount)||$li.hasClass("active")?($li.toggleClass("active"),setItems($li,$is)):Utils.triggerFn($is.onSelectionlimitexceed,{$event:evt,$scope:$is}):(evt.ctrlKey||evt.metaKey)&&$is.multiselect?checkSelectionLimit($is,selectCount)||$li.hasClass("active")?($is.lastSelectedItem=$is.firstSelectedItem=$li,$li.toggleClass("active"),setItems($li,$is)):Utils.triggerFn($is.onSelectionlimitexceed,{$event:evt,$scope:$is}):evt.shiftKey&&$is.multiselect?($liItems=$el.find("li.app-list-item"),first=$liItems.index($li),last=$liItems.index($is.firstSelectedItem),first>last&&(last=[first,first=last][0]),checkSelectionLimit($is,last-first)?(clearItems($is,$el),_.forEach($liItems,function(element,index){var $currentLi;index>=first&&index<=last&&($currentLi=WM.element($liItems[index]),$currentLi.addClass("active"),setItems($currentLi,$is))}),$is.lastSelectedItem=$li):Utils.triggerFn($is.onSelectionlimitexceed,{$event:evt,$scope:$is})):(!isActive||selectCount>1)&&(clearItems($is,$el),$li.addClass("active"),setItems($li,$is),$is.lastSelectedItem=$is.firstSelectedItem=$li),updateSelectedItemsWidgets($is,$el),$rs.$safeApply($is))}},!0),$el.on("keydown","li.app-list-item",function(evt){function setIndexValues(){$liItems=$el.find("li.app-list-item"),presentIndex=$liItems.index($is.lastSelectedItem),firstIndex=$liItems.index($is.firstSelectedItem),selectCount=WM.isArray($is.selecteditem)?$is.selecteditem.length:WM.isObject($is.selecteditem)?1:0}var $liItems,presentIndex,firstIndex,keyPressed,$currentLi;keyPressed=Utils.getActionFromKey(evt),$is.multiselect&&("SHIFT+UP"===keyPressed||"SHIFT+LEFT"===keyPressed?(setIndexValues(),presentIndex>0&&((presentIndex===firstIndex||presentIndex<firstIndex)&&checkSelectionLimit($is,selectCount)?($currentLi=$is.lastSelectedItem=WM.element($liItems[presentIndex-1]),$currentLi.toggleClass("active"),setItems($currentLi,$is)):presentIndex>firstIndex?($currentLi=WM.element($liItems[presentIndex]),$currentLi.toggleClass("active"),setItems($currentLi,$is),$is.lastSelectedItem=WM.element($liItems[presentIndex-1])):Utils.triggerFn($is.onSelectionlimitexceed,{$event:evt,$scope:$is}),$rs.$safeApply($is))):"SHIFT+RIGHT"!==keyPressed&&"SHIFT+DOWN"!==keyPressed||(setIndexValues(),presentIndex<$liItems.length-1&&((presentIndex===firstIndex||presentIndex>firstIndex)&&checkSelectionLimit($is,selectCount)?($currentLi=$is.lastSelectedItem=WM.element($liItems[presentIndex+1]),$currentLi.toggleClass("active"),setItems($currentLi,$is)):presentIndex<firstIndex?($currentLi=WM.element($liItems[presentIndex]),$currentLi.toggleClass("active"),setItems($currentLi,$is),$is.lastSelectedItem=WM.element($liItems[presentIndex+1])):Utils.triggerFn($is.onSelectionlimitexceed,{$event:evt,$scope:$is}),$rs.$safeApply($is)))),evt.shiftKey||("UP-ARROW"===keyPressed?(setIndexValues(),
0!==presentIndex&&($is.lastSelectedItem=WM.element($liItems[presentIndex-1]),$is.lastSelectedItem.focus())):"DOWN-ARROW"===keyPressed?(setIndexValues(),presentIndex!==$liItems.length-1&&($is.lastSelectedItem=WM.element($liItems[presentIndex+1]),$is.lastSelectedItem.focus())):"ENTER"===keyPressed&&(setIndexValues(),WM.element($liItems[presentIndex]).trigger("click")))}),$el.on("dblclick.wmActive","ul.app-livelist-container",function(evt){var $li=WM.element(evt.target).closest("li.app-list-item"),$liScope=$li&&$li.scope();$liScope&&!$liScope._disableItem($liScope)&&(attrs.onDblclick&&Utils.triggerFn($liScope.onDblclick,{$event:evt,$scope:$liScope}),attrs.onDoubletap&&Utils.triggerFn($liScope.onDoubletap,{$event:evt,$scope:$liScope}),$rs.$safeApply($is))}),$hammerEl.on("pressup",function(evt){if(!$is.multiselect&&$rs.isMobileApplicationType){var $li=WM.element(evt.target).closest("li.app-list-item");$el.find("li.app-list-item.active").removeClass("active"),$li.addClass("active"),setItems($li,$is),$rs.$safeApply($is),pressStartTimeStamp=Date.now()}}),$el.on("click",'[class*="edit-list-item"]',function(evt){triggerWMEvent($is,evt,"update")}),$el.on("click",'[class*="delete-list-item"]',function(evt){triggerWMEvent($is,evt,"delete")})}function preLinkFn($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,$is.oldbinddataset=CONSTANTS.isStudioMode?attrs.dataset:void 0,$is.dataset=[],$is.fieldDefs=[],$is.noDataFound=!1,$is.isStudioMode=CONSTANTS.isStudioMode,Object.defineProperty($is,"selecteditem",{configurable:!0}),defineProps($is,$el),$el.removeAttr("title")}function configureDnD($el,$is){var data;$el.find(".app-livelist-container").sortable({appendTo:"body",containment:$el.find(".app-livelist-container"),delay:100,opacity:.8,helper:"clone","z-index":100,tolerance:"pointer",start:function(evt,ui){ui.placeholder.height(ui.item.height()),WM.element(this).data("oldIndex",ui.item.index())},update:function(evt,ui){var newIndex,oldIndex,draggedItem,$dragEl;data=data||Utils.getClonedObject($is.$liScope.fieldDefs),$dragEl=WM.element(this),newIndex=ui.item.index(),oldIndex=$dragEl.data("oldIndex"),draggedItem=_.pullAt(data,oldIndex)[0],data.splice(newIndex,0,draggedItem),Utils.triggerFn($is.onReorder,{$event:evt,$data:data}),$dragEl.removeData("oldIndex")}}),$el.find(".app-livelist-container").droppable({accept:".app-list-item"})}function defineSelectedItemProp($is,$el){Object.defineProperty($is,"selecteditem",{configurable:!0,get:function(){return $is.multiselect?$is._items:_.isEmpty($is._items)?{}:$is._items[0]},set:function(items){$is._items.length=0,$el.find("li.app-list-item.active").removeClass("active"),_.isArray(items)?_.forEach(items,function(item){$is.selectItem(item)}):$is.selectItem(items)}})}function toggleSelectedItem($is,$el,item,isSelect){if(WM.isDefined(item)&&null!==item){var listItems=$el.find(".list-group li.app-list-item"),itemIndex=WM.isNumber(item)?item:getItemIndex(listItems,item),$li=WM.element(listItems[itemIndex]),$liScope=$li.length&&$li.scope();$liScope&&!$liScope._disableItem($liScope)&&($is.multiselect||clearItems($is,$el),isSelect?$li.addClass("active"):$li.removeClass("active"),setItems($li,$is),updateSelectedItemsWidgets($is,$el))}}function onDestroy($is,$el,handlers){var $scrollParent=$el.data("$scrollParent");Object.defineProperty($is,"selecteditem",{get:_.noop,set:_.noop}),handlers.forEach(Utils.triggerFn),$scrollParent&&$scrollParent.off(".scroll_evt")}function getCurrentItemWidgets(__s,element){var wid={};element.find("[init-widget]").each(function(){var _is,$target=WM.element(this);$target.isolateScope&&(_is=$target.isolateScope(),_is.name&&(wid[_is.name]=_is))}),__s.currentItemWidgets=wid}function postLinkFn($is,$el,attrs,listCtrl){var $liScope,$liTemplate,variable,_onDestroy,groupDataByUserDefinedFn,$dataNavigator,handlers=[];variable=Utils.getVariableName($is),$liScope=createChildScope($is,$el,attrs),$is._items=[],$is.$liScope=$liScope,$is.variableInflight=!1,$is.selectedItemWidgets=$is.multiselect?[]:{},setListClass($is),CONSTANTS.isRunMode?("None"!==$is.navigation&&$timeout(function(){$dataNavigator=$el.find("> .panel-footer > [data-identifier=datanavigator]"),$is.dataNavigator=$dataNavigator.isolateScope()}),$is.groupby&&_.includes($is.groupby,"(")&&(groupDataByUserDefinedFn=$liScope[$is.groupby.split("(")[0]],groupDataByUserDefinedFn||($is.groupby="")),$is.groupby||(liTemplateWrapper_start='<li ng-repeat="item in fieldDefs track by $index" ng-focus="onFocus($event)" tabindex="0" class="app-list-item" ng-class="[itemsPerRowClass, _itemClass(this), {\'disable-item\': _disableItem(this)}]" ',liTemplateWrapper_end=' ng-init="addCurrentItemWidgets(this);"></li>',$liTemplate=prepareLITemplate(listCtrl.$get("listTemplate"),attrs,!1,$is.name),$el.find("> [data-identifier=list]").append($liTemplate),$el.find("> [data-identifier=list]").addClass("list-group"),$compile($liTemplate)($liScope)),$liScope.addCurrentItemWidgets=function(__s){$timeout(function(){$rs.$evalAsync(function(){$is.groupby?$el.find("li.app-list-item-group:nth-child("+__s.item._groupIndex+")").each(function(){WM.element(this).find("li.app-list-item:nth-child("+(__s.$index+2)+")").each(function(){getCurrentItemWidgets(__s,WM.element(this))})}):$el.find("li.app-list-item:nth-child("+(__s.$index+1)+")").each(function(){getCurrentItemWidgets(__s,WM.element(this))})})},0,!1)},!$is.groupby&&$is.enablereorder&&configureDnD($el,$is),$liScope.onFocus=function($evt){$is.lastSelectedItem=WM.element($evt.target)},$is.$watch("binddataset",function(newVal){_.includes(newVal,"selecteditem.")&&LiveWidgetUtils.fetchDynamicData($is,$el.scope(),function(data){WM.isDefined(data)&&($is.dataNavigator&&($is.dataNavigator.dataset=data),onDataChange($is,$el,data,attrs,listCtrl))})}),setupEvtHandlers($is,$el,attrs),$is.getWidgets=getWidgets.bind(void 0,$el),$is.noDataFound=void 0===($is.binddataset||$is.scopedataset),handlers.push($rs.$on("toggle-variable-state",function(event,variableName,active){variable===variableName&&($is.variableInflight=active)})),_onDestroy=onDestroy.bind(void 0,$is,$el,handlers),$is.$on("$destroy",_onDestroy),$el.on("$destroy",_onDestroy)):($is.widgetProps.enablereorder.show=!$rs.isMobileApplicationType,$el.find(".app-listtemplate").addClass($liScope.itemclass+" "+$liScope.itemsPerRowClass)),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is,$el,attrs,listCtrl),$is,notifyFor),defineSelectedItemProp($is,$el),$is.selectItem=function(item){toggleSelectedItem($is,$el,item,!0)},$is.deselectItem=function(item){toggleSelectedItem($is,$el,item,!1)},$is.clear=function(){_.set($is,"$liScope.fieldDefs",void 0)},$is._onPaginationchange=function(options){$is.showNavigation&&$is.$element.find('[data-identifier="list"]').scrollTop(0),$is.onPaginationchange&&$is.onPaginationchange(options)},attrs.hasOwnProperty("shownavigation")&&"true"===attrs.shownavigation&&($is.navigation=NAVIGATION.BASIC),onNavigationTypeChange($is,$is.navigation),WidgetUtilService.postWidgetCreate($is,$el,attrs),!attrs.widgetid&&attrs.scopedataset&&$is.$watch("scopedataset",function(nv){nv&&!$is.dataset&&updateFieldDefs($is,$el,nv)},!0)}function compileFn($tEl,tAttrs){return CONSTANTS.isStudioMode&&(window[tAttrs.name+"Controller"]=WM.noop),{pre:preLinkFn,post:postLinkFn}}var liTemplateWrapper_start,liTemplateWrapper_end,directiveDefn,widgetProps=PropertiesFactory.getPropertiesOf("wm.livelist",["wm.base","wm.containers","wm.base.events","wm.base.navigation","wm.layouts.panel.defaults"]),notifyFor={dataset:!0,groupby:!0,navigation:CONSTANTS.isStudioMode,itemsperrow:!0,match:CONSTANTS.isStudioMode,padding:!0,paginationclass:!0},NAVIGATION={BASIC:"Basic",CLASSIC:"Classic",ADVANCED:"Advanced",SCROLL:"Scroll",INLINE:"Inline",PAGER:"Pager",ONDEMAND:"On-Demand"};return directiveDefn={restrict:"E",replace:!0,transclude:!0,scope:{},template:$tc.get("template/widget/list.html"),compile:compileFn},CONSTANTS.isRunMode&&(directiveDefn.controller="listController",directiveDefn.scope={scopedataset:"=?",onClick:"&",onDblclick:"&",onMouseenter:"&",onMouseleave:"&",onEnterkeypress:"&",onSetrecord:"&",onBeforedatarender:"&",onPaginationchange:"&",onTap:"&",onDoubletap:"&",onSelectionlimitexceed:"&"}),directiveDefn}]),WM.module("wm.widgets.advanced").directive("wmCalendar",["PropertiesFactory","WidgetUtilService","$compile","$locale","CONSTANTS","Utils","$rootScope","$timeout","$templateCache",function(PropertiesFactory,WidgetUtilService,$compile,$locale,CONSTANTS,Utils,$rs,$timeout,$tc){"use strict";function updateCalendarOptions($is){var ctrls=$is.controls,viewType=$is.calendartype,left="",right="",regEx=new RegExp("\\bday\\b","g");ctrls&&viewType&&(_.includes(ctrls,"navigation")&&(left+=" prev next"),_.includes(ctrls,"today")&&(left+=" today"),_.includes(ctrls,"month")&&(right+=" month"),_.includes(ctrls,"week")&&(right+=viewType===VIEW_TYPES.BASIC?" basicWeek":" agendaWeek"),regEx.test(ctrls)&&(right+=viewType===VIEW_TYPES.BASIC?" basicDay":" agendaDay"),WM.extend($is.calendarOptions.calendar.header,{left:left,right:right}))}function calculateHeight(calendar,$el,$is){var computedHeight,$parentEl=$el.parent(),parentHeight=$parentEl.css("height"),elHeight=$is.height;return _.includes(elHeight,"%")?(_.includes(parentHeight,"%")&&(parentHeight=$parentEl.height()),computedHeight=parseInt(parentHeight,10)*Number(elHeight.replace(/\%/g,""))/100):computedHeight=parseInt(elHeight,10),calendar.views.month.eventLimit=parseInt(computedHeight/200,10)+1,computedHeight}function triggerCalendarChange($is){$is.prepareCalendarEvents(),$rs.$safeApply($is,function(){$is._model_=$is._model_||moment().valueOf(),$is.selecteddates={start:moment($is._model_).valueOf(),end:moment($is._model_).endOf("day").valueOf()},$is.$$childHead.datepicker.refreshView()}),$is.onEventrender({$isolateScope:$is,$scope:$is,$data:$is.eventData})}function constructCalendarDataset($is,eventSource){var properties={title:$is.eventtitle,allday:$is.eventallday,start:$is.eventstart,end:$is.eventend,className:$is.eventclass};return _.forEach(eventSource,function(obj){_.mapKeys(properties,function(value,key){var objVal=_.get(obj,value);"start"!==key&&"end"!==key||(objVal=moment(objVal)),obj[key]=objVal})}),eventSource}function propertyChangeHandler($is,$el,key,newVal){var dataSet,calendar=$is.calendarOptions&&$is.calendarOptions.calendar,eleScope=$el.scope(),eleIscope=$el.find(".uib-datepicker").isolateScope(),variable=Utils.getVariableName($is,eleScope),eventSet=[];switch(key){case"dataset":if(isMobile)return void triggerCalendarChange($is);$is.eventSources.length=0,(CONSTANTS.isRunMode||variable&&"wm.ServiceVariable"!==eleScope.Variables[variable].category)&&(dataSet=Utils.getClonedObject(newVal.data||newVal),dataSet=WM.isArray(dataSet)?dataSet:WM.isObject(dataSet)?[dataSet]:[],dataSet=constructCalendarDataset($is,dataSet),_.includes(_.keys(dataSet[0]),"start")&&(_.forEach(dataSet,function(event){event.start=event.start||event.end,event.start&&eventSet.push(event)}),$is.eventSources.push(eventSet)));break;case"height":calendar.height=calculateHeight(calendar,$el,$is);break;case"controls":case"calendartype":updateCalendarOptions($is);break;case"view":if(eleIscope&&$is.widgetid)return void(eleIscope.datepickerMode=newVal);isMobile?"week"===newVal&&(calendar.defaultView="day"):"month"!==newVal?calendar.defaultView=$is.calendartype+_.capitalize(newVal):calendar.defaultView=newVal;break;case"selectionmode":newVal!==SELECTION_MODES.NONE&&(calendar.selectable=!0,newVal===SELECTION_MODES.SINGLE&&(calendar.selectConstraint={start:"00:00",end:"24:00"}))}}function getPropertyType($is,prop){var type,types=$rs.dataTypes;switch(prop){case"selecteddates":case"currentview":type=$is.widgettype+"_"+prop,types[type]={fields:{start:{type:"date, datetime, number, string"},end:{type:"date, datetime, number, string"}}}}return type}var widgetProps=PropertiesFactory.getPropertiesOf("wm.calendar",["wm.base","wm.base.datetime"]),isMobile=$rs.isMobileApplicationType||Utils.isMobile(),notifyFor=isMobile?{dataset:!0,view:!0}:{dataset:!0,height:!0,controls:!0,calendartype:!0,view:!0,selectionmode:!0},defaultHeaderOptions={left:"prev next today",center:"title",right:"month basicWeek basicDay"},VIEW_TYPES={BASIC:"basic",AGENDA:"agenda"},SELECTION_MODES={NONE:"none",SINGLE:"single",MULTIPLE:"multiple"};return isMobile||delete widgetProps.datavalue,{restrict:"E",replace:!0,scope:{scopedataset:"=?",onEventdrop:"&",onEventresize:"&",onEventclick:"&",onViewrender:"&",onSelect:"&",onEventrender:"&"},template:function(tElement,tAttrs){isMobile?$tc.put("template/widget/calendar.html",'<div init-widget has-model apply-styles="shell" class="app-date" listen-property="dataset" ><div uib-datepicker ng-model="_model_" ng-change="onModelUpdate(this);" datepicker-options="mobileCalendarOptions" apply-styles="inner-shell"></div></div>'):$tc.put("template/widget/calendar.html",'<div class="app-calendar" init-widget has-model ng-model ="_model_" listen-property="dataset"  ng-change="_onChange({$event: $event, $scope: this})" apply-styles="shell"><div ui-calendar="calendarOptions.calendar" calendar="{{name}}" ng-model="eventSources"></div></div>');var template=WM.element(WidgetUtilService.getPreparedTemplate("template/widget/calendar.html",tElement,tAttrs));return template.find(".model-holder").attr("name",tAttrs.name),tAttrs.hasOwnProperty("disabled")&&template.find("datepicker").attr("date-disabled",!0),template[0].outerHTML},link:{pre:function($is){$is.widgetProps=widgetProps,$is.events=[],$is.eventSources=[]},post:function($is,$el,attrs){function getDayClass(data){var eventDay,eventsLength,date=data.date,mode=data.mode;if("day"===mode)return eventDay=moment(date).startOf("day").format(dateFormat),!_.isEmpty($is.eventData)&&$is.eventData[eventDay]?(eventsLength=$is.eventData[eventDay].length,1===eventsLength?singleEventClass:2===eventsLength?doubleEventClass:multipleEventClass):""}function eventClickProxy(event,jsEvent,view){$is.onEventclick({$event:jsEvent,$data:event,$view:view})}function viewRenderProxy(view){$is.currentview={start:view.start.format(),end:view.end.format()},$is.onViewrender({$view:view})}function eventRenderProxy(event,jsEvent,view){$is.onEventrender({$event:{},$data:event,$view:view})}function setSelectedData(start,end){var filteredDates=[],dataset=$is.dataset,eventStartKey=$is.eventstart||"start",eventEndKey=$is.eventend||"end",startDate=moment(new Date(start)).format("MM/DD/YYYY"),endDate=moment(new Date(end)).subtract(1,"days").format("MM/DD/YYYY");if(dataset)return dataset=dataset.data||dataset,_.forEach(dataset,function(value){if(value[eventStartKey]){var eventStartDate=moment(new Date(value[eventStartKey])).format("MM/DD/YYYY"),eventEndDate=moment(new Date(value[eventEndKey]||value[eventStartKey])).format("MM/DD/YYYY"),eventExists=moment(startDate).isSame(eventStartDate)&&moment(eventEndDate).isSame(endDate);eventExists&&filteredDates.push(value)}}),filteredDates}function onSelectProxy(start,end,jsEvent,view){$is.selecteddates={start:start.valueOf(),end:end.valueOf()},$is.selecteddata=setSelectedData(start,end),$is.onSelect({$start:start.valueOf(),$end:end.valueOf(),$view:view,$data:$is.selecteddata})}function onEventdropProxy(event,delta,revertFunc,jsEvent,ui,view){$is.onEventdrop({$event:jsEvent,$newData:event,$oldData:oldData,$delta:delta,$revertFunc:revertFunc,$ui:ui,$view:view})}function onEventresizeProxy(event,delta,revertFunc,jsEvent,ui,view){$is.onEventresize({$event:jsEvent,$newData:event,$oldData:oldData,$delta:delta,$revertFunc:revertFunc,$ui:ui,$view:view})}function onEventChangeStart(event,jsEvent,ui,view){oldData=Utils.getClonedObject(event)}function renderMobileView(viewObj){var startDate,endDate;viewObj&&viewObj.date&&(startDate=moment(viewObj.date).startOf("month").valueOf(),endDate=moment(viewObj.date).endOf("month").valueOf(),$timeout(function(){$is.currentview={start:startDate,end:endDate},$is.onViewrender({$isolateScope:$is,$scope:$is,$view:$is.mobileCalendarOptions})}))}var oldData,handlers=[],headerOptions=Utils.getClonedObject(defaultHeaderOptions),multipleEventClass="app-calendar-event",doubleEventClass=multipleEventClass+" two",singleEventClass=multipleEventClass+" one",dateFormat="YYYY/MM/DD";$is.widgetProps;isMobile?($is.eventData={},$is.prepareCalendarEvents=function(){var eventDay,dataset;$is.eventData={},$is.dataset&&(dataset=$is.dataset.data||$is.dataset,dataset=WM.isArray(dataset)?dataset:WM.isObject(dataset)?[dataset]:[],$is.events=constructCalendarDataset($is,dataset),_.forEach($is.events,function(event){event.start&&(eventDay=moment(event.start).startOf("day").format(dateFormat),$is.eventData[eventDay]?$is.eventData[eventDay].push(event):$is.eventData[eventDay]=[event])}))},$is.onModelUpdate=function(eleScope){var selectedDate=$is._model_&&moment($is._model_).startOf("day").format(dateFormat),selectedEventData=$is.eventData[selectedDate],start=moment($is._model_),end=moment($is._model_).endOf("day");$is.selecteddata=selectedEventData,$is.selecteddates={start:moment(selectedDate).valueOf(),end:moment(selectedDate).endOf("day").valueOf()},$is.onSelect({$start:start.valueOf(),$end:end.valueOf(),$view:eleScope,$scope:$is,$isolateScope:$is,$data:selectedEventData}),selectedEventData&&$is.onEventclick({$event:this,$view:eleScope,$isolateScope:$is,$scope:$is,$data:selectedEventData})},$is.refresh=function(dtObj){dtObj=dtObj?new Date(dtObj):new Date($is._model_);var isValid=!isNaN(dtObj.valueOf());$is._model_=isValid?dtObj:new Date,$rs.$safeApply($is)},$is.openCalendar=function(){$is.isCalendarOpened=!0},$is.isCalendarOpened=!1,$is.view="week"===$is.view?"day":$is.view,$is.mobileCalendarOptions={showWeeks:!1,customClass:getDayClass,datepickerMode:$is.view},CONSTANTS.isRunMode&&$is.$on("$destroy",$is.$watch("$$childHead.activeDt",_.debounce(renderMobileView,30),!0))):($is.calendarOptions={calendar:{height:parseInt($is.height,10),editable:!0,selectable:!1,header:headerOptions,eventDrop:onEventdropProxy,eventResizeStart:onEventChangeStart,eventDragStart:onEventChangeStart,eventResize:onEventresizeProxy,eventClick:eventClickProxy,select:onSelectProxy,eventRender:eventRenderProxy,viewRender:viewRenderProxy,unselectAuto:!1,dayNames:$locale.DATETIME_FORMATS.DAY,dayNamesShort:$locale.DATETIME_FORMATS.SHORTDAY,views:{month:{eventLimit:0}}}},$is.multiselect&&!attrs.selectionmode&&($is.selectionmode=SELECTION_MODES.MULTIPLE),handlers.push($rs.$on("locale-change",function(){$is.calendarOptions.calendar.dayNames=$locale.DATETIME_FORMATS.DAY,$is.calendarOptions.calendar.dayNamesShort=$locale.DATETIME_FORMATS.SHORTDAY})),$is.addRemoveEventSource=function(sources,source){var canAdd=0;_.forEach(sources,function(value,key){sources[key]===source&&(sources.splice(key,1),canAdd=1)}),0===canAdd&&sources.push(source)},$is.addEvent=function(eventObject){$is.events.push(eventObject)},$is.remove=function(index){$is.events.splice(index,1)},$is.eventRender=function(event,el){el.attr({tooltip:event.title,"tooltip-append-to-body":!0}),$compile(el)($is)},$is.$on("$destroy",function(){handlers.forEach(Utils.triggerFn)}),$is.redraw=function(){$timeout(function(){$el.children().first().fullCalendar("render"),propertyChangeHandler($is,$el,"height")},void 0,!1)}),$is.getPropertyType=getPropertyType.bind(void 0,$is),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is,$el),$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs),isMobile||_.defer($is.redraw),!attrs.widgetid&&attrs.scopedataset&&handlers.push($is.$watch("scopedataset",function(newVal){$is.eventSources.push(newVal)},!0))}}}}]),WM.module("wm.widgets.advanced").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/advanced/login.html",'<div init-widget class="app-login" apply-styles="container"><wm-message scopedataset="loginMessage" class="app-login-message"></wm-message><form autocomplete="off" class="app-form app-login-form" method="post" wmtransclude></form></div>')}]).directive("wmLogin",["PropertiesFactory","$rootScope","$templateCache","WidgetUtilService","CONSTANTS","$controller","Utils",function(PropertiesFactory,$rootScope,$templateCache,WidgetUtilService,CONSTANTS,$controller,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.login",["wm.base","wm.layouts.login","wm.base.events.successerror"]);return{restrict:"E",replace:!0,scope:{onSuccess:"&",onError:"&"},transclude:!0,template:$templateCache.get("template/widget/advanced/login.html"),compile:function(tElement,tAttr){return CONSTANTS.isStudioMode&&(window[tAttr.name+"Controller"]=WM.noop),{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function(scope,element,attrs){if(CONSTANTS.isRunMode){var loginController;try{loginController=scope.name+"Controller",$controller(loginController,{$scope:element.scope()})}catch(ignore){}element.find(".app-login-button").unbind("click"),element.find(".app-login-button").click(function(event){var loginDetails,rememberMeElement,$rememberMe,successFn=attrs.onSuccess||"",errorFn=attrs.onError||"",submitFn=attrs.onSubmit||"",clickFn=WM.element(this).isolateScope().onClick||"",$userName=element.find('[name="usernametext"]'),$password=element.find('[name="passwordtext"]'),onSuccess=function(){element.trigger("success"),successFn.indexOf("(")!==-1?scope.onSuccess({$event:event,$scope:scope}):$rootScope.$emit("invoke-service",successFn,{scope:element.scope()})},onError=function(error){scope.loginMessage={type:"error",caption:scope.errormessage||error||$rootScope.appLocale.LABEL_INVALID_USERNAME_OR_PASSWORD},element.trigger("error"),errorFn.indexOf("(")!==-1?scope.onError({$event:event,$scope:scope}):$rootScope.$emit("invoke-service",errorFn,{scope:element.scope()})};scope.loginMessage=null,rememberMeElement=element.find('.app-checkbox [name="remembermeCheck"]'),rememberMeElement.length||(rememberMeElement=element.find('.app-checkbox [name="remembermecheck"]')),rememberMeElement.length&&($rememberMe=rememberMeElement.val()),$userName.controller("ngModel").$invalid||$password.controller("ngModel").$invalid||(submitFn||clickFn?(clickFn&&clickFn({$event:event,$scope:scope}),_.startsWith(submitFn,"Variables.")?$rootScope.$emit("invoke-service",submitFn,{scope:element.scope()},onSuccess,onError):submitFn.indexOf("(")!==-1&&scope.onSubmit({$event:event,$scope:scope})):(loginDetails={username:$userName.val(),password:$password.val(),rememberme:$rememberMe},element.scope().Variables.loginVariable.login({loginInfo:loginDetails},onSuccess,onError)))})}WidgetUtilService.postWidgetCreate(scope,element,attrs)}}}}}]),WM.module("wm.widgets.advanced").run(["$templateCache",function($tc){"use strict";$tc.put("template/widget/advanced/carousel/static/carousel.html",'<div init-widget class="app-carousel carousel slide" ng-class="navigationClass" apply-styles hm-swipe-left="next()" hm-swipe-right="prev()"><ol class="carousel-indicators"><li ng-repeat="content in contents" ng-class="{\'active\': activeIndex === $index}" ng-click="goTo($index)"></li></ol><div class="carousel-inner" wmtransclude></div><a class="left carousel-control" ng-click="prev()"><i class="wi wi-chevron-left"></i></a><a class="right carousel-control" ng-click="next()"><i class="wi wi-chevron-right"></i></a></div>'),$tc.put("template/widget/advanced/carousel/design/dynamic/carousel.html",'<div apply-styles init-widget class="app-carousel carousel slide" wmtransclude></div>'),$tc.put("template/widget/advanced/carousel/design/static/carousel.html",'<div init-widget class="app-carousel carousel slide" apply-styles><div class="carousel-inner" wmtransclude></div><div class="carousel-actions"><ul class="pagination" ><li ng-repeat="content in contents" ng-class="{\'active\': activeIndex === $index}""><a href="javascript:void(0);" ng-click="goTo($index)">{{$index + 1}}</a></li></ul></div></div>'),$tc.put("template/widget/advanced/carousel/dynamic/carousel.html",'<div class="app-carousel" ng-class="navigationClass" init-widget wmtransclude apply-styles data-identifier="carousel"><div class="text-center" ng-if="noDataFound">{{nodatamessage}}</div></div>'),$tc.put("template/widget/advanced/carousel/carousel-content.html",'<div class="app-carousel-item item" apply-styles init-widget wmtransclude></div>')}]).directive("wmCarousel",["$interval","PropertiesFactory","$templateCache","CONSTANTS","$timeout","WidgetUtilService","$compile","Utils",function($interval,PropertiesFactory,$templateCache,CONSTANTS,$timeout,WidgetUtilService,$compile,Utils){"use strict";function updateFieldDefs($is,data){$is.fieldDefs=data,$is.noDataFound=!$is.fieldDefs.length}function getVariable($is,variableName){if(variableName){var variables=$is.Variables||{};return variables[variableName]}}function onDataChange($is,nv){if(nv){if($is.noDataFound=!1,nv.data)nv=nv.data;else if(!_.includes($is.binddataset,"bind:Widgets.")){var boundVariableName=Utils.getVariableName($is),variable=getVariable($is,boundVariableName);if(variable&&"wm.LiveVariable"===variable.category)return}WM.isObject(nv)&&Utils.isPageable(nv)&&(nv=nv.content),WM.isObject(nv)&&!WM.isArray(nv)&&(nv=[nv]),$is.binddataset||WM.isString(nv)&&(nv=nv.split(",")),WM.isArray(nv)&&updateFieldDefs($is,nv)}else CONSTANTS.isRunMode&&updateFieldDefs($is,[])}function propertyChangeHandler($is,attrs,key,newVal){var widgetProperties=$is.widgetProps;switch(key){case"dataset":attrs.type===CAROUSEL_TYPE.DYNAMIC&&onDataChange($is,newVal);break;case"type":widgetProperties.addchild.show=newVal!==CAROUSEL_TYPE.DYNAMIC,widgetProperties.nodatamessage.show=widgetProperties.dataset.show=newVal===CAROUSEL_TYPE.DYNAMIC;break;case"animation":CONSTANTS.isStudioMode?widgetProperties.animationinterval.show="auto"===newVal:($is.interval="auto"===newVal?1e3*$is.animationinterval:0,attrs.type||$is.play());break;case"controls":switch(newVal){case"indicators":$is.navigationClass="hide-navs";break;case"navs":$is.navigationClass="hide-indicators";break;case"none":$is.navigationClass="hide-both"}}}function applyWrapper($tmplContent){var $tmpl=WM.element(slideTemplateWrapper);return $tmpl.children().first().append($tmplContent),$tmpl}function prepareSlideTemplate(tmpl,attrs){var $tmpl=WM.element(tmpl),$div=WM.element("<div></div>"),parentDataSet=attrs.dataset||attrs.scopedataset;return $tmpl=$div.append($tmpl),parentDataSet&&Utils.updateTmplAttrs($tmpl,parentDataSet,attrs.name),$tmpl=applyWrapper($tmpl,attrs)}function templateFn($el,attrs){return attrs.type?$templateCache.get("template/widget/advanced/carousel"+(CONSTANTS.isStudioMode?"/design/dynamic/":"/dynamic/")+"carousel.html"):$templateCache.get("template/widget/advanced/carousel"+(CONSTANTS.isStudioMode?"/design/static/":"/static/")+"carousel.html")}function onDestroy($is,handlers){handlers.forEach(Utils.triggerFn)}var widgetProps,directiveDefn,notifyFor,slideTemplateWrapper,CAROUSEL_TYPE={STATIC:"static",DYNAMIC:"dynamic"},isMoving=!1;return widgetProps=PropertiesFactory.getPropertiesOf("wm.carousel",["wm.base"]),notifyFor=CONSTANTS.isStudioMode?{dataset:!0,type:!0,animation:!0}:{dataset:!0,controls:!0,animation:!0},slideTemplateWrapper='<div uib-carousel interval="interval" active="active" ng-show="!noDataFound" no-wrap="noWrapSlides" hm-swipe-left="onSwipe(\'left\')" hm-swipe-right="onSwipe(\'right\')"> <div uib-slide ng-repeat="item in fieldDefs track by $index"  index="$index"></div></div>',directiveDefn={restrict:"E",scope:{},transclude:!0,template:templateFn,replace:!0,controller:function($scope){var _map={};this.$set=function(key,value){_map[key]=value},this.$get=function(key){return _map[key]},this.register=function(contentScope){$scope.contents.length||contentScope.getElement().addClass("active"),$scope.contents.push(contentScope),$scope.widgetid&&$scope.last()},this.unregister=function(contentScope){var i,len=$scope.contents.length;for(i=0;i<len&&$scope.contents[i].$id!==contentScope.$id;i++);$scope.contents.splice(i,1),$scope.activeIndex=$scope.contents.length-1,$scope.goTo($scope.activeIndex)}},link:{pre:function($is,$el,attrs){function animateSlide($active,$next,type){var direction="next"===type?"left":"right";$next.addClass(type),$next[0].offsetWidth,$active.addClass(direction),$next.addClass(direction),$timeout(function(){$next.removeClass([type,direction].join(" ")).addClass("active"),$active.removeClass(["active",direction].join(" ")),isMoving=!1},600,!1)}$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,$is.widgetProps.nodatamessage.show=attrs.type===CAROUSEL_TYPE.DYNAMIC,$is.noDataFound=!1,attrs.type||($is.contents=[],$is.activeIndex=0,attrs.widgetid&&(widgetProps.currentslide.show=!1),$is.goTo=function(index,direction){if($is.contents[$is.activeIndex]){var oldElement=$is.contents[$is.activeIndex].getElement(),newElement=$is.contents[index].getElement(),type=direction||"next";$is.widgetid?(oldElement.removeClass("active"),newElement.addClass("active"),$is.activeIndex=index):index===$is.activeIndex||isMoving||(isMoving=!0,$is.stop(),$is.activeIndex>index&&!direction&&(type="prev"),animateSlide(oldElement,newElement,type),$is.activeIndex=index,$is.play(),Utils.triggerFn($is.onChange,{$isolateScope:$is}))}},$is.next=function(){$is.activeIndex>$is.contents.length-2?$is.goTo(0,"next"):$is.goTo($is.activeIndex+1,"next")},$is.prev=function(){$is.activeIndex<1?$is.goTo($is.contents.length-1,"prev"):$is.goTo($is.activeIndex-1,"prev")},$is.first=function(){$is.goTo(0)},$is.last=function(){$is.goTo($is.contents.length-1)},CONSTANTS.isRunMode&&($is.play=function(){!$is.autoPlay&&$is.interval>=600&&"auto"===$is.animation&&($is.autoPlay=$interval(function(){$is.next()},$is.interval))},$is.stop=function(){$is.autoPlay&&$interval.cancel($is.autoPlay),$is.autoPlay=void 0}))},post:function($is,$el,attrs,listCtrl){var $slideTemplate,_onDestroy,$innerCarousel,$s=$el.scope(),handlers=[];Object.defineProperties($is,{Variables:{get:function(){return $s.Variables}},Widgets:{get:function(){return $s.Widgets}}}),CONSTANTS.isRunMode&&(attrs.type?($is.noDataFound=attrs.type===CAROUSEL_TYPE.DYNAMIC&&void 0===($is.binddataset||$is.scopedataset),$slideTemplate=prepareSlideTemplate(listCtrl.$get("carouselTemplate"),attrs),$el.prepend($slideTemplate),$compile($slideTemplate)($el.closest('[data-identifier="carousel"]').isolateScope()),handlers.push($is.$watch("active",function(nv){void 0!==nv&&($is.currentslide=$is.fieldDefs[nv],attrs.onChange&&Utils.triggerFn($is.onChange,{$isolateScope:$is}))})),$is.noWrapSlides=!1,$is.onSwipe=function(direction){$innerCarousel=$el.find(".carousel-inner").scope(),"left"===direction?$innerCarousel.next():$innerCarousel.prev()}):$is.play()),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is,attrs),$is,notifyFor),WidgetUtilService.postWidgetCreate($is,$el,attrs),_onDestroy=onDestroy.bind(void 0,$is,handlers),$is.$on("$destroy",_onDestroy),$el.on("$destroy",_onDestroy)}}}}]).directive("wmCarouselContent",["PropertiesFactory","$templateCache","WidgetUtilService","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.carouselcontent",["wm.base","wm.containers"]);return{restrict:"E",scope:{},transclude:!0,template:$templateCache.get("template/widget/advanced/carousel/carousel-content.html"),replace:!0,require:"^wmCarousel",link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs,controller){$is.getElement=function(){return $el},$is.$on("$destroy",function(){controller.unregister($is)}),controller.register($is),WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]).directive("wmCarouselTemplate",["PropertiesFactory","$templateCache","WidgetUtilService","CONSTANTS","Utils",function(PropertiesFactory,$templateCache,WidgetUtilService,CONSTANTS,Utils){"use strict";function preLinkFn($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps;
}function studioMode_postLinkFn($is,$el,attrs){WidgetUtilService.postWidgetCreate($is,$el,attrs)}function runMode_preLinkFn($is,$el,attrs,listCtrl){listCtrl.$set("carouselTemplate",$el.children()),$el.remove()}var directiveDefn,widgetProps=PropertiesFactory.getPropertiesOf("wm.carouselcontent",["wm.base","wm.containers"]);return directiveDefn={restrict:"E",replace:!0},CONSTANTS.isStudioMode?WM.extend(directiveDefn,{transclude:!0,scope:{},template:$templateCache.get("template/widget/advanced/carousel/carousel-content.html"),link:{pre:preLinkFn,post:studioMode_postLinkFn}}):WM.extend(directiveDefn,{scope:{},terminal:!0,require:"^wmCarousel",link:{pre:runMode_preLinkFn}}),directiveDefn}]),WM.module("wm.widgets.advanced").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/widget/advanced/rating.html",'<div ng-model="_model_" class="app-ratings" init-widget has-model apply-styles role="input" listen-property="dataset" ng-focus="onFocus($event)"><div ng-if="!readonly" class="rating-style"><label ng-class="{active : rate.value <= datavalue}" for="{{$id}}+{{rate.value}}" ng-mouseleave="onMouseleave($event, rate)" ng-mouseover="onMouseover($event, rate)" ng-style="{\'font-size\':iconsize, \'color\': rate.value <= datavalue && iconcolor}" ng-repeat="rate in range track by $index" title="{{rate.label || rate.value}}"><input type="radio" id="{{$id}}+{{rate.value}}" ng-click="getActiveElements($event)" name="{{ratingname}}" value="{{rate.value}}"/></label></div><div ng-if="readonly" ng-style="{\'font-size\':iconsize}" class="ratings-container disabled" ><div class="ratings active" ng-style="{width: ratingsWidth(), color: iconcolor}"></div></div><label ng-if="showcaptions" class="caption" ng-bind="caption"></label></div>')}]).directive("wmRating",["PropertiesFactory","WidgetUtilService","FormWidgetUtils","Utils","$rootScope",function(PropertiesFactory,WidgetUtilService,FormWidgetUtils,Utils,$rs){"use strict";function parseDataSet(dataSet,scope){var data=dataSet,dataField=scope.datafield,displayField=FormWidgetUtils.getDisplayField(dataSet,scope.displayfield||scope.datafield);return dataField&&(data={},WM.isObject(dataSet)&&!WM.isArray(dataSet)?data[WidgetUtilService.getObjValueByKey(dataSet,dataField)]=WidgetUtilService.getEvaluatedData(scope,dataSet,{fieldName:"displayfield",expressionName:"displayexpression"},displayField):_.forEach(dataSet,function(option){data[WidgetUtilService.getObjValueByKey(option,dataField)]=WidgetUtilService.getEvaluatedData(scope,option,{fieldName:"displayfield",expressionName:"displayexpression"},displayField)})),data}function getKey(optionObject){var keys=Object.keys(optionObject);return 1===keys.length?keys[0]:"dataValue"}function getLabel(options,i){return _.find(options,function(item){return Math.round(parseInt(item.key,10))===i})}function prepareRatingDataset(maxvalue,options){var i,maxValue,result,range=[];for(maxvalue=parseInt(maxvalue,10),maxValue=maxvalue>MAX_RATING?MAX_RATING:maxvalue,i=maxValue||DEFAULT_RATING;i>0;i--)result=getLabel(options,i),result?range.push({value:i,label:result.value}):range.push({value:i});return range}function createRatingOptions(dataset,scope){if(dataset){dataset=dataset.hasOwnProperty("data")?dataset.data:dataset;var key;dataset&&""!==dataset.dataValue&&(scope.selectOptions=[],WM.isArray(dataset)?(dataset=parseDataSet(dataset,scope),WM.isObject(dataset[0])?(key=getKey(dataset[0]),_.forEach(dataset,function(option){scope.selectOptions.push({key:key,value:option.name||option[key]})})):WM.isArray(dataset)?_.forEach(dataset,function(option,index){scope.selectOptions.push({key:index+1,value:option})}):WM.isObject(dataset)&&_.forEach(dataset,function(val,key){scope.selectOptions.push({key:key,value:val})})):WM.isObject(dataset)?(dataset=parseDataSet(dataset,scope),_.forEach(dataset,function(val,key){scope.selectOptions.push({key:key,value:val})})):WM.isString(dataset)?_.forEach(dataset.split(","),function(opt,index){opt=opt.trim(),scope.selectOptions.push({key:index+1,value:opt})}):scope.selectOptions.push({key:dataset,value:dataset}),scope.range=prepareRatingDataset(scope.maxvalue,scope.selectOptions),scope.caption=getCaption(scope))}}function getCaption(iScope,selecteditem){var captionItem=_.find(iScope.range,function(item){return item.value==(selecteditem?selecteditem.value:Math.round(parseInt(iScope.datavalue,10)))});return captionItem&&captionItem.hasOwnProperty("label")?captionItem.label:!iScope.dataset&&iScope.displayexpression?iScope.displayexpression:""}function onMouseover(iScope,attrs,evt,item){attrs.caption||(iScope.caption=getCaption(iScope,item)),WM.element(evt.target).nextAll().andSelf().css("color",iScope.iconcolor)}function onMouseout(iScope,attrs,$el){attrs.caption||(iScope.caption=getCaption(iScope)),$el.find("label").css("color",""),$el.find("label.active").css("color",iScope.iconcolor)}function onKeyDown(iScope,attrs,event){38!==event.which&&40!==event.which||(event.preventDefault(),event.stopPropagation());var action=Utils.getActionFromKey(event);iScope.isFocused&&(iScope.datavalue||(iScope.datavalue=0),"UP-ARROW"===action?$rs.$safeApply(iScope,function(){iScope.datavalue<iScope.maxvalue&&(iScope.datavalue=iScope.datavalue+1,attrs.caption||(iScope.caption=getCaption(iScope)))}):"DOWN-ARROW"===action&&$rs.$safeApply(iScope,function(){iScope.datavalue>0&&(iScope.datavalue=iScope.datavalue-1,attrs.caption||(iScope.caption=getCaption(iScope)))}))}function scopeDatasetWatcher(scope,element){scope.widgetid&&WidgetUtilService.updatePropertyPanelOptions(scope),createRatingOptions(scope.scopedataset,scope,element)}function propertyChangeHandler(scope,attrs,key,newVal){switch(key){case"dataset":WM.isDefined(newVal)&&null!==newVal&&createRatingOptions(scope.dataset,scope);break;case"maxvalue":scope.dataset||(scope.range=prepareRatingDataset(newVal),attrs.caption||(scope.caption=getCaption(scope))),scope.ratingname="ratings-"+scope.$id;break;case"displayexpression":scope.dataset||(scope.caption=newVal)}}var widgetProps=PropertiesFactory.getPropertiesOf("wm.rating",["wm.base","wm.base.editors"]),notifyFor={maxvalue:!0,readonly:!0,dataset:!0,displayexpression:!0},DEFAULT_RATING=5,MAX_RATING=10;return{restrict:"E",replace:!0,scope:{scopedataset:"=?"},template:WidgetUtilService.getPreparedTemplate.bind(void 0,"template/widget/advanced/rating.html"),link:{pre:function(scope,$el,attrs){scope.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps,scope.isFocused=!1},post:function(iScope,$el,attrs){WM.isString(iScope.datavalue)&&(iScope.datavalue=parseInt(iScope.datavalue,10)),attrs.caption||(iScope.caption=getCaption(iScope)),iScope.onMouseover=onMouseover.bind(void 0,iScope,attrs),iScope.onMouseleave=onMouseout.bind(void 0,iScope,attrs,$el),iScope.onFocus=function(){iScope.isFocused=!0},$el.bind("keydown",onKeyDown.bind(void 0,iScope,attrs)),iScope.getActiveElements=function($event){iScope._model_=$el.find(":checked").val(),attrs.caption||(iScope.caption=getCaption(iScope)),iScope._onChange($event)},iScope.ratingsWidth=function(){var dataValue=parseFloat(iScope.datavalue),starWidth=.925,maxValue=parseInt(iScope.maxvalue,10)||DEFAULT_RATING;return $el.find(".ratings-container").css("width",starWidth*maxValue+"em"),void 0===iScope.datavalue||""===iScope.datavalue||null===iScope.datavalue?0:dataValue<=maxValue&&dataValue>=0?dataValue*starWidth+"em":dataValue>maxValue?maxValue*starWidth+"em":void 0},iScope.reset=function(){iScope.datavalue=""},WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,iScope,attrs),iScope,notifyFor),WidgetUtilService.postWidgetCreate(iScope,$el,attrs),!attrs.widgetid&&attrs.scopedataset&&iScope.$watch("scopedataset",scopeDatasetWatcher.bind(void 0,iScope,$el))}}}}]),WM.module("wm.widgets.advanced").run(["$templateCache","CONSTANTS",function($tc,CONSTANTS){"use strict";var template;template=CONSTANTS.isStudioMode?'<div class="app-marquee app-container" title="{{hint}}" init-widget apply-styles wmtransclude></div>':'<marquee class="app-marquee app-container" title="{{hint}}" init-widget apply-styles wmtransclude onmouseover="this.stop();" onmouseout="this.start();"></marquee>',$tc.put("template/widget/advanced/marquee/marquee.html",template)}]).directive("wmMarquee",["PropertiesFactory","$templateCache","WidgetUtilService","Utils",function(PropertiesFactory,$tc,WidgetUtilService,Utils){"use strict";var widgetProps=PropertiesFactory.getPropertiesOf("wm.marquee",["wm.base"]);return{restrict:"E",scope:{},transclude:!0,replace:!0,template:$tc.get("template/widget/advanced/marquee/marquee.html"),link:{pre:function($is,$el,attrs){$is.widgetProps=attrs.widgetid?Utils.getClonedObject(widgetProps):widgetProps},post:function($is,$el,attrs){WidgetUtilService.postWidgetCreate($is,$el,attrs)}}}}]),WM.module("wm.prefabs").factory("debugModePrefabResourceInterceptor",[function(){"use strict";function getDevModePrefabUrl(requestUrl){var matchFound,redirectUrl,url;return(url=cache[requestUrl])?url:(matchFound=_.some(configs,function(config){var _url,index,resourceMatch=config.resourceMatch,servicesMatch=config.servicesMatch,prefabName=config.prefabName;return index=requestUrl.indexOf(resourceMatch),index!==-1?_url=requestUrl.substr(index+prefabName.length+13):(index=requestUrl.indexOf(servicesMatch),index!==-1&&(_url=requestUrl.substr(index+prefabName.length+10),_url="/services/"+_url)),redirectUrl=config.prefabAppUrl+_url,!!_url}),matchFound?(cache[requestUrl]=redirectUrl,redirectUrl):void 0)}function requestInterceptor(config){if(enableInterceptor){var _url=getDevModePrefabUrl(config.url);_url&&(config.url=_url)}return config}function registerConfig(pfName,url){enableInterceptor=!0,url.endsWith("/")||(url+="/"),configs.push({prefabName:pfName,prefabAppUrl:url,resourceMatch:"app/prefabs/"+pfName+"/",servicesMatch:"/prefabs/"+pfName+"/"})}var enableInterceptor,configs=[],cache={};return{request:requestInterceptor,register:registerConfig}}]).directive("wmPrefab",["PrefabManager","Utils","$compile","PropertiesFactory","WidgetUtilService","CONSTANTS","$timeout","WIDGET_CONSTANTS","$rootScope","DialogService","PrefabService","debugModePrefabResourceInterceptor",function(PrefabManager,Utils,$compile,PropertiesFactory,WidgetUtilService,CONSTANTS,$timeout,WIDGET_CONSTANTS,$rs,DialogService,PrefabService,debugModePrefabResourceInterceptor){"use strict";function propertyChangeHandler(scope,key,newVal){switch(key){case"height":scope.overflow=newVal?"auto":""}}function onConfigLoad($is,serverProps,config){if(prefabWidgetPropsMap[$is.prefabname])return $is.widgetProps=Utils.getClonedObject(prefabWidgetPropsMap[$is.prefabname]),$is._methodsMap=prefabMethodsMap[$is.prefabname],void(CONSTANTS.isStudioMode&&($is.serverProps=serverProps));var prefabProperties,prefabEvents,userDefinedProps,widgetProps={},methodsMap={};CONSTANTS.isStudioMode&&(prefabProperties=[],prefabEvents=[],propertiesGroup.subGroups.splice(1,0,{boundPrefabName:$is.prefabname,name:$is.prefabname+"_properties",parent:"properties",properties:prefabProperties},{boundPrefabName:$is.prefabname,name:$is.prefabname+"_layout",displayKey:"LABEL_PROPERTYGROUP_LAYOUT",parent:"properties",properties:["width","height"]},{boundPrefabName:$is.prefabname,name:$is.prefabname+"_behavior",displayKey:"LABEL_PROPERTYGROUP_BEHAVIOR",parent:"properties",properties:["show","animation"]}),eventsGroup.subGroups.push({boundPrefabName:$is.prefabname,name:$is.prefabname+"_events",parent:"events",properties:prefabEvents}),$is.serverProps=serverProps),userDefinedProps=config.properties||{},$is.prefabid=config.id,_.forEach(userDefinedProps,function(prop,key){return"method"===prop.type?void(methodsMap[key]=prop):(widgetProps[key]=prop,Utils.stringStartsWith(prop.value,"bind:")&&(prop.__value=prop.value,prop.value=void 0),void(CONSTANTS.isStudioMode&&("event"===prop.type?prefabEvents.push(key):_.includes(propsSkipList,key)||prefabProperties.push(key),prop.hasOwnProperty("show")||(prop.show=!0),prop.hasOwnProperty("disabled")||(prop.disabled=!1),"number"===prop.type&&"list"===prop.widget&&(prop.widget="list-number"),"event"===prop.type?prop.options=WIDGET_CONSTANTS.EVENTS_OPTIONS:prop.label=Utils.initCaps(key))))}),_.forEach(prefabDefaultProps,function(prop,key){WM.isUndefined(widgetProps[key])&&(widgetProps[key]=prop)}),prefabWidgetPropsMap[$is.prefabname]=widgetProps,prefabMethodsMap[$is.prefabname]=methodsMap,$is.widgetProps=Utils.getClonedObject(prefabWidgetPropsMap[$is.prefabname]),$is._methodsMap=prefabMethodsMap[$is.prefabname],CONSTANTS.isStudioMode&&($is.serverProps=serverProps)}function exposeMethodsOnWidget($is){_.forEach(prefabMethodsMap[$is.prefabname],function(methodObj,methodName){$is[methodName]=$is.ctrlScope[methodObj.method]})}var propertyGroups,propertiesGroup,eventsGroup,prefabDefaultProps=PropertiesFactory.getPropertiesOf("wm.prefabs",["wm.base"]),depsMap={},prefabWidgetPropsMap={},prefabMethodsMap={},propsSkipList=["width","height","show","animation"],notifyFor={height:!0};return CONSTANTS.isStudioMode&&!function(){var basicPropsSubGrp,groups=PropertiesFactory.getPropertyGroups();propertyGroups=groups.filter(function(group){return"properties"===group.name?propertiesGroup=group:"events"===group.name&&(eventsGroup=group),!!group.parent}),basicPropsSubGrp=_.find(propertiesGroup.subGroups,function(subGroup){return!subGroup.name}),propsSkipList=propsSkipList.concat(basicPropsSubGrp.properties)}(),{restrict:"E",scope:{prefabname:"@"},replace:!0,template:'<section data-role="prefab" init-widget class="app-prefab" ng-style="{width:width, height:height, margin: margin, overflow: overflow}"></section>',link:{pre:function($is,$el,attrs){function loadDependencies(){CONSTANTS.isStudioMode&&PrefabService.getAppPrefabServerProps({projectID:$rs.project.id,prefabName:$is.prefabname},function(response){serverProps=response||{}}),PrefabManager.loadAppPrefabConfig($is.prefabname,onConfigLoad.bind(void 0,$is,serverProps))}var serverProps;CONSTANTS.isStudioMode&&void 0!==attrs.registrationRequired?PrefabManager.registerPrefab($is.prefabname,loadDependencies):loadDependencies()},post:function($is,$el,attrs){function listenerFn(event,eventName){var parts,methodProps,fn,fnName,subParts,dialogId;eventName&&(parts=eventName.split("."),parts[0]===$is.name&&2===parts.length&&$is._methodsMap[parts[1]]&&(event.stopPropagation(),methodProps=$is._methodsMap[parts[1]],fnName=methodProps.method,fn=$is.ctrlScope[fnName],WM.isFunction(fn)?Utils.triggerFn(fn):(subParts=fnName.split("."),2===subParts.length?(dialogId=subParts[0],"show"===subParts[1]?DialogService.showDialog(dialogId,{scope:$is.ctrlScope}):"hide"===subParts[1]?DialogService.hideDialog(dialogId):_.includes(["send","open","close"],subParts[1])&&$rs.$emit("invoke-service",subParts[0],{scope:$is.ctrlScope,method:subParts[1]})):$rs.$emit("invoke-service",fnName,{scope:$is.ctrlScope}))))}function onTemplateLoad(){var pfScope=$el.find("[data-ng-controller], [ng-controller]").scope();pfScope&&!pfScope.$$destroyed&&(_.forEach($is.widgetProps,function(propDetails,propName){if(propDetails.__value&&!attrs.hasOwnProperty(propName)){var key=propDetails.__value.replace("bind:","");$is._watchers[propName]=pfScope.$watch(key,function(nv){$is[propName+"__updateFromWatcher"]=!0,$is[propName]=nv})}}),WidgetUtilService.postWidgetCreate($is,$el,attrs),Utils.triggerFn(pfScope.onInitPrefab),CONSTANTS.isRunMode&&(Utils.triggerFn($is.onLoad),$is.$on("$destroy",$is.onDestroy)),$is.ctrlScope=pfScope,exposeMethodsOnWidget($is))}function compileTemplate(prefabContent){var versionMsg=PrefabManager.getVersionMismatchMessage(prefabName),versionMsgEle='<div class="badge prefab-version" ng-if="showVersionMismatch"><span class="bold">'+versionMsg+"</span></div>",prefabEle=($is.widgetid?versionMsgEle:"")+'<div class="full-width full-height">'+prefabContent+"</div>",$prefabEle=WM.element(prefabEle);$is.showVersionMismatch=!!versionMsg,$el.append($prefabEle),$compile($el.children())($is),$timeout(onTemplateLoad)}var prefabName=$is.prefabname;$is.__compileWithIScope=!0,Object.defineProperty($is,"appLocale",{get:function(){return $is.$root.appLocale}}),$is.$on("$destroy",$rs.$on("invoke-service",listenerFn)),depsMap[prefabName]?compileTemplate(depsMap[prefabName].templateContent):PrefabManager.loadDependencies(prefabName).then(function(templateContent){var _content=PrefabManager.updateHTMLImportRefs(prefabName,templateContent);depsMap[prefabName]={templateContent:_content},compileTemplate(_content)}),WidgetUtilService.registerPropertyChangeListener(propertyChangeHandler.bind(void 0,$is),$is,notifyFor),$is.showServerProps=$is.serverProps&&_.keys($is.serverProps).length}}}}]).directive("wmPrefabRun",["$rootScope","Utils","$compile","PrefabManager","WidgetUtilService",function($rs,Utils,$compile,PrefabManager,WidgetUtilService){"use strict";function isExternalResource(path){return Utils.stringStartsWith(path,"http://|https://|//")}return{restrict:"E",scope:{},replace:!0,template:'<section  data-role="prefab" init-widget class="app-prefab app-prefab-run"></section>',link:{pre:function($is){var config=$rs.prefabConfig;$is.widgetProps=config.properties||[]},post:function($is,element,attrs){function compileTemplate(){element.append(WM.element($rs.prefabTemplate)),$compile(element.children())($is);var pfScope=element.find("[data-ng-controller]").scope();Object.defineProperties(element.scope(),{Widgets:{get:function(){return pfScope.Widgets}},Variables:{get:function(){return pfScope.Variables}}}),WidgetUtilService.postWidgetCreate($is,element,attrs),Utils.triggerFn(pfScope.onInitPrefab),$is.ctrlScope=pfScope}var resources,config=$rs.prefabConfig;$is.__compileWithIScope=!0,Object.defineProperty($is,"appLocale",{get:function(){return $rs.appLocale}}),config&&(resources=Utils.getClonedObject(config.resources),resources.scripts&&(resources.scripts=resources.scripts.map(function(script){var _script=script&&script.trim();return isExternalResource(_script)||"/"!==_script.charAt(0)||(_script="."+_script),_script})),resources.styles&&(resources.styles=resources.styles.map(function(style){var _style=style&&style.trim();return isExternalResource(_style)||"/"!==_style.charAt(0)||(_style="."+_style),_style})),resources.modules&&(resources.modules=resources.modules.map(function(module){return module.files=module.files.map(function(file){var _file=file&&file.trim();return isExternalResource(_file)||"/"!==_file.charAt(0)||(_file="."+_file),_file}),module})),Utils.loadStyleSheets(resources.styles),PrefabManager.loadScripts(resources.scripts).then(PrefabManager.loadModules.bind(void 0,resources.modules)).then(compileTemplate))}}}}]),wm.plugins.database=WM.module("wm.plugins.database",[]),wm.plugins.database.directives={},wm.plugins.database.controllers={},wm.plugins.database.services={},wm.plugins.database.factories={},wm.plugins.database.directive(wm.plugins.database.directives),wm.plugins.database.controller(wm.plugins.database.controllers),wm.plugins.database.service(wm.plugins.database.services),wm.plugins.database.factory(wm.plugins.database.factories),wm.plugins.database.constant("DB_SERVICE_URLS",{Database:{testConnection:{url:"services/projects/:projectID/database/testConnection",method:"POST"},testDatabase:{url:"services/projects/:projectID/database/testDatabase",method:"POST"},testJarRequired:{url:"services/projects/:projectID/database/testDriver?dbType=:dbType",method:"GET"},importDB:{url:"services/projects/:projectID/database/services/import",method:"POST"},reImportDB:{url:"services/projects/:projectID/database/services/:serviceId/reimport?retainDraft=:retainDraft",method:"POST"},exportDB:{url:"services/projects/:projectID/database/services/:serviceId/export",method:"POST"},loadModelInfo:{url:"services/projects/:projectID/database/loadModelInfo",method:"POST"},listTables:{url:"services/projects/:projectID/database/listTables",method:"POST"},getAllDataModels:{url:"services/projects/:projectID/datamodels",method:"GET"},getDataModel:{url:"services/projects/:projectID/datamodels/:dataModelName?isdraft=:isdraft",method:"GET"},createDatabase:{url:"services/projects/:projectID/database",method:"POST"},createService:{url:"services/projects/:projectID/database/services",method:"POST"},deleteService:{url:"services/projects/:projectID/database/services/:dataModelName",method:"DELETE"},saveDataModel:{url:"services/projects/:projectID/datamodels/:dataModelName/save",method:"POST"},applyDataModel:{url:"services/projects/:projectID/database/services/:serviceId/update",method:"POST"},revertDataModel:{url:"services/projects/:projectID/datamodels/:dataModelName/revert",method:"POST"},dataModelDiff:{url:"services/projects/:projectID/database/services/:serviceId/changes",method:"GET"},getAllEntities:{url:"services/projects/:projectID/datamodels/:dataModelName/tables",method:"GET"},getEntity:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:tableName",method:"GET"},createEntity:{url:"services/projects/:projectID/datamodels/:dataModelName/tables",method:"POST"},updateEntity:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName",method:"POST"},deleteEntity:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName",method:"DELETE"},addUniqueKey:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName/constraints",method:"POST"},deleteUniqueKey:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName/constraints/:uniquekeyname",method:"DELETE"},addPrimaryKey:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName/primaryKey",method:"PUT"},addColumns:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName/columns",method:"POST"},updateColumn:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName/columns/:columnName?forceDataLoss=:forceDataLoss",method:"PUT"},deleteColumn:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName/columns/:columnName",method:"DELETE"},addRelation:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName/relations",method:"POST"},updateRelation:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName/relations/:relationName",method:"PUT"},deleteRelation:{url:"services/projects/:projectID/datamodels/:dataModelName/tables/:entityName/relations/:relationName",method:"DELETE"},getTypesMap:{url:"services/projects/:projectID/database/services/:dataModelName/configuration",method:"GET"},getSequences:{url:"services/projects/:projectID/database/services/:dataModelName/sequences",method:"GET"},getAllQueries:{url:"services/projects/:projectID/datamodels/:dataModelName/queries",method:"GET"},getQuery:{url:"services/projects/:projectID/datamodels/:dataModelName/queries/:queryName",method:"GET"},createQuery:{url:"services/projects/:projectID/datamodels/:dataModelName/queries",method:"POST"},updateQuery:{url:"services/projects/:projectID/datamodels/:dataModelName/queries/:queryName",method:"PUT"},queryNameUsage:{url:"services/projects/:projectID/datamodels/:dataModelName/queries/:queryName/usages",method:"GET"},deleteQuery:{url:"services/projects/:projectID/datamodels/:dataModelName/queries/:queryName",method:"DELETE"},setQueryMetaData:{url:"services/projects/:projectID/datamodels/:dataModelName/queries/:queryName/metadata",method:"POST"},validateQuery:{url:"services/projects/:projectID/datamodels/:dataModelName/query/validate",method:"POST"},getAllProcedures:{url:"services/projects/:projectID/datamodels/:dataModelName/procedures",method:"GET"},getProcedure:{url:"services/projects/:projectID/datamodels/:dataModelName/procedures/:procedureName",method:"GET"},createProcedure:{url:"services/projects/:projectID/datamodels/:dataModelName/procedures",method:"POST"},updateProcedure:{url:"services/projects/:projectID/datamodels/:dataModelName/procedures/:procedureName",method:"PUT"},deleteProcedure:{url:"services/projects/:projectID/datamodels/:dataModelName/procedures/:procedureName",method:"DELETE"},readTableData:{url:"/:service/:dataModelName/:entityName?page=:page&size=:size&:sort",method:"GET"},insertTableData:{url:"/:service/:dataModelName/:entityName",method:"POST"},insertMultiPartTableData:{url:"/:service/:dataModelName/:entityName",method:"POST",headers:{"Content-Type":void 0},transformRequest:WM.identity},updateTableData:{url:"/:service/:dataModelName/:entityName/:id",method:"PUT"},updateMultiPartTableData:{url:"/:service/:dataModelName/:entityName/:id",method:"POST",headers:{"Content-Type":void 0},transformRequest:WM.identity},deleteTableData:{url:"/:service/:dataModelName/:entityName/:id",method:"DELETE"},updateCompositeTableData:{url:"/:service/:dataModelName/:entityName/composite-id?:id",method:"PUT"},updateMultiPartCompositeTableData:{url:"/:service/:dataModelName/:entityName/composite-id?:id",method:"POST",headers:{"Content-Type":void 0},transformRequest:WM.identity},deleteCompositeTableData:{url:"/:service/:dataModelName/:entityName/composite-id?:id",method:"DELETE"},searchTableData:{url:"/:service/:dataModelName/:entityName/search?page=:page&size=:size&:sort",method:"POST"},searchTableDataWithQuery:{url:"/:service/:dataModelName/:entityName/filter?page=:page&size=:size&:sort",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}},exportTableData:{url:"/:service/:dataModelName/:entityName/export/:exportFormat?size=:size&:sort",method:"POST"},readTableRelatedData:{url:"/:service/:dataModelName/:entityName/:id/:relatedFieldName?page=:page&size=:size&:sort",method:"GET"},executeNamedQuery:{url:"/:service/:dataModelName/queryExecutor/queries/:queryName?page=:page&size=:size&:queryParams",method:"GET"},executeCustomQuery:{url:"/:service/:dataModelName/queries/execute?page=:page&size=:size",method:"POST"},testRunQuery:{url:"/:service/:dataModelName/queries/test_run",method:"POST"},nativeTestRunQuery:{url:"services/projects/:projectID/database/services/:dataModelName/queries/testrun",method:"POST"},executeNamedProcedure:{url:"/:service/:dataModelName/procedureExecutor/procedure/execute/:procedureName?page=:page&size=:size&:procedureParams",method:"GET"},testRunProcedure:{url:"services/projects/:projectID/database/services/:dataModelName/procedures/testrun",method:"POST"},proceduresInDatabase:{url:"services/projects/:projectID/database/services/:dataModelName/procedures",method:"GET"},getSampleDbConnectionProperties:{url:"services/projects/:projectID/database/sample/connectionProps",method:"GET"},getConnectionProperties:{url:"services/projects/:projectID/database/services/:serviceId/properties",method:"GET"},updateConnectionProperties:{url:"services/projects/:projectID/database/services/:serviceId/properties",method:"PUT"},updateOfflineConfig:{url:"services/projects/:projectID/database/services/:serviceId/offline",method:"POST"},getOfflineConfig:{url:"services/projects/:projectID/database/services/:serviceId/offline",method:"GET"}}}),wm.plugins.database.constant("DB_CONSTANTS",{DATABASE_WORKSPACE_TYPE:"db",WAVEMAKER_SAMPLE_DB_NAME:"hrdb",DEFAULT_DB_NAME:"MyTestDatabase",HSQL_DB_TYPE:"HSQLDB",MYSQL_DB_TYPE:"MySQL",POSTGRESQL_DB_TYPE:"PostgreSQL",ORACLE_DB_TYPE:"Oracle",SQL_SERVER_DB_TYPE:"SQLServer",DB2_DB_TYPE:"DB2",MYSQL_CLOUD_HOST:"{WM_CLOUD_MYSQL_HOST}",MYSQL_CLOUD_DB_TYPE:"MySQL-Cloud",LOGIN:{SAAS_MYSQL_CLOUD:{USERNAME:"{WM_CLOUD_MYSQL_USERNAME}",PASSWORD:"{WM_CLOUD_MYSQL_PASSWORD}"}},DRIVER_VERSIONS:{Oracle:[{DB_VERSION:"Oracle 12.1 or 12cR1",DRIVER_VERSION:"ojdbc7.jar",URL:""},{DB_VERSION:"Oracle 11.2 or 11gR2",DRIVER_VERSION:"ojdbc6.jar",URL:""}],SQLServer:[{DB_VERSION:"SQL Server 2005",DRIVER_VERSION:"Driver 4.0",URL:""},{DB_VERSION:"SQL Server 2008",DRIVER_VERSION:"Driver 4.0",URL:""},{DB_VERSION:"SQL Server 2008R2",DRIVER_VERSION:"Driver 4.0",URL:""},{DB_VERSION:"SQL Server 2012",DRIVER_VERSION:"Driver 4.0",URL:""},{DB_VERSION:"Azure SQL Database",DRIVER_VERSION:"Driver 4.0",URL:""},{DB_VERSION:"PDW 2008R2 AU34",DRIVER_VERSION:"Driver 4.0",URL:""},{DB_VERSION:"SQL Server 2014",DRIVER_VERSION:"Driver 4.0",URL:""},{DB_VERSION:"SQL Server 2016",DRIVER_VERSION:"Driver 4.0",URL:""}],DB2:[{DB_VERSION:"Express-C 9.5",DRIVER_VERSION:"db2jcc4.jar",URL:""},{DB_VERSION:"Express-C 10.5",DRIVER_VERSION:"db2jcc4.jar",URL:""}]},NON_EDITABLE_DATABASE_SYSTEMS:["HSQLDB","DB2","Other"],PERMISSIONS:{DEFAULT:{CREATE:!0,UPDATE:!0,DELETE:!0,READ:!0},HSQLDB:{CREATE:!1,UPDATE:!1,DELETE:!1,READ:!0},"MySQL-Cloud":{CREATE:!0,UPDATE:!0,DELETE:!0,READ:!0},MySQL:{CREATE:!0,UPDATE:!0,DELETE:!0,READ:!0},DB2:{CREATE:!1,UPDATE:!1,DELETE:!1,READ:!0},PostgreSQL:{CREATE:!0,UPDATE:!0,DELETE:!0,READ:!0},Oracle:{CREATE:!0,UPDATE:!0,DELETE:!0,READ:!0},SQLServer:{CREATE:!0,UPDATE:!0,DELETE:!0,READ:!0},Other:{CREATE:!1,UPDATE:!1,DELETE:!1,READ:!0},RE_IMPORT_CASE:{CREATE:!1,UPDATE:!1,DELETE:!1,READ:!0,VIEWONLY:!0}},IDENTITY_GENERATORS:["integer","short","long","big_integer"],DATABASE_NUMERIC_DATA_TYPES:{short:"short",integer:"integer",long:"long",big_integer:"big_integer",float:"float",double:"double",big_decimal:"big_decimal"},DATABASE_DATA_TYPES:{big_decimal:{java_type:"big_decimal"},big_integer:{java_type:"big_integer"},blob:{java_type:"blob"},boolean:{java_type:"boolean"},byte:{java_type:"byte"},character:{java_type:"character"},clob:{java_type:"clob"},date:{java_type:"date"},datetime:{java_type:"datetime"},double:{java_type:"double"},float:{java_type:"float"},integer:{java_type:"integer"},long:{java_type:"long"},string:{java_type:"string"},short:{java_type:"short"},text:{java_type:"text"},time:{java_type:"time"},timestamp:{java_type:"timestamp"},unknown:{java_type:"blob"}},DATABASE_SECONDARY_DATA_TYPES:{binary:{java_type:"blob"},long:{java_type:"double"}},DATABASE_GENERATORS:{assigned:"assigned",identity:"auto increment",uniqueid:"unique id",sequence:"sequence"},DATABASE_MATCH_MODES:{like:"LIKE",start:"STARTING_WITH",end:"ENDING_WITH",anywhere:"CONTAINING",exact:"EQUALS",notequals:"NOT_EQUALS",between:"BETWEEN",in:"IN",lessthan:"LESS_THAN",lessthanequal:"LESS_THAN_OR_EQUALS",greaterthan:"GREATER_THAN",greaterthanequal:"GREATER_THAN_OR_EQUALS",null:"NULL",isnotnull:"IS_NOT_NULL",empty:"EMPTY",isnotempty:"IS_NOT_EMPTY",nullorempty:"NULL_OR_EMPTY"},DATABASE_MATCH_MODES_WITH_QUERY:{LIKE:"${0} like ${1}",STARTING_WITH:"${0} like ${1}",ENDING_WITH:"${0} like ${1}",CONTAINING:"${0} like ${1}",EQUALS:"${0}=${1}",NOT_EQUALS:"${0}!=${1}",BETWEEN:"${0} between ${1}",IN:"${0} in ${1}",LESS_THAN:"${0}<${1}",LESS_THAN_OR_EQUALS:"${0}<=${1}",GREATER_THAN:"${0}>${1}",GREATER_THAN_OR_EQUALS:"${0}>=${1}",NULL:"${0} is null",IS_NOT_NULL:"${0} is not null",EMPTY:"${0}=''",IS_NOT_EMPTY:"${0}<>''",NULL_OR_EMPTY:"${0} is null or ${0}=''"},DATABASE_EMPTY_MATCH_MODES:["NULL","IS_NOT_NULL","EMPTY","IS_NOT_EMPTY","NULL_OR_EMPTY"],DATABASE_STRING_MODES:["LIKE","STARTING_WITH","ENDING_WITH","CONTAINING","EQUALS","NOT_EQUALS"],DATABASE_NULL_EMPTY_MATCH:{NULL:"NULL",IS_NOT_NULL:"IS_NOT_NULL",EMPTY:"NULL",IS_NOT_EMPTY:"IS_NOT_NULL",NULL_OR_EMPTY:"NULL"},DATABASE_RANGE_MATCH_MODES:["BETWEEN","LESS_THAN","LESS_THAN_OR_EQUALS","GREATER_THAN","GREATER_THAN_OR_EQUALS","NOT_EQUALS"],ACTIONS:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",SAVED:"SAVED"},OBJECTS:{DATABASE:"wm-db",TABLE:"wm-db-table",COLUMN:"wm-db-table-column",RELATION:"wm-db-column-relation"},DML_QUERY_INDICATORS:{SELECT:"SELECT",UPDATE:["INSERT INTO","UPDATE","DELETE FROM"]},DDL_QUERY_INDICATORS:["CREATE","ALTER","RENAME","DROP"],PROCEDURE_INDICATORS:{CALL:"CALL",EXECUTE:"EXEC",SELECT:"SELECT"},SERVER_SIDE_PROPERTIES:{CURRENT_DATE:{property:"Current Date",label:"CURRENT_DATE",value:"DATE"},CURRENT_TIME:{property:"Current Time",label:"CURRENT_TIME",value:"TIME"},CURRENT_DATE_TIME:{property:"Current DateTime",label:"CURRENT_DATE_TIME",value:"DATETIME"},CURRENT_USER_ID:{property:"LoggedIn UserId",label:"CURRENT_USER_ID",value:"USER_ID"},CURRENT_USER_NAME:{property:"LoggedIn Username",label:"CURRENT_USER_NAME",value:"USER_NAME"}},COLUMN_VALUE_TYPES:{"user-defined":"User Defined",
"server-defined":"Server Defined","database-defined":"Database Defined"},COLUMN_VALUE_OPERATIONS:{BOTH:"Insert and Update",INSERT:"Insert Only",UPDATE:"Update Only"},COLUMN_SERVER_PROPERTIES:{DATE:"Current Date",TIME:"Current Time",DATE_TIME:"Current Datetime",USER_ID:"LoggedIn UserId",USER_NAME:"LoggedIn Username"}}),wm.plugins.database.config(function(BaseServiceManagerProvider,DB_SERVICE_URLS){"use strict";BaseServiceManagerProvider.register(DB_SERVICE_URLS)}),wm.plugins.database.services.QueryBuilder=["$rootScope","DatabaseService","Utils","ProjectService","DB_CONSTANTS",function($rootScope,DatabaseService,Utils,ProjectService,DB_CONSTANTS){"use strict";function getFieldValue(value,type){return Utils.isNumberType(type)||"boolean"===type?value:"'"+value+"'"}var matchModes=DB_CONSTANTS.DATABASE_MATCH_MODES;return{getQuery:function(options){var selectClause,fromClause,groupByClause,orderByClause,query,columnClause="",whereClause="",logicalOp=options.logicalOp&&"or"===options.logicalOp.toLowerCase()?" OR ":" AND ",logicalOpSliceLength=" OR "===logicalOp?-4:-5,whereParams=[],fields=[],dateTypes=["timestamp","datetime","time","date"];return selectClause="SELECT ",options.columns?(columnClause="",WM.forEach(options.columns,function(column){columnClause+=column+","}),columnClause=columnClause.slice(0,-1)):selectClause="",fromClause=" FROM "+options.tableName,_.isArray(options.filterFields)&&options.filterFields.length?(_.forEach(options.filterFields,function(field){var param,matchModeExpr,fieldValue,filterCondition=matchModes[field.matchMode];if(field.clause)param=field.clause;else{switch(filterCondition||(filterCondition=_.isArray(field.value)?matchModes.in:matchModes.exact),_.includes(DB_CONSTANTS.DATABASE_EMPTY_MATCH_MODES,filterCondition)&&!_.includes(["text","string"],_.toLower(field.type))&&(filterCondition=DB_CONSTANTS.DATABASE_NULL_EMPTY_MATCH[filterCondition]),filterCondition){case matchModes.in:fieldValue=field.value.length?"("+_.join(_.map(field.value,function(val){return getFieldValue(val,field.type)}),", ")+")":void 0;break;case matchModes.between:fieldValue=field.value.length?_.join(_.map(field.value,function(val){return getFieldValue(val,field.type)})," and "):void 0;break;default:fieldValue=getFieldValue(field.value,field.type)}matchModeExpr=DB_CONSTANTS.DATABASE_MATCH_MODES_WITH_QUERY[filterCondition],param=WM.isDefined(fieldValue)?Utils.replace(matchModeExpr,[field.column,fieldValue]):""}param&&whereParams.push(param)}),whereClause=whereParams.length?" WHERE "+_.join(whereParams,logicalOp):""):WM.element.isEmptyObject(options.filterFields)||(whereClause=" WHERE ",WM.forEach(options.filterFields,function(field,fieldName){var fieldValue;if(WM.isArray(field.value))"BETWEEN"===field.filterCondition?(_.includes(dateTypes,field.type)?(fields[0]="'"+moment(field.value[0]).format("YYYY-MM-DD HH:mm:ss")+"'",fields[1]="'"+moment(field.value[1]).format("YYYY-MM-DD HH:mm:ss")+"'"):fields=field.value,whereClause+=fieldName+" BETWEEN "+fields[0]+" AND "+fields[1]+logicalOp):(whereClause+="("+fieldName+"='",field.value.forEach(function(element,index){whereClause+=index+1===field.value.length?element:element+"' OR "+fieldName+"='"}),whereClause+="')"+logicalOp);else{if(WM.isUndefined(field.value)){if(WM.isObject(field))return;fieldValue=field}else fieldValue=field.value;whereClause+="boolean"===field.type?fieldName+"="+fieldValue+" "+logicalOp:fieldName+"='"+fieldValue+"'"+logicalOp}}),whereClause=whereClause.slice(0,logicalOpSliceLength)),groupByClause=options.groupby?" GROUP BY "+options.groupby:"",orderByClause=options.orderby?" ORDER BY "+options.orderby:"",query=selectClause+columnClause+fromClause+whereClause+groupByClause+orderByClause},executeQuery:function(options,success,error){var executeQuery=function(){DatabaseService.executeCustomQuery({projectID:$rootScope.project.id,dataModelName:options.databaseName,page:options.page,size:options.size,data:{queryString:options.query,parameters:options.queryParams||[],nativeSql:options.nativeSql,type:"SELECT"},service:options.prefabName?"":"services",url:options.prefabName?$rootScope.project.deployedUrl+"/prefabs/"+options.prefabName:$rootScope.project.deployedUrl},function(response){response.errors?Utils.triggerFn(error,response):Utils.triggerFn(success,response)},function(response){Utils.triggerFn(error,response)})};$rootScope.project.deployedUrl?executeQuery():ProjectService.run({projectId:$rootScope.project.id},function(result){$rootScope.project.deployedUrl=Utils.removeProtocol(result),executeQuery()})}}}],wm.plugins.database.services.DatabaseService=["$rootScope","BaseService","BaseServiceManager","CONSTANTS","Utils","WebService","$window","$q",function($rootScope,BaseService,BaseServiceManager,CONSTANTS,Utils,WebService,$window,$q){"use strict";var initiateAction=function(action,params,successCallback,failureCallback,noproxy){var param,val,config,connectionParams,urlParams,requestData,headers;if(config=BaseServiceManager.getConfig(),config=Utils.getClonedObject(config.Database[action]),headers=config&&config.headers,requestData=params.data,urlParams={projectID:params.projectID,service:WM.isDefined(params.service)?params.service:"services",dataModelName:params.dataModelName,entityName:params.entityName,queryName:params.queryName,queryParams:params.queryParams,procedureName:params.procedureName,procedureParams:params.procedureParams,id:params.id,relatedFieldName:params.relatedFieldName,page:params.page,size:params.size,sort:params.sort,exportFormat:params.exportFormat},params.url&&CONSTANTS.isStudioMode&&!noproxy){if(urlParams)for(param in urlParams)urlParams.hasOwnProperty(param)&&(val=urlParams[param],WM.isDefined(val)&&null!==val&&(config.url=config.url.replace(new RegExp(":"+param,"g"),val)));headers=headers||{},headers.skipSecurity="true",headers["Content-Type"]=headers["Content-Type"]||"application/json",connectionParams={data:{endpointAddress:$window.location.protocol+($rootScope.preferences.workspace.loadXDomainAppDataUsingProxy?"":"//"+$window.location.host)+params.url+config.url,method:config.method,requestBody:JSON.stringify(requestData),headers:headers},urlParams:{projectID:$rootScope.project.id}},WebService.testRestService(connectionParams,function(response){var errMsg,localeObject,parsedData=Utils.getValidJSON(response.responseBody);parsedData.hasOwnProperty("result")?Utils.triggerFn(successCallback,parsedData.result):parsedData.hasOwnProperty("error")?Utils.triggerFn(failureCallback,parsedData.error&&parsedData.error.message||parsedData.error):parsedData.hasOwnProperty("errorDetails")?(localeObject=$rootScope.locale||$rootScope.appLocale,errMsg=Utils.getClonedObject(localeObject[parsedData.errorDetails.code]),Utils.triggerFn(failureCallback,Utils.replace(errMsg,parsedData.errorDetails.data)||parsedData.errorDetails)):Utils.triggerFn(successCallback,parsedData)},failureCallback)}else{if(connectionParams={target:"Database",action:action,urlParams:urlParams,data:requestData||"",config:{url:params.url}},CONSTANTS.isStudioMode&&(headers=headers||{},headers.skipSecurity="true"),headers&&(connectionParams.headers=headers),"exportTableData"!==action)return BaseService.execute(connectionParams,successCallback,failureCallback);Utils.simulateFileDownload(BaseService.parseReplace(connectionParams))}};return{testConnection:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"testConnection",data:{username:params.username,password:params.password,url:params.url,driverClass:params.driverClass,dialect:params.dialect},urlParams:{projectID:params.projectID}},successCallback,failureCallback)},testDatabase:function(params){var deferred=$q.defer();return BaseService.execute({target:"Database",action:"testDatabase",urlParams:{projectID:params.projectID},data:params.data},deferred.resolve,deferred.reject),deferred.promise},testJarRequired:function(params){var deferred=$q.defer();return BaseService.execute({target:"Database",action:"testJarRequired",urlParams:{projectID:params.projectID,dbType:params.dbType}},deferred.resolve,deferred.reject),deferred.promise},importDB:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"importDB",data:{serviceId:params.serviceId,packageName:params.packageName,username:params.username,password:params.password,url:params.url,tableFilter:params.tableFilter,schemaName:params.schemaName,schemaFilter:params.schemaFilter,driverClass:params.driverClass,dialect:params.dialect,revengNamingStrategyClassName:params.revengNamingStrategyClassName,impersonateUser:!1,activeDirectoryDomain:params.activeDirectoryDomain,dbType:params.dbType,host:params.host,port:params.port,dbName:params.dbName,readOnly:params.readOnly},urlParams:{projectID:params.projectID}},successCallback,failureCallback)},reImportDB:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"reImportDB",urlParams:{projectID:params.projectID,serviceId:params.serviceId,retainDraft:params.retainDraft||!1}},successCallback,failureCallback)},exportDB:function(params,successCallback,failureCallback){return BaseService.execute({target:"Database",action:"exportDB",data:{serviceId:params.serviceId,username:params.username,password:params.password,url:params.url,schemaName:params.schemaName,schemaFilter:params.schemaFilter,driverClass:params.driverClass,dialect:params.dialect,revengNamingStrategyClassName:params.revengNamingStrategyClassName,impersonateUser:!1,overwrite:params.overwrite,dbType:params.dbType,host:params.host,port:params.port,dbName:params.dbName,packageName:params.packageName},urlParams:{projectID:params.projectID,serviceId:params.serviceId}},successCallback,failureCallback)},listTables:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"listTables",data:{serviceId:params.serviceId,packageName:params.packageName,username:params.username,password:params.password,url:params.url,schemaFilter:params.schemaFilter,tableFilter:[],driverClass:params.driverClass,dialect:params.dialect,revengNamingStrategyClassName:params.revengNamingStrategyClassName,impersonateUser:!1,dbType:params.dbType,host:params.host,port:params.port,dbName:params.dbName},urlParams:{projectID:params.projectID}},successCallback,failureCallback)},loadModelInfo:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"loadModelInfo",data:{serviceId:params.serviceId,packageName:params.packageName,username:params.username,password:params.password,url:params.url,schemaFilter:params.schemaFilter,tableFilter:params.tableFilter,driverClass:params.driverClass,dialect:params.dialect,revengNamingStrategyClassName:params.revengNamingStrategyClassName,impersonateUser:!1,dbType:params.dbType,host:params.host,port:params.port,dbName:params.dbName},urlParams:{projectID:params.projectID}},successCallback,failureCallback)},getAllDataModels:function(projectID,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getAllDataModels",urlParams:{projectID:projectID}},successCallback,failureCallback)},getDataModel:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getDataModel",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,isdraft:params.isdraft}},successCallback,failureCallback)},createDatabase:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"createDatabase",urlParams:{projectID:params.projectID},data:params.data},successCallback,failureCallback)},createService:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"createService",urlParams:{projectID:params.projectID},data:params.data},successCallback,failureCallback)},deleteDataModel:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"deleteService",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName}},successCallback,failureCallback)},saveDataModel:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"saveDataModel",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName}},successCallback,failureCallback)},applyDataModel:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"applyDataModel",urlParams:{projectID:params.projectID,serviceId:params.dataModelName},data:params.data},successCallback,failureCallback)},revertDataModel:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"revertDataModel",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName}},successCallback,failureCallback)},getDataModelDiff:function(params){var deferred=$q.defer();return BaseService.execute({target:"Database",action:"dataModelDiff",urlParams:{projectID:params.projectID,serviceId:params.dataModelName}},deferred.resolve,deferred.reject),deferred.promise},getAllEntities:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getAllEntities",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName}},successCallback,failureCallback)},getEntity:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getEntity",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,tableName:params.tableName}},successCallback,failureCallback)},createEntity:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"createEntity",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName},data:params.data},successCallback,failureCallback)},updateEntity:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"updateEntity",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:encodeURIComponent(params.entityName)},data:params.data},successCallback,failureCallback)},deleteEntity:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"deleteEntity",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:encodeURIComponent(params.entityName)}},successCallback,failureCallback)},addPrimaryKey:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"addPrimaryKey",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:params.entityName},data:params.data},successCallback,failureCallback)},addUniqueKey:function(params){var deferred=$q.defer();return BaseService.execute({target:"Database",action:"addUniqueKey",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:params.entityName},data:params.data},deferred.resolve,deferred.reject),deferred.promise},deleteUniqueKey:function(params){var deferred=$q.defer();return BaseService.execute({target:"Database",action:"deleteUniqueKey",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:encodeURIComponent(params.entityName),uniquekeyname:encodeURIComponent(params.uniquekeyname)}},deferred.resolve,deferred.reject),deferred.promise},addColumns:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"addColumns",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:params.entityName},data:params.data},successCallback,failureCallback)},updateColumn:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"updateColumn",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:encodeURIComponent(params.entityName),columnName:encodeURIComponent(params.columnName),forceDataLoss:params.forceDataLoss||!1},data:params.data},successCallback,failureCallback)},deleteColumn:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"deleteColumn",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:encodeURIComponent(params.entityName),columnName:encodeURIComponent(params.columnName)}},successCallback,failureCallback)},addRelation:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"addRelation",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:params.entityName},data:params.data},successCallback,failureCallback)},updateRelation:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"updateRelation",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:encodeURIComponent(params.entityName),relationName:encodeURIComponent(params.relationName)},data:params.data},successCallback,failureCallback)},deleteRelation:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"deleteRelation",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,entityName:encodeURIComponent(params.entityName),relationName:encodeURIComponent(params.relationName)}},successCallback,failureCallback)},getAllQueries:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getAllQueries",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName}},successCallback,failureCallback)},getQuery:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getQuery",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,queryName:params.queryName}},successCallback,failureCallback)},createQuery:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"createQuery",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName},data:params.data},successCallback,failureCallback)},setQueryMetaData:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"setQueryMetaData",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,queryName:params.queryName},data:params.data},successCallback,failureCallback)},updateQuery:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"updateQuery",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,queryName:params.queryName},data:params.data},successCallback,failureCallback)},queryNameUsage:function(params){var deferred=$q.defer();return BaseService.execute({target:"Database",action:"queryNameUsage",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,queryName:params.queryName}},deferred.resolve,deferred.reject),deferred.promise},deleteQuery:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"deleteQuery",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,queryName:params.queryName}},successCallback,failureCallback)},validateQuery:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"validateQuery",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName},data:params.queryDetails},successCallback,failureCallback)},testRunQuery:function(params,successCallback,failureCallback){return initiateAction("testRunQuery",params,successCallback,failureCallback)},nativeTestRunQuery:function(params,successCallback,failureCallback){return initiateAction("nativeTestRunQuery",params,successCallback,failureCallback,!0)},getAllProcedures:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getAllProcedures",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName}},successCallback,failureCallback)},proceduresInDatabase:function(params){var deferred=$q.defer();return BaseService.execute({target:"Database",action:"proceduresInDatabase",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName}},deferred.resolve,deferred.reject),deferred.promise},getProcedure:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getProcedure",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,procedureName:params.procedureName}},successCallback,failureCallback)},createProcedure:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"createProcedure",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName},data:params.data,returnTypeMetadata:params.returnTypeMetadata},successCallback,failureCallback)},updateProcedure:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"updateProcedure",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,procedureName:params.procedureName},data:params.data,returnTypeMetadata:params.returnTypeMetadata},successCallback,failureCallback)},deleteProcedure:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"deleteProcedure",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName,procedureName:params.procedureName}},successCallback,failureCallback)},validateProcedure:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"validateProcedure",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName},data:params.queryDetails},successCallback,failureCallback)},testRunProcedure:function(params,successCallback,failureCallback){return initiateAction("testRunProcedure",params,successCallback,failureCallback,!0)},getSampleDbConnectionProperties:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getSampleDbConnectionProperties",urlParams:{projectID:params.projectID}},successCallback,failureCallback)},getConnectionProperties:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getConnectionProperties",urlParams:{projectID:params.projectID,serviceId:params.dataModelName}},successCallback,failureCallback)},updateConnectionProperties:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"updateConnectionProperties",urlParams:{projectID:params.projectID,serviceId:params.dataModelName},data:params.data},successCallback,failureCallback)},getTypesMap:function(params,successCallback,failureCallback){BaseService.execute({target:"Database",action:"getTypesMap",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName}},successCallback,failureCallback)},getSequences:function(params){var deferred=$q.defer();return BaseService.execute({target:"Database",action:"getSequences",urlParams:{projectID:params.projectID,dataModelName:params.dataModelName}},deferred.resolve,deferred.reject),deferred.promise},readTableData:function(params,successCallback,failureCallback){return initiateAction("readTableData",params,successCallback,failureCallback)},searchTableData:function(params,successCallback,failureCallback){return initiateAction("searchTableData",params,successCallback,failureCallback)},searchTableDataWithQuery:function(params,successCallback,failureCallback){return initiateAction("searchTableDataWithQuery",params,successCallback,failureCallback)},exportTableData:function(params){return initiateAction("exportTableData",params)},readTableRelatedData:function(params,successCallback,failureCallback){return initiateAction("readTableRelatedData",params,successCallback,failureCallback)},insertTableData:function(params,successCallback,failureCallback){return initiateAction("insertTableData",params,successCallback,failureCallback)},insertMultiPartTableData:function(params,successCallback,failureCallback){return initiateAction("insertMultiPartTableData",params,successCallback,failureCallback)},updateTableData:function(params,successCallback,failureCallback){return initiateAction("updateTableData",params,successCallback,failureCallback)},updateMultiPartTableData:function(params,successCallback,failureCallback){return initiateAction("updateMultiPartTableData",params,successCallback,failureCallback)},updateMultiPartCompositeTableData:function(params,successCallback,failureCallback){return initiateAction("updateMultiPartCompositeTableData",params,successCallback,failureCallback)},deleteTableData:function(params,successCallback,failureCallback){return initiateAction("deleteTableData",params,successCallback,failureCallback)},updateCompositeTableData:function(params,successCallback,failureCallback){return initiateAction("updateCompositeTableData",params,successCallback,failureCallback)},deleteCompositeTableData:function(params,successCallback,failureCallback){return initiateAction("deleteCompositeTableData",params,successCallback,failureCallback)},executeNamedQuery:function(params,successCallback,failureCallback){return initiateAction("executeNamedQuery",params,successCallback,failureCallback)},executeNamedProcedure:function(params,successCallback,failureCallback){return initiateAction("executeNamedProcedure",params,successCallback,failureCallback)},executeCustomQuery:function(params,successCallback,failureCallback){return initiateAction("executeCustomQuery",params,successCallback,failureCallback)},executeCustomProcedure:function(params,successCallback,failureCallback){return initiateAction("executeCustomProcedure",params,successCallback,failureCallback)},getOfflineConfig:function(params){return BaseService.execute({target:"Database",action:"getOfflineConfig",urlParams:{projectID:params.projectID,serviceId:params.dataModelName}})},updateOfflineConfig:function(params){return BaseService.execute({target:"Database",action:"updateOfflineConfig",urlParams:{projectID:params.projectID,serviceId:params.dataModelName},data:params.data})}}}],wm.plugins.webServices=WM.module("wm.plugins.webServices",["base64"]),wm.plugins.webServices.controllers={},wm.plugins.webServices.services={},wm.plugins.webServices.factories={},wm.plugins.webServices.controller(wm.plugins.webServices.controllers),wm.plugins.webServices.service(wm.plugins.webServices.services),wm.plugins.webServices.factory(wm.plugins.webServices.factories),wm.plugins.webServices.constant("WS_SERVICE_URLS",{WebService:{invokeRestCall:{url:"services/projects/:projectID/restservices/invoke",method:"POST"},generateRESTWsdlSettings:{url:"services/projects/:projectID/restservice/settings",method:"POST"},buildRestService:{url:"services/projects/:projectID/restservice",method:"POST"},updateRestService:{url:"services/projects/:projectID/restservice",method:"PUT"},importWSDL:{url:"services/projects/:projectID/soapservice/import",method:"POST"},uploadWSDL:{url:"services/projects/:projectID/soapservice/import",method:"POST",headers:{"Content-Type":void 0},transformRequest:WM.identity},registerFeedService:{url:"services/projects/:projectID/feed/register",method:"POST"},getRESTDetails:{url:"services/projects/:projectID/restservice/:serviceID",method:"GET"},getWSDL:{url:"services/projects/:projectID/soapservice/:serviceID/wsdl",method:"GET"},getBindingProperties:{url:"services/projects/:projectID/services/:serviceID/properties",method:"GET"},setBindingProperties:{url:"services/projects/:projectID/services/:serviceID/properties",method:"POST"},listTypes:{url:"services/projects/:projectID/services/types",method:"GET"},listPrefabTypes:{url:"services/projects/:projectID/prefabs/:prefabName/types",method:"GET"},listServicesWithType:{url:"services/projects/:projectID/services",method:"GET"},getServiceMethods:{url:"services/projects/:projectID/services/:serviceID/operations",method:"GET"},getServiceOperationParams:{url:"services/projects/:projectID/services/:serviceID/operations/:operationID",method:"GET"},invoke:{url:"/:serviceFile",method:"POST"},invokeRestService:{url:"/services/:serviceID/:operationID",method:"POST"},invokePrefabRestService:{url:"/:serviceID/:operationID",method:"POST"},remove:{url:"services/projects/:projectID/services/:serviceID",method:"DELETE"},retrieveServiceOperations:{url:"services/projects/:projectId/services/:serviceId/servicedef",method:"GET"},invokeRuntimeRestCall:{url:""},buildApiRestService:{url:"services/restservices/create",method:"POST"},getSoapServiceSettings:{url:"services/projects/:projectId/soapservice/:serviceId/settings",method:"GET"},setSoapServiceSettings:{url:"services/projects/:projectId/soapservice/:serviceId/settings",method:"POST"},configureWebSocketService:{url:"services/projects/:projectID/websocketservice/settings",method:"POST"},buildWebSocketService:{url:"services/projects/:projectID/websocketservice",method:"POST"},updateWebSocketService:{url:"services/projects/:projectID/websocketservice",method:"PUT"},getWebSocketServiceDetails:{url:"services/projects/:projectID/websocketservice/:serviceID",method:"GET"}}}),wm.plugins.webServices.constant("WS_CONSTANTS",{WEBSERVICE_WORKSPACE_TYPE:"ws",HTTP_METHODS:["GET","POST","PUT","HEAD","PATCH","DELETE"],NON_BODY_HTTP_METHODS:["GET","HEAD"],PRIMITIVE_DATA_TYPES:["number","integer","string","boolean","file"],OPERATION_NAME_KEY:"x-WM-METHOD_NAME",CONTENT_TYPES:{FORM_URL_ENCODED:"application/x-www-form-urlencoded",MULTIPART_FORMDATA:"multipart/form-data",OCTET_STREAM:"application/octet-stream"},CONTROLLER_NAMES:{QUERY_CONTROLLER:"QueryExecutionController",PROCEDURE_CONTROLLER:"ProcedureExecutionController"},HTTP_STATUS_CODE:{CORS_FAILURE:-1}}),wm.plugins.webServices.config(function(BaseServiceManagerProvider,WS_SERVICE_URLS){"use strict";BaseServiceManagerProvider.register(WS_SERVICE_URLS)}),wm.plugins.webServices.services.WebService=function(BaseService){"use strict";return{testRestService:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"invokeRestCall",data:connectionParams.data,urlParams:connectionParams.urlParams,headers:connectionParams.headers},successCallback,failureCallback)},populateRestService:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"generateRESTWsdlSettings",data:connectionParams.data,urlParams:connectionParams.urlParams},successCallback,failureCallback)},buildRestService:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"buildRestService",data:connectionParams.data,urlParams:connectionParams.urlParams},successCallback,failureCallback)},updateRestService:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"updateRestService",data:connectionParams.data,urlParams:connectionParams.urlParams},successCallback,failureCallback)},importWSDL:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"importWSDL",params:connectionParams.params,urlParams:connectionParams.urlParams},successCallback,failureCallback)},uploadWSDL:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"uploadWSDL",params:connectionParams.params,urlParams:connectionParams.urlParams,data:connectionParams.content},successCallback,failureCallback)},listServicesWithType:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"listServicesWithType",urlParams:urlParams},successCallback,failureCallback)},getServiceOperations:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"getServiceMethods",urlParams:urlParams},successCallback,failureCallback)},getServiceOperationParams:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"getServiceOperationParams",urlParams:urlParams},successCallback,failureCallback)},getRESTDetails:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"getRESTDetails",urlParams:urlParams},successCallback,failureCallback);
},getSoapServiceSettings:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"getSoapServiceSettings",urlParams:urlParams},successCallback,failureCallback)},setSoapServiceSettings:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"setSoapServiceSettings",data:connectionParams.data,urlParams:connectionParams.urlParams},successCallback,failureCallback)},getWSDL:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"getWSDL",urlParams:urlParams},successCallback,failureCallback)},getBindingProperties:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"getBindingProperties",urlParams:urlParams},successCallback,failureCallback)},setBindingProperties:function(urlParams,data,successCallback,failureCallback){BaseService.send({target:"WebService",action:"setBindingProperties",urlParams:urlParams,data:data},successCallback,failureCallback)},listTypes:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"listTypes",urlParams:urlParams},successCallback,failureCallback)},listPrefabTypes:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"listPrefabTypes",urlParams:urlParams},successCallback,failureCallback)},registerFeedService:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"registerFeedService",urlParams:connectionParams},successCallback,failureCallback)},invoke:function(connectionParams,successCallback,failureCallback){return BaseService.send({target:"WebService",action:"invoke",urlParams:{serviceFile:connectionParams.serviceFile},data:{id:123,method:connectionParams.method,params:connectionParams.params},config:{url:connectionParams.url},byPassResult:!0},successCallback,failureCallback)},invokeRestService:function(connectionParams,successCallback,failureCallback){return BaseService.send({target:"WebService",action:connectionParams.target,data:connectionParams.params[2],urlParams:{serviceID:connectionParams.params[0],operationID:connectionParams.params[1]},config:{url:connectionParams.url},byPassResult:!0},successCallback,failureCallback)},remove:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"remove",urlParams:urlParams},successCallback,failureCallback)},retrieveServiceOperations:function(params,successCallback,failureCallback){BaseService.send({target:"WebService",action:"retrieveServiceOperations",urlParams:params.urlParams},successCallback,failureCallback)},invokeJavaService:function(params,successCallback,failureCallback){BaseService.send({target:"WebService",action:"invokeRuntimeRestCall",method:params.method,config:{url:params.url,method:params.method,headers:params.headers},data:params.dataParams||void 0,isDirectCall:params.isDirectCall,byPassResult:!0,isExtURL:params.isExtURL},successCallback,failureCallback)},buildApiRestService:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"buildApiRestService",data:connectionParams},successCallback,failureCallback)},configureWebSocketService:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"configureWebSocketService",data:connectionParams.data,urlParams:connectionParams.urlParams},successCallback,failureCallback)},buildWebSocketService:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"buildWebSocketService",data:connectionParams.data,urlParams:connectionParams.urlParams},successCallback,failureCallback)},updateWebSocketService:function(connectionParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"updateWebSocketService",data:connectionParams.data,urlParams:connectionParams.urlParams},successCallback,failureCallback)},getWebSocketServiceDetails:function(urlParams,successCallback,failureCallback){BaseService.send({target:"WebService",action:"getWebSocketServiceDetails",urlParams:urlParams},successCallback,failureCallback)}}},wm.plugins.webServices.factories.ServiceFactory=["WebService","wmToaster","$rootScope","Utils","VARIABLE_CONSTANTS","WS_CONSTANTS",function(WebService,wmToaster,$rootScope,Utils,VARIABLE_CONSTANTS,WS_CONSTANTS){"use strict";var services=[],projectId=$rootScope.project&&$rootScope.project.id,requestQueue={services:[],operations:{},serviceDef:{},prefabTypes:{}},serviceDefMap={},supportedOperations=WS_CONSTANTS.HTTP_METHODS.map(function(method){return method.toLowerCase()}),primitiveDataTypes=WS_CONSTANTS.PRIMITIVE_DATA_TYPES,IS_LIST_KEY="x-WM-IS_LIST",FULLY_QUALIFIED_NAME_KEY="x-WM-FULLY_QUALIFIED_NAME",parameterTypeKey="in",AUTH_TYPE_KEY="WM_Rest_Service_Authorization",prefabDataTypes={},getServiceObjectByName=function(name){var serviceObject={operations:[]};return WM.forEach(services,function(serviceObj){serviceObj.name===name&&(serviceObject=serviceObj)}),serviceObject},getServiceOperationObjectById=function(serviceName,operationId){var serviceObj=getServiceObjectByName(serviceName);return(operationId?_.find(serviceObj.operations,{operationId:operationId}):serviceObj.operations[0])||{}},resetServiceOperations=function(serviceName){getServiceObjectByName(serviceName).operations.length=0},getServicesWithType=function(successCallBack,reloadFlag){if(reloadFlag=!(!reloadFlag||"false"===reloadFlag),services.length>0&&!reloadFlag)return void Utils.triggerFn(successCallBack,services);if(requestQueue.services=requestQueue.services||[],requestQueue.services.push(successCallBack),!(requestQueue.services.length>1)){var urlParams={projectID:projectId||$rootScope.project.id};WebService.listServicesWithType(urlParams,function(response){response=Utils.sort(response,"name"),services=[],WM.forEach(response,function(serviceObj){services.push({type:serviceObj.type,name:serviceObj.name,url:serviceObj.url,operations:[]})}),WM.forEach(requestQueue.services,function(fn){Utils.triggerFn(fn,services)}),requestQueue.services=null},function(){wmToaster.show("error",$rootScope.locale.MESSAGE_ERROR_TITLE,$rootScope.locale.MESSAGE_ERROR_FETCH_WEB_DATA_SERVICES_DESC)})}},getServiceDef=function(serviceId,success,error,forceReload){var callback,urlParams={urlParams:{serviceId:serviceId,projectId:$rootScope.project.id}};return serviceDefMap[serviceId]&&!forceReload?void Utils.triggerFn(success,serviceDefMap[serviceId]):(requestQueue.serviceDef[serviceId]=requestQueue.serviceDef[serviceId]||[],requestQueue.serviceDef[serviceId].push({success:success,error:error}),void(requestQueue.serviceDef[serviceId].length>1||(forceReload&&resetServiceOperations(serviceId),WebService.retrieveServiceOperations(urlParams,function(response){for(response.paths=Utils.sort(response.paths,"x-WM-COMPLETE_PATH"),serviceDefMap[serviceId]=response;;)if(callback=requestQueue.serviceDef[serviceId].shift(),Utils.triggerFn(callback&&callback.success,response),!requestQueue.serviceDef[serviceId].length)break},function(errMsg){for(;;)if(callback=requestQueue.serviceDef[serviceId].shift(),Utils.triggerFn(callback&&callback.error,errMsg),!requestQueue.serviceDef[serviceId].length)break}))))},getFullyQualifiedName=function(refValue,definitions){var returnType;return refValue=refValue.split("/").pop(),returnType=definitions[refValue],returnType=returnType?returnType[FULLY_QUALIFIED_NAME_KEY]:"Object"},getReturnType=function(responseObject,definitions){var type;return responseObject.type?primitiveDataTypes.indexOf(responseObject.type)!==-1?responseObject.type:"array"===responseObject.type?(responseObject[IS_LIST_KEY]?responseObject.items.type?type=responseObject.items.type:responseObject.items.$ref&&(type=getFullyQualifiedName(responseObject.items.$ref,definitions)):responseObject.items.type?type=responseObject.items.type:responseObject.items.$ref&&(type=getFullyQualifiedName(responseObject.items.$ref,definitions)),type):void 0:getFullyQualifiedName(responseObject.$ref,definitions)},isRESTSupported=function(type){return VARIABLE_CONSTANTS.REST_SUPPORTED_SERVICES.indexOf(type)!==-1},isBodyTypeQueryProcedure=function(variable){return _.includes(["QueryExecution","ProcedureExecution"],variable.controller)&&_.includes(["put","post"],variable.operationType)},getRawParams=function(operationObj,definitions){var refValue=_.get(operationObj,["parameters",0,"schema","$ref"]),refKey=_.last(_.split(refValue,"/")),defObj=definitions[refKey],operationList=[];return _.forEach(defObj.properties,function(value,key){value.name=key,value[parameterTypeKey]=VARIABLE_CONSTANTS.BODY_FIELD,value.required=_.includes(defObj.required,key),operationList.push(value)}),operationList},processOperations=function(serviceObj,operations,swagger){function getFormatFromMap(format){var MAP={int32:"integer",int64:"long"};return MAP[format]||format}var paramsKey,definitions,securityDefinitions,schemaObject,typeArgumentsObject,isRestSupportedService=isRESTSupported(serviceObj.type);serviceObj.operations=[],isRestSupportedService&&(definitions=swagger.definitions,securityDefinitions=swagger.securityDefinitions),WM.forEach(operations,function(operation){var isList,typeRef,format,returnObj,returnType,returnFormat,rawParameters,operationObject={},isDbServiceOp=function(type){return"hqlquery"===type||"nativequery"===type||"procedure"===type};isDbServiceOp(operation.operationType)?returnType=operation.return:(operation.responses&&operation.responses[200].schema?(schemaObject=operation.responses[200].schema,typeArgumentsObject=schemaObject["x-WM-TYPE_ARGUMENTS"],isList="#/definitions/Page"===schemaObject.$ref,typeArgumentsObject&&typeArgumentsObject[0]&&(schemaObject=typeArgumentsObject[0]),returnType=getReturnType(schemaObject,definitions),returnFormat=schemaObject.format,isList||(isList=schemaObject.type&&"array"===schemaObject.type)):returnType=_.isEmpty(operation["x-WM-OUT-PARAMS-TYPE"])?"void":getFullyQualifiedName(operation["x-WM-OUT-PARAMS-TYPE"][0],definitions),returnFormat=getFormatFromMap(returnFormat)),isRestSupportedService?(returnObj={typeRef:returnType},paramsKey="parameters"):(returnObj=returnType,paramsKey="parameter",IS_LIST_KEY="isList",parameterTypeKey="parameterType"),operationObject={name:operation[WS_CONSTANTS.OPERATION_NAME_KEY]||operation.operationId||operation.name,operationType:operation.operationType||null,parameter:void 0,isList:isList,return:returnObj,returnFormat:returnFormat,controller:operation.tags&&operation.tags[0].replace(/Controller$/,""),operationId:operation.operationId,deprecated:operation.deprecated},serviceObj.operations.push(operationObject),WM.element.isEmptyObject(operation[paramsKey])?operationObject.parameter=[]:(operationObject.parameter=[],rawParameters=isBodyTypeQueryProcedure(operationObject)?getRawParams(operation,definitions):operation[paramsKey],WM.forEach(rawParameters,function(param){isList=param[IS_LIST_KEY],"formdata"===_.lowerCase(param[parameterTypeKey])?"ref"===param.type?typeRef=param["x-WM-FULLY_QUALIFIED_TYPE"]:"array"===param.type?(isList=!0,typeRef=param.items&&param.items.type):typeRef=param.type:param.type?"array"===param.type?(isList=!0,typeRef=param.items&&param.items.type,format=param.items&&param.items.format):(typeRef=param.type,format=param.format):param.schema?(isList="array"===param.schema.type,typeRef=getReturnType(param.schema,definitions),format=param.schema.format):param.items&&(typeRef=getReturnType(param.items,definitions)),format=getFormatFromMap(format),operationObject.parameter.push({name:param.name,typeRef:typeRef,format:format,isList:isList,parameterType:param[parameterTypeKey]})})),_.isEmpty(operation["x-WM-IN-PARAMS-TYPE"])||(operationObject.parameter=operationObject.parameter||[],operationObject.parameter.push({name:"RequestBody",typeRef:getFullyQualifiedName(operation["x-WM-IN-PARAMS-TYPE"][0],definitions),parameterType:"BODY"})),securityDefinitions&&securityDefinitions[AUTH_TYPE_KEY]&&"basic"===securityDefinitions[AUTH_TYPE_KEY].type&&operation.security[0][AUTH_TYPE_KEY]&&(operationObject.parameter||(operationObject.parameter=[]),operationObject.parameter.push({name:"wm_auth_username",parameterType:"auth"}),operationObject.parameter.push({name:"wm_auth_password",parameterType:"auth"}))})},getServiceOperations=function(serviceId,successCallBack,reloadFlag){if(serviceId&&""!==serviceId){reloadFlag=!(!reloadFlag||"false"===reloadFlag);var urlParams,operations,serviceObj=getServiceObjectByName(serviceId),onOperationsFetch=function(operations,swagger){processOperations(serviceObj,operations,swagger);for(var callback;;)if(callback=requestQueue.operations[serviceId].shift(),Utils.triggerFn(callback&&callback.success,serviceObj.operations),!requestQueue.operations[serviceId].length)break},onOperationFetchError=function(){for(;;)if(requestQueue.operations[serviceId].shift(),!requestQueue.operations[serviceId].length)break};if(serviceObj.operations.length>0&&!reloadFlag)return void Utils.triggerFn(successCallBack,serviceObj.operations);requestQueue.operations[serviceId]=requestQueue.operations[serviceId]||[],requestQueue.operations[serviceId].push({success:successCallBack}),requestQueue.operations[serviceId].length>1||(isRESTSupported(serviceObj.type)?(operations=[],getServiceDef(serviceId,function(response){WM.forEach(response.paths,function(path){WM.forEach(supportedOperations,function(operation){path[operation]&&(path[operation].operationType=operation,path[operation].relativePath=path["x-WM-RELATIVE_PATH"],path[operation].tags&&path[operation].tags[0]===WS_CONSTANTS.CONTROLLER_NAMES.PROCEDURE_CONTROLLER?path[operation].serviceSubType="procedure":path[operation].tags&&path[operation].tags[0]===WS_CONSTANTS.CONTROLLER_NAMES.QUERY_CONTROLLER&&(path[operation].serviceSubType="query"),operations.push(path[operation]))})}),onOperationsFetch(operations,response)},function(){wmToaster.show("error",$rootScope.locale.MESSAGE_ERROR_TITLE,$rootScope.locale.MESSAGE_ERROR_FETCH_SERVICE_METHODS_DESC),onOperationFetchError()},reloadFlag)):(urlParams={projectID:projectId||$rootScope.project.id,serviceID:serviceId},WebService.getServiceOperations(urlParams,function(response){onOperationsFetch(response)},function(){wmToaster.show("error",$rootScope.locale.MESSAGE_ERROR_TITLE,$rootScope.locale.MESSAGE_ERROR_FETCH_SERVICE_METHODS_DESC),onOperationFetchError()})))}},getServiceOperationParams=function(serviceId,operationId,successCallBack,reloadFlag){if(!_.isEmpty(serviceId)){reloadFlag=!(!reloadFlag||"false"===reloadFlag);var urlParams,serviceObj=getServiceObjectByName(serviceId),operationObj=getServiceOperationObjectById(serviceId,operationId),onOperationParamsFetch=function(){Utils.triggerFn(successCallBack,operationObj)};return operationObj.parameter&&!reloadFlag?void Utils.triggerFn(successCallBack,operationObj):void(isRESTSupported(serviceObj.type)?getServiceOperations(serviceId,function(){operationObj=getServiceOperationObjectById(serviceId,operationId),Utils.triggerFn(successCallBack,operationObj)},!0):(urlParams={projectID:projectId||$rootScope.project.id,serviceID:serviceId,operationID:operationId},WebService.getServiceOperationParams(urlParams,function(response){onOperationParamsFetch(response)},function(){wmToaster.show("error",$rootScope.locale.MESSAGE_ERROR_TITLE,$rootScope.locale.MESSAGE_ERROR_FETCH_SERVICE_METHOD_PARAMS_DESC)})))}},addService=function(service){var serviceExists=!1;return WM.forEach(services,function(existingService){service.name===existingService.name&&service.type===existingService.type&&(serviceExists=!0)}),serviceExists||services.push({name:service.name,type:service.type,operations:[],url:service.url||"/services/"+service.name,sampleResponse:service.sampleResponse}),!serviceExists},getSampleResponse=function(serviceId){var service=getServiceObjectByName(serviceId);return service.sampleResponse},setSampleResponse=function(serviceId,response){var service=getServiceObjectByName(serviceId);service.sampleResponse=response},getPrefabTypes=function(prefabName,success){return prefabDataTypes[prefabName]?void Utils.triggerFn(success,prefabDataTypes[prefabName]):(requestQueue.prefabTypes[prefabName]=requestQueue.prefabTypes[prefabName]||[],requestQueue.prefabTypes[prefabName].push(success),void(requestQueue.prefabTypes[prefabName].length>1||WebService.listPrefabTypes({projectID:$rootScope.project.id,prefabName:prefabName},function(response){prefabDataTypes[prefabName]=response.types,WM.forEach(requestQueue.prefabTypes[prefabName],function(fn){Utils.triggerFn(fn,prefabDataTypes[prefabName])}),requestQueue.prefabTypes[prefabName]=null})))};return{getServicesWithType:getServicesWithType,getServiceOperations:getServiceOperations,getServiceOperationParams:getServiceOperationParams,add:addService,getServiceObjectByName:getServiceObjectByName,getSampleResponse:getSampleResponse,setSampleResponse:setSampleResponse,getServiceDef:getServiceDef,getPrefabTypes:getPrefabTypes,isBodyTypeQueryProcedure:isBodyTypeQueryProcedure}}],wm.plugins.security=WM.module("wm.plugins.security",[]),wm.plugins.security.controllers={},wm.plugins.security.services={},wm.plugins.security.factories={},wm.plugins.security.directives={},wm.plugins.security.controller(wm.plugins.security.controllers),wm.plugins.security.service(wm.plugins.security.services),wm.plugins.security.factory(wm.plugins.security.factories),wm.plugins.security.directive(wm.plugins.security.directives),wm.plugins.security.constant("SECURITY_URLS",{Security:{getMethods:{url:"services/projects/:projectID/services/securityService/operations",method:"GET"},getGeneralOptions:{url:"services/projects/:projectID/securityservice/general",method:"GET"},setGeneralOptions:{url:"services/projects/:projectID/securityservice/general",method:"POST"},configDemo:{url:"services/projects/:projectID/securityservice/providers/demo",method:"POST"},getDemoOptions:{url:"services/projects/:projectID/securityservice/providers/demo",method:"GET"},configDatabase:{url:"services/projects/:projectID/securityservice/providers/database",method:"POST"},getDatabaseOptions:{url:"services/projects/:projectID/securityservice/providers/database",method:"GET"},configAD:{url:"services/projects/:projectID/securityservice/providers/activedirectory",method:"POST"},getADOptions:{url:"services/projects/:projectID/securityservice/providers/activedirectory",method:"GET"},configLDAP:{url:"services/projects/:projectID/securityservice/providers/ldap",method:"POST"},getLDAPOptions:{url:"services/projects/:projectID/securityservice/providers/ldap",method:"GET"},testLDAPConnection:{url:"services/projects/:projectID/securityservice/providers/ldap/testconnection",method:"POST"},getCASOptions:{url:"services/projects/:projectID/securityservice/providers/cas",method:"GET"},configCAS:{url:"services/projects/:projectID/securityservice/providers/cas",method:"POST"},getSAMLOptions:{url:"services/projects/:projectID/securityservice/providers/saml",method:"GET"},configSAML:{url:"services/projects/:projectID/securityservice/providers/saml",method:"POST"},loadIdpMatadata:{url:"services/projects/:projectID/securityservice/providers/saml/loadidpmetadata?idpMetadataUrl=:idpMetadataUrl",method:"get"},configCustomAuth:{url:"services/projects/:projectID/securityservice/providers/customauth",method:"POST"},getCustomAuthOptions:{url:"services/projects/:projectID/securityservice/providers/customauth",method:"GET"},getPortMapping:{url:"services/projects/:projectID/securityservice/portmapping",method:"GET"},getSecurityInterceptURLs:{url:"services/projects/:projectID/securityservice/intercepturls",method:"GET"},setSecurityInterceptURLs:{url:"services/projects/:projectID/securityservice/intercepturls",method:"POST"},getRoles:{url:"services/projects/:projectID/securityservice/roles",method:"GET"},setRoles:{url:"services/projects/:projectID/securityservice/roles",method:"POST"},getRolesConfig:{url:"services/projects/:projectID/securityservice/rolesconfig",method:"GET"},setRolesConfig:{url:"services/projects/:projectID/securityservice/rolesconfig",method:"POST"},appLogin:{url:"j_spring_security_check",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}},appLogout:{url:"j_spring_security_logout",method:"POST"},getLoggedInUser:{url:"services/security/user",method:"GET"},getConfig:{url:"services/security/info",method:"GET"},getMobileConfig:{url:"metadata/app/security-config.json",method:"GET"},configCustomSecurity:{url:"services/projects/:projectID/securityservice/providers/customauth",method:"POST"},getCustomSecurityConfig:{url:"services/projects/:projectID/securityservice/providers/customauth",method:"GET"},testADConnection:{url:"services/projects/:projectID/securityservice/providers/ad/testconnection",method:"POST"},getPolicyConfig:{url:"services/projects/:projectID/securityservice/xss/policy",method:"GET"},setPolicyConfig:{url:"services/projects/:projectID/securityservice/xss/policy",method:"PUT"}}}),wm.plugins.security.config(function(BaseServiceManagerProvider,SECURITY_URLS){"use strict";BaseServiceManagerProvider.register(SECURITY_URLS)}),wm.plugins.security.services.SecurityService=["BaseService","Utils","$rootScope","CONSTANTS","$q",function(BaseService,Utils,$rs,CONSTANTS,$q){"use strict";var _roles,_rolesConfig,_interceptUrls,_generalOptions,_lastUser,_config,_mobileconfig,loggedInUser,requestQueue={config:[]},_serviceMap={},onLoginCallbacks=[],mergeWebAndMobileConfig=function(webconfig){var userRoles,roleObj,userInfo=webconfig.userInfo,roles=_mobileconfig.roles,finalConfig=_.extend({},_mobileconfig);return webconfig.authenticated&&userInfo&&(finalConfig.authenticated=!0,userRoles=userInfo.userRoles,roleObj=_.find(roles,function(o){return _.includes(userRoles,o.name)}),roleObj&&(userInfo.landingPage=roleObj.homePage||roleObj.landingPage)),finalConfig.userInfo=userInfo,finalConfig},getMobileConfig=function(success,error){return _mobileconfig?void Utils.triggerFn(success,_mobileconfig):void BaseService.send({target:"Security",action:"getMobileConfig"},function(mobileconfig){_mobileconfig=mobileconfig,Utils.triggerFn(success,_mobileconfig)},error)},getWebConfig=function(success,error){return _config?void Utils.triggerFn(success,_config):void BaseService.send({target:"Security",action:"getConfig"},function(config){_config=config,Utils.triggerFn(success,_config)},error)},getConfig=function(successCallback,failureCallback){function invokeQueuedCallbacks(id,method,data){WM.forEach(requestQueue[id],function(fn){Utils.triggerFn(fn[method],data)}),requestQueue[id]=null}function onSuccess(config){config.homePage=_WM_APP_PROPERTIES.homePage,config.userInfo&&(config.userInfo.homePage=config.userInfo.landingPage),_config=config,loggedInUser=config.userInfo,_lastUser=loggedInUser,invokeQueuedCallbacks("config","success",_config)}function onError(error){$rs.isMobileApplicationType?(_config={securityEnabled:!1,authenticated:!1,homePage:_WM_APP_PROPERTIES.homePage,userInfo:null,login:null},invokeQueuedCallbacks("config","success",_config)):invokeQueuedCallbacks("config","error",error)}return _config?void Utils.triggerFn(successCallback,_config):(requestQueue.config=requestQueue.config||[],requestQueue.config.push({success:successCallback,error:failureCallback}),void(requestQueue.config.length>1||(CONSTANTS.hasCordova?getMobileConfig(function(mobileconfig){mobileconfig.securityEnabled?getWebConfig(function(config){config=mergeWebAndMobileConfig(config),onSuccess(config)},function(){onSuccess(mobileconfig)}):onSuccess(mobileconfig)},onError):getWebConfig(onSuccess,onError))))},setConfig=function(config){_lastUser=loggedInUser,_config=config,loggedInUser=config&&config.userInfo},getLoggedInUser=function(successCallback,failureCallback){loggedInUser?Utils.triggerFn(successCallback,loggedInUser):getConfig(successCallback,failureCallback)};return{getMethods:function(projectID,successCallback,failureCallback){BaseService.send({target:"Security",action:"getMethods",urlParams:{projectID:projectID}},successCallback,failureCallback)},getGeneralOptions:function(projectID,successCallback,failureCallback){_generalOptions?Utils.triggerFn(successCallback,_generalOptions):BaseService.send({target:"Security",action:"getGeneralOptions",urlParams:{projectID:projectID}},function(generalOptions){_generalOptions=generalOptions,Utils.triggerFn(successCallback,generalOptions)},failureCallback)},setGeneralOptions:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"setGeneralOptions",urlParams:{projectID:params.projectID},data:params.config},function(){_generalOptions=params.config,Utils.triggerFn(successCallback)},failureCallback)},cacheGeneralOptions:function(generalOptions){_generalOptions=generalOptions},configDemo:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"configDemo",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},getDemoOptions:function(projectID,successCallback,failureCallback){BaseService.send({target:"Security",action:"getDemoOptions",urlParams:{projectID:projectID}},successCallback,failureCallback)},configDatabase:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"configDatabase",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},getDatabaseOptions:function(projectID,successCallback,failureCallback){BaseService.send({target:"Security",action:"getDatabaseOptions",urlParams:{projectID:projectID}},successCallback,failureCallback)},configAD:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"configAD",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},getADOptions:function(projectID,successCallback,failureCallback){BaseService.send({target:"Security",action:"getADOptions",urlParams:{projectID:projectID}},successCallback,failureCallback)},configLDAP:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"configLDAP",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},getLDAPOptions:function(projectID,successCallback,failureCallback){BaseService.send({target:"Security",action:"getLDAPOptions",urlParams:{projectID:projectID}},successCallback,failureCallback)},testLDAPConnection:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"testLDAPConnection",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},getCASOptions:function(projectID,successCallback,failureCallback){BaseService.send({target:"Security",action:"getCASOptions",urlParams:{projectID:projectID}},successCallback,failureCallback)},configCAS:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"configCAS",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},getSAMLOptions:function(projectID){return BaseService.execute({target:"Security",action:"getSAMLOptions",urlParams:{projectID:projectID}})},configSAML:function(params){return BaseService.execute({target:"Security",action:"configSAML",urlParams:{projectID:params.projectID},data:params.config})},loadIdpMatadata:function(params){return BaseService.execute({target:"Security",action:"loadIdpMatadata",urlParams:{projectID:params.projectID,idpMetadataUrl:params.idpMetadataUrl}})},configCustomAuth:function(projectID,successCallback,failureCallback){BaseService.send({target:"Security",action:"configCustomAuth",urlParams:{projectID:projectID}},successCallback,failureCallback)},getCustomAuthOptions:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"getCustomAuthOptions",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},getPortMapping:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"getPortMapping",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},getSecurityInterceptURLs:function(projectID,successCallback,failureCallback){void 0===_interceptUrls?BaseService.send({target:"Security",action:"getSecurityInterceptURLs",urlParams:{projectID:projectID}},function(response){_interceptUrls=response,Utils.triggerFn(successCallback,response)},failureCallback):Utils.triggerFn(successCallback,_interceptUrls)},clearInterceptUrls:function(serviceName){_.remove(_interceptUrls,function(interceptUrl){return _.includes(interceptUrl.urlPattern,_serviceMap[serviceName])})},setSecurityInterceptURLs:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"setSecurityInterceptURLs",urlParams:{projectID:params.projectID},data:params.config},function(response){_interceptUrls=params.config,Utils.triggerFn(successCallback,response)},failureCallback)},getRoles:function(projectID,successCallback,failureCallback){void 0===_roles?BaseService.send({target:"Security",action:"getRoles",urlParams:{projectID:projectID}},function(response){_roles=response,Utils.triggerFn(successCallback,response)},failureCallback):Utils.triggerFn(successCallback,_roles)},getRolesConfig:function(projectID,forceReload,successCallback,failureCallback){forceReload||!_rolesConfig.length?BaseService.send({target:"Security",action:"getRolesConfig",urlParams:{projectID:projectID}},function(response){_rolesConfig=response,Utils.triggerFn(successCallback,response)},failureCallback):Utils.triggerFn(successCallback,_rolesConfig)},setRolesConfig:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"setRolesConfig",urlParams:{projectID:params.projectID},data:params.config},function(response){_rolesConfig=params.config,Utils.triggerFn(successCallback,response)},failureCallback)},setRoles:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"setRoles",urlParams:{projectID:params.projectID},data:params.config},function(response){_roles=params.config,Utils.triggerFn(successCallback,response)},failureCallback)},appLogin:function(params,successCallback,failureCallback){var rememberme=!WM.isUndefined(params.rememberme)&&params.rememberme,loginParams=["username","password","rememberme"],customParams="";return _.each(params,function(value,name){_.includes(loginParams,name)||(customParams+="&"+encodeURIComponent(name)+"="+encodeURIComponent(value))}),BaseService.send({target:"Security",action:"appLogin",data:"j_username="+encodeURIComponent(params.username)+"&j_password="+encodeURIComponent(params.password)+"&remember-me="+rememberme+customParams},function(response){_.forEach(onLoginCallbacks,Utils.triggerFn),onLoginCallbacks.length=0,Utils.triggerFn(successCallback,response)},failureCallback)},appLogout:function(successCallback,failureCallback){return BaseService.send({target:"Security",action:"appLogout",byPassResult:!0},function(response){_.set(_config,"authenticated",!1),_.set(_config,"userInfo",null),Utils.triggerFn(successCallback,response)},failureCallback)},isAuthenticated:function(successCallback,failureCallback){getConfig(function(config){Utils.triggerFn(successCallback,config.authenticated)},failureCallback)},getUserName:function(successCallback,failureCallback){getLoggedInUser(function(loggedInUser){Utils.triggerFn(successCallback,loggedInUser.userName)},failureCallback)},getUserId:function(successCallback,failureCallback){getLoggedInUser(function(loggedInUser){Utils.triggerFn(successCallback,loggedInUser.userId)},failureCallback)},getTenantId:function(successCallback,failureCallback){getLoggedInUser(function(loggedInUser){Utils.triggerFn(successCallback,loggedInUser.tenantId)},failureCallback)},getUserRoles:function(successCallback,failureCallback){getConfig(function(config){Utils.triggerFn(successCallback,config.userInfo.userRoles,config.authenticated)},failureCallback)},isSecurityEnabled:function(successCallback,failureCallback){
getConfig(function(loggedInUser){Utils.triggerFn(successCallback,config.securityEnabled)},failureCallback)},configCustomSecurity:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"configCustomSecurity",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},getCustomSecurityConfig:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"getCustomSecurityConfig",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},getPolicyConfig:function(projectID){var deferred=$q.defer();return BaseService.execute({target:"Security",action:"getPolicyConfig",urlParams:{projectID:projectID}},deferred.resolve,deferred.reject),deferred.promise},setPolicyConfig:function(params){BaseService.send({target:"Security",action:"setPolicyConfig",urlParams:{projectID:params.projectID},data:params.config})},testADConnection:function(params,successCallback,failureCallback){BaseService.send({target:"Security",action:"testADConnection",urlParams:{projectID:params.projectID},data:params.config},successCallback,failureCallback)},setLoggedInUser:function(user){_lastUser=loggedInUser,loggedInUser=user},updateCachedRolesInfo:function(rolesConfig){WM.isArray(rolesConfig)&&rolesConfig.length&&(_rolesConfig=rolesConfig,_roles=_.map(rolesConfig,"name"))},getLastLoggedInUser:function(){return _lastUser&&_lastUser.userName},getConfig:getConfig,setConfig:setConfig,setServices:function(serviceMap){_serviceMap=serviceMap},onUserLogin:function(){var deferred=$q.defer();return getConfig(function(config){config.securityEnabled?config.authenticated?deferred.resolve():onLoginCallbacks.push(deferred.resolve):deferred.resolve()}),deferred.promise}}}],wm.variables.services.LoginVariableService=["Variables","BaseVariablePropertyFactory","SecurityService","Utils","$window","$rootScope","VARIABLE_CONSTANTS","CONSTANTS","$location","BaseService","DialogService",function(Variables,BaseVariablePropertyFactory,SecurityService,Utils,$window,$rootScope,VARIABLE_CONSTANTS,CONSTANTS,$location,BaseService,DialogService){"use strict";var methods,loginVariableObj,initiateCallback,login=function(options,success,error){options=options||{},options.scope=this.activeScope||options.scope,methods.login(this,options,success,error)};return initiateCallback=Variables.initiateCallback,methods={login:function(variable,options,success,error){var errMsg,paramKey,output,params={},variableEvents=VARIABLE_CONSTANTS.EVENTS,loginInfo={};loginInfo=options.loginInfo?options.loginInfo:variable.dataBinding;for(paramKey in loginInfo){if(loginInfo.hasOwnProperty(paramKey)&&(""===loginInfo[paramKey]||void 0===loginInfo[paramKey])&&"rememberme"!==paramKey){errMsg="Please provide "+paramKey+".";break}params[paramKey]=loginInfo[paramKey]}if(errMsg)return void(CONSTANTS.isRunMode&&(Utils.triggerFn(error,errMsg),initiateCallback("onError",variable,errMsg)));if(output=initiateCallback(VARIABLE_CONSTANTS.EVENT.BEFORE_UPDATE,variable,params),_.isObject(output))params=output;else if(output===!1)return;$rootScope.$emit("toggle-variable-state",variable.name,!0),variable.promise=SecurityService.appLogin(params,function(response){$rootScope.$emit("toggle-variable-state",variable.name,!1);var redirectUrl=response&&response.url?response.url:"index.html",appManager=Utils.getService("AppManager"),lastLoggedinUser=SecurityService.getLastLoggedInUser();DialogService.close("CommonLoginDialog"),CONSTANTS.isRunMode&&appManager.resetSecurityConfig().then(function(config){$rootScope.isUserAuthenticated=!0,Utils.triggerFn(success),WM.forEach(variableEvents,function(event){"onError"!==event&&event!==VARIABLE_CONSTANTS.EVENT.BEFORE_UPDATE&&initiateCallback(event,variable,_.get(config,"userInfo"))});var redirectPage=$location.search().redirectTo;$location.search("redirectTo",void 0),variable.useDefaultSuccessHandler&&(lastLoggedinUser&&lastLoggedinUser!==params.username||BaseService.executeErrorCallStack(),CONSTANTS.hasCordova&&_.includes(redirectUrl,"/")&&(redirectUrl=redirectUrl.substr(redirectUrl.lastIndexOf("/")+1)),redirectPage&&WM.isString(redirectPage)?lastLoggedinUser&&lastLoggedinUser!==params.username?$window.location=$window.location.pathname:$location.path(redirectPage):"dialog"!==options.mode||lastLoggedinUser===params.username||$rootScope._noRedirect?"dialog"!==options.mode&&appManager.navigateOnLogin():$window.location=$window.location.pathname),$rootScope._noRedirect=void 0})},function(errorMsg){$rootScope.$emit("toggle-variable-state",variable.name,!1),errorMsg=errorMsg||"Invalid credentials.",CONSTANTS.isRunMode&&initiateCallback("onError",variable,errorMsg),Utils.triggerFn(error,errorMsg)})},cancel:function(variable){variable.promise&&variable.promise.abort()}},loginVariableObj={login:login,invoke:login,cancel:function(){return methods.cancel(this)}},BaseVariablePropertyFactory.register("wm.LoginVariable",loginVariableObj,["wm.Variable","wm.ServiceVariable"],methods),{}}];wm.variables.services.LogoutVariableService=["Variables","BaseVariablePropertyFactory","SecurityService","Utils","$window","$location","CONSTANTS","VARIABLE_CONSTANTS","$rootScope","$timeout",function(Variables,BaseVariablePropertyFactory,SecurityService,Utils,$window,$location,CONSTANTS,VARIABLE_CONSTANTS,$rootScope,$timeout){"use strict";function onLogoutSuccess(){$rootScope.$emit("app-logout-success")}var methods,logoutVariableObj,initiateCallback,logout=function(options,success,error){options=options||{},options.scope=options.scope||this.activeScope,methods.logout(this,options,function(){onLogoutSuccess(),Utils.triggerFn(success)},error)};return initiateCallback=Variables.initiateCallback,methods={logout:function(variable,options,success,error){var handleError,redirectPage,appManager,variableEvents=VARIABLE_CONSTANTS.EVENTS,logoutErrorMessage="No authenticated user to logout.";handleError=function(msg){CONSTANTS.isRunMode&&initiateCallback("onError",variable,msg),Utils.triggerFn(error,msg)},$rootScope.$emit("toggle-variable-state",variable.name,!0),SecurityService.isAuthenticated(function(isAuthenticated){$rootScope.$emit("toggle-variable-state",variable.name,!1),isAuthenticated?variable.promise=SecurityService.appLogout(function(redirectUrl){redirectUrl=Utils.getValidJSON(redirectUrl),redirectUrl?$window.location.href=redirectUrl.result:variable.useDefaultSuccessHandler?(redirectPage=variable.redirectTo,redirectPage&&"login.html"!==redirectPage&&"index.html"!==redirectPage||(redirectPage=""),$location.url(redirectPage),$timeout(function(){$window.location.reload()})):CONSTANTS.isRunMode&&(appManager=Utils.getService("AppManager"),appManager.resetSecurityConfig().then(function(){WM.forEach(variableEvents,function(event){"onError"!==event&&initiateCallback(event,variable)})})),$rootScope.isUserAuthenticated=!1,Utils.triggerFn(success)},handleError):handleError()},function(){$rootScope.$emit("toggle-variable-state",variable.name,!1),handleError(logoutErrorMessage)})},cancel:function(variable){variable.promise&&variable.promise.abort()}},logoutVariableObj={logout:logout,invoke:logout,cancel:function(){return methods.cancel(this)}},BaseVariablePropertyFactory.register("wm.LogoutVariable",logoutVariableObj,["wm.Variable","wm.ServiceVariable"],methods),{}}];wm.variables.services.TimerVariableService=["Variables","BaseVariablePropertyFactory","$rootScope","$interval","$timeout","CONSTANTS",function(Variables,BaseVariablePropertyFactory,$rootScope,$interval,$timeout,CONSTANTS){"use strict";var methods,timerVariableObj,initiateCallback,DEFAULT_TIMER_DELAY=500,fire=function(success,error){return methods.fire(this,{scope:this.activeScope},success,error)};return initiateCallback=Variables.initiateCallback,methods={fire:function(variable,options,success,error){if(!WM.isDefined(variable._promise)&&!CONSTANTS.isStudioMode){var repeatTimer=variable.repeating,delay=variable.delay||DEFAULT_TIMER_DELAY,event="onTimerFire",callBackScope=options.scope||$rootScope,exec=function(){initiateCallback(event,variable)};return variable._promise=repeatTimer?$interval(exec,delay):$timeout(function(){exec(),variable._promise=void 0},delay),callBackScope.$on("$destroy",function(){variable.cancel(variable._promise)}),variable._promise}},cancel:function(variable,options){var status;return WM.isDefined(variable._promise)&&(status=variable.repeating?$interval.cancel(variable._promise):$timeout.cancel(variable._promise),variable._promise=void 0),status}},timerVariableObj={fire:fire,invoke:fire,cancel:function(){return methods.cancel(this)}},BaseVariablePropertyFactory.register("wm.TimerVariable",timerVariableObj,[],methods),{}}],WM.module("i18n",[]),WM.module("i18n").service("i18nService",["$rootScope","Utils","$http","$locale","CONSTANTS","$q",function($rs,Utils,$http,$locale,CONSTANTS,$q){"use strict";function extendLocale(dst,src){dst.id=src.id,dst.pluralCat=src.pluralCat,["DATETIME_FORMATS","NUMBER_FORMATS"].forEach(function(type){_.keys(src[type]).forEach(function(key){dst[type][key]=src[type][key]})})}function loadComponentLocaleBundles(){var deferred=$q.defer(),count=_componentLocalePaths.length,content={};return count||deferred.resolve(content),_componentLocalePaths.forEach(function(path){path+=_selectedLocale+".json",$http.get(path).then(function(response){WM.extend(content,response),count--,count||deferred.resolve(content)},deferred.resolve)}),deferred.promise}function loadAppLocaleBundle(content){var path=_appLocaleRootPath+_selectedLocale+".json";return $http.get(path).success(function(response){WM.extend($rs[localeKey],response,content)})}function loadNgLocaleBundle(){var deferred=$q.defer(),ngLocaleFilePath=_ngLocaleRootPath;return ngLocaleFilePath||deferred.resolve(),ngLocaleFilePath+="angular-locale_"+_selectedLocale+".js",WM.element.ajax({dataType:"script",url:ngLocaleFilePath,cache:!0}).done(function(){extendLocale($locale,WM.injector(["ngLocale"]).get("$locale")),deferred.resolve()}),deferred.promise}function loadMomentLocaleBundle(){var path,deferred=$q.defer();return _appLocaleRootPath&&"en"!==_selectedLocale?(path=_momentLocalePath+_selectedLocale+".js",WM.element.ajax({dataType:"script",url:path,cache:!0}).always(function(){moment.locale(_selectedLocale),deferred.resolve()}),deferred.promise):(moment.locale("en"),deferred.resolve(),deferred.promise)}function loadLocaleBundles(emitEvent){loadNgLocaleBundle().then(loadComponentLocaleBundles).then(loadAppLocaleBundle).then(loadMomentLocaleBundle).then(function(){$rs.selectedLocale=_selectedLocale,emitEvent&&$rs.$emit("locale-change")})}function setSelectedLocale(locale){_initSuccess&&_.includes(_supportedLocale,locale)&&locale&&locale!==_selectedLocale&&(_selectedLocale=locale,$rs[localeKey]={},loadLocaleBundles(!0))}function getDefaultLocale(){return _defaultLocale}function getSelectedLocale(){return _selectedLocale}function init(supportedLocale,defaultLocale,appLocaleRootPath,ngLocaleRootPath,momentLocaleRootPath){supportedLocale&&WM.isArray(supportedLocale)&&supportedLocale.length&&(_supportedLocale=supportedLocale,appLocaleRootPath&&appLocaleRootPath.length&&(_appLocaleRootPath=appLocaleRootPath,_defaultLocale=defaultLocale||supportedLocale[0],_ngLocaleRootPath=ngLocaleRootPath,_momentLocalePath=momentLocaleRootPath,_initSuccess=!0,setSelectedLocale(_defaultLocale)))}function extendAppLocale(path){path+=_selectedLocale+".json",$http.get(path).success(function(response){WM.extend($rs.appLocale,response)})}function loadComponentLocaleBundle(path){_initSuccess&&path&&!_.includes(_componentLocalePaths,path)&&(_componentLocalePaths.push(path),extendAppLocale(path))}function getLocaleCodesMap(){return localeCodesMap}var _defaultLocale,_appLocaleRootPath,_ngLocaleRootPath,_momentLocalePath,_selectedLocale,_supportedLocale=[],localeKey=CONSTANTS.isStudioMode?"locale":"appLocale",_componentLocalePaths=[],_initSuccess=!1,localeCodesMap={};localeCodesMap={af:"Afrikaans","af-na":"Afrikaans (Namibië)","af-za":"Afrikaans (Suid-Afrika)",am:"አማርኛ","am-et":"አማርኛ (ኢትዮጵያ)",ar:"العربية","ar-001":"(العالم) العربية","ar-ae":"(الإمارات العربية المتحدة) العربية ","ar-bh":"(البحرين) العربية‏","ar-dz":"(الجزائر) العربية","ar-eg":"(مصر) العربية","ar-iq":"(العراق) العربية","ar-jo":"(الأردن) العربية","ar-kw":"(الكويت) العربية","ar-lb":"(لبنان) العربية","ar-ly":"(ليبيا) العربية","ar-ma":"(المغرب) العربية","ar-om":"(عمان) العربية ","ar-qa":"(قطر) العربية ","ar-sa":"(السعودية جزيره العرب) العربية","ar-sd":"(السودان) العربية","ar-sy":"(سوريا) العربية","ar-tn":"(تونس) العربية","ar-ye":"(اليمن) العربية",bg:"български","bg-bg":"български (България)",bn:"বাংলা","bn-bd":"বাংলা (বাংলাদেশ)","bn-in":"বাংলা (ভারত)",ca:"català","ca-es":"català (Espanya)",cs:"čeština","cs-cz":"čeština (Česká republika)",da:"dansk","da-dk":"dansk (Danmark)",de:"Deutsch","de-at":"Deutsch (Österreich)","de-be":"Deutsch (Belgien)","de-ch":"Deutsch (Schweiz)","de-de":"Deutsch (Deutschland)","de-li":"Deutsch (Liechtenstein)","de-lu":"Deutsch (Luxemburg)",el:"ελληνικά","el-cy":"ελληνικά (Κύπρος)","el-gr":"ελληνικά (Ελλάδα)",en:"English","en-as":"English (American Samoa)","en-au":"English (Australia)","en-bb":"English (Barbados)","en-be":"English (Belgium)","en-bm":"English (Bermuda)","en-bw":"English (Botswana)","en-bz":"English (Belize)","en-ca":"English (Canada)","en-gb":"English (United Kingdom)","en-gu":"English (Guam)","en-gy":"English (Guyana)","en-hk":"English (Hong Kong SAR China)","en-ie":"English (Ireland)","en-in":"English (India)","en-jm":"English (Jamaica)","en-mh":"English (Marshall Islands)","en-mp":"English (Northern Mariana Islands)","en-mt":"English (Malta)","en-mu":"English (Mauritius)","en-na":"English (Namibia)","en-nz":"English (New Zealand)","en-ph":"English (Philippines)","en-pk":"English (Pakistan)","en-sg":"English (Singapore)","en-tt":"English (Trinidad and Tobago)","en-um":"English (U.S. Minor Outlying Islands)","en-us":"English (United States)","en-vi":"English (U.S. Virgin Islands)","en-za":"English (South Africa)","en-zw":"English (Zimbabwe)",es:"español","es-419":"español (Latinoamérica)","es-ar":"español (Argentina)","es-bo":"español (Bolivia)","es-cl":"español (Chile)","es-co":"español (colombia)","es-cr":"español (Costa Rica)","es-do":"español (República Dominicana)","es-ec":"español (Ecuador)","es-es":"español (España)","es-gq":"española (Guinea Ecuatorial)","es-gt":"español (Guatemala)","es-hn":"español (Honduras)","es-mx":"español (México)","es-ni":"español (Nicaragua)","es-pa":"español (Panamá)","es-pe":"español (Perú)","es-pr":"español (Puerto Rico)","es-py":"español (Paraguay)","es-sv":"español (El Salvador)","es-us":"español (estados unidos)","es-uy":"español (Uruguay)","es-ve":"español (Venezuela)",et:"eesti","et-ee":"eesti (Eesti)",eu:"euskara","eu-es":"euskara (euskara)",fa:"فارسی","fa-af":"(افغانستان) فارسی","fa-ir":"(ایران) فارسی",fi:"suomi","fi-fi":"suomi (Suomi)",fil:"Filipino","fil-ph":"Filipino (Pilipinas)",fr:"français","fr-be":"français (belgique)","fr-bf":"français (Burkina Faso)","fr-bi":"français (Burundi)","fr-bj":"français (Bénin)","fr-bl":"français (saints Barthélemy)","fr-ca":"français (Canada)","fr-cd":"français (Congo-Kinshasa)","fr-cf":"français (République centrafricaine)","fr-cg":"français (Congo-Brazzaville)","fr-ch":"français (Suisse)","fr-ci":"français (Côte d’Ivoire)","fr-cm":"français (Cameroun)","fr-dj":"français (Djibouti)","fr-fr":"français (France)","fr-ga":"français (Gabon)","fr-gf":"français (Guyane française)","fr-gn":"français (Guinée)","fr-gp":"français (Guadeloupe)","fr-gq":"français (Guinée équatoriale)","fr-km":"français (Comores)","fr-lu":"français (luxembourg)","fr-mc":"français (Monaco)","fr-mf":"français (Saint-Martin)","fr-mg":"français (Madagascar)","fr-ml":"français (Mali)","fr-mq":"français (Martinique)","fr-ne":"français (Niger)","fr-re":"français (Réunion)","fr-yt":"français (Mayotte)",gl:"galego","gl-es":"galego (España)",gsw:"Elsässisch",gu:"ગુજરાતી","gu-in":"ગુજરાતી (ભારત)",he:"עברית","he-il":"(ישראל) עברית",hi:"हिंदी","hi-in":"हिंदी (भारत)",hr:"hrvatski","hr-hr":"hrvatski (Hrvatska)",hu:"magyar","hu-hu":"magyar (Magyarország)",id:"indonesia","id-id":"indonesia (Indonesia)",is:"íslenska","is-is":"íslenska (Ísland)",it:"italiano","it-it":"italiano (svizzera)",ja:"日本の","ja-jp":"日本語（日本）",kn:"ಕನ್ನಡ","kn-in":"ಕನ್ನಡ (ಭಾರತ)",ko:"한국의","ko-kr":"한국어 (한국)",ln:"Lingala","ln-cd":"Lingala (Congo - Kinshasa)",lt:"lietuvių","lt-lt":"lietuvių (Lietuva)",lv:"latviešu","lv-lv":"latviešu (Latvija)",ml:"മലയാളം","ml-in":"മലയാളം (ഭാരതം)",mr:"मराठी","mr-in":"मराठी (भारत)",ms:"Melayu","ms-my":"Melayu (Malaysia)",mt:"Malti","mt-mt":"Malti (Malta)",nl:"nederlands","nl-cw":"nederlands (Curacao)","nl-nl":"nederlands (Nederland)","nl-sx":"nederlands (Sint Maarten)",no:"norsk",or:"ଓଡ଼ିଆ","or-in":"ଓଡ଼ିଆ (ଭାରତ)",pl:"polski","pl-pl":"polski (Polska)",pt:"Português","pt-br":"Português (Brasil)","pt-pt":"português (Portugal)","pt-st":"português (São Tomé and Príncipe)",ro:"română","ro-ro":"română (România)",ru:"русский","ru-ru":"русский (Россия)",sk:"slovenčina","sk-sk":"Slovak (Slovakia)",sl:"slovenski","sl-si":"slovenski (Slovenija)",sq:"shqipe","sq-al":"shqipe (Shqipëria)",sr:"srpski","sr-cyrl-rs":"српски (Србија)","sr-latn-rs":"srpski (Srbija)",sv:"svenska","sv-se":"svenska (Sverige)",sw:"Swahili","sw-tz":"Swahili (Tanzania)",ta:"தமிழ்","ta-in":"தமிழ் (இந்தியா)",te:"తెలుగు","te-in":"తెలుగు (భారత దేశం)",th:"ไทย","th-th":"ไทย (ไทย)",tl:"Tigrinya ",tr:"Türkçe","tr-tr":"Türkçe (Türkiye)",uk:"українська","uk-ua":"українська (Україна)",ur:"اُردو‏","ur-pk":" (پاکستان)‏ اُردو",vi:"Tiếng Việt","vi-vn":"Tiếng Việt (Việt Nam)",zh:"中文","zh-cn":"中文(中华人民共和国)","zh-hans-cn":"中国（简体，中国）","zh-hk":"中文(香港特別行政區)","zh-tw":"中文(台灣)",zu:"isiZulu","zu-za":"isiZulu (iNingizimu Afrika)"},$rs[localeKey]={},$rs.getLocalizedMessage=function(){var args=Array.prototype.slice.call(arguments),key=$rs[localeKey][args.shift()];return Utils.replace(key,args)},this.init=init,this.getDefaultLocale=getDefaultLocale,this.getSelectedLocale=getSelectedLocale,this.setSelectedLocale=setSelectedLocale,this.loadComponentLocaleBundle=loadComponentLocaleBundle,this.getLocaleCodesMap=getLocaleCodesMap}]),WM.module("wm.mobile",[]),wm.modules.wmCommon.services.DeviceService=["$q",function($q){"use strict";this.whenDeviceReady=function(){var d=$q.defer();return d.resolve(),d.promise},this.onBackButtonTap=function(){return WM.noop}}],wm.modules.wmCommon.services.DeviceFileCacheService=WM.noop,wm.modules.wmCommon.services.DeviceFileDownloadService=WM.noop,wm.modules.wmCommon.services.DeviceFileService=WM.noop,wm.variables.services.DeviceVariableService=WM.noop,wm.variables.services.FileSelectorService=WM.noop,wm.variables.services.DeviceMediaService=WM.noop,wm.modules.wmCommon.services.NavigationService=["$rootScope","ViewService","DialogService","$timeout","$location","SecurityService",function($rs,ViewService,DialogService,$timeout,$location,SecurityService){"use strict";function isPartialWithNameExists(name){return WM.element('[page-container][content="'+name+'"]').length}function showAncestors(element){var ancestorSearchQuery='[wm-navigable-element="true"]';element.parents(ancestorSearchQuery).toArray().reverse().forEach(function(parent){var $is=WM.element(parent).isolateScope();switch($is._widgettype){case"wm-view":ViewService.showView($is.name);break;case"wm-accordionpane":$is.expand();break;case"wm-tabpane":$is.select();break;case"wm-segment-content":$is.navigate();break;case"wm-panel":$is.expanded=!0}})}function showAncestorDialog(viewName){var dialogId;return WM.element("#wm-app-content [dialogtype]").each(function(){var dialog=WM.element(this);if(WM.element(dialog.html()).find("[name='"+viewName+"']").length)return dialogId=dialog.attr("name"),DialogService.closeAllDialogs(),DialogService.showDialog(dialogId),!1}),dialogId}function getViewElementInActivePage($el){var selector;return $el.length>1&&(selector=_.filter($el,function(childSelector){if(_.isEmpty(WM.element(childSelector).closest('[data-role = "partial"]')))return childSelector}),selector&&($el=WM.element(selector))),$el}function goToView(viewElement,viewName,pageName){var $is,parentDialog;if(viewElement.length)switch(pageName===$rs.activePageName&&(viewElement=getViewElementInActivePage(viewElement)),$is=viewElement.isolateScope(),$is._widgettype){case"wm-view":showAncestors(viewElement),ViewService.showView(viewName);break;case"wm-accordionpane":showAncestors(viewElement),$is.expand();break;case"wm-tabpane":showAncestors(viewElement),$is.select();break;case"wm-segment-content":showAncestors(viewElement),$is.navigate();break;case"wm-panel":$is.expanded=!0}else parentDialog=showAncestorDialog(viewName),$timeout(function(){parentDialog&&goToView(WM.element('[name="'+viewName+'"]'),viewName,pageName)})}var nextTransitionToApply,pageStackObject,parentSelector="body:first >#wm-app-content:last";pageStackObject=function(){var currentPage,stack=[];return{getCurrentPage:function(){return currentPage},addPage:function(pageInfo){currentPage&&stack.push(currentPage),currentPage=pageInfo},goBack:function(){currentPage=stack.pop()},getLastPage:function(){return stack.length>0?stack[stack.length-1]:void 0},isLastVisitedPage:function(pageName){return stack.length>0&&this.getLastPage().name===pageName}}}(),$rs.$on("$routeChangeStart",function(evt,$next,$p){var pageName=$next.params.name;pageName&&(pageStackObject.isLastVisitedPage(pageName)?(nextTransitionToApply=pageStackObject.getCurrentPage().transition,_.isEmpty(nextTransitionToApply)||(nextTransitionToApply+="-exit"),pageStackObject.goBack()):pageStackObject.addPage({name:pageName,transition:nextTransitionToApply}),_.isEmpty(nextTransitionToApply)||($next.transition="page-transition page-transition-"+nextTransitionToApply,nextTransitionToApply=""))}),this.goToPage=function(pageName,options){options=options||{};var location="/"+pageName,viewName=options.viewName,queryParams=options.urlParams||{};nextTransitionToApply=options.transition||"",viewName&&(location+="."+viewName),$rs._appNavEvt=options.$event,$location.path(location).search(queryParams)},this.goToView=function(viewName,options){options=options||{};var pageName=options.pageName,transition=options.transition||"",$event=options.$event;!pageName||pageName===$rs.activePageName||isPartialWithNameExists(pageName)?goToView(WM.element(parentSelector).find('[name="'+viewName+'"]'),viewName,pageName):this.goToPage(pageName,{viewName:viewName,$event:$event,transition:transition,urlParams:options.urlParams})},this.goToPrevious=function($event){var lastPage=pageStackObject.getLastPage();return!!lastPage&&(this.goToPage(lastPage.name,{$event:$event}),!0)}}],WM.element.holdReady(!0),document.addEventListener("DOMContentLoaded",function(){"use strict";var $appView=WM.element("#wm-app-content");$appView.attr("wm-page-view",""),WM.element('<i id="wm-mobile-display"></i>').appendTo(".wm-app"),window.cordova?document.addEventListener("deviceready",function(){WM.element.holdReady(!1)},!1):($appView.attr("no-animate",""),WM.element.holdReady(!1))});var Application=WM.module("Application",["ngRoute","vcRecaptcha","ui.bootstrap","wm.common","wm.variables","wm.plugins.database","wm.plugins.webServices","wm.plugins.security","wm.widgets","wm.layouts","wm.mobile","wm.utils","oc.lazyLoad","wm.prefabs","i18n","angular-gestures","ngSanitize","angular-websocket","ngAnimate"]);Application.constant("CONSTANTS",{isRunMode:!0,INT_MAX_VALUE:2147483647,DELAY:{SEARCH_WAIT:500},DATA_SEARCH_LIMIT:10,IFRAME_WINDOW_NAME:"WM_RUN_WINDOW",WM_OAUTH_STATE:"WMOAuthState"}).service("PrefabService",WM.noop).config(["$controllerProvider","$httpProvider","$compileProvider","$filterProvider",function($controllerProvider,$httpProvider,$compileProvider,$filterProvider){"use strict";Application.$controller=$controllerProvider.register,Application.$directive=$compileProvider.directive,Application.$filter=$filterProvider.register,$httpProvider.useApplyAsync(!0),$controllerProvider.allowGlobals()}]).service("AsyncTaskManager",["$browser","$rootScope",function($browser,$rootScope){"use strict";function resume(){pause=!1,_.forEach(queue,function(fn){fn()}),$rootScope.$digest(),queue.length=0}function defer(fn){return function(){pause?queue.push(fn):fn()}}var timerId,pause=!1,oDefer=$browser.defer,oCancel=$browser.defer.cancel,queue=[];$browser.defer=function(fn,delay){return oDefer.call($browser,defer(fn),delay)},$browser.defer.cancel=oCancel,this.resumeAsyncTasks=function(){pause&&(window.clearTimeout(timerId),resume())},this.pauseAsyncTasks=function(timeoutInMillis){pause||(pause=!0,timeoutInMillis>0&&(timerId=window.setTimeout(function(){resume()},timeoutInMillis)))}}]).directive("wmPageView",["$$animateQueue","$compile","$route","$rootScope","AsyncTaskManager",function($$animateQueue,$compile,$route,$rootScope,AsyncTaskManager){"use strict";function removePage(page){var pageScope;page&&(pageScope=page.scope(),pageScope&&pageScope.$destroy(),page.remove())}function update($scope,$element){var oldPage,newPage,locals=$route.current&&$route.current.locals,template=locals&&locals.$template,pageScope=$scope.$new();locals&&(newPage=$compile(template)(pageScope),oldPage=$element.children().last(),$element.append(newPage),$route.current.transition?($route.current.transitionCompleted=!1,$$animateQueue.enabled(newPage,!0),$$animateQueue.enabled(oldPage,!0),oldPage.addClass($route.current.transition),$rootScope.$emit("page-transition-start"),AsyncTaskManager.pauseAsyncTasks(500),$$animateQueue.push(newPage,"enter").then(function(){removePage(oldPage),oldPage=void 0}),$$animateQueue.push(oldPage,"leave").then(function(){removePage(oldPage),oldPage=void 0,$route.current.transitionCompleted=!0,$rootScope.$emit("page-transition-end")})):(removePage(oldPage),oldPage=void 0,$route.current.transitionCompleted=!0,$rootScope.$emit("page-transition-end")))}return{restrict:"A",link:function($scope,$element){$rootScope.$on("$routeChangeSuccess",function(){update($scope,$element)}),update($scope,$element)}}}]).service("AppManager",["$q","Utils","BaseService","$location","$window","$rootScope","wmToaster","SecurityService","i18nService","$compile","Variables","$cacheFactory","$document","CONSTANTS","wmSpinner","$timeout","$route","$http","DeviceService",function($q,Utils,BaseService,$location,$window,$rs,wmToaster,SecurityService,i18nService,$compile,Variables,$cacheFactory,$document,CONSTANTS,wmSpinner,$timeout,$route,$http,DeviceService){"use strict";function defaultPageLoadSuccessHandler(pageName,response,isPartial){cache.put(pageName,Utils.parseCombinedPageContent(response.data,pageName)),isPartial||(prevRoute=$location.path())}function showLoginDialog(){$rs.isCommonPageLoaded?BaseService.handleSessionTimeOut():$rs.$watch(":: isCommonPageLoaded",function(nv){nv&&BaseService.handleSessionTimeOut()})}function handleSessionTimeout(page,onSuccess,onError){function getRedirectPage(config){var prevRedirectPage,homePage=_WM_APP_PROPERTIES.homePage,loginPage=_.get(config,"login.pageName");return page=page||$location.path().replace("/",""),page===homePage||page===loginPage?(prevRedirectPage=_.get($location.search,"redirectTo"),_.isEmpty(prevRedirectPage)?void 0:prevRedirectPage):page}var sessionTimeoutConfig,sessionTimeoutMethod,loginConfig,loginMethod,ssoUrl,LOGIN_METHOD={DIALOG:"DIALOG",PAGE:"PAGE",SSO:"SSO"};SecurityService.getConfig(function(config){if(config.userInfo&&config.userInfo.userName)config.authenticated=!1,sessionTimeoutConfig=config.login.sessionTimeout||{type:LOGIN_METHOD.DIALOG},sessionTimeoutMethod=sessionTimeoutConfig.type.toUpperCase(),sessionTimeoutMethod===LOGIN_METHOD.DIALOG?(page&&BaseService.pushToErrorCallStack(null,function(){_load(page,onSuccess,onError)},WM.noop),showLoginDialog()):sessionTimeoutMethod===LOGIN_METHOD.PAGE&&(page||(page=$location.path().replace("/","")),$location.path(sessionTimeoutConfig.pageName),$location.search("redirectTo",page));else switch(loginConfig=config.login,loginMethod=loginConfig.type.toUpperCase()){case LOGIN_METHOD.DIALOG:$rs._noRedirect=!0,page&&BaseService.pushToErrorCallStack(null,function(){_load(page,onSuccess,onError)},WM.noop),showLoginDialog();break;case LOGIN_METHOD.PAGE:page=getRedirectPage(config),$location.path(loginConfig.pageName),$location.search("redirectTo",page);break;case LOGIN_METHOD.SSO:page=getRedirectPage(config),document.body.textContent="Redirecting to sso login...",ssoUrl=$rs.project.deployedUrl+SSO_URL+(page?"?redirectPage="+page:""),$window.self!==$window.top?$window.parent.location.href=ssoUrl:$window.location.href=ssoUrl}})}function showPageSwitchSpinner(){wmSpinner.show("","globalSpinner","app-page-switch")}function hidePageSwitchSpinner(){$timeout(function(){wmSpinner.hide("globalSpinner")},200)}function defaultPageLoadErrorHandler(pageName,onSuccess,onError,jqxhr){401===jqxhr.status?(hidePageSwitchSpinner(),handleSessionTimeout(pageName,onSuccess,onError)):403===jqxhr.status?(wmToaster.show("error",$rs.appLocale.LABEL_ACCESS_DENIED||"Access Denied",$rs.appLocale.LABEL_FORBIDDEN_MESSAGE||"The requested resource access/action is forbidden."),$location.path(prevRoute)):Utils.triggerFn(onError)}function _load(pageName,onSuccess,onError,isPartial){WM.isDefined(pageReqQueue[pageName])||(pageReqQueue[pageName]=[]),pageReqQueue[pageName].push({success:onSuccess,error:onError}),pageReqQueue[pageName].length>1||BaseService.getHttpPromise({method:"GET",url:Utils.preventCachingOf("pages/"+pageName+"/page.min.html")}).then(function(response){defaultPageLoadSuccessHandler(pageName,response,isPartial),_.forEach(pageReqQueue[pageName],function(handler){Utils.triggerFn(handler.success,cache.get(pageName))}),pageReqQueue[pageName].length=0},function(jqxhr){$route.current.params.name===pageName&&404===jqxhr.status&&(WM.element(".app-spinner").addClass("ng-hide"),wmToaster.show("error",$rs.appLocale.MESSAGE_PAGE_NOT_FOUND||"The page you are trying to reach is not available")),_.forEach(pageReqQueue[pageName],function(handler){defaultPageLoadErrorHandler(pageName,handler.success,handler.error,jqxhr)}),pageReqQueue[pageName].length=0})}function loadPage(pageName,isPartial){var content,deferred=$q.defer();return pageName=pageName.split(".").shift(),content=cache.get(pageName),content?(Variables.setPageVariables(pageName,content.variables||{}),deferred.resolve(content)):_load(pageName,deferred.resolve,deferred.reject,isPartial),deferred.promise}function loadPartial(partialPageName){return loadPage(partialPageName,!0)}function getPageContent(pageName,type){return(cache.get(pageName)||{})[type]}function getAcceptedLanguages(){var languages=CONSTANTS.hasCordova?navigator.languages:(Utils.getCookieByName("X-Accept-Language")||"").split(",");return _.map(languages,_.toLower)}function initI18nService(supportedLocale,defaultLocale){var _dl,_acceptLang=getAcceptedLanguages(),_sl=supportedLocale;_acceptLang.push(defaultLocale),_dl=_.intersection(_acceptLang,_sl)[0]||"en",_sl=_sl||[_dl],i18nService.init(_sl,_dl,APP_LOCALE_PATH,NG_LOCALE_PATH,MOMENT_LOCALE_PATH),i18nService.setSelectedLocale(_dl)}function compileCommonPageContent($s,pageName,content){Variables.setPageVariables(pageName,content.variables);var $html=WM.element(Utils.processMarkup(content.html));WM.element("#wm-common-content").append($html),$compile($html)($s),$rs.isCommonPageLoaded=!0}function loadCommonPage($s){var pageName="Common",deferred=$q.defer();return loadPage(pageName).then(function(content){var deRegister;appVariablesLoaded?compileCommonPageContent($s,pageName,content):deRegister=$rs.$watch(function(){return appVariablesLoaded},function(){deRegister(),compileCommonPageContent($s,pageName,content)}),deferred.resolve()},deferred.resolve),deferred.promise}function updateLoggedInUserVariable(){function clearLoggedInUser(){loggedInUser.isAuthenticated=!1,loggedInUser.roles=[],loggedInUser.name=void 0,loggedInUser.id=void 0,loggedInUser.tenantId=void 0,deferred.resolve()}var loggedInUser=$rs.Variables&&$rs.Variables.loggedInUser&&$rs.Variables.loggedInUser.dataSet,deferred=$q.defer();return loggedInUser?(SecurityService.getConfig(function(config){
return config.securityEnabled&&config.authenticated?(loggedInUser.isAuthenticated=config.authenticated,loggedInUser.roles=config.userInfo.userRoles,loggedInUser.name=config.userInfo.userName,loggedInUser.id=config.userInfo.userId,loggedInUser.tenantId=config.userInfo.tenantId,void deferred.resolve(config)):void clearLoggedInUser()},clearLoggedInUser),deferred.promise):($timeout(deferred.resolve),deferred.promise)}function getPreparedPageContent(pageName){var content=cache.get(pageName).html,$content=content||"";return $content=WM.element(Utils.processMarkup(content)),$rs.isPrefabType&&($rs.prefabTemplate=$content,$rs.isPrefabTemplate=!0,$content=WM.element("<wm-prefab-run></wm-prefab-run>")),$content}function clearPagesCache(){cache.destroy(),cache=$cacheFactory("APP_PAGES")}function loadSecurityConfig(forcePageLoad){var page,deferred=$q.defer(),XSRF_COOKIE="wm_xsrf_token";return $rs.isApplicationType?SecurityService.getConfig(function(config){$rs.isSecurityEnabled=config.securityEnabled,$rs.isUserAuthenticated=config.authenticated,config.securityEnabled?config.authenticated?(page=config.userInfo.homePage||_WM_APP_PROPERTIES.homePage,$rs.userRoles=config.userInfo.userRoles,$http.defaults.xsrfCookieName=XSRF_COOKIE,Utils.getCookieByName(XSRF_COOKIE)&&($http.defaults.xsrfHeaderName=config.csrfHeaderName)):page=CONSTANTS.hasCordova?config.login.pageName:config.homePage:page=config.homePage,("/"===$location.path()||forcePageLoad)&&($location.path()==="/"+page&&$route.reload(),$location.path(page)),landingPageName=page,deferred.resolve()},deferred.resolve):("/"===$location.path()&&$location.path(_WM_APP_PROPERTIES.homePage),deferred.resolve()),deferred.promise}function initAppVariablesAndDependencies(){var deferred=$q.defer();return Variables.initAppVariables(void 0,function(){appVariablesLoaded=!0,updateLoggedInUserVariable().then(deferred.resolve)},function(error){deferred.reject(error)}),deferred.promise}function resetSecurityConfig(){var deferred=$q.defer();return SecurityService.setConfig(null),SecurityService.getConfig(function(){appVariablesLoaded?updateLoggedInUserVariable().then(deferred.resolve,deferred.resolve):initAppVariablesAndDependencies().then(deferred.resolve,deferred.resolve)},WM.noop,!0),deferred.promise}function navigateOnLogin(){loadSecurityConfig(!0)}var prevRoute,cache=$cacheFactory("APP_PAGES"),NG_LOCALE_PATH="resources/ngLocale/",MOMENT_LOCALE_PATH="resources/momentLocale/",APP_LOCALE_PATH="resources/i18n/",appVariablesLoaded=!1,SSO_URL="/services/security/ssologin",landingPageName="",pageReqQueue={};$rs.$on("app-logout-success",clearPagesCache),DeviceService.onBackButtonTap(function(){landingPageName===$rs.activePageName?$window.navigator.app.exitApp():$window.history.back()}),Utils.isMobile()&&$document.on("submit","form",function(){document.activeElement.blur()}),this.loadPage=loadPage,this.loadPartial=loadPartial,this.getPageContent=getPageContent,this.loadCommonPage=loadCommonPage,this.initI18nService=initI18nService,this.initAppVariablesAndDependencies=initAppVariablesAndDependencies,this.getPreparedPageContent=getPreparedPageContent,this.loadSecurityConfig=loadSecurityConfig,this.handleSessionTimeOut=handleSessionTimeout,this.showPageSwitchSpinner=showPageSwitchSpinner,this.hidePageSwitchSpinner=hidePageSwitchSpinner,this.resetSecurityConfig=resetSecurityConfig,this.navigateOnLogin=navigateOnLogin}]).config(["$routeProvider",function($routeProvider){"use strict";var initText="<div></div>",routeConfig={template:initText,resolve:{securityConfig:function(AppManager){return AppManager.loadSecurityConfig()},appVariables:["$q","$rootScope",function($q,$rs){var deferred=$q.defer();return $rs.isApplicationType?$rs.Variables?deferred.resolve():$rs.$watch(":: Variables",function(nv){nv&&deferred.resolve()}):($rs.isTemplateBundleType&&($rs.Variables={}),deferred.resolve()),deferred.promise}],appLocale:["$q","$rootScope",function($q,$rs){var deferred=$q.defer();return $rs.isApplicationType||$rs.isPrefabType?$rs.selectedLocale?deferred.resolve():$rs.$watch(":: selectedLocale",function(nv){nv&&deferred.resolve()}):deferred.resolve(),deferred.promise}]}};$routeProvider.when("/",routeConfig).when("/:name",{template:initText,resolve:WM.extend({},routeConfig.resolve,{pageContent:["AppManager","$route","$rootScope",function(AppManager,$route,$rs){var pageName=$route.current.params.name;return AppManager.loadPage(pageName).then(function(){$rs.activePageName=pageName})}]})})}]).controller("AppController",["$scope","$rootScope","ProjectService","i18nService","Utils","AppManager","SecurityService","Variables","CONSTANTS","wmSpinner","MetaDataFactory","DeviceService","AppDefaults","$location","BasicVariableService","$servicevariable","$liveVariable","NavigationVariableService","NotificationVariableService","LoginVariableService","LogoutVariableService","TimerVariableService","$websocketvariable",function($s,$rs,ProjectService,i18nService,Utils,AppManager,SecurityService,Variables,CONSTANTS,wmSpinner,MetaDataFactory,DeviceService,AppDefaults,$location){"use strict";var dateFormat,timeFormat,dateTimeFormat,projectID=ProjectService.getId(),appProperties=Utils.getClonedObject(_WM_APP_PROPERTIES),locationQueryParams=$location.search(),stateParams=locationQueryParams.state;$rs.projectName=appProperties.name,$rs.isPrefabType="PREFAB"===appProperties.type,$rs.isApplicationType="APPLICATION"===appProperties.type,$rs.isTemplateBundleType="TEMPLATEBUNDLE"===appProperties.type,dateFormat=appProperties.dateFormat,timeFormat=appProperties.timeFormat,dateTimeFormat=dateFormat&&timeFormat?dateFormat+" "+timeFormat:void 0,AppDefaults.set({dateFormat:dateFormat,timeFormat:timeFormat,dateTimeFormat:dateTimeFormat}),$rs.project={id:projectID,activeTheme:appProperties.activeTheme,deployedUrl:ProjectService.getDeployedUrl()},$rs.changeLocale=function($is){i18nService.setSelectedLocale($is.datavalue)},($rs.isApplicationType||$rs.isPrefabType)&&AppManager.initI18nService(_.split(_WM_APP_PROPERTIES.supportedLanguages,",")||["en"],_WM_APP_PROPERTIES.defaultLanguage),stateParams=Utils.getValidJSON(stateParams),_.get(stateParams,CONSTANTS.WM_OAUTH_STATE)&&(window.opener||(window.opener=window.open("",CONSTANTS.IFRAME_WINDOW_NAME)),document.write("You may close the window now!"),window.opener.location.reload(),window.close()),$rs.$on("$routeChangeSuccess",function(evt,$cRoute,$pRoute){var pageName=$cRoute.params.name;$rs._appNavEvt&&($rs._appNavEvt.widgetName=WM.element($rs._appNavEvt.target).closest("[init-widget]").attr("name")),Utils.triggerFn($rs.onBeforePageLoad,{requested:$cRoute.params.name,last:_.get($pRoute,"params.name")},$rs._appNavEvt),$rs._appNavEvt=void 0,pageName&&(pageName=pageName.split(".").shift(),$cRoute.locals.$template=AppManager.getPreparedPageContent(pageName))}),$rs.isMobileApplicationType||($rs.$on("$routeChangeStart",AppManager.showPageSwitchSpinner),$rs.$on("page-startupdate-variables-loaded",AppManager.hidePageSwitchSpinner),$rs.$on("template-ready",AppManager.hidePageSwitchSpinner)),$rs.isApplicationType&&DeviceService.whenDeviceReady().then(function(){return MetaDataFactory.load()}).then(function(){AppManager.loadCommonPage($s),SecurityService.getConfig(function(){AppManager.initAppVariablesAndDependencies()})}),$rs.isPrefabType&&(MetaDataFactory.load(),Utils.fetchContent("json",Utils.preventCachingOf("./config.json"),function(response){response.error||($rs.prefabConfig=response)},WM.noop,!0)),$rs.$on("invoke-service",function(event,name,options,onSuccess,onError){if(_.startsWith(name,"Variables."))name=name.split(".")[1];else if(_.includes(name,"("))return;var variable;if(options=options||{},variable=_.get(options,["scope","Variables",name]),variable||(variable=Variables.getVariableByName(name)),variable)switch(variable.category){case"wm.LiveVariable":"read"===variable.operation?variable.update(options,onSuccess,onError):variable[variable.operation+"Record"](options,onSuccess,onError);break;case"wm.ServiceVariable":variable.update(options,onSuccess,onError);break;case"wm.NavigationVariable":variable.navigate(options,onSuccess,onError);break;case"wm.NotificationVariable":variable.notify(options,onSuccess,onError);break;case"wm.LoginVariable":variable.login(options,onSuccess,onError);break;case"wm.LogoutVariable":variable.logout(options,onSuccess,onError);break;case"wm.TimerVariable":variable.fire(options,onSuccess,onError);break;case"wm.DeviceVariable":variable.invoke(options,onSuccess,onError);break;case"wm.WebSocketVariable":variable[options.method||"invoke"]()}}),DeviceService.whenDeviceReady().then(function(){$rs.$emit("application-ready")}),$rs.$on("toggle-variable-state",function(event,variableName,active){var variable=Variables.getVariableByName(variableName);variable&&!_.isEmpty(_.trim(variable.spinnerContext))&&(active?variable._spinnerId=wmSpinner.show(variable.spinnerMessage,variable._id,variable.spinnerclass,variable.spinnerContext):wmSpinner.hide(variable._spinnerId))}),window.top!==window.self&&(window.name=CONSTANTS.IFRAME_WINDOW_NAME)}]);

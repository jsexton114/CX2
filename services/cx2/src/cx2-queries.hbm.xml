<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
  <sql-query name="AdminsMunicipalities">
    <![CDATA[
      select M.* from Municipalities M,Roles R,Users U where U.ID=:user and U.ID=R.UserId and R.MunicipalityId=M.ID
    ]]>
  </sql-query>
  <sql-query name="EmployeesMunicipalities">
    <![CDATA[
      select M.* from Municipalities M,Roles R,Users U where U.ID=:user and U.ID=R.UserId and R.MunicipalityId=M.ID
    ]]>
  </sql-query>
  <sql-query name="MunicipalityCount">
    <![CDATA[
      select count(*) as municipalitiesCount from Municipalities
    ]]>
  </sql-query>
  <sql-query name="resetPasswordForUser">
    <![CDATA[
      UPDATE Users SET Password=:newPassword where ID=:userID
    ]]>
  </sql-query>
  <sql-query name="resetPasswordWithTokenForUser">
    <![CDATA[
      DELETE FROM UserPasswordResetTokens WHERE UserId = :userid
      INSERT INTO UserPasswordResetTokens (UserId, Token, ExpirationDate) VALUES ( :userid, :token, DATEADD(day, 2, GETDATE()))
    ]]>
  </sql-query>
  <sql-query name="StandardUserMunicipalites">
    <![CDATA[
      select M.* from Municipalities M,UserSubscriptions US,Users U where U.ID=:USER and U.ID=US.UserId and US.MunicipalityId=M.ID
    ]]>
  </sql-query>
  <sql-query name="SubDivisonCount">
    <![CDATA[
      select count(*) as SubDivisonCount from Subdivisions where MunicipalityId=:municipalityId
    ]]>
  </sql-query>
  <sql-query name="UpdateCFInProfile">
    <![CDATA[
      Update Users set CommunicationFrequency=:cf where ID=:user
    ]]>
  </sql-query>
  <sql-query name="UpdateInfoFromMyProfile">
    <![CDATA[
      Update Users set FirstName=:fn,LastName=:ln,Email=:em,PhoneNumber=:ph,Address1=:ad1,Address2=:ad2,StateId=:st,City=:ct,Country=:ctry,PostalCode=:pc where ID=:user
    ]]>
  </sql-query>
  <sql-query name="UpdateNewPassword">
    <![CDATA[
      UPDATE Users SET Password=:password where ID=:newUser
    ]]>
  </sql-query>
  <sql-query name="UpdatePasswordAndCF">
    <![CDATA[
      UPDATE Users SET Password=:password, CommunicationFrequency=:cf where ID=:newUser
    ]]>
  </sql-query>
  <sql-query name="UpdateWorkMunicipality">
    <![CDATA[
      Update Municipalities set MondayYN=:monday,TuesdayYN=:tuesday,WednesdayYN=:wednesday,ThursdayYN=:thursday,FridayYN=:friday,SaturdayYN=:saturday,SundayYN=:sunday,TimeZone=:timezone,OpenTime=:openTime,CloseTime=:closeTime where ID=:municipalityId
    ]]>
  </sql-query>
  <sql-query name="UserCount">
    <![CDATA[
      select count(*) as usersCount from Users
    ]]>
  </sql-query>
  <sql-query name="userSubscriptionsCount">
    <![CDATA[
      select count(*) as userSubscriptionsCount from UserSubscriptions
    ]]>
  </sql-query>
  <sql-query name="userSubscriptionsCountForMunicipality">
    <![CDATA[
      select count(*) as userSubscriptionsCountForMunicipality from UserSubscriptions where MunicipalityId=:municipalityId
    ]]>
  </sql-query>
  <sql-query name="verifyPasswordResetToken">
    <![CDATA[
      select * from UserPasswordResetTokens WHERE( ExpirationDate >= GETDATE() AND Token = :token)
    ]]>
  </sql-query>
</hibernate-mapping>
{
  "name" : "cx2",
  "description" : "Queries for cx2",
  "queries" : [ {
    "name" : "AdminsMunicipalities",
    "query" : "select M.* from Municipalities M,Roles R,Users U where U.ID=:user and U.ID=R.UserId and R.MunicipalityId=M.ID",
    "comment" : "Admin'sMunicipalities",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : false,
    "queryParams" : [ {
      "paramName" : "user",
      "paramType" : "java.lang.Integer",
      "testValue" : "2",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2AdminsMunicipalitiesrtnType",
    "returnTypeMetadata" : {
      "Active" : "java.lang.Boolean",
      "Address1" : "java.lang.String",
      "Address2" : "java.lang.String",
      "AllowManualPayment" : "java.lang.Boolean",
      "City" : "java.lang.String",
      "Email" : "java.lang.String",
      "GlobalEmailSig" : "java.lang.String",
      "ID" : "java.math.BigDecimal",
      "Logo" : "[B",
      "ManualPaymentPercent" : "java.math.BigDecimal",
      "MunicipalityGuid" : "java.lang.String",
      "MunicipalityName" : "java.lang.String",
      "Phone" : "java.lang.String",
      "PostalCode" : "java.lang.String",
      "State" : "java.lang.String"
    }
  }, {
    "name" : "EmployeesMunicipalities",
    "query" : "select M.* from Municipalities M,Roles R,Users U where U.ID=:user and U.ID=R.UserId and R.MunicipalityId=M.ID",
    "comment" : "EmployeesMunicipalities",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : false,
    "queryParams" : [ {
      "paramName" : "user",
      "paramType" : "java.lang.Integer",
      "testValue" : "2",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2EmployeesMunicipalitiesrtnType",
    "returnTypeMetadata" : {
      "Active" : "java.lang.Boolean",
      "Address1" : "java.lang.String",
      "Address2" : "java.lang.String",
      "AllowManualPayment" : "java.lang.Boolean",
      "City" : "java.lang.String",
      "Email" : "java.lang.String",
      "GlobalEmailSig" : "java.lang.String",
      "ID" : "java.math.BigDecimal",
      "Logo" : "[B",
      "ManualPaymentPercent" : "java.math.BigDecimal",
      "MunicipalityGuid" : "java.lang.String",
      "MunicipalityName" : "java.lang.String",
      "Phone" : "java.lang.String",
      "PostalCode" : "java.lang.String",
      "State" : "java.lang.String"
    }
  }, {
    "name" : "MunicipalityCount",
    "query" : "select count(*) as municipalitiesCount from Municipalities",
    "comment" : "MunicipalityCount",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : false,
    "queryParams" : [ ],
    "outputType" : "cx2MunicipalityCountrtnType",
    "returnTypeMetadata" : {
      "municipalitiesCount" : "java.lang.Integer"
    }
  }, {
    "name" : "resetPasswordForUser",
    "query" : "UPDATE Users SET Password=:newPassword where ID=:userID",
    "comment" : "Resets password for a user, given user ID as Integer and password as String.",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : true,
    "queryParams" : [ {
      "paramName" : "newPassword",
      "paramType" : "java.lang.String",
      "testValue" : "HelloWorld",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "userID",
      "paramType" : "java.lang.Integer",
      "testValue" : "2",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2resetPasswordForUserrtnType",
    "returnTypeMetadata" : { }
  }, {
    "name" : "resetPasswordWithTokenForUser",
    "query" : "DELETE FROM UserPasswordResetTokens WHERE UserId = :userid \nINSERT INTO UserPasswordResetTokens (UserId, Token, ExpirationDate) VALUES ( :userid, :token, DATEADD(day, 2, GETDATE()))",
    "comment" : "This saves a reset password token in the DB given a User ID and Token.",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : true,
    "queryParams" : [ {
      "paramName" : "userid",
      "paramType" : "java.lang.Integer",
      "testValue" : "2",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "token",
      "paramType" : "java.lang.String",
      "testValue" : "asdfadsfasdfasd",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2resetPasswordWithTokenForUserrtnType",
    "returnTypeMetadata" : { }
  }, {
    "name" : "StandardUserMunicipalites",
    "query" : "select M.* from Municipalities M,UserSubscriptions US,Users U where U.ID=:USER and U.ID=US.UserId and US.MunicipalityId=M.ID",
    "comment" : "StandardUserMunicipalites",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : false,
    "queryParams" : [ {
      "paramName" : "USER",
      "paramType" : "java.lang.Integer",
      "testValue" : "42",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2StandardUserMunicipalitesrtnType",
    "returnTypeMetadata" : {
      "Active" : "java.lang.Boolean",
      "Address1" : "java.lang.String",
      "Address2" : "java.lang.String",
      "AllowManualPayment" : "java.lang.Boolean",
      "City" : "java.lang.String",
      "Email" : "java.lang.String",
      "GlobalEmailSig" : "java.lang.String",
      "ID" : "java.math.BigDecimal",
      "Logo" : "[B",
      "ManualPaymentPercent" : "java.math.BigDecimal",
      "MunicipalityGuid" : "java.lang.String",
      "MunicipalityName" : "java.lang.String",
      "Phone" : "java.lang.String",
      "PostalCode" : "java.lang.String",
      "State" : "java.lang.String"
    }
  }, {
    "name" : "SubDivisonCount",
    "query" : "select count(*) as SubDivisonCount from Subdivisions where MunicipalityId=:municipalityId",
    "comment" : "SubDivisonCount",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : false,
    "queryParams" : [ {
      "paramName" : "municipalityId",
      "paramType" : "java.lang.Integer",
      "testValue" : "1",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2SubDivisonCountrtnType",
    "returnTypeMetadata" : {
      "SubDivisonCount" : "java.lang.Integer"
    }
  }, {
    "name" : "UpdateCFInProfile",
    "query" : "Update Users set CommunicationFrequency=:cf where ID=:user",
    "comment" : "UpdateCFInProfile",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : true,
    "queryParams" : [ {
      "paramName" : "cf",
      "paramType" : "java.lang.String",
      "testValue" : "Immediately",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "user",
      "paramType" : "java.lang.Integer",
      "testValue" : "42",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2UpdateCFInProfilertnType",
    "returnTypeMetadata" : { }
  }, {
    "name" : "UpdateInfoFromMyProfile",
    "query" : "Update Users set FirstName=:fn,LastName=:ln,Email=:em,PhoneNumber=:ph,Address1=:ad1,Address2=:ad2,State=:st,City=:ct,PostalCode=:pc where ID=:user",
    "comment" : "UpdateInfoFromMyProfile",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : true,
    "queryParams" : [ {
      "paramName" : "fn",
      "paramType" : "java.lang.String",
      "testValue" : "Test",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "ln",
      "paramType" : "java.lang.String",
      "testValue" : "User3",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "em",
      "paramType" : "java.lang.String",
      "testValue" : "Test.User3@gmail.com",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "ph",
      "paramType" : "java.lang.String",
      "testValue" : "36535656",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "ad1",
      "paramType" : "java.lang.String",
      "testValue" : "dfad",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "ad2",
      "paramType" : "java.lang.String",
      "testValue" : "adad",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "st",
      "paramType" : "java.lang.String",
      "testValue" : "adad",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "ct",
      "paramType" : "java.lang.String",
      "testValue" : "adad",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "pc",
      "paramType" : "java.lang.String",
      "testValue" : "1313",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "user",
      "paramType" : "java.lang.Integer",
      "testValue" : "42",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2UpdateInfoFromMyProfilertnType",
    "returnTypeMetadata" : { }
  }, {
    "name" : "UpdatePasswordAndCF",
    "query" : "UPDATE Users SET Password=:password, CommunicationFrequency=:cf where ID=:newUser",
    "comment" : "UpdatePasswordAndCF",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : true,
    "queryParams" : [ {
      "paramName" : "password",
      "paramType" : "java.lang.String",
      "testValue" : "civicxpress",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "cf",
      "paramType" : "java.lang.String",
      "testValue" : "civicxpress",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    }, {
      "paramName" : "newUser",
      "paramType" : "java.lang.Integer",
      "testValue" : "3",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2UpdatePasswordAndCFrtnType",
    "returnTypeMetadata" : { }
  }, {
    "name" : "UserCount",
    "query" : "select count(*) as usersCount from Users",
    "comment" : "UserCount",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : false,
    "queryParams" : [ ],
    "outputType" : "cx2UserCountrtnType",
    "returnTypeMetadata" : {
      "usersCount" : "java.lang.Integer"
    }
  }, {
    "name" : "userSubscriptionsCount",
    "query" : "select count(*) as userSubscriptionsCount from UserSubscriptions",
    "comment" : "userSubscriptionsCount",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : false,
    "queryParams" : [ ],
    "outputType" : "cx2userSubscriptionsCountrtnType",
    "returnTypeMetadata" : {
      "userSubscriptionsCount" : "java.lang.Integer"
    }
  }, {
    "name" : "userSubscriptionsCountForMunicipality",
    "query" : "select count(*) as userSubscriptionsCountForMunicipality from UserSubscriptions where MunicipalityId=:municipalityId",
    "comment" : "userSubscriptionsCountForMunicipality",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : false,
    "queryParams" : [ {
      "paramName" : "municipalityId",
      "paramType" : "java.lang.Integer",
      "testValue" : "2",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2userSubscriptionsCountForMunicipalityrtnType",
    "returnTypeMetadata" : {
      "userSubscriptionsCountForMunicipality" : "java.lang.Integer"
    }
  }, {
    "name" : "verifyPasswordResetToken",
    "query" : "select * from UserPasswordResetTokens WHERE( ExpirationDate >= GETDATE() AND Token = :token)",
    "comment" : "Given a token, Validates token based on expiration date. Null returned if no tokens match or expiration date is past.",
    "description" : null,
    "nativeSql" : true,
    "returnsSingleResult" : false,
    "update" : false,
    "queryParams" : [ {
      "paramName" : "token",
      "paramType" : "java.lang.String",
      "testValue" : "asdfadsfasdfasd",
      "systemParamName" : null,
      "systemParam" : false,
      "list" : false
    } ],
    "outputType" : "cx2verifyPasswordResetTokenrtnType",
    "returnTypeMetadata" : {
      "ExpirationDate" : "java.sql.Date",
      "ID" : "java.math.BigDecimal",
      "Token" : "java.lang.String",
      "UserId" : "java.math.BigDecimal"
    }
  } ]
}